generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

enum ContentTypes {
  OFFICIAL
  CUSTOM
}

enum Status {
  DRAFT
  PUBLISHED
  ARCHIVED
}

/////////////////// ATTRIBUTE //////////////////////

model Attribute {
  refId               String       @id @default(uuid())
  id                  String       @unique // ID for versioning or app-level tracking
  version             Int // per id
  positive            Boolean
  name                String
  description         String
  balance             Json
  thresholds          Json
  settlementPointCost Json
  icon                Json
  tags                String[] // Array of strings for tags
  isValid             Boolean
  status              Status
  contentType         ContentTypes // for separating official from custom content
  createdBy           String // Potential foreign key to User model in the future
  collaborators String[]
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  @@index([contentType])
  @@index([tags])
  @@index([id, updatedAt(sort: Desc)])
}

////////////////// CATEGORY //////////////////////////

model Category {
  refId        String       @id @default(uuid())
  id           String       @unique // ID for versioning or app-level tracking
  version      Int // per id
  name         String
  description  String
  attributes   Json
  thresholds   Json
  dependencies Json
  tags         String[]
  isValid      Boolean
  status       Status
  contentType  ContentTypes
  createdBy    String
  collaborators String[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  @@index([contentType])
  @@index([tags])
  @@index([id, updatedAt(sort: Desc)])
}

////////////////// EVENT //////////////////////////

model Event {
  refId           String       @id @default(uuid())
  id              String       @unique // ID for versioning or app-level tracking
  version         Int // per id
  name            String
  description     String
  flavorText      Json
  narrativeWeight String?
  phases          Json
  replacement     Json
  links           String[]
  entryPhaseId    String
  isValid         Boolean
  status          Status
  contentType     ContentTypes
  createdBy       String
  collaborators String[]
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

  //flavorText:
  //trivial: string,
  //minor: string,
  //...
  //significant: string

  //phases:
  //[
  //  {
  //    type: 'active / immediate / passive / indefinite'
  //    impacts: see-below,
  //    length: 0+,
  //    productivity: 0+,
  //  },
  //]

  //resolutions:
  //[
  //{
  //uuid():
  //{
  //name:
  //description:
  //impacts:
  //}
  //}
  //]

    @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])
}

////////////////// LISTENER //////////////////////////

model Listener {
  refId               String       @id @default(uuid())
  id                  String       @unique // ID for versioning or app-level tracking
  version             Int // per id
  name                String
  description         String
  conditionEventPairs Json
  active              Boolean?
  isValid             Boolean
  status              Status
  contentType         ContentTypes
  createdBy           String
  collaborators String[]
  createdAt           DateTime     @default(now())
  updatedAt           DateTime     @updatedAt

  //conditions:
  //array of logic objects, eg:
  //  [
  //    {
  //    logic: 'none',
  //   condition: {
  //     attribute_base_id: value
  //   }
  // },
  // {
  //  logic: 'and',
  // condition: {
  //  attribute_base_id: value,
  // attribute_base_id: value,
  // }
  // }
  // ]
  @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])
}


/////////////////// KITS //////////////////////////

model Kit {
  refId       String       @id @default(uuid())
  id          String       @unique
  name        String
  data        Json
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
}

/////////////////// KEYS ///////////////////////////

model Key {
  refId       String        @id @default(uuid())
  id          String        @unique
  name        String        @unique
  version     Int
  description String?
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt
  backLinks   KeySettings[] // just want keySetting ids

  @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])
}

model KeySettings {
  id               String       @id @default(uuid())
  refId            String
  delay            Int
  duration         Int
  durationType     String
  severityOverTime Json
  contentType      ContentTypes
  createdBy        String
  collaborators String[]
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  key              Key          @relation(fields: [refId], references: [refId], onDelete: Cascade)
}

////////////////// STATUS //////////////////////////
enum StatusType {
  Weather
  Morale
  Settlement
}

enum StatusMode {
  Simple
  Advanced
}

model gameStatus {
  refId       String       @id @default(uuid())
  id          String       @unique // ID for versioning or app-level tracking
  version     Int // per id
  name        String
  description String
  type        StatusType
  steps       Json
  mode        StatusMode
  isValid     Boolean
  status      Status
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

    @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])
}

////////////////// BUILDING //////////////////////////

model Building {
  refId        String       @id @default(uuid())
  id           String       @unique // ID for versioning or app-level tracking
  version      Int // per id
  name         String
  description  String
  metrics      Json
  attributes   String[]
  upgradeTree  Json?
  initialCost  Json
  impacts      Json
  flavorText   String?
  dependencies String[]
  isValid      Boolean
  status       Status[]
  contentType  ContentTypes
  createdBy    String
  collaborators String[]
  createdAt    DateTime     @default(now())
  updatedAt    DateTime     @updatedAt

  //upgrades:
  //upgrade_base_id
  //upgrade_ref_id

    @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])
}

////////////////// UPGRADE //////////////////////////
enum UpgradeType {
  Settlement
  Leadership
  Building
}

model Upgrade {
  refId       String       @id @default(uuid())
  id          String       @unique // ID for versioning or app-level tracking
  version     Int // per id
  name        String
  description String
  root        String
  nodes       Json
  isValid     Boolean
  status      Status
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

  //impact:
  //attribute_base_id: value
  //ability:
  //description of skill. eg, 'Adaptive Resources: If losing an attribute in one category, you can spend from another at a 1:1 settlement point cost ratio. E.g., if losing 3 food, you could lose 1 medical supply instead. Once per turn.'

////////////////// TRADE HUB //////////////////////////

model TradeHub {
  refId       String       @id @default(uuid())
  id          String       @unique // ID for versioning or app-level tracking
  version     Int // per id
  name        String
  description String
  stock       Json
  region      String
  location    String
  trend       String
  trendRange  Int[]
  faction     String?
  isValid     Boolean
  status      Status
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])


  // region pulls from narrative data
  // location pulls from narrative data
  // stock:
  // attribute_base_id
  // attribute name
  // number
  // trend: tuple (eg, -1, 1) for weekly loss/gain limit (0, 2) would be increasing, (-5, -2) would be decreasing
}

////////////////// SETTLEMENT TYPE //////////////////////////

model SettlementType {
  refId       String       @id @default(uuid())
  id          String       @unique // ID for versioning or app-level tracking
  version     Int // per id
  name        String
  description String
  upgrades    String[]
  isValid     Boolean
  status      Status
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////////// SETTLEMENT //////////////////////////

model Settlement {
  refId         String       @id @default(uuid())
  id            String       @unique // ID for versioning or app-level tracking
  version       Int // per id
  name          String
  stats         Json
  population    Json
  categories    Json
  buildings     Json
  eventLog      Json
  narrativeData String // foreign key later
  isValid       Boolean
  contentType   ContentTypes
  createdBy     String
  collaborators String[]
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])


  //stats includes:
  // level
  // health
  // gold (currency?)
  // calendar id

  //pop includes:
  // DM (array)
  // players (array)
  // residents (array)
  // aristocrats (array)

  //categories includes:
  //category_refId:
  // bonus
  // attribute refId:
  // current
  // bonus

  //eventLog includes:
  // eventId keys:
  // narrative data selections (array of details in [[description tag]] order)
  // impacts
  // dates (irl && calendar)
}

////////////// APT ////////////

model APT {
  refId           String       @id @default(uuid())
  id              String       @unique
  version         Int
  name            String
  description     String
  display         Json
  eventThresholds Json
  progressType    String
  decay           Int
  contentType     ContentTypes
  createdBy       String
  collaborators String[]
  createdAt       DateTime     @default(now())
  updatedAt       DateTime     @updatedAt

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////// Action ////////////

model Action {
  refId       String       @id @default(uuid())
  id          String       @unique
  version     Int
  name        String
  description String
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  effects     Json
  conditions  Json?
  cooldown    String?
  flavorText  String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////// StoryThread ////////////

model StoryThread {
  refId       String       @id @default(uuid())
  id          String       @unique
  version     Int
  name        String
  description String
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime     @default(now())
  updatedAt   DateTime     @updatedAt
  origin      Json
  primaryKey  Json

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////// Glossary /////////////

enum GlossShape {
  folder
  file
}

enum EntryTypes {
  continent
  territory
  domain
  province
  landmark
  settlement
  faction
  location
  person
  note
  event
}

enum ClimateTypes {
  tropical
  arid
  temperate
  polar
  subtropical
  continental
  icecap
}

enum TerrainTypes {
  forests
  mountains
  deserts
  swamps
  plains
  hills
  valleys
  plateaus
  tundra
  badlands
  coastal
  volcanic
  glacial
  taiga
}

enum GeographicTypes {
  forest
  mountain
  river
  lake
  ocean
  desert
  swamp
  cave
  hill
  plain
  valley
  plateau
  island
  archipelago
  peninsula
  bay
  gulf
  fjord
  volcano
  glacier
  canyon
  steppe
  march
  wetland
  reef
  delta
  atoll
}

model Glossary {
  id          String         @id @default(uuid())
  name        String
  description Json?
  createdBy   String
  collaborators String[]
  createdAt   DateTime       @default(now())
  updatedAt   DateTime       @updatedAt
  editors     String[]
  contentType ContentTypes
  nodes       GlossaryNode[]
  theme       String

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

model GlossaryTheme {
  id           String @id @default(uuid())
  refId        String
  name         String
  createdBy    String
  collaborators String[]
  createdAt    DateTime @default(now())
  updatedAt    DateTime @updatedAt
  contentType  ContentTypes
  description  String
  palettes     Json
  glossaries   String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

model GlossaryNode {
  id         String         @id @default(uuid())
  name       String
  entryType  EntryTypes?
  type       GlossShape
  icon       Json?
  parentId   String?
  children   GlossaryNode[] @relation("NodeHierarchy")
  parent     GlossaryNode?  @relation("NodeHierarchy", fields: [parentId], references: [id], onDelete: Cascade)
  glossaryId String
  glossary   Glossary       @relation(fields: [glossaryId], references: [id], onDelete: Cascade)
  sortIndex  Int            @default(0)

  @@index([id])

}

////////////// Territory ////////////

model TerritoryGlossary {
  refId            String       @id @default(uuid())
  id               String       @unique
  version          Int
  name             String
  description      Json
  dataString  String
  contentType      ContentTypes
  createdBy        String
  collaborators String[]
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  tags             String[]
  climates          String[]
  terrain          TerrainTypes[]
  nations          String[]
  factions         String[]
  population       Json
  locations        String[]
  landmarks         String[]
  resources        String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

//////////////////// Province //////////////

model ProvinceGlossary {
  refId            String       @id @default(uuid())
  id               String       @unique
  version          Int
  name             String
  description      Json
  dataString  String
  contentType      ContentTypes
  createdBy        String
  collaborators String[]
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  tags             String[]
  nation           String?
  terrain          TerrainTypes[]
  locations        String[]
  landmarks        String[]
  people           String[]
  notableEvents    String[]
  resources        String[]
  population       Json

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////// Location ////////////

model LocationGlossary {
  refId            String       @id @default(uuid())
  id               String       @unique
  version          Int
  name             String
  description      Json
  dataString  String
  contentType      ContentTypes
  createdBy        String
  collaborators String[]
  createdAt        DateTime     @default(now())
  updatedAt        DateTime     @updatedAt
  tags             String[]
  locationType             String?
  region           String?
  currentOccupants String[]
  nearbyFeatures   Json?
  eventLog         String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////// Person ////////////

model PersonGlossary {
  refId         String       @id @default(uuid())
  id            String       @unique
  version       Int
  name          String
  description   Json
  dataString  String
  contentType   ContentTypes
  createdBy     String
  collaborators String[]
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  tags          String[]
  occupations    String[]
  titles         String[]
  traits        String[]
  factions       String[]
  locations      String[]
  relationships Json
  notoriety     String

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////// Faction ////////////

model FactionGlossary {
  refId          String       @id @default(uuid())
  id             String       @unique
  version        Int
  name           String
  description    Json
  dataString  String
  contentType    ContentTypes
  createdBy      String
  collaborators String[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  tags           String[]
  leaders         String[]
  homeBases       String[]
  relationships  Json
  allies         String[]
  enemies        String[]
  influence      Int?
  notoriety      Int?
  cultureTags    String[]
  activeKeys     String[]
  passiveBonuses Json

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

////////////// Note ////////////
model NoteGlossary {
  refId          String       @id @default(uuid())
  id             String       @unique
  version        Int
  name           String
  description    Json
  dataString  String
  contentType    ContentTypes
  createdBy      String
  collaborators String[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  type           String?
  priority       String?
  dueDate        String?
  relatedEntries Json
  tags           String[]
  isArchived     Boolean
  isPinned       Boolean
  isShared       Boolean
  sharedWith     String[]
  attachments    Json

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

/////////////////// continent //////////
model ContinentGlossary {
  refId            String            @id @default(uuid())
  id               String            @unique
  version          Int
  name             String
  description      Json
  dataString  String
  contentType      ContentTypes
  createdBy        String
  collaborators String[]
  createdAt        DateTime          @default(now())
  updatedAt        DateTime          @updatedAt
  nations          String[]
  regions          String[]
  locations        String[]
  resources        String[]
  landmarks        String[]
  population       Json
  climates          ClimateTypes[]
  terrain          TerrainTypes[]
  eventLog         String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

/////////////////// Domain ///////////////
model DomainGlossary {
  refId         String       @id @default(uuid())
  id            String       @unique
  version       Int
  name          String
  description   Json
  dataString  String
  contentType   ContentTypes
  createdBy     String
  collaborators String[]
  createdAt     DateTime     @default(now())
  updatedAt     DateTime     @updatedAt
  continents     String[]
  regions       String[]
  capitals       String[]
  population    Json
  economy       Json
  cultures       Json
  languages     String[]
  persons       String[]
  eventLog      String[]
  flags         String[]
  history       String[]
  relationships Json
  locations     String[]
  landmarks     String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

///////////////////// settlementGlossary //////////////
model SettlementGlossary {
  refId          String       @id @default(uuid())
  id             String       @unique
  version        Int
  name           String
  description    Json
  contentType    ContentTypes
  createdBy      String
  collaborators String[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  nations         String?
  regions         String?
  persons        String[]
  eventLog       String[]
  locations      String[]
  history        Json
  relationships  Json

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

///////////////////// eventGlossary //////////////
model EventGlossary {
  refId          String       @id @default(uuid())
  id             String       @unique
  version        Int
  name           String
  description    Json
  dataString  String
  contentType    ContentTypes
  createdBy      String
  collaborators String[]
  createdAt      DateTime     @default(now())
  updatedAt      DateTime     @updatedAt
  significance   String?
  gameDate       String?
  frequency      String?
  locations       String[]     //includes more than just the location model
  relatedEntries String[]
  tags           String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}

///////////////////// landmarkGlossary //////////////
model LandmarkGlossary {
  refId       String          @id @default(uuid())
  id          String          @unique
  version     Int
  name        String
  description Json
  dataString  String
  contentType ContentTypes
  createdBy   String
  collaborators String[]
  createdAt   DateTime        @default(now())
  updatedAt   DateTime        @updatedAt
  regions      String[]
  climates     ClimateTypes?
  terrain     TerrainTypes?
  type        GeographicTypes
  eventLog    String[]

      @@index([contentType])
  @@index([id, updatedAt(sort: Desc)])

}
