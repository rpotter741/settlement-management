import{F as ne,j as r,a0 as W,aa as B,ak as se,bl as oe,ac as q,r as u,bm as ie,ar as ce,bn as pe,b0 as ue,R as N,a1 as j,ay as U,a4 as X,_ as A,G as _,U as Z,a6 as de,f as me,K as Y,I as ye,H as he,T as H,a2 as J,aF as fe,aA as be,bo as ge,b1 as xe,bp as ee,i as D,W as V,bq as ve,br as ke,bs as te,bt as Se,bu as Ce,bv as je,bw as Ee,bx as Te,ai as Le}from"./main.js";import{P as Q,S as Ae,u as G}from"./PageBox.js";import{t as $}from"./glossaryThunks.js";import{g as we}from"./hasParentProperty.js";import{A as Pe,T as Oe}from"./TabbedContent.js";const Me=ne(r.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle"),Ge=(e,t)=>{try{const a=localStorage.getItem(e);return a?JSON.parse(a):null}catch(a){return console.error("Error getting local storage item:",a),t??null}},Re=(e,t)=>{try{localStorage.setItem(e,JSON.stringify(t))}catch(a){console.error("Error setting local storage item:",a)}},Be=e=>{try{localStorage.removeItem(e)}catch(t){console.error("Error removing local storage item:",t)}},Ne=e=>({get:t=>Ge(e,t),set:t=>Re(e,t),remove:()=>Be(e)}),z=(e,t)=>{const a=W(),l=B(se(e,t)),i=B(oe(e,t)),d=B(q(e));console.log(d),u.useEffect(()=>{!i&&(l!=null&&l.entryType)&&a($.getEntryById({node:l}))},[a,t,e,l==null?void 0:l.entryType,i]);const s=u.useCallback(p=>{a($.updateEntryById({glossaryId:e,entryId:t,content:p}))},[a,e,t]),v=u.useCallback(({subModel:p,keypath:T,data:w,tabId:M})=>{console.log(M,"tabId in updateSubModel"),a($.updateEntrySubModelById({glossaryId:e,entryId:t,subModel:p,keypath:T,data:w,tabId:M}))},[a,e,t]),k=u.useCallback((p,T)=>a($.getOptionsByProperty({glossaryId:e,entryId:t,property:p,inheritanceMap:T})),[e,t]),x=p=>B(ie(e,t,p)),y=p=>{i[p]||a($.getEntrySubModel({glossaryId:e,entryId:t,entryType:l.entryType,subModel:p}))},f=Ne(`${e}-${t}`),n=u.useCallback(()=>f.get(),[e,t]),m=u.useCallback(p=>{f.set(p)},[e,t]),o=u.useCallback(()=>{f.remove()},[e,t]),h=u.useCallback(()=>{const p=f.get();if(!p)return!1;const T=new Date((i==null?void 0:i.updatedAt)||0);return new Date((p==null?void 0:p.updatedAt)||0)>T},[e,t]);return{node:l,entry:i,buildOptionsByKeypath:k,getOptionsByKeypath:x,updateGlossaryEntry:s,getLocalStorage:n,setLocalStorage:m,clearLocalStorage:o,localIsNewer:h,getSubModel:y,updateSubModel:v}},De=({tab:e,editComponent:t,editComponentProps:a,previewComponent:l,previewComponentProps:i})=>{const d=W(),{showModal:s,closeModal:v}=ce(),{tool:k,id:x,mode:y,side:f,tabId:n,glossaryId:m,tabType:o}=e;console.log(e);const h=g=>{const C=j.cloneDeep(e.viewState.lastSaved||{});C[g]=new Date().toISOString(),d(U({tabId:n,side:f,keypath:"viewState.lastUpdated",updates:C}))};if(!m)return null;const{node:p,entry:T}=z(m,x);console.log(p,T,m,x);const w=B(pe(m)),M=u.useMemo(()=>p?we({node:p,nodeStructure:w}):{},[p,w]),{splitSize:R,soloSize:b,splitTabs:S}=ue(),c=u.useMemo(()=>({tab:e,tool:k,id:x,mode:y,side:f,tabId:n,glossaryId:m,entry:T,node:p,inheritanceMap:M,updateLastSaved:h,showModal:s,closeModal:v}),[e,k,x,y,f,n,m,T,h,s,v,p,M]);return T?r.jsx(Ae.Provider,{value:c,children:r.jsx(Q,{variant:S?R?"default":"blend":b?"blend":"default",tabType:"glossary",mode:y,children:y==="edit"&&t?N.createElement(t,{...a}):y==="preview"&&l?N.createElement(l,{...i}):r.jsx("div",{style:{padding:"16px"},children:"Yo shit is busted, bruh"})})}):r.jsx(Q,{mode:y,variant:"default",children:"Loading..."})},ae=({multiple:e=!0,subModel:t,label:a,keypath:l,alphabetizeOptions:i=!0,hasPrimary:d=!1,placeholder:s})=>{const{glossaryId:v,id:k,inheritanceMap:x,tabId:y}=G();if(!v)return null;const{entry:f,updateSubModel:n,getOptionsByKeypath:m,buildOptionsByKeypath:o}=z(v,k),h=m(l);u.useEffect(()=>{h||o(l,x)},[l,h]);const[p,T]=N.useState(d?"Aymaq":""),w=N.useRef(null);function M(c,g){const C=new Map,L={inherited:1,nearby:2,extended:3,other:4};for(const E of Object.keys(L))for(const P of c[E]??[]){const K=(Array.isArray(P[g]),P[g]);if(K)for(const F of K)if(C.has(F)){const I=C.get(F);I.sources.push({id:P.id,name:P.name,relationship:E});const le=L[E],re=L[I.group];console.log(le,re,"tier and existingTier"),L[E]<L[I.group]&&(console.log("Updating group for",F,"from",I.group,"to",E),I.group=E)}else C.set(F,{value:F,label:F,group:E,sources:[{id:P.id,name:P.name,relationship:E}]})}return[...C.values()].map(E=>({...E,label:j.capitalize(E.label),group:j.capitalize(E.group)}))}u.useMemo(()=>h?Object.entries(h).flatMap(([c,g])=>g.map(C=>({label:j.capitalize(C[l]),value:C[l],group:j.capitalize(c),meta:{id:C.id[0],name:C.name}}))):[],[h,l]);const R=c=>{var g;Array.isArray(c)&&(d&&(c.includes(p)||(c=[p,...c])),c=c.map(C=>C.trim().toLowerCase())),n({subModel:t,keypath:l,data:c,tabId:y}),e&&((g=w.current)==null||g.focus())},b=h?M(h,l):[],S=u.useMemo(()=>{var c,g;return(g=(c=f==null?void 0:f[t])==null?void 0:c[l])==null?void 0:g.map(C=>({label:j.capitalize(C)}))},[f,t,l]);return f[t]?r.jsx(X,{freeSolo:!0,disablePortal:!0,multiple:e,options:b,groupBy:c=>c.group,value:S??[],disableCloseOnSelect:e,onChange:(c,g)=>{g===null?R(e?[]:""):Array.isArray(g)?R(g.map(C=>C.label)):R([g.label])},renderInput:c=>r.jsx(Y,{...c,inputRef:w,label:a,variant:"outlined",fullWidth:!0,slotProps:{inputLabel:{shrink:!0}}}),renderTags:(c,g)=>c.map((C,L)=>u.createElement(de,{label:C,...g({index:L}),key:C.value,sx:{mr:.5,mb:.5,backgroundColor:E=>me(E.palette.primary.main,E.palette.mode==="dark"?.5:.9),color:"primary.contrastText"}})),blurOnSelect:!e,getOptionLabel:c=>{var g;return((g=c[0])==null?void 0:g.label)||""},renderOption:(c,g,{selected:C})=>{const L=g.value===p,P=C&&!L;return u.createElement(A,{component:"li",...c,key:g.value,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",position:"relative"}},r.jsxs(A,{children:[e&&d&&r.jsx(_,{title:L?`This is the current primary ${l}.`:P?`Make ${g} the primary ${l}`:"",children:r.jsx("span",{children:r.jsx(Z,{checked:L,disabled:!P&&!L,onClick:K=>K.stopPropagation(),onChange:()=>T(g),disableRipple:!0,tabIndex:-1,sx:{mr:1}})})}),j.capitalize(g.label)]}))}}):r.jsx("div",{children:"Loading..."})},ze=[{name:"Geography",children:[{multiple:!1,component:ae,keypath:"climates"},{multiple:!0,keypath:"terrain"},{multiple:!0,keypath:"regions"}]},{name:"Politics",children:[{multiple:!0,keypath:"nations",label:"Nations"},{multiple:!0,keypath:"settlements",label:"Settlements"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"resources",label:"Resources"},{multiple:!1,keypath:"population",label:"Population"}]},{name:"History",children:[{multiple:!0,keypath:"events",label:"Event Log"},{multiple:!1,keypath:"history",label:"History"}]}],O=e=>e,Fe=O([{name:"Geography",children:[{multiple:!1,keypath:"climates",label:"Climates",hasPrimary:!0},{multiple:!0,keypath:"terrain",label:"Terrain"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"landmarks",label:"Landmarks"}]},{name:"Political",children:[{multiple:!0,keypath:"nations",label:"Nations",hasPrimary:!0},{multiple:!0,keypath:"factions",label:"Factions",hasPrimary:!1},{multiple:!1,keypath:"population",label:"Population"},{multiple:!0,keypath:"resources",label:"Resources"}]}]),$e=O([{name:"Government",children:[{multiple:!0,keypath:"capital",label:"Capital"},{multiple:!1,keypath:"governmentType",label:"Government Type"},{multiple:!1,keypath:"population",label:"Population"},{multiple:!0,keypath:"notableFigures",label:"Notable Figures"},{multiple:!1,keypath:"culture",label:"Culture"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"languages",label:"Languages"},{multiple:!1,keypath:"economy",label:"Economy"},{multiple:!0,keypath:"resources",label:"Resources"}]},{name:"Geography",children:[{multiple:!0,keypath:"continent",label:"Continents"},{multiple:!0,keypath:"regions",label:"Regions"},{multiple:!0,keypath:"geography",label:"Landmarks"}]},{name:"History",children:[{multiple:!1,keypath:"history",label:"History"},{multiple:!0,keypath:"notableEvents",label:"Notable Events"},{multiple:!0,keypath:"flags",label:"Flags"}]}]),He=O([{name:"Geography",children:[{multiple:!0,keypath:"terrain",label:"Terrain"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"landmarks",label:"Landmarks"}]},{name:"Political",children:[{multiple:!0,keypath:"nations",label:"Nations"},{multiple:!0,keypath:"resources",label:"Resources"},{multiple:!1,keypath:"population",label:"Population"},{multiple:!0,keypath:"people",label:"People"}]},{name:"History",children:[{multiple:!0,keypath:"eventLog",label:"Event Log"}]}]),Ie=O([{name:"Geography",children:[{multiple:!1,keypath:"climates",label:"Climate"},{multiple:!0,keypath:"regions",label:"Region",hasPrimary:!0},{multiple:!1,keypath:"geographicType",label:"Type"}]},{name:"Notes",children:[{multiple:!1,keypath:"notes",label:"Notes"}]}]),Ue=O([{name:"Geopolitical",children:[{multiple:!0,keypath:"nation",label:"Nation"},{multiple:!0,keypath:"region",label:"Region"},{multiple:!1,keypath:"population",label:"Population"}]},{name:"Government",children:[{multiple:!1,keypath:"government",label:"Government"},{multiple:!1,keypath:"type",label:"Settlement Type"},{multiple:!1,keypath:"economy",label:"Economy"},{multiple:!1,keypath:"culture",label:"Culture"},{multiple:!0,keypath:"people",label:"Notable Figures"}]},{name:"History",children:[{multiple:!0,keypath:"events",label:"Notable Events"},{multiple:!0,keypath:"locations",label:"Notable Locations"},{multiple:!1,keypath:"history",label:"History"}]}]),We=O([{name:"Roster",children:[{multiple:!0,keypath:"leader",label:"Leader"},{multiple:!0,keypath:"homeBase",label:"Home Base"},{multiple:!0,keypath:"members",label:"Members"}]},{name:"Geopolitical",children:[{multiple:!0,keypath:"nations",label:"Nations"},{multiple:!0,keypath:"regions",label:"Regions"}]},{name:"Relationships",children:[{multiple:!0,keypath:"allies",label:"Allies"},{multiple:!0,keypath:"enemies",label:"Enemies"}]}]),Ke=O([{name:"Profession",children:[{multiple:!1,keypath:"occupation",label:"Occupation"},{multiple:!1,keypath:"title",label:"Title"}]},{name:"Background",children:[{multiple:!0,keypath:"traits",label:"Traits"},{multiple:!0,keypath:"faction",label:"Faction"},{multiple:!1,keypath:"history",label:"History"}]},{name:"Details",children:[{multiple:!0,keypath:"location",label:"Location"},{multiple:!1,keypath:"appearance",label:"Appearance"},{multiple:!1,keypath:"events",label:"Events"}]}]),qe=O([{name:"Details",children:[{multiple:!1,keypath:"locationType",label:"Type"},{multiple:!0,keypath:"currentOccupants",label:"Current Occupants"},{multiple:!0,keypath:"resources",label:"Resources"}]},{name:"History",children:[{multiple:!0,keypath:"eventLog",label:"Event Log"}]}]),_e=O([{name:"Details",children:[{multiple:!1,keypath:"type",label:"Type"},{multiple:!1,keypath:"priority",label:"Priority"},{multiple:!1,keypath:"dueDate",label:"Due Date"},{multiple:!0,keypath:"sharedWith",label:"Shared With"}]}]),Ye=O([{name:"Details",children:[{multiple:!1,keypath:"significance",label:"Significance"},{multiple:!1,keypath:"gameDate",label:"Game Date"},{multiple:!0,keypath:"location",label:"Location"},{multiple:!1,keypath:"frequency",label:"Frequency"}]},{name:"Related",children:[{multiple:!0,keypath:"relatedEntries",label:"Related Entries"}]}]),Je={continent:ze,territory:Fe,domain:$e,province:He,landmark:Ie,settlement:Ue,faction:We,person:Ke,location:qe,note:_e,event:Ye};function Ve(e){return[...e].sort((t,a)=>t.localeCompare(a))}const Qe=({multiple:e=!0,subModel:t,label:a,keypath:l,options:i,alphabetizeOptions:d=!0,hasPrimary:s=!1,placeholder:v})=>{const{glossaryId:k,id:x}=G();if(!k)return null;const[y,f]=N.useState(""),{entry:n,updateSubModel:m}=z(k,x),[o,h]=N.useState(s?"Aymaq":""),p=N.useRef(null),T=u.useMemo(()=>{let b=i.filter(S=>n[l]?Array.isArray(n[l])?!n[l].some(c=>c.toLowerCase()===S.toLowerCase()):n[l].toLowerCase()!==S.toLowerCase():!0);return d?Ve(b).map(S=>S):b.map(S=>j.capitalize(S))},[i]),w=u.useMemo(()=>{if(!n[l])return[];const b=Array.isArray(n[l])?n[l]:[n[l]];return[o,...b.filter(S=>S.toLowerCase()!==o)]},[n,l,o]),M=b=>{var S;if(e){const c=[...Array.isArray(n[t][l])?n[t][l]:n[t][l]?[n[t][l]]:[],b].flat();m({subModel:t,keypath:l,data:c}),e&&((S=p.current)==null||S.focus());return}else m({subModel:t,keypath:l,data:b})},R=b=>{let S=[];Array.isArray(n[t][l])?S=n[t][l]:typeof n[t][l]=="string"&&(S=[n[t][l]]);const c=S.filter(g=>g.toLowerCase()!==b.toLowerCase());m({subModel:t,keypath:l,data:c})};return r.jsxs(A,{sx:{display:"flex",flexDirection:"column",width:"100%",my:2},children:[r.jsx(X,{options:T,freeSolo:!0,disableCloseOnSelect:!0,value:null,inputValue:y,blurOnSelect:!1,clearOnBlur:!0,onInputChange:(b,S)=>f(S),onChange:(b,S)=>{S&&M(S),f(""),setTimeout(()=>{var c;return(c=p.current)==null?void 0:c.focus()})},renderInput:b=>r.jsx(Y,{...b,inputRef:p,placeholder:`Search for ${a}â€¦`,variant:"outlined",fullWidth:!0}),clearOnEscape:!0,selectOnFocus:!0,handleHomeEndKeys:!0,getOptionLabel:b=>j.capitalize(b),renderOption:(b,S)=>u.createElement(A,{component:"li",...b,key:S,sx:{px:1}},j.capitalize(S))}),r.jsx(A,{children:e?w.length>0?r.jsx(A,{sx:{display:"flex",flexDirection:"column",gap:.5,mt:1},children:w.map((b,S)=>r.jsxs(A,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"100%",position:"relative"},children:[r.jsx(ye,{onClick:()=>R(b),disabled:o===b.toLowerCase(),children:r.jsx(he,{sx:{color:o===b.toLowerCase()?"transparent":"inherit"}})}),s&&r.jsx(_,{title:`Click to set ${b} as primary`,placement:"auto",children:r.jsx(Z,{checked:o===b.toLowerCase(),onChange:()=>{o!==b&&h(b.toLowerCase())},disabled:o===b.toLowerCase(),sx:{mr:2}})}),r.jsx(H,{children:j.capitalize(b)})]},b))}):r.jsxs(A,{sx:{textAlign:"left",mt:1,ml:4,color:"text.secondary",fontStyle:"italic"},children:["No ",a," selected"]}):r.jsx(A,{sx:{mt:1,color:"text.secondary",fontStyle:"italic"},children:n[l]?`Selected: ${j.capitalize(n[t][l])}`:`No ${{label:a}} selected`})})]})};function Xe({glossaryId:e,subModel:t,entryId:a,tabId:l}){return async(i,d)=>{var s;try{const v=d(),k=v.glossary.glossaries.edit.byId[e],x=v.glossary.glossaries.static.byId[e];if(!x||!k){i(J({message:"Glossary not found.",type:"error",duration:3e3}));return}const y=v.tabs.left.data[l]||v.tabs.right.data[l],f=Object.keys(((s=y==null?void 0:y.viewState)==null?void 0:s.dirtyKeypaths)||{}).map(n=>{if(!n.startsWith(`entries.${a}.${t}.`))return null;const m=j.get(x,n),o=j.get(k,n),h=n.split(".").pop();if(o===void 0)return{key:h,value:null};if(m!==o)return{key:h,value:o};if(m===o)return null}).filter(n=>n!==null);if(f.length>0){const n={};f.forEach(m=>{const{key:o,value:h}=m;n[o]=h}),await fe.updateEntrySubModel({id:a,subModel:t,updates:n}),i(be({tabId:l,key:`entries.${a}.${t}`})),i(ge({glossaryId:e,entryId:a,subModel:t}))}}catch{i(J({message:"Error updating glossary entry. Try again later.",type:"error",duration:3e3}))}}}function Ze({glossaryId:e,subModel:t,entryId:a,tabId:l,name:i}){const d=W();return{name:i,batchSaveFn:async()=>{d(Xe({glossaryId:e,subModel:t,entryId:a,tabId:l}))},intervalMs:5e3}}const et=({subModel:e,propertyMap:t})=>{const a=u.useRef(!1),{glossaryId:l,id:i,tab:d}=G(),{entry:s,getSubModel:v}=z(l,i),k=B(q(l));u.useEffect(()=>{!s[e]&&!a.current&&(a.current=!0,v(e))},[s,e]),xe(Ze({glossaryId:l,subModel:e,entryId:i,tabId:d.tabId,name:`${d.name} - ${e}`}));const x=u.useMemo(()=>[...t],[t]);return r.jsx(r.Fragment,{children:x.map(y=>{const{label:f}=ee({glossary:k,subModel:e,key:y.keypath});return y.multiple?r.jsx(Qe,{subModel:e,multiple:!0,keypath:y.keypath,options:[],label:f},y.keypath):r.jsx(ae,{subModel:e,multiple:!1,keypath:y.keypath,options:[],label:f},y.keypath)})})},tt=({label:e,value:t,onSave:a,style:l={}})=>{const[i,d]=u.useState(t),[s,v]=u.useState(!1),k=i!==t;u.useEffect(()=>{d(t)},[t]);const x=()=>{a(i)},y=f=>{d(f.target.value)};return r.jsxs(D,{sx:{display:"flex",alignItems:"center",gap:2,...l},children:[r.jsx(Y,{label:e,variant:"outlined",value:i,onChange:y,disabled:!s,fullWidth:!0,slotProps:{input:{endAdornment:s?r.jsx(Me,{sx:{color:k?"error.main":"transparent",fontSize:".75rem"}}):null}}}),r.jsx(V,{variant:"contained",onClick:()=>{s&&x(),v(!s),s&&k&&d(t)},children:s?"Save":"Edit"}),r.jsx(V,{variant:"outlined",disabled:!s,onClick:()=>{d(t),v(!1)},children:"Cancel"})]})},at=j.debounce((e,t,a)=>{e({description:t,dataString:a.trim()})},1e3),lt=j.debounce((e,t)=>{e(t)},1e3),rt=({keypath:e,minHeight:t="300px",maxHeight:a="1015px",style:l={}})=>{var n,m;ve();const{entry:i,tab:d,updateLastSaved:s}=G(),{updateGlossaryEntry:v}=z(d.glossaryId,d.id),k=((m=(n=d==null?void 0:d.viewState)==null?void 0:n.lastUpdated)==null?void 0:m[e])||null,[x,y]=u.useState(i[e]||""),f=(o,h)=>{at(v,o,h),lt(s,e)};return r.jsxs(D,{sx:{display:"flex",flexDirection:"column",boxSizing:"border-box",border:"1px solid",borderColor:"divider"},children:[r.jsx(D,{className:"shell-editor",sx:{boxSizing:"border-box",display:"flex",flexDirection:"column",position:"relative",minHeight:t,maxHeight:a,overflowY:"scroll",height:"100%",...l},children:r.jsx(ke,{slotBefore:r.jsx(Se,{}),extensions:te,content:x,onUpdate:o=>{const h=o.editor.getHTML(),p=o.editor.getText();y(h),f(h,p)}})}),k&&r.jsxs(H,{variant:"caption",sx:{width:"100%",backgroundColor:o=>o.palette.mode==="dark"?"secondary.main":"secondary.light",borderTop:"1px solid",borderColor:"divider",color:o=>o.palette.mode==="dark"?"text.primary":"secondary.contrastText"},children:["Last Saved: ",Ce(k)]})]})},nt=()=>{const{glossaryId:e,id:t,tabId:a,side:l,mode:i}=G(),{updateGlossaryEntry:d,node:s}=z(e,t),v=W(),[k,x]=u.useState(s.name||""),y=u.useRef(!1);u.useEffect(()=>{k!==s.name&&(y.current=!0,d({name:k}),v(U({tabId:a,side:l,keypath:"name",updates:k})))},[k,v,a,l]),u.useEffect(()=>{if(y.current){y.current=!1;return}k!==s.name&&(x(s.name),v(U({tabId:a,side:l,keypath:"name",updates:s.name})))},[s.name]);const f=n=>{x(n),v(U({tabId:a,side:l,keypath:"name",updates:n})),v($.renameNodeAndEntry({node:s}))};return r.jsxs(r.Fragment,{children:[r.jsx(tt,{label:"Entry Title",value:k,onSave:f,style:{width:"100%",mb:2}}),r.jsx(rt,{keypath:"description",maxHeight:"500px"}),r.jsx(Pe,{})]})},st={Overview:nt},ot=[{name:"Overview",key:"overview",disabled:!1,props:{keypath:"description"}},{name:"Backlinks",key:"backlinks",disabled:!1,props:{propertyMap:[]}}],it=({propertyMap:e})=>{var f,n;const t=W(),{tab:a}=G(),l=B(q(a.glossaryId)),[i,d]=u.useState(((f=a==null?void 0:a.viewState)==null?void 0:f.activeTab)||"Overview"),[s,v]=u.useState(((n=a==null?void 0:a.viewState)==null?void 0:n.activeIndex)||0),k=u.useMemo(()=>a.side==="right"?"secondary":"primary",[a.side]);u.useEffect(()=>()=>{const m={...a.viewState,activeTab:i,activeIndex:s};t(U({tabId:a.tabId,side:a.side,keypath:"viewState",updates:m}))},[i,s]);const x=u.useMemo(()=>{const m=e.map(h=>({name:ee({glossary:l,subModel:h.name.toLowerCase(),key:`${j.capitalize(h.name)} Name`}).label,key:h.name,disabled:!1,props:{subModel:h.name.toLowerCase(),propertyMap:h.children}}));return ot.toSpliced(1,0,...m)},[e,l.integrationState]),y=u.useMemo(()=>x.reduce((m,o)=>(m[o.name]=st[o.name]||et||(()=>null),m),{}),[x]);return u.useEffect(()=>{var m,o,h;x.findIndex(p=>p.name===i)===-1&&d(((m=x[s])==null?void 0:m.name)??((h=x[(o=a==null?void 0:a.viewState)==null?void 0:o.activeIndex])==null?void 0:h.name)??"Overview")},[x,i]),r.jsx(Oe,{tabs:x,componentMap:y,activeTab:i,handleTabClick:(m,o)=>{d(m),v(o)},lastIndex:s,color:k})},ct=({height:e="100%"})=>{const{glossaryId:t,id:a,mode:l,side:i}=G(),{node:d}=z(t,a);return r.jsx(it,{propertyMap:Je[d.entryType]})},pt=({content:e})=>{const t=je({extensions:te,content:e,editable:!1});return r.jsx(A,{sx:{width:"100%",maxHeight:"calc(100vh - 200px)",overflowY:"auto",borderRadius:2},children:r.jsx(Ee,{editor:t})})},ut=({keypath:e,header:t})=>{const{entry:a}=G();return r.jsxs(D,{sx:{display:"flex",justifyContent:"start",alignItems:"start",mt:2,width:"100%",flexDirection:"column"},children:[r.jsx(H,{sx:{fontSize:"1.25rem",width:"100%",borderBottom:"1px solid",borderColor:"divider",textAlign:"left",fontWeight:600},children:t}),r.jsx(H,{sx:{fontSize:"1.1rem",width:"100%",textAlign:"left",ml:2},children:Array.isArray(a[e])?a[e].map(l=>j.capitalize(l)).join(", "):j.capitalize(a[e])||"No data available"})]})},dt={nations:"Nations",regions:"Regions",locations:"Locations",resources:"Resources",population:"Population",climate:"Climate",terrain:"Terrain",capital:"Capital",languages:"Languages",persons:"Persons",eventLog:"Event Log",geography:"Geography",type:"Type",region:"Regions",landmark:"Landmark",settlement:"Settlement",faction:"Faction",person:"Person",event:"Event",note:"Note"},mt=({keypathArray:e})=>r.jsxs(D,{sx:{width:"100%",p:2,borderLeft:"1px solid",borderColor:"divider"},children:[r.jsx(D,{sx:{width:"100%",display:"flex",justifyContent:"start",alignItems:"center",borderBottom:"1px solid",borderColor:"primary.main",flexWrap:"wrap"},children:Te.map(t=>{const a=(Math.random()*(10*Math.random())).toFixed(0),l=a==="1"?"Backlink":"Backlinks";return Number(a)<1?null:r.jsx(_,{title:`${a} ${j.capitalize(t)} ${l}`,children:r.jsxs(D,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:1,cursor:"pointer"},children:[Le[t],r.jsxs(H,{variant:"body2",sx:{mt:.5},children:["(",a,")"]})]})},t)})}),e.map(t=>r.jsx(ut,{keypath:t,header:dt[t]},t))]}),yt={continent:["nations","regions","locations","resources","population","climate","terrain"],territory:[],domain:["continent","regions","capital","population","languages","persons","eventLog","locations","geography"],province:[],landmark:["region","climate","type"],settlement:[],faction:[],location:["terrain","climate","type","region"],person:[],event:[],note:[]},ht=()=>{const{entry:e,node:t}=G(),{entryType:a}=t;return r.jsxs(A,{sx:{display:"grid",height:"100%",width:"100%",gridTemplateColumns:"2fr 1fr"},children:[r.jsxs(A,{sx:{width:"100%",py:2,borderColor:"divider",display:"flex",flexDirection:"column"},children:[r.jsx(H,{variant:"h2",sx:{mb:2},children:e.name}),r.jsx(pt,{content:e.description})]}),r.jsx(mt,{keypathArray:yt[a]})]})},kt=({tab:e})=>r.jsx(De,{tab:e,editComponent:ct,editComponentProps:{},previewComponent:ht,previewComponentProps:{}});export{kt as default};
