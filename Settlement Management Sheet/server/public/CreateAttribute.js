import{r as j,G as Dt,H as Le,I as zt,J as Ft,K as nt,L as He,M as st,N as ut,O as We,P as gt,Q as xt,R as ge,j as a,S as yt,U as Nt,V as oe,W as J,X as H,Y as Ct,_ as ee,$ as Xe,a0 as lt,a1 as ct,n as _e,a2 as kt,a3 as ot,a4 as Vt,a5 as wt,v as Ne,c as xe,a6 as Ot,d as St,C as me,T as F,B as I,a7 as Bt,a8 as Ut,A as qt,g as Gt,a9 as fe,aa as Ht,ab as Wt,u as Tt,ac as _t,ad as Yt,ae as jt,af as Xt,ag as pt}from"./main.js";import{i as Kt}from"./iconList.js";import{S as Lt,u as Pt,a as we}from"./PageBox.js";import{T as ve,I as Jt}from"./ToolInput.js";import{T as Qt}from"./ToolSelect.js";import{A as Zt,s as ea,m as ta,T as aa}from"./TabbedContent.js";import{u as ra,O as na,R as Ve,P as sa}from"./ThresholdPreview.js";import{I as It}from"./Icon.js";import{G as oa}from"./GenreSelect.js";import{A as ia}from"./TagTable.js";import{u as la}from"./useTabSplit.js";import{C as ca}from"./CreateToolShell.js";const da={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function ua(e,t,r=(o,n)=>o===n){return e.length===t.length&&e.every((o,n)=>r(o,t[n]))}const pa=2;function ke(e,t,r,o,n){return r===1?Math.min(e+t,n):Math.max(e-t,o)}function $t(e,t){return e-t}function ht(e,t){const{index:r}=e.reduce((o,n,m)=>{const g=Math.abs(t-n);return o===null||g<o.distance||g===o.distance?{distance:g,index:m}:o},null)??{};return r}function Oe(e,t){if(t.current!==void 0&&e.changedTouches){const r=e;for(let o=0;o<r.changedTouches.length;o+=1){const n=r.changedTouches[o];if(n.identifier===t.current)return{x:n.clientX,y:n.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function Ye(e,t,r){return(e-t)*100/(r-t)}function ha(e,t,r){return(r-t)*e+t}function ba(e){if(Math.abs(e)<1){const r=e.toExponential().split("e-"),o=r[0].split(".")[1];return(o?o.length:0)+parseInt(r[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}function ma(e,t,r){const o=Math.round((e-r)/t)*t+r;return Number(o.toFixed(ba(t)))}function bt({values:e,newValue:t,index:r}){const o=e.slice();return o[r]=t,o.sort($t)}function Be({sliderRef:e,activeIndex:t,setActive:r}){var n,m,g;const o=He(e.current);(!((n=e.current)!=null&&n.contains(o.activeElement))||Number((m=o==null?void 0:o.activeElement)==null?void 0:m.getAttribute("data-index"))!==t)&&((g=e.current)==null||g.querySelector(`[type="range"][data-index="${t}"]`).focus()),r&&r(t)}function Ue(e,t){return typeof e=="number"&&typeof t=="number"?e===t:typeof e=="object"&&typeof t=="object"?ua(e,t):!1}const fa={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},va=e=>e;let qe;function mt(){return qe===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?qe=CSS.supports("touch-action","none"):qe=!0),qe}function ga(e){const{"aria-labelledby":t,defaultValue:r,disabled:o=!1,disableSwap:n=!1,isRtl:m=!1,marks:g=!1,max:c=100,min:u=0,name:y,onChange:i,onChangeCommitted:p,orientation:f="horizontal",rootRef:h,scale:d=va,step:b=1,shiftStep:k=10,tabIndex:V,value:D}=e,S=j.useRef(void 0),[L,_]=j.useState(-1),[ie,Q]=j.useState(-1),[re,ne]=j.useState(!1),W=j.useRef(0),le=j.useRef(null),[G,T]=Dt({controlled:D,default:r??u,name:"Slider"}),C=i&&((s,l,v)=>{const w=s.nativeEvent||s,P=new w.constructor(w.type,w);Object.defineProperty(P,"target",{writable:!0,value:{value:l,name:y}}),le.current=l,i(P,l,v)}),te=Array.isArray(G);let A=te?G.slice().sort($t):[G];A=A.map(s=>s==null?u:Le(s,u,c));const Se=g===!0&&b!==null?[...Array(Math.floor((c-u)/b)+1)].map((s,l)=>({value:u+b*l})):g||[],M=Se.map(s=>s.value),[se,ye]=j.useState(-1),$=j.useRef(null),ce=zt(h,$),Ke=s=>l=>{var w;const v=Number(l.currentTarget.getAttribute("data-index"));ut(l.target)&&ye(v),Q(v),(w=s==null?void 0:s.onFocus)==null||w.call(s,l)},Je=s=>l=>{var v;ut(l.target)||ye(-1),Q(-1),(v=s==null?void 0:s.onBlur)==null||v.call(s,l)},Ie=(s,l)=>{const v=Number(s.currentTarget.getAttribute("data-index")),w=A[v],P=M.indexOf(w);let x=l;if(Se&&b==null){const z=M[M.length-1];x>=z?x=z:x<=M[0]?x=M[0]:x=x<w?M[P-1]:M[P+1]}if(x=Le(x,u,c),te){n&&(x=Le(x,A[v-1]||-1/0,A[v+1]||1/0));const z=x;x=bt({values:A,newValue:x,index:v});let U=v;n||(U=x.indexOf(z)),Be({sliderRef:$,activeIndex:U})}T(x),ye(v),C&&!Ue(x,G)&&C(s,x,v),p&&p(s,le.current??x)},Qe=s=>l=>{var v;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(l.key)){l.preventDefault();const w=Number(l.currentTarget.getAttribute("data-index")),P=A[w];let x=null;if(b!=null){const z=l.shiftKey?k:b;switch(l.key){case"ArrowUp":x=ke(P,z,1,u,c);break;case"ArrowRight":x=ke(P,z,m?-1:1,u,c);break;case"ArrowDown":x=ke(P,z,-1,u,c);break;case"ArrowLeft":x=ke(P,z,m?1:-1,u,c);break;case"PageUp":x=ke(P,k,1,u,c);break;case"PageDown":x=ke(P,k,-1,u,c);break;case"Home":x=u;break;case"End":x=c;break}}else if(Se){const z=M[M.length-1],U=M.indexOf(P),E=[m?"ArrowRight":"ArrowLeft","ArrowDown","PageDown","Home"],Y=[m?"ArrowLeft":"ArrowRight","ArrowUp","PageUp","End"];E.includes(l.key)?U===0?x=M[0]:x=M[U-1]:Y.includes(l.key)&&(U===M.length-1?x=z:x=M[U+1])}x!=null&&Ie(l,x)}(v=s==null?void 0:s.onKeyDown)==null||v.call(s,l)};Ft(()=>{var s;o&&$.current.contains(document.activeElement)&&((s=document.activeElement)==null||s.blur())},[o]),o&&L!==-1&&_(-1),o&&se!==-1&&ye(-1);const $e=s=>l=>{var v;(v=s.onChange)==null||v.call(s,l),Ie(l,l.target.valueAsNumber)},de=j.useRef(void 0);let ue=f;m&&f==="horizontal"&&(ue+="-reverse");const pe=({finger:s,move:l=!1})=>{const{current:v}=$,{width:w,height:P,bottom:x,left:z}=v.getBoundingClientRect();let U;ue.startsWith("vertical")?U=(x-s.y)/P:U=(s.x-z)/w,ue.includes("-reverse")&&(U=1-U);let E;if(E=ha(U,u,c),b)E=ma(E,b,u);else{const je=ht(M,E);E=M[je]}E=Le(E,u,c);let Y=0;if(te){l?Y=de.current:Y=ht(A,E),n&&(E=Le(E,A[Y-1]||-1/0,A[Y+1]||1/0));const je=E;E=bt({values:A,newValue:E,index:Y}),n&&l||(Y=E.indexOf(je),de.current=Y)}return{newValue:E,activeIndex:Y}},he=nt(s=>{const l=Oe(s,S);if(!l)return;if(W.current+=1,s.type==="mousemove"&&s.buttons===0){Z(s);return}const{newValue:v,activeIndex:w}=pe({finger:l,move:!0});Be({sliderRef:$,activeIndex:w,setActive:_}),T(v),!re&&W.current>pa&&ne(!0),C&&!Ue(v,G)&&C(s,v,w)}),Z=nt(s=>{const l=Oe(s,S);if(ne(!1),!l)return;const{newValue:v}=pe({finger:l,move:!0});_(-1),s.type==="touchend"&&Q(-1),p&&p(s,le.current??v),S.current=void 0,be()}),O=nt(s=>{if(o)return;mt()||s.preventDefault();const l=s.changedTouches[0];l!=null&&(S.current=l.identifier);const v=Oe(s,S);if(v!==!1){const{newValue:P,activeIndex:x}=pe({finger:v});Be({sliderRef:$,activeIndex:x,setActive:_}),T(P),C&&!Ue(P,G)&&C(s,P,x)}W.current=0;const w=He($.current);w.addEventListener("touchmove",he,{passive:!0}),w.addEventListener("touchend",Z,{passive:!0})}),be=j.useCallback(()=>{const s=He($.current);s.removeEventListener("mousemove",he),s.removeEventListener("mouseup",Z),s.removeEventListener("touchmove",he),s.removeEventListener("touchend",Z)},[Z,he]);j.useEffect(()=>{const{current:s}=$;return s.addEventListener("touchstart",O,{passive:mt()}),()=>{s.removeEventListener("touchstart",O),be()}},[be,O]),j.useEffect(()=>{o&&be()},[o,be]);const Ze=s=>l=>{var P;if((P=s.onMouseDown)==null||P.call(s,l),o||l.defaultPrevented||l.button!==0)return;l.preventDefault();const v=Oe(l,S);if(v!==!1){const{newValue:x,activeIndex:z}=pe({finger:v});Be({sliderRef:$,activeIndex:z,setActive:_}),T(x),C&&!Ue(x,G)&&C(l,x,z)}W.current=0;const w=He($.current);w.addEventListener("mousemove",he,{passive:!0}),w.addEventListener("mouseup",Z)},Ae=Ye(te?A[0]:u,u,c),B=Ye(A[A.length-1],u,c)-Ae,Te=(s={})=>{const l=st(s),v={onMouseDown:Ze(l||{})},w={...l,...v};return{...s,ref:ce,...w}},Me=s=>l=>{var w;(w=s.onMouseOver)==null||w.call(s,l);const v=Number(l.currentTarget.getAttribute("data-index"));Q(v)},Re=s=>l=>{var v;(v=s.onMouseLeave)==null||v.call(s,l),Q(-1)},Ee=(s={})=>{const l=st(s),v={onMouseOver:Me(l||{}),onMouseLeave:Re(l||{})};return{...s,...l,...v}},De=s=>({pointerEvents:L!==-1&&L!==s?"none":void 0});let Ce;return f==="vertical"&&(Ce=m?"vertical-rl":"vertical-lr"),{active:L,axis:ue,axisProps:fa,dragging:re,focusedThumbIndex:se,getHiddenInputProps:(s={})=>{const l=st(s),v={onChange:$e(l||{}),onFocus:Ke(l||{}),onBlur:Je(l||{}),onKeyDown:Qe(l||{})},w={...l,...v};return{tabIndex:V,"aria-labelledby":t,"aria-orientation":f,"aria-valuemax":d(c),"aria-valuemin":d(u),name:y,type:"range",min:e.min,max:e.max,step:e.step===null&&e.marks?"any":e.step??void 0,disabled:o,...s,...w,style:{...da,direction:m?"rtl":"ltr",width:"100%",height:"100%",writingMode:Ce}}},getRootProps:Te,getThumbProps:Ee,marks:Se,open:ie,range:te,rootRef:ce,trackLeap:B,trackOffset:Ae,values:A,getThumbStyle:De}}const xa=e=>!e||!We(e);function ya(e){return xt("MuiSlider",e)}const X=gt("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),Ca=e=>{const{open:t}=e;return{offset:ge(t&&X.valueLabelOpen),circle:X.valueLabelCircle,label:X.valueLabelLabel}};function ka(e){const{children:t,className:r,value:o}=e,n=Ca(e);return t?j.cloneElement(t,{className:ge(t.props.className)},a.jsxs(j.Fragment,{children:[t.props.children,a.jsx("span",{className:ge(n.offset,r),"aria-hidden":!0,children:a.jsx("span",{className:n.circle,children:a.jsx("span",{className:n.label,children:o})})})]})):null}function ft(e){return e}const wa=J("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${H(r.color)}`],r.size!=="medium"&&t[`size${H(r.size)}`],r.marked&&t.marked,r.orientation==="vertical"&&t.vertical,r.track==="inverted"&&t.trackInverted,r.track===!1&&t.trackFalse]}})(ee(({theme:e})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${X.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${X.dragging}`]:{[`& .${X.thumb}, & .${X.track}`]:{transition:"none"}},variants:[...Object.entries(e.palette).filter(Xe()).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),Sa=J("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),Ta=J("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(ee(({theme:e})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(e.palette).filter(Xe()).map(([t])=>({props:{color:t,track:"inverted"},style:{...e.vars?{backgroundColor:e.vars.palette.Slider[`${t}Track`],borderColor:e.vars.palette.Slider[`${t}Track`]}:{backgroundColor:lt(e.palette[t].main,.62),borderColor:lt(e.palette[t].main,.62),...e.applyStyles("dark",{backgroundColor:ct(e.palette[t].main,.5)}),...e.applyStyles("dark",{borderColor:ct(e.palette[t].main,.5)})}}}))]}))),ja=J("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.thumb,t[`thumbColor${H(r.color)}`],r.size!=="medium"&&t[`thumbSize${H(r.size)}`]]}})(ee(({theme:e})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${X.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(e.palette).filter(Xe()).map(([t])=>({props:{color:t},style:{[`&:hover, &.${X.focusVisible}`]:{...e.vars?{boxShadow:`0px 0px 0px 8px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 8px ${_e(e.palette[t].main,.16)}`},"@media (hover: none)":{boxShadow:"none"}},[`&.${X.active}`]:{...e.vars?{boxShadow:`0px 0px 0px 14px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 14px ${_e(e.palette[t].main,.16)}`}}}}))]}))),La=J(ka,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(ee(({theme:e})=>({zIndex:1,whiteSpace:"nowrap",...e.typography.body2,fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${X.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${X.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),Pa=J("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>kt(e)&&e!=="markActive",overridesResolver:(e,t)=>{const{markActive:r}=e;return[t.mark,r&&t.markActive]}})(ee(({theme:e})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}}]}))),Ia=J("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>kt(e)&&e!=="markLabelActive",overridesResolver:(e,t)=>t.markLabel})(ee(({theme:e})=>({...e.typography.body2,color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(e.vars||e).palette.text.primary}}]}))),$a=e=>{const{disabled:t,dragging:r,marked:o,orientation:n,track:m,classes:g,color:c,size:u}=e,y={root:["root",t&&"disabled",r&&"dragging",o&&"marked",n==="vertical"&&"vertical",m==="inverted"&&"trackInverted",m===!1&&"trackFalse",c&&`color${H(c)}`,u&&`size${H(u)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",u&&`thumbSize${H(u)}`,c&&`thumbColor${H(c)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return Ct(y,ya,g)},Aa=({children:e})=>e,Ma=j.forwardRef(function(t,r){const o=yt({props:t,name:"MuiSlider"}),n=Nt(),{"aria-label":m,"aria-valuetext":g,"aria-labelledby":c,component:u="span",components:y={},componentsProps:i={},color:p="primary",classes:f,className:h,disableSwap:d=!1,disabled:b=!1,getAriaLabel:k,getAriaValueText:V,marks:D=!1,max:S=100,min:L=0,name:_,onChange:ie,onChangeCommitted:Q,orientation:re="horizontal",shiftStep:ne=10,size:W="medium",step:le=1,scale:G=ft,slotProps:T,slots:C,tabIndex:te,track:A="normal",value:Se,valueLabelDisplay:M="off",valueLabelFormat:se=ft,...ye}=o,$={...o,isRtl:n,max:S,min:L,classes:f,disabled:b,disableSwap:d,orientation:re,marks:D,color:p,size:W,step:le,shiftStep:ne,scale:G,track:A,valueLabelDisplay:M,valueLabelFormat:se},{axisProps:ce,getRootProps:Ke,getHiddenInputProps:Je,getThumbProps:Ie,open:Qe,active:$e,axis:de,focusedThumbIndex:ue,range:pe,dragging:he,marks:Z,values:O,trackOffset:be,trackLeap:Ze,getThumbStyle:Ae}=ga({...$,rootRef:r});$.marked=Z.length>0&&Z.some(R=>R.label),$.dragging=he,$.focusedThumbIndex=ue;const B=$a($),Te=(C==null?void 0:C.root)??y.Root??wa,Me=(C==null?void 0:C.rail)??y.Rail??Sa,Re=(C==null?void 0:C.track)??y.Track??Ta,Ee=(C==null?void 0:C.thumb)??y.Thumb??ja,De=(C==null?void 0:C.valueLabel)??y.ValueLabel??La,Ce=(C==null?void 0:C.mark)??y.Mark??Pa,ze=(C==null?void 0:C.markLabel)??y.MarkLabel??Ia,s=(C==null?void 0:C.input)??y.Input??"input",l=(T==null?void 0:T.root)??i.root,v=(T==null?void 0:T.rail)??i.rail,w=(T==null?void 0:T.track)??i.track,P=(T==null?void 0:T.thumb)??i.thumb,x=(T==null?void 0:T.valueLabel)??i.valueLabel,z=(T==null?void 0:T.mark)??i.mark,U=(T==null?void 0:T.markLabel)??i.markLabel,E=(T==null?void 0:T.input)??i.input,Y=oe({elementType:Te,getSlotProps:Ke,externalSlotProps:l,externalForwardedProps:ye,additionalProps:{...xa(Te)&&{as:u}},ownerState:{...$,...l==null?void 0:l.ownerState},className:[B.root,h]}),je=oe({elementType:Me,externalSlotProps:v,ownerState:$,className:B.rail}),Mt=oe({elementType:Re,externalSlotProps:w,additionalProps:{style:{...ce[de].offset(be),...ce[de].leap(Ze)}},ownerState:{...$,...w==null?void 0:w.ownerState},className:B.track}),et=oe({elementType:Ee,getSlotProps:Ie,externalSlotProps:P,ownerState:{...$,...P==null?void 0:P.ownerState},className:B.thumb}),Rt=oe({elementType:De,externalSlotProps:x,ownerState:{...$,...x==null?void 0:x.ownerState},className:B.valueLabel}),tt=oe({elementType:Ce,externalSlotProps:z,ownerState:$,className:B.mark}),at=oe({elementType:ze,externalSlotProps:U,ownerState:$,className:B.markLabel}),Et=oe({elementType:s,getSlotProps:Je,externalSlotProps:E,ownerState:$});return a.jsxs(Te,{...Y,children:[a.jsx(Me,{...je}),a.jsx(Re,{...Mt}),Z.filter(R=>R.value>=L&&R.value<=S).map((R,N)=>{const rt=Ye(R.value,L,S),Fe=ce[de].offset(rt);let ae;return A===!1?ae=O.includes(R.value):ae=A==="normal"&&(pe?R.value>=O[0]&&R.value<=O[O.length-1]:R.value<=O[0])||A==="inverted"&&(pe?R.value<=O[0]||R.value>=O[O.length-1]:R.value>=O[0]),a.jsxs(j.Fragment,{children:[a.jsx(Ce,{"data-index":N,...tt,...!We(Ce)&&{markActive:ae},style:{...Fe,...tt.style},className:ge(tt.className,ae&&B.markActive)}),R.label!=null?a.jsx(ze,{"aria-hidden":!0,"data-index":N,...at,...!We(ze)&&{markLabelActive:ae},style:{...Fe,...at.style},className:ge(B.markLabel,at.className,ae&&B.markLabelActive),children:R.label}):null]},N)}),O.map((R,N)=>{const rt=Ye(R,L,S),Fe=ce[de].offset(rt),ae=M==="off"?Aa:De;return a.jsx(ae,{...!We(ae)&&{valueLabelFormat:se,valueLabelDisplay:M,value:typeof se=="function"?se(G(R),N):se,index:N,open:Qe===N||$e===N||M==="on",disabled:b},...Rt,children:a.jsx(Ee,{"data-index":N,...et,className:ge(B.thumb,et.className,$e===N&&B.active,ue===N&&B.focusVisible),style:{...Fe,...Ae(N),...et.style},children:a.jsx(s,{"data-index":N,"aria-label":k?k(N):m,"aria-valuenow":G(R),"aria-labelledby":c,"aria-valuetext":V?V(G(R),N):g,value:O[N],...Et})})},N)})]})});function Ra(e){return xt("MuiSwitch",e)}const q=gt("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Ea=e=>{const{classes:t,edge:r,size:o,color:n,checked:m,disabled:g}=e,c={root:["root",r&&`edge${H(r)}`,`size${H(o)}`],switchBase:["switchBase",`color${H(n)}`,m&&"checked",g&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=Ct(c,Ra,t);return{...t,...u}},Da=J("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.edge&&t[`edge${H(r.edge)}`],t[`size${H(r.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${q.thumb}`]:{width:16,height:16},[`& .${q.switchBase}`]:{padding:4,[`&.${q.checked}`]:{transform:"translateX(16px)"}}}}]}),za=J(Vt,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.switchBase,{[`& .${q.input}`]:t.input},r.color!=="default"&&t[`color${H(r.color)}`]]}})(ee(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${q.checked}`]:{transform:"translateX(20px)"},[`&.${q.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${q.checked} + .${q.track}`]:{opacity:.5},[`&.${q.disabled} + .${q.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${q.input}`]:{left:"-100%",width:"300%"}})),ee(({theme:e})=>({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:_e(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(e.palette).filter(Xe(["light"])).map(([t])=>({props:{color:t},style:{[`&.${q.checked}`]:{color:(e.vars||e).palette[t].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_e(e.palette[t].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${q.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t}DisabledColor`]:`${e.palette.mode==="light"?lt(e.palette[t].main,.62):ct(e.palette[t].main,.55)}`}},[`&.${q.checked} + .${q.track}`]:{backgroundColor:(e.vars||e).palette[t].main}}}))]}))),Fa=J("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(ee(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`}))),Na=J("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(ee(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),At=j.forwardRef(function(t,r){const o=yt({props:t,name:"MuiSwitch"}),{className:n,color:m="primary",edge:g=!1,size:c="medium",sx:u,slots:y={},slotProps:i={},...p}=o,f={...o,color:m,edge:g,size:c},h=Ea(f),d={slots:y,slotProps:i},[b,k]=ot("root",{className:ge(h.root,n),elementType:Da,externalForwardedProps:d,ownerState:f,additionalProps:{sx:u}}),[V,D]=ot("thumb",{className:h.thumb,elementType:Na,externalForwardedProps:d,ownerState:f}),S=a.jsx(V,{...D}),[L,_]=ot("track",{className:h.track,elementType:Fa,externalForwardedProps:d,ownerState:f});return a.jsxs(b,{...k,children:[a.jsx(za,{type:"checkbox",icon:S,checkedIcon:S,ref:r,ownerState:f,...p,classes:{...h,root:h.switchBase},slots:{...y.switchBase&&{root:y.switchBase},...y.input&&{input:y.input}},slotProps:{...i.switchBase&&{root:typeof i.switchBase=="function"?i.switchBase(f):i.switchBase},...i.input&&{input:typeof i.input=="function"?i.input(f):i.input}}}),a.jsx(L,{..._})]})}),Va=wt(a.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),vt=wt(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),Oa=["Critical","Strained","Unstable","Stable","Improving","Strong","Thriving"];function Ba(){const e=[9,29,49,69,84,99,100],t={data:{},order:[]};t.order=e.map((n,m)=>{const g=Ne();return t.data[g]={name:Oa[m],max:n},g});const r={data:{},order:[]},o=Ne();return r.data[o]={name:"default",value:1},r.order=[o],{id:Ne(),refId:Ne(),version:1,name:"",description:"",balance:{cost:{base:0,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},max:{base:1,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},health:{base:0,perLevel:!1,valuePerLevel:0,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]}},thresholds:t,settlementPointCost:r,icon:{...Kt[0],color:"black",backgroundColor:"#fbf7ef"},isPositive:!0,canHurt:!0,isTradeable:!0,hasThresholds:!0,hasSPC:!0,genre:"",subGenre:"",properties:{data:{canOverflow:!0,isCurrency:!1,requiresUpkeep:!1,canGather:!1},config:{},order:["canOverflow","isCurrency","requiresUpkeep"]},tags:[],isValid:!1,status:"DRAFT",createdBy:""}}const Pe={name:{label:"Attribute Name",type:"text",tooltip:"The unique name of the attribute. This should clearly convey the attribute's purpose and role within the settlement mechanics.",validateFn:e=>e?e.trim().length<3?"Attribute name must be at least 3 characters long":null:"Attribute name is required",keypath:"name"},costPerLevel:{label:"Currency Cost",type:"number",tooltip:"The amount of currency required per level to acquire this attribute. This cost scales with the settlement's level.",validateFn:e=>e?e<=0?"Cost per level must be greater than 0":null:"Cost per level is required",keypath:"balance.cost.base"},healthPerLevel:{label:"Health Drain",type:"number",tooltip:"This value represents the health damage the settlement takes for each missing unit of this attribute, scaled by settlement level.",validateFn:e=>e==null?"Health per level is required":e<0?"Health per level cannot be negative":null,keypath:"balance.health.base"},maxPerLevel:{label:"Max",type:"number",tooltip:"The maximum number of units of this attribute that can provide benefits to the settlement per level.",validateFn:e=>e===void 0?"Max per level is required":e<0?"Max per level must be 0 or greater":null,keypath:"balance.max.base"},description:{label:"Description",type:"textarea",tooltip:"A brief explanation of the attribute's purpose and impact. This provides essential context for understanding its role in the settlement.",validateFn:e=>e?e.trim().length<30?`Description must be at least 30 characters long. You need ${30-e.length} more characters.`:null:"Description is required",keypath:"description"},healthValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for health per level. This value represents the scaling value per interval based on Health Drain.",validateFn:e=>e==null?"Health per level scale is required":null,keypath:"balance.health.valuePerLevel"},healthIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which health is calculated based on the health drain. This value determines how often the health is updated.",validateFn:e=>e==null?"Health interval per level is required":e<=0?"Health interval per level must be greater than 0":null,keypath:"balance.health.interval"},costValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for cost per level. This value represents the scaling value per interval based on Cost.",validateFn:e=>e==null?"Cost per level scale is required":null,keypath:"balance.cost.valuePerLevel"},costIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which cost is calculated based on the cost per level. This value determines how often the cost is updated.",validateFn:e=>e==null?"Cost interval per level is required":e<=0?"Cost interval per level must be greater than 0":null,keypath:"balance.cost.interval"},maxValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for max per level. This value represents the scaling value per interval based on Max.",validateFn:e=>e==null?"Max per level scale is required":null,keypath:"balance.max.valuePerLevel"},maxIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which max is calculated based on the max per level. This value determines how often the max is updated.",validateFn:e=>e==null?"Max interval per level is required":e<=0?"Max interval per level must be greater than 0":null,keypath:"balance.max.interval"}},K=({keypath:e,trueLabel:t="",falseLabel:r="",sx:o={display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,boxSizing:"border-box",transition:"background-color 0.3s ease, border-color 1s ease",borderLeft:"2px solid",pl:2,py:.5,width:"100%",color:"text.primary",borderRadius:0},tooltip:n,disabled:m=!1,onChange:g,falseColor:c="warning",trueColor:u="success",trueThemeKey:y="main",falseThemeKey:i="main",border:p=!0,variant:f="row",buttonType:h="button",heightLock:d=!1})=>{const{tool:b,id:k}=j.useContext(Lt),{updateTool:V,selectEditValue:D}=xe(b,k),S=D(e),{utils:L}=Ot(),{lockHeight:_}=Pt(),ie=()=>{d&&S&&_(),V(e,!S),typeof g=="function"&&g(!S)};return a.jsxs(St,{tabIndex:-1,disableFocusRipple:!0,disabled:m,onClick:()=>{h==="button"&&ie()},sx:{...o,borderColor:S?L.color(u,y,.5):L.color(c,i,.5),"&:hover":{bgcolor:S?L.color(u,y,.1):L.color(c,i,.1)},borderLeft:p?o==null?void 0:o.borderLeft:"none",flexDirection:f},children:[a.jsx(me,{title:a.jsx(F,{variant:"body2",children:n||`Toggle ${e}`}),placement:"top",arrow:!0,children:a.jsx(F,{variant:"body2",sx:{flexGrow:1,textAlign:"left",textTransform:"uppercase"},children:S?t:r||t})}),a.jsx(At,{id:`${b}-${k}-${e}`,size:"small",color:S?u:c,checked:S===!0,sx:{"& .MuiSwitch-switchBase":{"&.Mui-checked":{color:L.color(u,y,.8)},"&:not(.Mui-checked)":{color:L.color(c,i,.8)}},"& .MuiSwitch-track":{backgroundColor:L.color("info","light",1)}},onClick:()=>{(h="switch")&&ie()}})]})},Ua=ea(ta.div)({}),Ge=({children:e,show:t=!0,duration:r=.3,sx:o={},onMouseLeave:n=()=>{},onMouseEnter:m=()=>{}})=>a.jsx(Zt,{children:t&&a.jsx(Ua,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:r},style:{overflow:"hidden",marginBottom:"0.5rem"},sx:o,onMouseLeave:n,onMouseEnter:m,children:e})}),qa={linear:"Change Per Interval","slow-exponential":"Base","fast-exponential":"Base",custom:"Change Per Interval"},it=({disabled:e,property:t,fields:r,slide:o,setSlide:n,slideLabel:m="",slideColor:g="secondary",borderColor:c="honey.main",accentColor:u="info.main"})=>{const{id:y,tool:i}=we(),{edit:p,updateTool:f,selectEditValue:h}=xe(i,y),[d,b]=j.useState(!1),k=h(`balance.${t}`);if(!k)return null;const{valuePerLevel:V,interval:D,scaleToggle:S,scaleCurve:L,base:_,perLevel:ie,valuesPerInterval:Q}=k,re=()=>{const ne=p.balance[t],{interval:W,scaleToggle:le,valuesPerInterval:G}=ne;if(W<=0)return[];const T={};if(G.forEach(C=>{C&&C.level&&C.value!==void 0&&(T[C.level]=C.value)}),le){const C=Array.from({length:Math.ceil(21/W)},(te,A)=>A*W).slice(1,21).map(te=>({level:te,value:0}));f(`balance.${t}.valuesPerInterval`,C)}else return[]};return j.useEffect(()=>{L==="custom"&&re()},[L,D]),a.jsxs(Ge,{show:!e,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",border:"1px solid",borderColor:p!=null&&p.balance[t].perLevel?d?u:c:"transparent",transition:"border-color 0.3s ease, padding 0.3s ease",boxSizing:"border-box",p:p.balance[t].perLevel?1:0,borderRadius:2},onMouseEnter:b.bind(null,!0),onMouseLeave:b.bind(null,!1),children:[a.jsx(ve,{inputConfig:r[`${t}PerLevel`]}),a.jsx(K,{keypath:`balance.${t}.perLevel`,trueLabel:"Scale",falseLabel:"Flat",tooltip:"Enable to automatically adjust related values when max per level changes.",border:!1,variant:"column-reverse",disabled:e,heightLock:!0}),a.jsxs(Ge,{show:p==null?void 0:p.balance[t].perLevel,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",justifyContent:"center"},children:[a.jsx(ve,{inputConfig:r[`${t}IntervalPerLevel`],decimals:0,allowZero:!1}),a.jsx(K,{keypath:`balance.${t}.scaleToggle`,trueLabel:"Custom",falseLabel:"Default",variant:"column-reverse",tooltip:"Enable scaling separate from the base value.",border:!1,heightLock:!0}),a.jsxs(Ge,{show:p==null?void 0:p.balance[t].scaleToggle,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"center"},children:[a.jsx(ve,{dynamicLabel:qa[p==null?void 0:p.balance[t].scaleCurve],inputConfig:r[`${t}ValuePerLevel`],style:{width:"100%"},disabled:(p==null?void 0:p.balance[t].scaleCurve)==="custom"}),a.jsx(Qt,{keypath:`balance.${t}.scaleCurve`,label:"Scale Curve",options:[{value:"linear",name:"Linear"},{value:"slow-exponential",name:"Slow Exponential"},{value:"fast-exponential",name:"Fast Exponential"},{value:"custom",name:"Per Interval"}],small:!1}),a.jsx(Ge,{show:(p==null?void 0:p.balance[t].scaleCurve)==="custom",sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)","repeat(4, 1fr)","repeat(5, 1fr)"],gap:1,width:"100%"},children:Q.map((ne,W)=>a.jsx(ve,{inputConfig:{keypath:`balance.${t}.valuesPerInterval.${W}.value`,label:`Level ${ne.level}`,type:"number"},style:{width:"100%"}},`${t}-interval-${W}`))})]})]})]})},Ga=({columns:e})=>{const{tool:t,id:r}=j.useContext(Lt),{edit:o}=xe(t,r),[n,m]=j.useState(!1),[g,c]=j.useState(5),u=i=>{const p=o.balance[i],{base:f,perLevel:h,valuePerLevel:d,interval:b,scaleToggle:k}=p;return k?`Floor(${g} / ${b}) * ${d} + ${f})`:h?`Floor(${g} / ${b}) * ${f})`:`${f}`},y=i=>{const p=o.balance[i],{base:f,perLevel:h,valuePerLevel:d,interval:b,scaleToggle:k,scaleCurve:V,valuesPerInterval:D}=p;if(f===void 0)return"0";switch(k){case!0:{const S=g/b;switch(V){case"linear":return(Math.floor(S)*d+f).toFixed(0);case"slow-exponential":return(Math.pow(S,1.5)*d+f).toFixed(0);case"fast-exponential":return(Math.pow(S,2)*d+f).toFixed(0);case"custom":{if(!(D!=null&&D.length))return f.toFixed(0);const L=Math.floor(S);return L<0||L-1>=D.length?f.toFixed(0):(D.slice(0,L).reduce((Q,re)=>Q+re.value,0)+f).toFixed(0)}default:return f.toFixed(0)}}case!1:return h?(Math.max(1,Math.floor(g/b))*f).toFixed(0):f.toFixed(0);default:return f.toFixed(0)}};return o?a.jsxs(I,{id:`attr-values-${r}`,sx:{display:"flex",flexDirection:"column",gap:2},children:[a.jsxs(Bt,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,height:"100%"},children:[a.jsxs(Ut,{sx:{display:"flex",alignItems:"center",gap:.5},children:[a.jsx(F,{children:"Autobalance"}),a.jsx(me,{title:"Automatically adjust related values to maintain a balanced configuration.",children:a.jsx(Jt,{sx:{fontSize:18,color:"text.secondary",cursor:"pointer"}})})]}),a.jsx(At,{checked:n,onChange:i=>m(i.target.checked)})]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"auto",alignItems:"center",justifyContent:"start",my:2,width:"100%",position:"relative",gridColumn:"span 3",boxSizing:"border-box"},children:[a.jsx(I,{sx:{gridColumn:"span 2",display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:a.jsxs(I,{sx:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",px:4},children:[a.jsx(Ma,{valueLabelDisplay:"auto",color:"secondary",defaultValue:g,value:g,onChange:(i,p)=>{c(p)},min:1,max:20,step:1}),a.jsxs(I,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:1},children:[a.jsx(F,{variant:"body2",sx:{fontWeight:"bold",width:"100%"},children:`Values at Level ${g}: `}),a.jsx(me,{title:u("max"),children:a.jsxs(F,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"success.main"},children:["Max: ",y("max")]})}),o.canHurt&&a.jsx(me,{title:u("health"),children:a.jsxs(F,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"error.main"},children:["Health: ",y("health")]})}),o.isTradeable&&a.jsx(me,{title:u("cost"),children:a.jsxs(F,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"honey.main"},children:["Cost: ",y("cost")]})})]})]})}),a.jsx(it,{disabled:!1,property:"max",fields:Pe,slide:g,setSlide:c,slideLabel:"Max Value",borderColor:"dividerDark"}),a.jsx(it,{disabled:!o.canHurt,property:"health",fields:Pe,slide:g,setSlide:c,slideLabel:"Total Drain",borderColor:"dividerDark",accentColor:"error.main"}),a.jsx(it,{disabled:!o.isTradeable,property:"cost",fields:Pe,slide:g,setSlide:c,slideLabel:"Total Cost",borderColor:"dividerDark",accentColor:"honey.main"})]})]}):null},Ha={name:"",tooltip:"",type:"number",validate:e=>e<=-1?"Value must be 0 or greater":null,keypath:""},Wa=({content:e})=>a.jsx(F,{component:"span",children:e.map((t,r)=>t.type==="text"?a.jsx("span",{children:t.value},r):t.type==="strong"?a.jsx("strong",{children:t.value},r):t.type==="tooltip"?a.jsx(me,{title:t.title,arrow:!0,children:a.jsx(F,{component:"span",sx:{textDecoration:"underline",fontWeight:"bold",cursor:"pointer"},onClick:t.onClick,children:t.value})},r):null)}),_a=[{name:"Fortified",description:"Fortified Settlements put their trust in theirs walls, preemptive reconnaissance, and well-trained troops.",id:"789"},{name:"Mercantile",description:"Mercantile Settlements focus on establishing and expanding trade, developing vibrant culture, and welcoming artisans.",id:"456"},{name:"Survivalist",description:"Survivalists focus on gathering food, supplies, medical items, and constructing durable shelters.",id:"123"}],Ya=[{type:"text",value:"Define the "},{type:"tooltip",title:"Settlements earn 1 settlement point per level per turn, barring other boons or banes. Click for more information.",value:"Settlement Point Cost",onClick:()=>console.log("open SPC help panel")},{type:"text",value:" of this attribute per Settlement Type. A value of "},{type:"strong",value:"0"},{type:"text",value:" means this cannot be purchased with settlement points for that settlement type."}],Xa=()=>{const{tool:e,id:t}=we(),{data:r,order:o,errors:n,add:m,remove:g}=ra(e,t,"settlementPointCost"),[c,u]=j.useState(null),[y,i]=j.useState(""),p=j.useMemo(()=>{const h=Object.keys(r||{}).reduce((b,k)=>(b.push(k),b),[]);return _a.filter(b=>!h.includes(b.id))},[r]),f=j.useMemo(()=>Object.entries(r||{}).map(([h,d])=>{const b=d;return{...Ha,name:b.name,label:b.name.charAt(0).toUpperCase()+b.name.slice(1),tooltip:void 0,id:h,keypath:`settlementPointCost.data.${h}.value`}}),[r]);return o?a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"1fr 0.1fr 1fr",gap:2},children:[a.jsx(I,{sx:{gridColumn:"span 3",p:2},children:a.jsx(Wa,{content:Ya})}),a.jsx(I,{sx:{display:"flex",alignItems:"start",width:"100%"},children:a.jsx(qt,{inputValue:y,options:p,getOptionLabel:h=>h.name,renderInput:h=>a.jsx(Gt,{...h,label:"Settlement Type",variant:"outlined",error:!!(n!=null&&n.name),helperText:n==null?void 0:n.name,onChange:d=>{i(d.target.value)},onKeyDown:d=>{d.key==="Enter"&&(m({id:c.id,entry:{name:c.name,value:1},sort:!1}),i(""))}}),onChange:(h,d)=>{u(d),i((d==null?void 0:d.name)||"")},renderOption:(h,d)=>j.createElement(I,{...h,component:"li",key:d.name,sx:{display:"flex",alignItems:"center"}},a.jsx(me,{title:a.jsx(F,{children:d.description}),placement:"left",arrow:!0,children:a.jsx(F,{children:d.name})})),sx:{my:2,width:"100%"}})}),a.jsx(fe,{orientation:"vertical",flexItem:!0,children:a.jsx(Ht,{label:a.jsx(Va,{}),onClick:()=>{m({id:c.id,entry:{name:c.name,value:1},sort:!1}),i("")},sx:{width:"100%",color:"white"}})}),a.jsx(I,{children:o.map((h,d)=>{const b=f.find(k=>k.id===h);return b?a.jsx(Wt.Fragment,{children:a.jsx(ve,{inputConfig:b,style:{width:"100%",m:0,p:0},shrink:!0,onMoreDetails:b.name!=="default"?()=>{console.log("More details clicked")}:void 0,onRemove:b.name!=="default"?()=>g(h):void 0})},h):null})})]}):a.jsx(I,{children:"Loading..."})},Ka={propertiesExpanded:!0,editTabs:{Properties:{name:"Properties",disabled:!1},Values:{name:"Values",disabled:!1},SPC:{name:"SPC",disabled:!1},Thresholds:{name:"Thresholds",disabled:!1},Currency:{name:"Currency",disabled:!0},Gather:{name:"Gather",disabled:!0},Upkeep:{name:"Upkeep",disabled:!0}},activeTab:"Properties",lastTab:null,activeIndex:0,lastIndex:0};function Ja(e,t){switch(t.type){case"TOGGLE_PROPERTIES":return{...e,propertiesExpanded:!e.propertiesExpanded};case"SET_ACTIVE_TAB":const{name:r,index:o,defaultLast:n}=t.payload;return{...e,lastIndex:n?0:e.activeIndex,lastTab:n?"Values":e.activeTab,activeTab:r,activeIndex:o};case"SET_TAB_DISABLED":{const{property:m,disabled:g}=t.payload;return{...e,editTabs:{...e.editTabs,[m]:{...e.editTabs[m],disabled:g}}}}default:return e}}const dt=(e,t,r)=>({type:"SET_ACTIVE_TAB",payload:{name:e,index:t,defaultLast:r}}),Qa=(e,t)=>({type:"SET_TAB_DISABLED",payload:{property:e,disabled:t}}),Za=({columns:e})=>{var f,h,d,b;const{tool:t,id:r,showModal:o,tabId:n,side:m,tab:g}=we(),{edit:c}=xe(t,r),u=Tt(),{edit:y,current:i}=xe(t,r),p=_t(y,1e3);return Yt(()=>{if(!y)return;const k=y!=null&&y.name?y.name.trim():"Untitled";k!==i.name&&u(jt({tabId:n,side:m,keypath:"name",updates:k.length>0?k:"Untitled"}))},300,[p==null?void 0:p.name,u,n,m]),a.jsxs(a.Fragment,{children:[a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"flex",alignItems:"center",gap:2},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-around",flexGrow:1},children:[a.jsx(F,{variant:"h6",children:"Icon:"}),a.jsx(It,{viewBox:((f=c==null?void 0:c.icon)==null?void 0:f.viewBox)||"0 0 664 512",path:((h=c==null?void 0:c.icon)==null?void 0:h.d)||"",size:24,color:((d=c==null?void 0:c.icon)==null?void 0:d.color)||"primary",backgroundColor:((b=c==null?void 0:c.icon)==null?void 0:b.backgroundColor)||"background.paper",onClick:()=>{o({entry:{componentKey:"IconSelector",props:{tool:t,id:r},id:"icon-selector"}})}})]}),a.jsx(ve,{inputConfig:Pe.name,style:{flexGrow:2,flexShrink:1,px:1}})]}),a.jsx(ve,{inputConfig:Pe.description,style:{gridColumn:`span ${e}`,px:1},multiline:!0})]})},er={isTradeable:{disables:["properties.data.isCurrency"]},"properties.data.isCurrency":{disables:["properties.data.requiresUpkeep","isTradeable"],enables:["properties.data.canOverflow"]},"properties.data.requiresUpkeep":{disables:["properties.data.isCurrency","properties.data.canHarvest"]},"properties.data.canGather":{disables:["properties.data.requiresUpkeep"]}},tr={hasThresholds:{key:"Thresholds",value:!0},hasSPC:{key:"SPC",value:!0},"properties.data.isCurrency":{key:"Currency",value:!1},"properties.data.requiresUpkeep":{key:"Upkeep",value:!1},"properties.data.canGather":{key:"Gather",value:!1}},ar=({columns:e,activeTab:t,lastTab:r,lastIndex:o,localDispatch:n})=>{const{tool:m,id:g,showModal:c,tabId:u,side:y}=we(),{edit:i,updateTool:p}=xe(m,g),{makeSnackbar:f}=Xt(),h=(d,b)=>{var D,S;const k=er[d],V=tr[d];V&&(t===V.key&&!b&&n(dt(r,o,!0)),n(Qa(V.key,!b))),k&&b&&((D=k.disables)==null||D.forEach(L=>{p(L,!1)}),k!=null&&k.enables&&((S=k==null?void 0:k.enables)==null||S.forEach(L=>{p(L,!0)})))};return i?a.jsxs(a.Fragment,{children:[a.jsx(Za,{columns:e}),a.jsx(I,{sx:{gridColumn:`span ${e}`},children:a.jsx(oa,{defaultGenre:i.genre,defaultSubGenre:i.subGenre,updateFn:p})}),a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"grid",gridTemplateColumns:["1fr","1fr",`repeat(${e}, 1fr)`],gap:2},children:[a.jsxs(I,{children:[a.jsxs(fe,{children:["Major Properties"," ",a.jsx(pt,{size:"small",children:a.jsx(vt,{})})]}),a.jsx(K,{keypath:"isPositive",trueLabel:"Is Positive",falseLabel:"Is Negative",falseColor:"error",tooltip:"Toggle if this attribute is positive or negative. A positive attribute is beneficial, while a negative attribute is detrimental."}),a.jsx(K,{keypath:"canHurt",trueLabel:"Can Hurt",falseLabel:"Cannot Hurt",tooltip:"Toggle if this attribute can affect health."}),a.jsx(K,{keypath:"isTradeable",trueLabel:"Can Trade",falseLabel:"Cannot Trade",tooltip:"Toggle if this attribute can be traded. This forces a baseline cost, and allows it to be added to Trading Hubs. Tradeable attributes cannot be currency.",disabled:i==null?void 0:i.properties.data.isCurrency}),a.jsx(K,{keypath:"hasThresholds",trueLabel:"Thresholds",falseLabel:"No Thresholds",tooltip:"Toggle if this attribute has unique thresholds. If disabled, default thresholds will be used internally.",onChange:()=>{h("hasThresholds",!i.hasThresholds),i.hasThresholds&&f({message:"Default thresholds will be used.",type:"info",duration:3e3})}}),a.jsx(K,{keypath:"hasSPC",trueLabel:"Settlement Points",falseLabel:"No Settlement Points",tooltip:"Toggle if this attribute can be acquired through settlement points.",onChange:()=>{h("hasSPC",!i.hasSPC)}})]}),a.jsxs(I,{children:[a.jsxs(fe,{children:["Minor Properties"," ",a.jsx(pt,{size:"small",children:a.jsx(vt,{})})]}),a.jsx(K,{keypath:"properties.data.canOverflow",trueLabel:"Can Overflow",falseLabel:"Cannot Overflow",tooltip:"Toggle if this attribute can overflow. Overflowing attributes can exceed their maximum value, but overages will not be counted towards calculations.",disabled:i==null?void 0:i.properties.data.isCurrency}),a.jsx(K,{keypath:"properties.data.isCurrency",trueLabel:"Is Currency",falseLabel:"Not Currency",tooltip:"Toggle if this attribute is treated as currency. This removes any cap on the attribute's value and allows it to integrate with the Tax System, among other things.",disabled:(i==null?void 0:i.isTradeable)||(i==null?void 0:i.properties.data.requiresUpkeep),onChange:d=>{h("properties.data.isCurrency",d),d&&i.properties.data.canGather&&f({message:"Currency attributes are rarely harvestable. Be sure this makes sense in your world!",type:"warning",duration:5e3})}}),a.jsx(K,{keypath:"properties.data.requiresUpkeep",trueLabel:"Requires Upkeep",falseLabel:"No Upkeep Required",tooltip:"Toggle if this attribute requires upkeep. This will add an upkeep cost to the attribute, which must be paid with a currency to keep it active.",disabled:(i==null?void 0:i.properties.data.isCurrency)||(i==null?void 0:i.properties.data.canGather),onChange:d=>{h("properties.data.requiresUpkeep",d)}}),a.jsx(K,{keypath:"properties.data.canGather",trueLabel:"Can Gather",falseLabel:"Cannot Gather",tooltip:"Toggle if this attribute can be acquired by assigning other attributes, e.g. 'Productivity', to it.",disabled:i==null?void 0:i.properties.data.requiresUpkeep,onChange:d=>{h("properties.data.canGather",d),d&&i.properties.data.isCurrency&&f({message:"Harvestable attributes are rarely currency. Be sure this makes sense in your world!",type:"warning",duration:5e3})}})]})]}),a.jsx(ia,{})]}):null},rr={Properties:ar,Values:Ga,SPC:Xa,Thresholds:na,Currency:()=>a.jsx(I,{children:"Currency Component"}),Gather:()=>a.jsx(I,{children:"Gather Component"}),Upkeep:()=>a.jsx(I,{children:"Upkeep Component"})},nr=()=>{const{side:e,tab:t}=we(),{both:r}=la(),o=Tt(),[n,m]=j.useReducer(Ja,t.viewState.editAttr||Ka),{activeTab:g,editTabs:c,lastIndex:u}=n;j.useEffect(()=>{t.lastTab&&t.lastIndex&&m(dt(t.lastTab,t.lastIndex))},[]),j.useEffect(()=>()=>{o(jt({tabId:t.tabId,side:e,keypath:"viewState.editAttr",updates:{...n}}))},[n]);const y=r?1:2,i=(h,d)=>{m(dt(h,d))},{ref:p,height:f}=Pt();return a.jsx(I,{id:`edit-attribute-${t.id}`,ref:p,sx:{height:"100%",transition:"height 0.4s ease-in-out",overflow:typeof f=="number"?"hidden":"auto",width:"100%",px:2,boxSizing:"border-box"},children:a.jsx(aa,{tabs:Object.values(c).map(h=>({...h,disabled:h.disabled||!1,props:{localDispatch:m}})),componentMap:rr,activeTab:g,handleTabClick:i,columns:y,lastIndex:u})})},sr=()=>{var m,g,c,u,y,i,p,f,h,d;const{tool:e,id:t,mode:r,side:o}=we(),{current:n}=xe("attribute",t);return a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",mt:2,gap:2,width:"100%",position:"relative",pb:4},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,height:"88px",flexGrow:1,flexShrink:2},children:[a.jsx(F,{variant:"body1",sx:{fontWeight:"bold",fontSize:"1.25rem"},children:"Icon"}),a.jsx(St,{sx:{boxShadow:4,borderRadius:"50%",height:64,width:64},disabled:!0,children:a.jsx(It,{viewBox:((m=n==null?void 0:n.icon)==null?void 0:m.viewBox)||"0 0 664 512",path:((g=n==null?void 0:n.icon)==null?void 0:g.d)||"",size:24,color:((c=n==null?void 0:n.icon)==null?void 0:c.color)||"primary",backgroundColor:((u=n==null?void 0:n.icon)==null?void 0:u.backgroundColor)||"background.paper"})})]}),a.jsxs(I,{sx:{gridColumn:"span 2",display:"flex",gap:2,alignItems:"center",justifyContent:"start",height:"100%"},children:[a.jsx(F,{variant:"h6",children:"Name:"}),a.jsx(F,{children:(n==null?void 0:n.name)||"None"})]}),a.jsx(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"DESCRIPTION"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",flexDirection:"column",gap:2,alignItems:"start",justifyContent:"center"},children:[a.jsx(F,{sx:{textAlign:"start"},variant:"body1",children:(n==null?void 0:n.description)||"No description"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",gap:2,alignItems:"center",justifyContent:"center"},children:[a.jsx(F,{variant:"body1",sx:{fontWeight:"bold"},children:"Type:"}),a.jsx(F,{variant:"body1",children:n!=null&&n.isPositive?"Positive":"Negative"})]})]}),a.jsxs(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:[" ","SCALING PER LEVEL"," "]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridColumn:"span 3",columnGap:2},children:[a.jsx(Ve,{name:"Max",value:(i=(y=n==null?void 0:n.balance)==null?void 0:y.max)==null?void 0:i.base,even:!1}),a.jsx(Ve,{name:"Health",value:(f=(p=n==null?void 0:n.balance)==null?void 0:p.health)==null?void 0:f.base,even:!0}),a.jsx(Ve,{name:"Cost",value:(d=(h=n==null?void 0:n.balance)==null?void 0:h.cost)==null?void 0:d.base,even:!1})]}),a.jsx(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"SETTLEMENT POINT COSTS"}),n.settlementPointCost.order.map((b,k)=>a.jsx(Ve,{name:n.settlementPointCost.data[b].name,value:n.settlementPointCost.data[b].value,even:k%2===0},b)),a.jsx(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"THRESHOLDS"}),a.jsx(sa,{data:n.thresholds.data,order:n.thresholds.order})]})},or=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],ir=["name","description","balance","thresholds","settlementPointCost"],yr=({tab:e})=>a.jsx(ca,{tab:e,initializeTool:Ba,validationFields:ir,editComponent:nr,previewComponent:sr,checklistContent:or});export{yr as default,ir as validationFields};
