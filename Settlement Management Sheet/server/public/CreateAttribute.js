import{r as S,aK as Mt,aL as Se,b as Et,a as Rt,aM as tt,aN as Be,aO as at,aP as it,aQ as We,y as Dt,z as $t,c as ge,j as a,u as Ft,aR as zt,aS as ae,s as be,C as re,d as Nt,m as xe,aT as ot,D as ct,E as ut,f as dt,aU as Ct,F as kt,v as ze,aV as Vt,W as wt,G as de,T as F,aW as Tt,A as Ot,aX as Ut,aY as qt,i as I,N as Gt,aZ as Bt,a4 as Wt,K as Ht,X as pe,a6 as _t,R as Yt,a0 as lt,ay as nt,a_ as Kt,aD as Xt,I as pt,a1 as ht,a$ as bt,aA as Zt,Y as mt,a2 as Qt,b0 as Jt,b1 as ea}from"./main.js";import{i as ta}from"./iconList.js";import{u as ye}from"./useTools.js";import{S as St,u as Ce}from"./PageBox.js";import{T as he,I as aa}from"./ToolInput.js";import{T as ra}from"./ToolSelect.js";import{u as na,O as sa,R as Ne,P as oa}from"./ThresholdPreview.js";import{I as Lt}from"./Icon.js";import{A as la,T as ia}from"./TabbedContent.js";import{C as ca}from"./CreateToolShell.js";import"./toolSelectors.js";import"./loadTool.js";const ua={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function da(e,t,s=(o,r)=>o===r){return e.length===t.length&&e.every((o,r)=>s(o,t[r]))}const pa=2;function ve(e,t,s,o,r){return s===1?Math.min(e+t,r):Math.max(e-t,o)}function jt(e,t){return e-t}function ft(e,t){const{index:s}=e.reduce((o,r,h)=>{const p=Math.abs(t-r);return o===null||p<o.distance||p===o.distance?{distance:p,index:h}:o},null)??{};return s}function Ve(e,t){if(t.current!==void 0&&e.changedTouches){const s=e;for(let o=0;o<s.changedTouches.length;o+=1){const r=s.changedTouches[o];if(r.identifier===t.current)return{x:r.clientX,y:r.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function He(e,t,s){return(e-t)*100/(s-t)}function ha(e,t,s){return(s-t)*e+t}function ba(e){if(Math.abs(e)<1){const s=e.toExponential().split("e-"),o=s[0].split(".")[1];return(o?o.length:0)+parseInt(s[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}function ma(e,t,s){const o=Math.round((e-s)/t)*t+s;return Number(o.toFixed(ba(t)))}function vt({values:e,newValue:t,index:s}){const o=e.slice();return o[s]=t,o.sort(jt)}function Oe({sliderRef:e,activeIndex:t,setActive:s}){var r,h,p;const o=Be(e.current);(!((r=e.current)!=null&&r.contains(o.activeElement))||Number((h=o==null?void 0:o.activeElement)==null?void 0:h.getAttribute("data-index"))!==t)&&((p=e.current)==null||p.querySelector(`[type="range"][data-index="${t}"]`).focus()),s&&s(t)}function Ue(e,t){return typeof e=="number"&&typeof t=="number"?e===t:typeof e=="object"&&typeof t=="object"?da(e,t):!1}const fa={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},va=e=>e;let qe;function gt(){return qe===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?qe=CSS.supports("touch-action","none"):qe=!0),qe}function ga(e){const{"aria-labelledby":t,defaultValue:s,disabled:o=!1,disableSwap:r=!1,isRtl:h=!1,marks:p=!1,max:l=100,min:d=0,name:C,onChange:i,onChangeCommitted:u,orientation:g="horizontal",rootRef:y,scale:v=va,step:f=1,shiftStep:w=10,tabIndex:G,value:N}=e,L=S.useRef(void 0),[j,_]=S.useState(-1),[je,K]=S.useState(-1),[J,ee]=S.useState(!1),B=S.useRef(0),ne=S.useRef(null),[q,T]=Mt({controlled:N,default:s??d,name:"Slider"}),x=i&&((n,c,b)=>{const k=n.nativeEvent||n,P=new k.constructor(k.type,k);Object.defineProperty(P,"target",{writable:!0,value:{value:c,name:C}}),ne.current=c,i(P,c,b)}),Z=Array.isArray(q);let M=Z?q.slice().sort(jt):[q];M=M.map(n=>n==null?d:Se(n,d,l));const ke=p===!0&&f!==null?[...Array(Math.floor((l-d)/f)+1)].map((n,c)=>({value:d+f*c})):p||[],E=ke.map(n=>n.value),[te,me]=S.useState(-1),A=S.useRef(null),se=Et(y,A),_e=n=>c=>{var k;const b=Number(c.currentTarget.getAttribute("data-index"));it(c.target)&&me(b),K(b),(k=n==null?void 0:n.onFocus)==null||k.call(n,c)},Ye=n=>c=>{var b;it(c.target)||me(-1),K(-1),(b=n==null?void 0:n.onBlur)==null||b.call(n,c)},Pe=(n,c)=>{const b=Number(n.currentTarget.getAttribute("data-index")),k=M[b],P=E.indexOf(k);let m=c;if(ke&&f==null){const $=E[E.length-1];m>=$?m=$:m<=E[0]?m=E[0]:m=m<k?E[P-1]:E[P+1]}if(m=Se(m,d,l),Z){r&&(m=Se(m,M[b-1]||-1/0,M[b+1]||1/0));const $=m;m=vt({values:M,newValue:m,index:b});let U=b;r||(U=m.indexOf($)),Oe({sliderRef:A,activeIndex:U})}T(m),me(b),x&&!Ue(m,q)&&x(n,m,b),u&&u(n,ne.current??m)},Ke=n=>c=>{var b;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(c.key)){c.preventDefault();const k=Number(c.currentTarget.getAttribute("data-index")),P=M[k];let m=null;if(f!=null){const $=c.shiftKey?w:f;switch(c.key){case"ArrowUp":m=ve(P,$,1,d,l);break;case"ArrowRight":m=ve(P,$,h?-1:1,d,l);break;case"ArrowDown":m=ve(P,$,-1,d,l);break;case"ArrowLeft":m=ve(P,$,h?1:-1,d,l);break;case"PageUp":m=ve(P,w,1,d,l);break;case"PageDown":m=ve(P,w,-1,d,l);break;case"Home":m=d;break;case"End":m=l;break}}else if(ke){const $=E[E.length-1],U=E.indexOf(P),D=[h?"ArrowRight":"ArrowLeft","ArrowDown","PageDown","Home"],W=[h?"ArrowLeft":"ArrowRight","ArrowUp","PageUp","End"];D.includes(c.key)?U===0?m=E[0]:m=E[U-1]:W.includes(c.key)&&(U===E.length-1?m=$:m=E[U+1])}m!=null&&Pe(c,m)}(b=n==null?void 0:n.onKeyDown)==null||b.call(n,c)};Rt(()=>{var n;o&&A.current.contains(document.activeElement)&&((n=document.activeElement)==null||n.blur())},[o]),o&&j!==-1&&_(-1),o&&te!==-1&&me(-1);const Ie=n=>c=>{var b;(b=n.onChange)==null||b.call(n,c),Pe(c,c.target.valueAsNumber)},oe=S.useRef(void 0);let le=g;h&&g==="horizontal"&&(le+="-reverse");const ie=({finger:n,move:c=!1})=>{const{current:b}=A,{width:k,height:P,bottom:m,left:$}=b.getBoundingClientRect();let U;le.startsWith("vertical")?U=(m-n.y)/P:U=(n.x-$)/k,le.includes("-reverse")&&(U=1-U);let D;if(D=ha(U,d,l),f)D=ma(D,f,d);else{const Te=ft(E,D);D=E[Te]}D=Se(D,d,l);let W=0;if(Z){c?W=oe.current:W=ft(M,D),r&&(D=Se(D,M[W-1]||-1/0,M[W+1]||1/0));const Te=D;D=vt({values:M,newValue:D,index:W}),r&&c||(W=D.indexOf(Te),oe.current=W)}return{newValue:D,activeIndex:W}},ce=tt(n=>{const c=Ve(n,L);if(!c)return;if(B.current+=1,n.type==="mousemove"&&n.buttons===0){X(n);return}const{newValue:b,activeIndex:k}=ie({finger:c,move:!0});Oe({sliderRef:A,activeIndex:k,setActive:_}),T(b),!J&&B.current>pa&&ee(!0),x&&!Ue(b,q)&&x(n,b,k)}),X=tt(n=>{const c=Ve(n,L);if(ee(!1),!c)return;const{newValue:b}=ie({finger:c,move:!0});_(-1),n.type==="touchend"&&K(-1),u&&u(n,ne.current??b),L.current=void 0,ue()}),V=tt(n=>{if(o)return;gt()||n.preventDefault();const c=n.changedTouches[0];c!=null&&(L.current=c.identifier);const b=Ve(n,L);if(b!==!1){const{newValue:P,activeIndex:m}=ie({finger:b});Oe({sliderRef:A,activeIndex:m,setActive:_}),T(P),x&&!Ue(P,q)&&x(n,P,m)}B.current=0;const k=Be(A.current);k.addEventListener("touchmove",ce,{passive:!0}),k.addEventListener("touchend",X,{passive:!0})}),ue=S.useCallback(()=>{const n=Be(A.current);n.removeEventListener("mousemove",ce),n.removeEventListener("mouseup",X),n.removeEventListener("touchmove",ce),n.removeEventListener("touchend",X)},[X,ce]);S.useEffect(()=>{const{current:n}=A;return n.addEventListener("touchstart",V,{passive:gt()}),()=>{n.removeEventListener("touchstart",V),ue()}},[ue,V]),S.useEffect(()=>{o&&ue()},[o,ue]);const Xe=n=>c=>{var P;if((P=n.onMouseDown)==null||P.call(n,c),o||c.defaultPrevented||c.button!==0)return;c.preventDefault();const b=Ve(c,L);if(b!==!1){const{newValue:m,activeIndex:$}=ie({finger:b});Oe({sliderRef:A,activeIndex:$,setActive:_}),T(m),x&&!Ue(m,q)&&x(c,m,$)}B.current=0;const k=Be(A.current);k.addEventListener("mousemove",ce,{passive:!0}),k.addEventListener("mouseup",X)},Ae=He(Z?M[0]:d,d,l),O=He(M[M.length-1],d,l)-Ae,we=(n={})=>{const c=at(n),b={onMouseDown:Xe(c||{})},k={...c,...b};return{...n,ref:se,...k}},Me=n=>c=>{var k;(k=n.onMouseOver)==null||k.call(n,c);const b=Number(c.currentTarget.getAttribute("data-index"));K(b)},Ee=n=>c=>{var b;(b=n.onMouseLeave)==null||b.call(n,c),K(-1)},Re=(n={})=>{const c=at(n),b={onMouseOver:Me(c||{}),onMouseLeave:Ee(c||{})};return{...n,...c,...b}},De=n=>({pointerEvents:j!==-1&&j!==n?"none":void 0});let fe;return g==="vertical"&&(fe=h?"vertical-rl":"vertical-lr"),{active:j,axis:le,axisProps:fa,dragging:J,focusedThumbIndex:te,getHiddenInputProps:(n={})=>{const c=at(n),b={onChange:Ie(c||{}),onFocus:_e(c||{}),onBlur:Ye(c||{}),onKeyDown:Ke(c||{})},k={...c,...b};return{tabIndex:G,"aria-labelledby":t,"aria-orientation":g,"aria-valuemax":v(l),"aria-valuemin":v(d),name:C,type:"range",min:e.min,max:e.max,step:e.step===null&&e.marks?"any":e.step??void 0,disabled:o,...n,...k,style:{...ua,direction:h?"rtl":"ltr",width:"100%",height:"100%",writingMode:fe}}},getRootProps:we,getThumbProps:Re,marks:ke,open:je,range:Z,rootRef:se,trackLeap:O,trackOffset:Ae,values:M,getThumbStyle:De}}const xa=e=>!e||!We(e);function ya(e){return $t("MuiSlider",e)}const H=Dt("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),Ca=e=>{const{open:t}=e;return{offset:ge(t&&H.valueLabelOpen),circle:H.valueLabelCircle,label:H.valueLabelLabel}};function ka(e){const{children:t,className:s,value:o}=e,r=Ca(e);return t?S.cloneElement(t,{className:ge(t.props.className)},a.jsxs(S.Fragment,{children:[t.props.children,a.jsx("span",{className:ge(r.offset,s),"aria-hidden":!0,children:a.jsx("span",{className:r.circle,children:a.jsx("span",{className:r.label,children:o})})})]})):null}function xt(e){return e}const wa=be("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.root,t[`color${re(s.color)}`],s.size!=="medium"&&t[`size${re(s.size)}`],s.marked&&t.marked,s.orientation==="vertical"&&t.vertical,s.track==="inverted"&&t.trackInverted,s.track===!1&&t.trackFalse]}})(xe(({theme:e})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${H.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${H.dragging}`]:{[`& .${H.thumb}, & .${H.track}`]:{transition:"none"}},variants:[...Object.entries(e.palette).filter(ot()).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),Ta=be("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),Sa=be("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(xe(({theme:e})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(e.palette).filter(ot()).map(([t])=>({props:{color:t,track:"inverted"},style:{...e.vars?{backgroundColor:e.vars.palette.Slider[`${t}Track`],borderColor:e.vars.palette.Slider[`${t}Track`]}:{backgroundColor:ct(e.palette[t].main,.62),borderColor:ct(e.palette[t].main,.62),...e.applyStyles("dark",{backgroundColor:ut(e.palette[t].main,.5)}),...e.applyStyles("dark",{borderColor:ut(e.palette[t].main,.5)})}}}))]}))),La=be("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{const{ownerState:s}=e;return[t.thumb,t[`thumbColor${re(s.color)}`],s.size!=="medium"&&t[`thumbSize${re(s.size)}`]]}})(xe(({theme:e})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${H.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(e.palette).filter(ot()).map(([t])=>({props:{color:t},style:{[`&:hover, &.${H.focusVisible}`]:{...e.vars?{boxShadow:`0px 0px 0px 8px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 8px ${dt(e.palette[t].main,.16)}`},"@media (hover: none)":{boxShadow:"none"}},[`&.${H.active}`]:{...e.vars?{boxShadow:`0px 0px 0px 14px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 14px ${dt(e.palette[t].main,.16)}`}}}}))]}))),ja=be(ka,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(xe(({theme:e})=>({zIndex:1,whiteSpace:"nowrap",...e.typography.body2,fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${H.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${H.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),Pa=be("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>Ct(e)&&e!=="markActive",overridesResolver:(e,t)=>{const{markActive:s}=e;return[t.mark,s&&t.markActive]}})(xe(({theme:e})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}}]}))),Ia=be("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>Ct(e)&&e!=="markLabelActive",overridesResolver:(e,t)=>t.markLabel})(xe(({theme:e})=>({...e.typography.body2,color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(e.vars||e).palette.text.primary}}]}))),Aa=e=>{const{disabled:t,dragging:s,marked:o,orientation:r,track:h,classes:p,color:l,size:d}=e,C={root:["root",t&&"disabled",s&&"dragging",o&&"marked",r==="vertical"&&"vertical",h==="inverted"&&"trackInverted",h===!1&&"trackFalse",l&&`color${re(l)}`,d&&`size${re(d)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",d&&`thumbSize${re(d)}`,l&&`thumbColor${re(l)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return Nt(C,ya,p)},Ma=({children:e})=>e,Ea=S.forwardRef(function(t,s){const o=Ft({props:t,name:"MuiSlider"}),r=zt(),{"aria-label":h,"aria-valuetext":p,"aria-labelledby":l,component:d="span",components:C={},componentsProps:i={},color:u="primary",classes:g,className:y,disableSwap:v=!1,disabled:f=!1,getAriaLabel:w,getAriaValueText:G,marks:N=!1,max:L=100,min:j=0,name:_,onChange:je,onChangeCommitted:K,orientation:J="horizontal",shiftStep:ee=10,size:B="medium",step:ne=1,scale:q=xt,slotProps:T,slots:x,tabIndex:Z,track:M="normal",value:ke,valueLabelDisplay:E="off",valueLabelFormat:te=xt,...me}=o,A={...o,isRtl:r,max:L,min:j,classes:g,disabled:f,disableSwap:v,orientation:J,marks:N,color:u,size:B,step:ne,shiftStep:ee,scale:q,track:M,valueLabelDisplay:E,valueLabelFormat:te},{axisProps:se,getRootProps:_e,getHiddenInputProps:Ye,getThumbProps:Pe,open:Ke,active:Ie,axis:oe,focusedThumbIndex:le,range:ie,dragging:ce,marks:X,values:V,trackOffset:ue,trackLeap:Xe,getThumbStyle:Ae}=ga({...A,rootRef:s});A.marked=X.length>0&&X.some(R=>R.label),A.dragging=ce,A.focusedThumbIndex=le;const O=Aa(A),we=(x==null?void 0:x.root)??C.Root??wa,Me=(x==null?void 0:x.rail)??C.Rail??Ta,Ee=(x==null?void 0:x.track)??C.Track??Sa,Re=(x==null?void 0:x.thumb)??C.Thumb??La,De=(x==null?void 0:x.valueLabel)??C.ValueLabel??ja,fe=(x==null?void 0:x.mark)??C.Mark??Pa,$e=(x==null?void 0:x.markLabel)??C.MarkLabel??Ia,n=(x==null?void 0:x.input)??C.Input??"input",c=(T==null?void 0:T.root)??i.root,b=(T==null?void 0:T.rail)??i.rail,k=(T==null?void 0:T.track)??i.track,P=(T==null?void 0:T.thumb)??i.thumb,m=(T==null?void 0:T.valueLabel)??i.valueLabel,$=(T==null?void 0:T.mark)??i.mark,U=(T==null?void 0:T.markLabel)??i.markLabel,D=(T==null?void 0:T.input)??i.input,W=ae({elementType:we,getSlotProps:_e,externalSlotProps:c,externalForwardedProps:me,additionalProps:{...xa(we)&&{as:d}},ownerState:{...A,...c==null?void 0:c.ownerState},className:[O.root,y]}),Te=ae({elementType:Me,externalSlotProps:b,ownerState:A,className:O.rail}),Pt=ae({elementType:Ee,externalSlotProps:k,additionalProps:{style:{...se[oe].offset(ue),...se[oe].leap(Xe)}},ownerState:{...A,...k==null?void 0:k.ownerState},className:O.track}),Ze=ae({elementType:Re,getSlotProps:Pe,externalSlotProps:P,ownerState:{...A,...P==null?void 0:P.ownerState},className:O.thumb}),It=ae({elementType:De,externalSlotProps:m,ownerState:{...A,...m==null?void 0:m.ownerState},className:O.valueLabel}),Qe=ae({elementType:fe,externalSlotProps:$,ownerState:A,className:O.mark}),Je=ae({elementType:$e,externalSlotProps:U,ownerState:A,className:O.markLabel}),At=ae({elementType:n,getSlotProps:Ye,externalSlotProps:D,ownerState:A});return a.jsxs(we,{...W,children:[a.jsx(Me,{...Te}),a.jsx(Ee,{...Pt}),X.filter(R=>R.value>=j&&R.value<=L).map((R,z)=>{const et=He(R.value,j,L),Fe=se[oe].offset(et);let Q;return M===!1?Q=V.includes(R.value):Q=M==="normal"&&(ie?R.value>=V[0]&&R.value<=V[V.length-1]:R.value<=V[0])||M==="inverted"&&(ie?R.value<=V[0]||R.value>=V[V.length-1]:R.value>=V[0]),a.jsxs(S.Fragment,{children:[a.jsx(fe,{"data-index":z,...Qe,...!We(fe)&&{markActive:Q},style:{...Fe,...Qe.style},className:ge(Qe.className,Q&&O.markActive)}),R.label!=null?a.jsx($e,{"aria-hidden":!0,"data-index":z,...Je,...!We($e)&&{markLabelActive:Q},style:{...Fe,...Je.style},className:ge(O.markLabel,Je.className,Q&&O.markLabelActive),children:R.label}):null]},z)}),V.map((R,z)=>{const et=He(R,j,L),Fe=se[oe].offset(et),Q=E==="off"?Ma:De;return a.jsx(Q,{...!We(Q)&&{valueLabelFormat:te,valueLabelDisplay:E,value:typeof te=="function"?te(q(R),z):te,index:z,open:Ke===z||Ie===z||E==="on",disabled:f},...It,children:a.jsx(Re,{"data-index":z,...Ze,className:ge(O.thumb,Ze.className,Ie===z&&O.active,le===z&&O.focusVisible),style:{...Fe,...Ae(z),...Ze.style},children:a.jsx(n,{"data-index":z,"aria-label":w?w(z):h,"aria-valuenow":q(R),"aria-labelledby":l,"aria-valuetext":G?G(q(R),z):p,value:V[z],...At})})},z)})]})}),Ra=kt(a.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),yt=kt(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),Da=["Critical","Strained","Unstable","Stable","Improving","Strong","Thriving"];function $a(){const e=[9,29,49,69,84,99,100],t={data:{},order:[]};t.order=e.map((r,h)=>{const p=ze();return t.data[p]={name:Da[h],max:r},p});const s={data:{},order:[]},o=ze();return s.data[o]={name:"default",value:1},s.order=[o],{id:ze(),refId:ze(),version:0,name:"",description:"",icon:{...ta[0],color:"black",backgroundColor:"#fbf7ef"},balance:{cost:{base:0,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},max:{base:1,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},health:{base:0,perLevel:!1,valuePerLevel:0,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]}},thresholds:t,settlementPointCost:s,isPositive:!0,canHurt:!0,isTradeable:!0,hasThresholds:!0,hasSPC:!0,genre:"",subGenre:"",properties:{data:{canOverflow:!0,isCurrency:!1,requiresUpkeep:!1,canGather:!1},config:{},order:["canOverflow","isCurrency","requiresUpkeep"]},tags:[],isValid:!1,status:"DRAFT",createdBy:""}}const Le={name:{label:"Attribute Name",type:"text",tooltip:"The unique name of the attribute. This should clearly convey the attribute's purpose and role within the settlement mechanics.",validateFn:e=>e?e.trim().length<3?"Attribute name must be at least 3 characters long":null:"Attribute name is required",keypath:"name"},costPerLevel:{label:"Currency Cost",type:"number",tooltip:"The amount of currency required per level to acquire this attribute. This cost scales with the settlement's level.",validateFn:e=>e?e<=0?"Cost per level must be greater than 0":null:"Cost per level is required",keypath:"balance.cost.base"},healthPerLevel:{label:"Health Drain",type:"number",tooltip:"This value represents the health damage the settlement takes for each missing unit of this attribute, scaled by settlement level.",validateFn:e=>e==null?"Health per level is required":e<0?"Health per level cannot be negative":null,keypath:"balance.health.base"},maxPerLevel:{label:"Max",type:"number",tooltip:"The maximum number of units of this attribute that can provide benefits to the settlement per level.",validateFn:e=>e===void 0?"Max per level is required":e<0?"Max per level must be 0 or greater":null,keypath:"balance.max.base"},description:{label:"Description",type:"textarea",tooltip:"A brief explanation of the attribute's purpose and impact. This provides essential context for understanding its role in the settlement.",validateFn:e=>e?e.trim().length<30?`Description must be at least 30 characters long. You need ${30-e.length} more characters.`:null:"Description is required",keypath:"description"},healthValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for health per level. This value represents the scaling value per interval based on Health Drain.",validateFn:e=>e==null?"Health per level scale is required":null,keypath:"balance.health.valuePerLevel"},healthIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which health is calculated based on the health drain. This value determines how often the health is updated.",validateFn:e=>e==null?"Health interval per level is required":e<=0?"Health interval per level must be greater than 0":null,keypath:"balance.health.interval"},costValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for cost per level. This value represents the scaling value per interval based on Cost.",validateFn:e=>e==null?"Cost per level scale is required":null,keypath:"balance.cost.valuePerLevel"},costIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which cost is calculated based on the cost per level. This value determines how often the cost is updated.",validateFn:e=>e==null?"Cost interval per level is required":e<=0?"Cost interval per level must be greater than 0":null,keypath:"balance.cost.interval"},maxValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for max per level. This value represents the scaling value per interval based on Max.",validateFn:e=>e==null?"Max per level scale is required":null,keypath:"balance.max.valuePerLevel"},maxIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which max is calculated based on the max per level. This value determines how often the max is updated.",validateFn:e=>e==null?"Max interval per level is required":e<=0?"Max interval per level must be greater than 0":null,keypath:"balance.max.interval"}},Y=({keypath:e,trueLabel:t="",falseLabel:s="",sx:o={display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,boxSizing:"border-box",transition:"background-color 0.3s ease, border-color 1s ease",borderLeft:"2px solid",pl:2,py:.5,width:"100%",color:"text.primary",borderRadius:0},tooltip:r,disabled:h=!1,onChange:p,falseColor:l="warning",trueColor:d="success",trueThemeKey:C="main",falseThemeKey:i="main",border:u=!0,variant:g="row",buttonType:y="button",heightLock:v=!1})=>{const{tool:f,id:w}=S.useContext(St),{updateTool:G,selectEditValue:N}=ye(f,w),L=N(e),{utils:j}=Vt(),_=()=>{G(e,!L),typeof p=="function"&&p(!L)};return a.jsxs(wt,{tabIndex:-1,disableFocusRipple:!0,disabled:h,onClick:()=>{y==="button"&&_()},sx:{...o,borderColor:L?j.color(d,C,.5):j.color(l,i,.5),"&:hover":{bgcolor:L?j.color(d,C,.1):j.color(l,i,.1)},borderLeft:u?o==null?void 0:o.borderLeft:"none",flexDirection:g},children:[a.jsx(de,{title:a.jsx(F,{variant:"body2",children:r||`Toggle ${e}`}),placement:"top",arrow:!0,children:a.jsx(F,{variant:"body2",sx:{flexGrow:1,textAlign:"left",textTransform:"uppercase"},children:L?t:s||t})}),a.jsx(Tt,{id:`${f}-${w}-${e}`,size:"small",color:L?d:l,checked:L===!0,sx:{"& .MuiSwitch-switchBase":{"&.Mui-checked":{color:j.color(d,C,.8)},"&:not(.Mui-checked)":{color:j.color(l,i,.8)}},"& .MuiSwitch-track":{backgroundColor:j.color("info","light",1)}},onClick:()=>{(y="switch")&&_()}})]})},Fa=Ut(qt.div)({}),Ge=({children:e,show:t=!0,duration:s=.3,sx:o={},onMouseLeave:r=()=>{},onMouseEnter:h=()=>{}})=>a.jsx(Ot,{children:t&&a.jsx(Fa,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:s},style:{overflow:"hidden",marginBottom:"0.5rem"},sx:o,onMouseLeave:r,onMouseEnter:h,children:e})}),za={linear:"Change Per Interval","slow-exponential":"Base","fast-exponential":"Base",custom:"Change Per Interval"},rt=({disabled:e,property:t,fields:s,slide:o,setSlide:r,slideLabel:h="",slideColor:p="secondary",borderColor:l="honey.main",accentColor:d="info.main"})=>{const{id:C,tool:i}=Ce(),{edit:u,updateTool:g,selectEditValue:y}=ye(i,C),[v,f]=S.useState(!1),w=y(`balance.${t}`);if(!w)return null;const{valuePerLevel:G,interval:N,scaleToggle:L,scaleCurve:j,base:_,perLevel:je,valuesPerInterval:K}=w,J=()=>{const ee=u.balance[t],{interval:B,scaleToggle:ne,valuesPerInterval:q}=ee;if(B<=0)return[];const T={};if(q.forEach(x=>{x&&x.level&&x.value!==void 0&&(T[x.level]=x.value)}),ne){const x=Array.from({length:Math.ceil(21/B)},(Z,M)=>M*B).slice(1,21).map(Z=>({level:Z,value:0}));g(`balance.${t}.valuesPerInterval`,x)}else return[]};return S.useEffect(()=>{j==="custom"&&J()},[j,N]),a.jsxs(Ge,{show:!e,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",border:"1px solid",borderColor:u!=null&&u.balance[t].perLevel?v?d:l:"transparent",transition:"border-color 0.3s ease, padding 0.3s ease",boxSizing:"border-box",p:u.balance[t].perLevel?1:0,borderRadius:2},onMouseEnter:f.bind(null,!0),onMouseLeave:f.bind(null,!1),children:[a.jsx(he,{inputConfig:s[`${t}PerLevel`]}),a.jsx(Y,{keypath:`balance.${t}.perLevel`,trueLabel:"Scale",falseLabel:"Flat",tooltip:"Enable to automatically adjust related values when max per level changes.",border:!1,variant:"column-reverse",disabled:e,heightLock:!0}),a.jsxs(Ge,{show:u==null?void 0:u.balance[t].perLevel,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",justifyContent:"center"},children:[a.jsx(he,{inputConfig:s[`${t}IntervalPerLevel`],decimals:0,allowZero:!1}),a.jsx(Y,{keypath:`balance.${t}.scaleToggle`,trueLabel:"Custom",falseLabel:"Default",variant:"column-reverse",tooltip:"Enable scaling separate from the base value.",border:!1,heightLock:!0}),a.jsxs(Ge,{show:u==null?void 0:u.balance[t].scaleToggle,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"center"},children:[a.jsx(he,{dynamicLabel:za[u==null?void 0:u.balance[t].scaleCurve],inputConfig:s[`${t}ValuePerLevel`],style:{width:"100%"},disabled:(u==null?void 0:u.balance[t].scaleCurve)==="custom"}),a.jsx(ra,{keypath:`balance.${t}.scaleCurve`,label:"Scale Curve",options:[{value:"linear",name:"Linear"},{value:"slow-exponential",name:"Slow Exponential"},{value:"fast-exponential",name:"Fast Exponential"},{value:"custom",name:"Per Interval"}],small:!1}),a.jsx(Ge,{show:(u==null?void 0:u.balance[t].scaleCurve)==="custom",sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)","repeat(4, 1fr)","repeat(5, 1fr)"],gap:1,width:"100%"},children:K.map((ee,B)=>a.jsx(he,{inputConfig:{keypath:`balance.${t}.valuesPerInterval.${B}.value`,label:`Level ${ee.level}`,type:"number"},style:{width:"100%"}},`${t}-interval-${B}`))})]})]})]})},Na=({columns:e})=>{const{tool:t,id:s}=S.useContext(St),{edit:o}=ye(t,s),[r,h]=S.useState(!1),[p,l]=S.useState(5),d=i=>{const u=o.balance[i],{base:g,perLevel:y,valuePerLevel:v,interval:f,scaleToggle:w}=u;return w?`Floor(${p} / ${f}) * ${v} + ${g})`:y?`Floor(${p} / ${f}) * ${g})`:`${g}`},C=i=>{const u=o.balance[i],{base:g,perLevel:y,valuePerLevel:v,interval:f,scaleToggle:w,scaleCurve:G,valuesPerInterval:N}=u;if(g===void 0)return"0";switch(w){case!0:{const L=p/f;switch(G){case"linear":return(Math.floor(L)*v+g).toFixed(0);case"slow-exponential":return(Math.pow(L,1.5)*v+g).toFixed(0);case"fast-exponential":return(Math.pow(L,2)*v+g).toFixed(0);case"custom":{if(!(N!=null&&N.length))return g.toFixed(0);const j=Math.floor(L);return j<0||j-1>=N.length?g.toFixed(0):(N.slice(0,j).reduce((K,J)=>K+J.value,0)+g).toFixed(0)}default:return g.toFixed(0)}}case!1:return y?(Math.max(1,Math.floor(p/f))*g).toFixed(0):g.toFixed(0);default:return g.toFixed(0)}};return o?a.jsxs(I,{id:`attr-values-${s}`,sx:{display:"flex",flexDirection:"column",gap:2},children:[a.jsxs(Gt,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,height:"100%"},children:[a.jsxs(Bt,{sx:{display:"flex",alignItems:"center",gap:.5},children:[a.jsx(F,{children:"Autobalance"}),a.jsx(de,{title:"Automatically adjust related values to maintain a balanced configuration.",children:a.jsx(aa,{sx:{fontSize:18,color:"text.secondary",cursor:"pointer"}})})]}),a.jsx(Tt,{checked:r,onChange:i=>h(i.target.checked)})]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"auto",alignItems:"center",justifyContent:"start",my:2,width:"100%",position:"relative",gridColumn:"span 3",boxSizing:"border-box"},children:[a.jsx(I,{sx:{gridColumn:"span 2",display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:a.jsxs(I,{sx:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",px:4},children:[a.jsx(Ea,{valueLabelDisplay:"auto",color:"secondary",defaultValue:p,value:p,onChange:(i,u)=>{l(u)},min:1,max:20,step:1}),a.jsxs(I,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:1},children:[a.jsx(F,{variant:"body2",sx:{fontWeight:"bold",width:"100%"},children:`Values at Level ${p}: `}),a.jsx(de,{title:d("max"),children:a.jsxs(F,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"success.main"},children:["Max: ",C("max")]})}),o.canHurt&&a.jsx(de,{title:d("health"),children:a.jsxs(F,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"error.main"},children:["Health: ",C("health")]})}),o.isTradeable&&a.jsx(de,{title:d("cost"),children:a.jsxs(F,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"honey.main"},children:["Cost: ",C("cost")]})})]})]})}),a.jsx(rt,{disabled:!1,property:"max",fields:Le,slide:p,setSlide:l,slideLabel:"Max Value",borderColor:"dividerDark"}),a.jsx(rt,{disabled:!o.canHurt,property:"health",fields:Le,slide:p,setSlide:l,slideLabel:"Total Drain",borderColor:"dividerDark",accentColor:"error.main"}),a.jsx(rt,{disabled:!o.isTradeable,property:"cost",fields:Le,slide:p,setSlide:l,slideLabel:"Total Cost",borderColor:"dividerDark",accentColor:"honey.main"})]})]}):null},Va={name:"",tooltip:"",type:"number",validate:e=>e<=-1?"Value must be 0 or greater":null,keypath:""},Oa=({content:e})=>a.jsx(F,{component:"span",children:e.map((t,s)=>t.type==="text"?a.jsx("span",{children:t.value},s):t.type==="strong"?a.jsx("strong",{children:t.value},s):t.type==="tooltip"?a.jsx(de,{title:t.title,arrow:!0,children:a.jsx(F,{component:"span",sx:{textDecoration:"underline",fontWeight:"bold",cursor:"pointer"},onClick:t.onClick,children:t.value})},s):null)}),Ua=[{name:"Fortified",description:"Fortified Settlements put their trust in theirs walls, preemptive reconnaissance, and well-trained troops.",id:"789"},{name:"Mercantile",description:"Mercantile Settlements focus on establishing and expanding trade, developing vibrant culture, and welcoming artisans.",id:"456"},{name:"Survivalist",description:"Survivalists focus on gathering food, supplies, medical items, and constructing durable shelters.",id:"123"}],qa=[{type:"text",value:"Define the "},{type:"tooltip",title:"Settlements earn 1 settlement point per level per turn, barring other boons or banes. Click for more information.",value:"Settlement Point Cost",onClick:()=>console.log("open SPC help panel")},{type:"text",value:" of this attribute per Settlement Type. A value of "},{type:"strong",value:"0"},{type:"text",value:" means this cannot be purchased with settlement points for that settlement type."}],Ga=()=>{const{tool:e,id:t}=Ce(),{data:s,order:o,errors:r,add:h,remove:p}=na(e,t,"settlementPointCost"),[l,d]=S.useState(null),[C,i]=S.useState(""),u=S.useMemo(()=>{const y=Object.keys(s||{}).reduce((f,w)=>(f.push(w),f),[]);return Ua.filter(f=>!y.includes(f.id))},[s]),g=S.useMemo(()=>Object.entries(s||{}).map(([y,v])=>{const f=v;return{...Va,name:f.name,label:f.name.charAt(0).toUpperCase()+f.name.slice(1),tooltip:void 0,id:y,keypath:`settlementPointCost.data.${y}.value`}}),[s]);return o?a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"1fr 0.1fr 1fr",gap:2},children:[a.jsx(I,{sx:{gridColumn:"span 3",p:2},children:a.jsx(Oa,{content:qa})}),a.jsx(I,{sx:{display:"flex",alignItems:"start",width:"100%"},children:a.jsx(Wt,{inputValue:C,options:u,getOptionLabel:y=>y.name,renderInput:y=>a.jsx(Ht,{...y,label:"Settlement Type",variant:"outlined",error:!!(r!=null&&r.name),helperText:r==null?void 0:r.name,onChange:v=>{i(v.target.value)},onKeyDown:v=>{v.key==="Enter"&&(h({id:l.id,entry:{name:l.name,value:1},sort:!1}),i(""))}}),onChange:(y,v)=>{d(v),i((v==null?void 0:v.name)||"")},renderOption:(y,v)=>S.createElement(I,{...y,component:"li",key:v.name,sx:{display:"flex",alignItems:"center"}},a.jsx(de,{title:a.jsx(F,{children:v.description}),placement:"left",arrow:!0,children:a.jsx(F,{children:v.name})})),sx:{my:2,width:"100%"}})}),a.jsx(pe,{orientation:"vertical",flexItem:!0,children:a.jsx(_t,{label:a.jsx(Ra,{}),onClick:()=>{h({id:l.id,entry:{name:l.name,value:1},sort:!1}),i("")},sx:{width:"100%",color:"white"}})}),a.jsx(I,{children:o.map((y,v)=>{const f=g.find(w=>w.id===y);return f?a.jsx(Yt.Fragment,{children:a.jsx(he,{inputConfig:f,style:{width:"100%",m:0,p:0},shrink:!0,onMoreDetails:f.name!=="default"?()=>{console.log("More details clicked")}:void 0,onRemove:f.name!=="default"?()=>p(y):void 0})},y):null})})]}):a.jsx(I,{children:"Loading..."})},Ba={propertiesExpanded:!0,editTabs:{Properties:{name:"Properties",disabled:!1},Values:{name:"Values",disabled:!1},SPC:{name:"SPC",disabled:!1},Thresholds:{name:"Thresholds",disabled:!1},Currency:{name:"Currency",disabled:!0},Gather:{name:"Gather",disabled:!0},Upkeep:{name:"Upkeep",disabled:!0}},activeTab:"Properties",lastTab:null,activeIndex:0,lastIndex:0};function Wa(e,t){switch(t.type){case"TOGGLE_PROPERTIES":return{...e,propertiesExpanded:!e.propertiesExpanded};case"SET_ACTIVE_TAB":const{name:s,index:o,defaultLast:r}=t.payload;return{...e,lastIndex:r?0:e.activeIndex,lastTab:r?"Values":e.activeTab,activeTab:s,activeIndex:o};case"SET_TAB_DISABLED":{const{property:h,disabled:p}=t.payload;return{...e,editTabs:{...e.editTabs,[h]:{...e.editTabs[h],disabled:p}}}}default:return e}}const st=(e,t,s)=>({type:"SET_ACTIVE_TAB",payload:{name:e,index:t,defaultLast:s}}),Ha=(e,t)=>({type:"SET_TAB_DISABLED",payload:{property:e,disabled:t}}),_a=({columns:e})=>{var d,C,i,u;const t=lt(),{tool:s,id:o,showModal:r,tabId:h,side:p}=Ce(),{edit:l}=ye(s,o);return S.useEffect(()=>{l!=null&&l.name&&(t(nt({tabId:h,side:p,keypath:"name",updates:(l==null?void 0:l.name.trim().length)>0?l==null?void 0:l.name.trim():"Untitled"})),t(nt({tabId:h,side:p,keypath:"viewState.isDirty",updates:!0})))},[l==null?void 0:l.name,t,h,p]),a.jsxs(a.Fragment,{children:[a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"flex",alignItems:"center",gap:2},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-around",flexGrow:1},children:[a.jsx(F,{variant:"h6",children:"Icon:"}),a.jsx(Lt,{viewBox:((d=l==null?void 0:l.icon)==null?void 0:d.viewBox)||"0 0 664 512",path:((C=l==null?void 0:l.icon)==null?void 0:C.d)||"",size:24,color:((i=l==null?void 0:l.icon)==null?void 0:i.color)||"primary",backgroundColor:((u=l==null?void 0:l.icon)==null?void 0:u.backgroundColor)||"background.paper",onClick:()=>{r({entry:{componentKey:"IconSelector",props:{tool:s,id:o,tabId:h,side:p},id:"icon-selector"}})}})]}),a.jsx(he,{inputConfig:Le.name,style:{flexGrow:2,flexShrink:1,px:1}})]}),a.jsx(he,{inputConfig:Le.description,style:{gridColumn:`span ${e}`,px:1},multiline:!0})]})},Ya={isTradeable:{disables:["properties.data.isCurrency"]},"properties.data.isCurrency":{disables:["properties.data.requiresUpkeep","isTradeable"],enables:["properties.data.canOverflow"]},"properties.data.requiresUpkeep":{disables:["properties.data.isCurrency","properties.data.canHarvest"]},"properties.data.canGather":{disables:["properties.data.requiresUpkeep"]}},Ka={hasThresholds:{key:"Thresholds",value:!0},hasSPC:{key:"SPC",value:!0},"properties.data.isCurrency":{key:"Currency",value:!1},"properties.data.requiresUpkeep":{key:"Upkeep",value:!1},"properties.data.canGather":{key:"Gather",value:!1}},Xa=({columns:e,activeTab:t,lastTab:s,lastIndex:o,localDispatch:r})=>{const{tool:h,id:p,showModal:l,tabId:d,side:C}=Ce(),{edit:i,updateTool:u}=ye(h,p),{makeSnackbar:g}=Kt(),y=(v,f)=>{var N,L;const w=Ya[v],G=Ka[v];G&&(t===G.key&&!f&&r(st(s,o,!0)),r(Ha(G.key,!f))),w&&f&&((N=w.disables)==null||N.forEach(j=>{u(j,!1)}),w!=null&&w.enables&&((L=w==null?void 0:w.enables)==null||L.forEach(j=>{u(j,!0)})))};return i?a.jsxs(a.Fragment,{children:[a.jsx(_a,{columns:e}),a.jsx(I,{sx:{gridColumn:`span ${e}`},children:a.jsx(Xt,{defaultGenre:i.genre,defaultSubGenre:i.subGenre,updateFn:u})}),a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"grid",gridTemplateColumns:["1fr","1fr",`repeat(${e}, 1fr)`],gap:2},children:[a.jsxs(I,{children:[a.jsxs(pe,{children:["Major Properties"," ",a.jsx(pt,{size:"small",children:a.jsx(yt,{})})]}),a.jsx(Y,{keypath:"isPositive",trueLabel:"Is Positive",falseLabel:"Is Negative",falseColor:"error",tooltip:"Toggle if this attribute is positive or negative. A positive attribute is beneficial, while a negative attribute is detrimental."}),a.jsx(Y,{keypath:"canHurt",trueLabel:"Can Hurt",falseLabel:"Cannot Hurt",tooltip:"Toggle if this attribute can affect health."}),a.jsx(Y,{keypath:"isTradeable",trueLabel:"Can Trade",falseLabel:"Cannot Trade",tooltip:"Toggle if this attribute can be traded. This forces a baseline cost, and allows it to be added to Trading Hubs. Tradeable attributes cannot be currency.",disabled:i==null?void 0:i.properties.data.isCurrency}),a.jsx(Y,{keypath:"hasThresholds",trueLabel:"Thresholds",falseLabel:"No Thresholds",tooltip:"Toggle if this attribute has unique thresholds. If disabled, default thresholds will be used internally.",onChange:()=>{y("hasThresholds",!i.hasThresholds),i.hasThresholds&&g({message:"Default thresholds will be used.",type:"info",duration:3e3})}}),a.jsx(Y,{keypath:"hasSPC",trueLabel:"Settlement Points",falseLabel:"No Settlement Points",tooltip:"Toggle if this attribute can be acquired through settlement points.",onChange:()=>{y("hasSPC",!i.hasSPC)}})]}),a.jsxs(I,{children:[a.jsxs(pe,{children:["Minor Properties"," ",a.jsx(pt,{size:"small",children:a.jsx(yt,{})})]}),a.jsx(Y,{keypath:"properties.data.canOverflow",trueLabel:"Can Overflow",falseLabel:"Cannot Overflow",tooltip:"Toggle if this attribute can overflow. Overflowing attributes can exceed their maximum value, but overages will not be counted towards calculations.",disabled:i==null?void 0:i.properties.data.isCurrency}),a.jsx(Y,{keypath:"properties.data.isCurrency",trueLabel:"Is Currency",falseLabel:"Not Currency",tooltip:"Toggle if this attribute is treated as currency. This removes any cap on the attribute's value and allows it to integrate with the Tax System, among other things.",disabled:(i==null?void 0:i.isTradeable)||(i==null?void 0:i.properties.data.requiresUpkeep),onChange:v=>{y("properties.data.isCurrency",v),v&&i.properties.data.canGather&&g({message:"Currency attributes are rarely harvestable. Be sure this makes sense in your world!",type:"warning",duration:5e3})}}),a.jsx(Y,{keypath:"properties.data.requiresUpkeep",trueLabel:"Requires Upkeep",falseLabel:"No Upkeep Required",tooltip:"Toggle if this attribute requires upkeep. This will add an upkeep cost to the attribute, which must be paid with a currency to keep it active.",disabled:(i==null?void 0:i.properties.data.isCurrency)||(i==null?void 0:i.properties.data.canGather),onChange:v=>{y("properties.data.requiresUpkeep",v)}}),a.jsx(Y,{keypath:"properties.data.canGather",trueLabel:"Can Gather",falseLabel:"Cannot Gather",tooltip:"Toggle if this attribute can be acquired by assigning other attributes, e.g. 'Productivity', to it.",disabled:i==null?void 0:i.properties.data.requiresUpkeep,onChange:v=>{y("properties.data.canGather",v),v&&i.properties.data.isCurrency&&g({message:"Harvestable attributes are rarely currency. Be sure this makes sense in your world!",type:"warning",duration:5e3})}})]})]}),a.jsx(la,{})]}):null};function Za({id:e,tool:t,tabId:s,side:o}){return async(r,h)=>{var i,u;const p=h(),l=ht.cloneDeep(p.tools[t].edit.byId[e]),d=Object.keys(((u=(i=p.tabs[o].data[s])==null?void 0:i.viewState)==null?void 0:u.dirtyKeypaths)||{});if(d.length===0)return;const C={};d.forEach(g=>{const y=g.split(".").shift();C[y]=ht.get(l,y)}),r(bt({tool:t,id:e,updates:{...C,version:1}})),r(Zt({tabId:s}));try{l.version===0?await mt.saveTool({id:e,tool:t,data:{...l,version:1}}):await mt.saveTool({id:e,tool:t,data:{...C}})}catch(g){console.error("Error during batch update:",g),r(Qt({message:`Failed to batch update ${l.name}. Please try again.`,type:"error",duration:5e3})),r(bt({tool:t,id:e,updates:{...l}}))}}}function Qa({tool:e,id:t,tabId:s,side:o,name:r}){const h=lt();return{name:r,batchSaveFn:async()=>{h(Za({id:t,side:o,tabId:s,tool:e}))},intervalMs:6e4}}const Ja={Properties:Xa,Values:Na,SPC:Ga,Thresholds:sa,Currency:()=>a.jsx(I,{children:"Currency Component"}),Gather:()=>a.jsx(I,{children:"Gather Component"}),Upkeep:()=>a.jsx(I,{children:"Upkeep Component"})},er=()=>{const{tab:e,id:t}=Ce(),{both:s}=Jt(),o=lt(),[r,h]=S.useReducer(Wa,e.viewState.editAttr||Ba),{activeTab:p,editTabs:l,lastIndex:d}=r;ea(Qa({name:e.name,tool:"attribute",id:t,tabId:e.tabId,side:e.side})),S.useEffect(()=>{e.lastTab&&e.lastIndex&&h(st(e.lastTab,e.lastIndex))},[]),S.useEffect(()=>()=>{o(nt({tabId:e.tabId,side:e.side,keypath:"viewState.editAttr",updates:{...r}}))},[r]);const C=s?1:2,i=(u,g)=>{h(st(u,g))};return a.jsx(I,{id:`edit-attribute-${e.id}`,sx:{height:"100%",transition:"height 0.4s ease-in-out",overflow:"auto",width:"100%",px:2,boxSizing:"border-box"},children:a.jsx(ia,{tabs:Object.values(l).map(u=>({...u,disabled:u.disabled||!1,props:{localDispatch:h}})),componentMap:Ja,activeTab:p,handleTabClick:i,columns:C,lastIndex:d})})},tr=()=>{var h,p,l,d,C,i,u,g,y,v;const{tool:e,id:t,mode:s,side:o}=Ce(),{current:r}=ye("attribute",t);return a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",mt:2,gap:2,width:"100%",position:"relative",pb:4},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,height:"88px",flexGrow:1,flexShrink:2},children:[a.jsx(F,{variant:"body1",sx:{fontWeight:"bold",fontSize:"1.25rem"},children:"Icon"}),a.jsx(wt,{sx:{boxShadow:4,borderRadius:"50%",height:64,width:64},disabled:!0,children:a.jsx(Lt,{viewBox:((h=r==null?void 0:r.icon)==null?void 0:h.viewBox)||"0 0 664 512",path:((p=r==null?void 0:r.icon)==null?void 0:p.d)||"",size:24,color:((l=r==null?void 0:r.icon)==null?void 0:l.color)||"primary",backgroundColor:((d=r==null?void 0:r.icon)==null?void 0:d.backgroundColor)||"background.paper"})})]}),a.jsxs(I,{sx:{gridColumn:"span 2",display:"flex",gap:2,alignItems:"center",justifyContent:"start",height:"100%"},children:[a.jsx(F,{variant:"h6",children:"Name:"}),a.jsx(F,{children:(r==null?void 0:r.name)||"None"})]}),a.jsx(pe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"DESCRIPTION"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",flexDirection:"column",gap:2,alignItems:"start",justifyContent:"center"},children:[a.jsx(F,{sx:{textAlign:"start"},variant:"body1",children:(r==null?void 0:r.description)||"No description"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",gap:2,alignItems:"center",justifyContent:"center"},children:[a.jsx(F,{variant:"body1",sx:{fontWeight:"bold"},children:"Type:"}),a.jsx(F,{variant:"body1",children:r!=null&&r.isPositive?"Positive":"Negative"})]})]}),a.jsxs(pe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:[" ","SCALING PER LEVEL"," "]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridColumn:"span 3",columnGap:2},children:[a.jsx(Ne,{name:"Max",value:(i=(C=r==null?void 0:r.balance)==null?void 0:C.max)==null?void 0:i.base,even:!1}),a.jsx(Ne,{name:"Health",value:(g=(u=r==null?void 0:r.balance)==null?void 0:u.health)==null?void 0:g.base,even:!0}),a.jsx(Ne,{name:"Cost",value:(v=(y=r==null?void 0:r.balance)==null?void 0:y.cost)==null?void 0:v.base,even:!1})]}),a.jsx(pe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"SETTLEMENT POINT COSTS"}),r.settlementPointCost.order.map((f,w)=>a.jsx(Ne,{name:r.settlementPointCost.data[f].name,value:r.settlementPointCost.data[f].value,even:w%2===0},f)),a.jsx(pe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"THRESHOLDS"}),a.jsx(oa,{data:r.thresholds.data,order:r.thresholds.order})]})},ar=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],rr=["name","description","balance","thresholds","settlementPointCost"],fr=({tab:e})=>a.jsx(ca,{tab:e,initializeTool:$a,validationFields:rr,editComponent:er,previewComponent:tr,checklistContent:ar});export{fr as default,rr as validationFields};
