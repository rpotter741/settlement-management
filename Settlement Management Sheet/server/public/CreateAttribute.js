import{k as T,F as Nt,G as Le,H as Vt,I as Ot,J as nt,K as He,L as st,M as ht,N as We,O as wt,P as St,Q as ge,j as a,R as Tt,S as Bt,U as oe,V as J,W as H,X as jt,Y as ee,_ as Ke,$ as lt,a0 as ct,a1 as _e,a2 as Lt,a3 as ot,a4 as Ut,a5 as Pt,q as Ne,f as ke,g as It,E as me,T as z,B as I,a6 as qt,a7 as Gt,A as Ht,m as Wt,a8 as fe,a9 as _t,aa as Yt,b as pt,u as ut,ab as bt,l as mt,ac as ft,c as Kt,t as vt,h as Xt}from"./main.js";import{i as Jt}from"./iconList.js";import{S as $t,u as At,a as we}from"./PageBox.js";import{T as ve,I as Qt}from"./ToolInput.js";import{T as Zt}from"./ToolSelect.js";import{u as ea,a as ta}from"./useSharedHooks.js";import{A as aa,s as ra,m as na,T as sa}from"./TabbedContent.js";import{u as oa,O as ia,R as Ve,P as la}from"./ThresholdPreview.js";import{I as Mt}from"./Icon.js";import{G as ca}from"./GenreSelect.js";import{A as ua}from"./TagTable.js";import{u as da}from"./useTabSplit.js";import{u as pa}from"./useAutosave.js";import{C as ha}from"./CreateToolShell.js";import"./useDebounce.js";const ba={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function ma(e,t,n=(o,r)=>o===r){return e.length===t.length&&e.every((o,r)=>n(o,t[r]))}const fa=2;function Ce(e,t,n,o,r){return n===1?Math.min(e+t,r):Math.max(e-t,o)}function Et(e,t){return e-t}function gt(e,t){const{index:n}=e.reduce((o,r,p)=>{const d=Math.abs(t-r);return o===null||d<o.distance||d===o.distance?{distance:d,index:p}:o},null)??{};return n}function Oe(e,t){if(t.current!==void 0&&e.changedTouches){const n=e;for(let o=0;o<n.changedTouches.length;o+=1){const r=n.changedTouches[o];if(r.identifier===t.current)return{x:r.clientX,y:r.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function Ye(e,t,n){return(e-t)*100/(n-t)}function va(e,t,n){return(n-t)*e+t}function ga(e){if(Math.abs(e)<1){const n=e.toExponential().split("e-"),o=n[0].split(".")[1];return(o?o.length:0)+parseInt(n[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}function xa(e,t,n){const o=Math.round((e-n)/t)*t+n;return Number(o.toFixed(ga(t)))}function xt({values:e,newValue:t,index:n}){const o=e.slice();return o[n]=t,o.sort(Et)}function Be({sliderRef:e,activeIndex:t,setActive:n}){var r,p,d;const o=He(e.current);(!((r=e.current)!=null&&r.contains(o.activeElement))||Number((p=o==null?void 0:o.activeElement)==null?void 0:p.getAttribute("data-index"))!==t)&&((d=e.current)==null||d.querySelector(`[type="range"][data-index="${t}"]`).focus()),n&&n(t)}function Ue(e,t){return typeof e=="number"&&typeof t=="number"?e===t:typeof e=="object"&&typeof t=="object"?ma(e,t):!1}const ya={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},Ca=e=>e;let qe;function yt(){return qe===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?qe=CSS.supports("touch-action","none"):qe=!0),qe}function ka(e){const{"aria-labelledby":t,defaultValue:n,disabled:o=!1,disableSwap:r=!1,isRtl:p=!1,marks:d=!1,max:i=100,min:u=0,name:y,onChange:l,onChangeCommitted:h,orientation:b="horizontal",rootRef:f,scale:m=Ca,step:g=1,shiftStep:w=10,tabIndex:V,value:D}=e,S=T.useRef(void 0),[L,_]=T.useState(-1),[ie,Q]=T.useState(-1),[re,ne]=T.useState(!1),W=T.useRef(0),le=T.useRef(null),[G,j]=Nt({controlled:D,default:n??u,name:"Slider"}),C=l&&((s,c,v)=>{const k=s.nativeEvent||s,P=new k.constructor(k.type,k);Object.defineProperty(P,"target",{writable:!0,value:{value:c,name:y}}),le.current=c,l(P,c,v)}),te=Array.isArray(G);let A=te?G.slice().sort(Et):[G];A=A.map(s=>s==null?u:Le(s,u,i));const Se=d===!0&&g!==null?[...Array(Math.floor((i-u)/g)+1)].map((s,c)=>({value:u+g*c})):d||[],M=Se.map(s=>s.value),[se,xe]=T.useState(-1),$=T.useRef(null),ce=Vt(f,$),Xe=s=>c=>{var k;const v=Number(c.currentTarget.getAttribute("data-index"));ht(c.target)&&xe(v),Q(v),(k=s==null?void 0:s.onFocus)==null||k.call(s,c)},Je=s=>c=>{var v;ht(c.target)||xe(-1),Q(-1),(v=s==null?void 0:s.onBlur)==null||v.call(s,c)},Ie=(s,c)=>{const v=Number(s.currentTarget.getAttribute("data-index")),k=A[v],P=M.indexOf(k);let x=c;if(Se&&g==null){const F=M[M.length-1];x>=F?x=F:x<=M[0]?x=M[0]:x=x<k?M[P-1]:M[P+1]}if(x=Le(x,u,i),te){r&&(x=Le(x,A[v-1]||-1/0,A[v+1]||1/0));const F=x;x=xt({values:A,newValue:x,index:v});let U=v;r||(U=x.indexOf(F)),Be({sliderRef:$,activeIndex:U})}j(x),xe(v),C&&!Ue(x,G)&&C(s,x,v),h&&h(s,le.current??x)},Qe=s=>c=>{var v;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(c.key)){c.preventDefault();const k=Number(c.currentTarget.getAttribute("data-index")),P=A[k];let x=null;if(g!=null){const F=c.shiftKey?w:g;switch(c.key){case"ArrowUp":x=Ce(P,F,1,u,i);break;case"ArrowRight":x=Ce(P,F,p?-1:1,u,i);break;case"ArrowDown":x=Ce(P,F,-1,u,i);break;case"ArrowLeft":x=Ce(P,F,p?1:-1,u,i);break;case"PageUp":x=Ce(P,w,1,u,i);break;case"PageDown":x=Ce(P,w,-1,u,i);break;case"Home":x=u;break;case"End":x=i;break}}else if(Se){const F=M[M.length-1],U=M.indexOf(P),R=[p?"ArrowRight":"ArrowLeft","ArrowDown","PageDown","Home"],Y=[p?"ArrowLeft":"ArrowRight","ArrowUp","PageUp","End"];R.includes(c.key)?U===0?x=M[0]:x=M[U-1]:Y.includes(c.key)&&(U===M.length-1?x=F:x=M[U+1])}x!=null&&Ie(c,x)}(v=s==null?void 0:s.onKeyDown)==null||v.call(s,c)};Ot(()=>{var s;o&&$.current.contains(document.activeElement)&&((s=document.activeElement)==null||s.blur())},[o]),o&&L!==-1&&_(-1),o&&se!==-1&&xe(-1);const $e=s=>c=>{var v;(v=s.onChange)==null||v.call(s,c),Ie(c,c.target.valueAsNumber)},ue=T.useRef(void 0);let de=b;p&&b==="horizontal"&&(de+="-reverse");const pe=({finger:s,move:c=!1})=>{const{current:v}=$,{width:k,height:P,bottom:x,left:F}=v.getBoundingClientRect();let U;de.startsWith("vertical")?U=(x-s.y)/P:U=(s.x-F)/k,de.includes("-reverse")&&(U=1-U);let R;if(R=va(U,u,i),g)R=xa(R,g,u);else{const je=gt(M,R);R=M[je]}R=Le(R,u,i);let Y=0;if(te){c?Y=ue.current:Y=gt(A,R),r&&(R=Le(R,A[Y-1]||-1/0,A[Y+1]||1/0));const je=R;R=xt({values:A,newValue:R,index:Y}),r&&c||(Y=R.indexOf(je),ue.current=Y)}return{newValue:R,activeIndex:Y}},he=nt(s=>{const c=Oe(s,S);if(!c)return;if(W.current+=1,s.type==="mousemove"&&s.buttons===0){Z(s);return}const{newValue:v,activeIndex:k}=pe({finger:c,move:!0});Be({sliderRef:$,activeIndex:k,setActive:_}),j(v),!re&&W.current>fa&&ne(!0),C&&!Ue(v,G)&&C(s,v,k)}),Z=nt(s=>{const c=Oe(s,S);if(ne(!1),!c)return;const{newValue:v}=pe({finger:c,move:!0});_(-1),s.type==="touchend"&&Q(-1),h&&h(s,le.current??v),S.current=void 0,be()}),O=nt(s=>{if(o)return;yt()||s.preventDefault();const c=s.changedTouches[0];c!=null&&(S.current=c.identifier);const v=Oe(s,S);if(v!==!1){const{newValue:P,activeIndex:x}=pe({finger:v});Be({sliderRef:$,activeIndex:x,setActive:_}),j(P),C&&!Ue(P,G)&&C(s,P,x)}W.current=0;const k=He($.current);k.addEventListener("touchmove",he,{passive:!0}),k.addEventListener("touchend",Z,{passive:!0})}),be=T.useCallback(()=>{const s=He($.current);s.removeEventListener("mousemove",he),s.removeEventListener("mouseup",Z),s.removeEventListener("touchmove",he),s.removeEventListener("touchend",Z)},[Z,he]);T.useEffect(()=>{const{current:s}=$;return s.addEventListener("touchstart",O,{passive:yt()}),()=>{s.removeEventListener("touchstart",O),be()}},[be,O]),T.useEffect(()=>{o&&be()},[o,be]);const Ze=s=>c=>{var P;if((P=s.onMouseDown)==null||P.call(s,c),o||c.defaultPrevented||c.button!==0)return;c.preventDefault();const v=Oe(c,S);if(v!==!1){const{newValue:x,activeIndex:F}=pe({finger:v});Be({sliderRef:$,activeIndex:F,setActive:_}),j(x),C&&!Ue(x,G)&&C(c,x,F)}W.current=0;const k=He($.current);k.addEventListener("mousemove",he,{passive:!0}),k.addEventListener("mouseup",Z)},Ae=Ye(te?A[0]:u,u,i),B=Ye(A[A.length-1],u,i)-Ae,Te=(s={})=>{const c=st(s),v={onMouseDown:Ze(c||{})},k={...c,...v};return{...s,ref:ce,...k}},Me=s=>c=>{var k;(k=s.onMouseOver)==null||k.call(s,c);const v=Number(c.currentTarget.getAttribute("data-index"));Q(v)},Ee=s=>c=>{var v;(v=s.onMouseLeave)==null||v.call(s,c),Q(-1)},Re=(s={})=>{const c=st(s),v={onMouseOver:Me(c||{}),onMouseLeave:Ee(c||{})};return{...s,...c,...v}},De=s=>({pointerEvents:L!==-1&&L!==s?"none":void 0});let ye;return b==="vertical"&&(ye=p?"vertical-rl":"vertical-lr"),{active:L,axis:de,axisProps:ya,dragging:re,focusedThumbIndex:se,getHiddenInputProps:(s={})=>{const c=st(s),v={onChange:$e(c||{}),onFocus:Xe(c||{}),onBlur:Je(c||{}),onKeyDown:Qe(c||{})},k={...c,...v};return{tabIndex:V,"aria-labelledby":t,"aria-orientation":b,"aria-valuemax":m(i),"aria-valuemin":m(u),name:y,type:"range",min:e.min,max:e.max,step:e.step===null&&e.marks?"any":e.step??void 0,disabled:o,...s,...k,style:{...ba,direction:p?"rtl":"ltr",width:"100%",height:"100%",writingMode:ye}}},getRootProps:Te,getThumbProps:Re,marks:Se,open:ie,range:te,rootRef:ce,trackLeap:B,trackOffset:Ae,values:A,getThumbStyle:De}}const wa=e=>!e||!We(e);function Sa(e){return St("MuiSlider",e)}const K=wt("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),Ta=e=>{const{open:t}=e;return{offset:ge(t&&K.valueLabelOpen),circle:K.valueLabelCircle,label:K.valueLabelLabel}};function ja(e){const{children:t,className:n,value:o}=e,r=Ta(e);return t?T.cloneElement(t,{className:ge(t.props.className)},a.jsxs(T.Fragment,{children:[t.props.children,a.jsx("span",{className:ge(r.offset,n),"aria-hidden":!0,children:a.jsx("span",{className:r.circle,children:a.jsx("span",{className:r.label,children:o})})})]})):null}function Ct(e){return e}const La=J("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,t[`color${H(n.color)}`],n.size!=="medium"&&t[`size${H(n.size)}`],n.marked&&t.marked,n.orientation==="vertical"&&t.vertical,n.track==="inverted"&&t.trackInverted,n.track===!1&&t.trackFalse]}})(ee(({theme:e})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${K.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${K.dragging}`]:{[`& .${K.thumb}, & .${K.track}`]:{transition:"none"}},variants:[...Object.entries(e.palette).filter(Ke()).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),Pa=J("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),Ia=J("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(ee(({theme:e})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(e.palette).filter(Ke()).map(([t])=>({props:{color:t,track:"inverted"},style:{...e.vars?{backgroundColor:e.vars.palette.Slider[`${t}Track`],borderColor:e.vars.palette.Slider[`${t}Track`]}:{backgroundColor:lt(e.palette[t].main,.62),borderColor:lt(e.palette[t].main,.62),...e.applyStyles("dark",{backgroundColor:ct(e.palette[t].main,.5)}),...e.applyStyles("dark",{borderColor:ct(e.palette[t].main,.5)})}}}))]}))),$a=J("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.thumb,t[`thumbColor${H(n.color)}`],n.size!=="medium"&&t[`thumbSize${H(n.size)}`]]}})(ee(({theme:e})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${K.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(e.palette).filter(Ke()).map(([t])=>({props:{color:t},style:{[`&:hover, &.${K.focusVisible}`]:{...e.vars?{boxShadow:`0px 0px 0px 8px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 8px ${_e(e.palette[t].main,.16)}`},"@media (hover: none)":{boxShadow:"none"}},[`&.${K.active}`]:{...e.vars?{boxShadow:`0px 0px 0px 14px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 14px ${_e(e.palette[t].main,.16)}`}}}}))]}))),Aa=J(ja,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(ee(({theme:e})=>({zIndex:1,whiteSpace:"nowrap",...e.typography.body2,fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${K.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${K.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),Ma=J("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>Lt(e)&&e!=="markActive",overridesResolver:(e,t)=>{const{markActive:n}=e;return[t.mark,n&&t.markActive]}})(ee(({theme:e})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}}]}))),Ea=J("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>Lt(e)&&e!=="markLabelActive",overridesResolver:(e,t)=>t.markLabel})(ee(({theme:e})=>({...e.typography.body2,color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(e.vars||e).palette.text.primary}}]}))),Ra=e=>{const{disabled:t,dragging:n,marked:o,orientation:r,track:p,classes:d,color:i,size:u}=e,y={root:["root",t&&"disabled",n&&"dragging",o&&"marked",r==="vertical"&&"vertical",p==="inverted"&&"trackInverted",p===!1&&"trackFalse",i&&`color${H(i)}`,u&&`size${H(u)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",u&&`thumbSize${H(u)}`,i&&`thumbColor${H(i)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return jt(y,Sa,d)},Da=({children:e})=>e,Fa=T.forwardRef(function(t,n){const o=Tt({props:t,name:"MuiSlider"}),r=Bt(),{"aria-label":p,"aria-valuetext":d,"aria-labelledby":i,component:u="span",components:y={},componentsProps:l={},color:h="primary",classes:b,className:f,disableSwap:m=!1,disabled:g=!1,getAriaLabel:w,getAriaValueText:V,marks:D=!1,max:S=100,min:L=0,name:_,onChange:ie,onChangeCommitted:Q,orientation:re="horizontal",shiftStep:ne=10,size:W="medium",step:le=1,scale:G=Ct,slotProps:j,slots:C,tabIndex:te,track:A="normal",value:Se,valueLabelDisplay:M="off",valueLabelFormat:se=Ct,...xe}=o,$={...o,isRtl:r,max:S,min:L,classes:b,disabled:g,disableSwap:m,orientation:re,marks:D,color:h,size:W,step:le,shiftStep:ne,scale:G,track:A,valueLabelDisplay:M,valueLabelFormat:se},{axisProps:ce,getRootProps:Xe,getHiddenInputProps:Je,getThumbProps:Ie,open:Qe,active:$e,axis:ue,focusedThumbIndex:de,range:pe,dragging:he,marks:Z,values:O,trackOffset:be,trackLeap:Ze,getThumbStyle:Ae}=ka({...$,rootRef:n});$.marked=Z.length>0&&Z.some(E=>E.label),$.dragging=he,$.focusedThumbIndex=de;const B=Ra($),Te=(C==null?void 0:C.root)??y.Root??La,Me=(C==null?void 0:C.rail)??y.Rail??Pa,Ee=(C==null?void 0:C.track)??y.Track??Ia,Re=(C==null?void 0:C.thumb)??y.Thumb??$a,De=(C==null?void 0:C.valueLabel)??y.ValueLabel??Aa,ye=(C==null?void 0:C.mark)??y.Mark??Ma,Fe=(C==null?void 0:C.markLabel)??y.MarkLabel??Ea,s=(C==null?void 0:C.input)??y.Input??"input",c=(j==null?void 0:j.root)??l.root,v=(j==null?void 0:j.rail)??l.rail,k=(j==null?void 0:j.track)??l.track,P=(j==null?void 0:j.thumb)??l.thumb,x=(j==null?void 0:j.valueLabel)??l.valueLabel,F=(j==null?void 0:j.mark)??l.mark,U=(j==null?void 0:j.markLabel)??l.markLabel,R=(j==null?void 0:j.input)??l.input,Y=oe({elementType:Te,getSlotProps:Xe,externalSlotProps:c,externalForwardedProps:xe,additionalProps:{...wa(Te)&&{as:u}},ownerState:{...$,...c==null?void 0:c.ownerState},className:[B.root,f]}),je=oe({elementType:Me,externalSlotProps:v,ownerState:$,className:B.rail}),Dt=oe({elementType:Ee,externalSlotProps:k,additionalProps:{style:{...ce[ue].offset(be),...ce[ue].leap(Ze)}},ownerState:{...$,...k==null?void 0:k.ownerState},className:B.track}),et=oe({elementType:Re,getSlotProps:Ie,externalSlotProps:P,ownerState:{...$,...P==null?void 0:P.ownerState},className:B.thumb}),Ft=oe({elementType:De,externalSlotProps:x,ownerState:{...$,...x==null?void 0:x.ownerState},className:B.valueLabel}),tt=oe({elementType:ye,externalSlotProps:F,ownerState:$,className:B.mark}),at=oe({elementType:Fe,externalSlotProps:U,ownerState:$,className:B.markLabel}),zt=oe({elementType:s,getSlotProps:Je,externalSlotProps:R,ownerState:$});return a.jsxs(Te,{...Y,children:[a.jsx(Me,{...je}),a.jsx(Ee,{...Dt}),Z.filter(E=>E.value>=L&&E.value<=S).map((E,N)=>{const rt=Ye(E.value,L,S),ze=ce[ue].offset(rt);let ae;return A===!1?ae=O.includes(E.value):ae=A==="normal"&&(pe?E.value>=O[0]&&E.value<=O[O.length-1]:E.value<=O[0])||A==="inverted"&&(pe?E.value<=O[0]||E.value>=O[O.length-1]:E.value>=O[0]),a.jsxs(T.Fragment,{children:[a.jsx(ye,{"data-index":N,...tt,...!We(ye)&&{markActive:ae},style:{...ze,...tt.style},className:ge(tt.className,ae&&B.markActive)}),E.label!=null?a.jsx(Fe,{"aria-hidden":!0,"data-index":N,...at,...!We(Fe)&&{markLabelActive:ae},style:{...ze,...at.style},className:ge(B.markLabel,at.className,ae&&B.markLabelActive),children:E.label}):null]},N)}),O.map((E,N)=>{const rt=Ye(E,L,S),ze=ce[ue].offset(rt),ae=M==="off"?Da:De;return a.jsx(ae,{...!We(ae)&&{valueLabelFormat:se,valueLabelDisplay:M,value:typeof se=="function"?se(G(E),N):se,index:N,open:Qe===N||$e===N||M==="on",disabled:g},...Ft,children:a.jsx(Re,{"data-index":N,...et,className:ge(B.thumb,et.className,$e===N&&B.active,de===N&&B.focusVisible),style:{...ze,...Ae(N),...et.style},children:a.jsx(s,{"data-index":N,"aria-label":w?w(N):p,"aria-valuenow":G(E),"aria-labelledby":i,"aria-valuetext":V?V(G(E),N):d,value:O[N],...zt})})},N)})]})});function za(e){return St("MuiSwitch",e)}const q=wt("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),Na=e=>{const{classes:t,edge:n,size:o,color:r,checked:p,disabled:d}=e,i={root:["root",n&&`edge${H(n)}`,`size${H(o)}`],switchBase:["switchBase",`color${H(r)}`,p&&"checked",d&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},u=jt(i,za,t);return{...t,...u}},Va=J("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.root,n.edge&&t[`edge${H(n.edge)}`],t[`size${H(n.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${q.thumb}`]:{width:16,height:16},[`& .${q.switchBase}`]:{padding:4,[`&.${q.checked}`]:{transform:"translateX(16px)"}}}}]}),Oa=J(Ut,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:n}=e;return[t.switchBase,{[`& .${q.input}`]:t.input},n.color!=="default"&&t[`color${H(n.color)}`]]}})(ee(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${q.checked}`]:{transform:"translateX(20px)"},[`&.${q.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${q.checked} + .${q.track}`]:{opacity:.5},[`&.${q.disabled} + .${q.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${q.input}`]:{left:"-100%",width:"300%"}})),ee(({theme:e})=>({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:_e(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(e.palette).filter(Ke(["light"])).map(([t])=>({props:{color:t},style:{[`&.${q.checked}`]:{color:(e.vars||e).palette[t].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_e(e.palette[t].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${q.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t}DisabledColor`]:`${e.palette.mode==="light"?lt(e.palette[t].main,.62):ct(e.palette[t].main,.55)}`}},[`&.${q.checked} + .${q.track}`]:{backgroundColor:(e.vars||e).palette[t].main}}}))]}))),Ba=J("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(ee(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`}))),Ua=J("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(ee(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),Rt=T.forwardRef(function(t,n){const o=Tt({props:t,name:"MuiSwitch"}),{className:r,color:p="primary",edge:d=!1,size:i="medium",sx:u,slots:y={},slotProps:l={},...h}=o,b={...o,color:p,edge:d,size:i},f=Na(b),m={slots:y,slotProps:l},[g,w]=ot("root",{className:ge(f.root,r),elementType:Va,externalForwardedProps:m,ownerState:b,additionalProps:{sx:u}}),[V,D]=ot("thumb",{className:f.thumb,elementType:Ua,externalForwardedProps:m,ownerState:b}),S=a.jsx(V,{...D}),[L,_]=ot("track",{className:f.track,elementType:Ba,externalForwardedProps:m,ownerState:b});return a.jsxs(g,{...w,children:[a.jsx(Oa,{type:"checkbox",icon:S,checkedIcon:S,ref:n,ownerState:b,...h,classes:{...f,root:f.switchBase},slots:{...y.switchBase&&{root:y.switchBase},...y.input&&{input:y.input}},slotProps:{...l.switchBase&&{root:typeof l.switchBase=="function"?l.switchBase(b):l.switchBase},...l.input&&{input:typeof l.input=="function"?l.input(b):l.input}}}),a.jsx(L,{..._})]})}),qa=Pt(a.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),kt=Pt(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),Ga=["Critical","Strained","Unstable","Stable","Improving","Strong","Thriving"];function Ha(){const e=[9,29,49,69,84,99,100],t={data:{},order:[]};t.order=e.map((r,p)=>{const d=Ne();return t.data[d]={name:Ga[p],max:r},d});const n={data:{},order:[]},o=Ne();return n.data[o]={name:"default",value:1},n.order=[o],{id:Ne(),refId:Ne(),version:0,name:"",description:"",icon:{...Jt[0],color:"black",backgroundColor:"#fbf7ef"},balance:{cost:{base:0,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},max:{base:1,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},health:{base:0,perLevel:!1,valuePerLevel:0,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]}},thresholds:t,settlementPointCost:n,isPositive:!0,canHurt:!0,isTradeable:!0,hasThresholds:!0,hasSPC:!0,genre:"",subGenre:"",properties:{data:{canOverflow:!0,isCurrency:!1,requiresUpkeep:!1,canGather:!1},config:{},order:["canOverflow","isCurrency","requiresUpkeep"]},tags:[],isValid:!1,status:"DRAFT",createdBy:""}}const Pe={name:{label:"Attribute Name",type:"text",tooltip:"The unique name of the attribute. This should clearly convey the attribute's purpose and role within the settlement mechanics.",validateFn:e=>e?e.trim().length<3?"Attribute name must be at least 3 characters long":null:"Attribute name is required",keypath:"name"},costPerLevel:{label:"Currency Cost",type:"number",tooltip:"The amount of currency required per level to acquire this attribute. This cost scales with the settlement's level.",validateFn:e=>e?e<=0?"Cost per level must be greater than 0":null:"Cost per level is required",keypath:"balance.cost.base"},healthPerLevel:{label:"Health Drain",type:"number",tooltip:"This value represents the health damage the settlement takes for each missing unit of this attribute, scaled by settlement level.",validateFn:e=>e==null?"Health per level is required":e<0?"Health per level cannot be negative":null,keypath:"balance.health.base"},maxPerLevel:{label:"Max",type:"number",tooltip:"The maximum number of units of this attribute that can provide benefits to the settlement per level.",validateFn:e=>e===void 0?"Max per level is required":e<0?"Max per level must be 0 or greater":null,keypath:"balance.max.base"},description:{label:"Description",type:"textarea",tooltip:"A brief explanation of the attribute's purpose and impact. This provides essential context for understanding its role in the settlement.",validateFn:e=>e?e.trim().length<30?`Description must be at least 30 characters long. You need ${30-e.length} more characters.`:null:"Description is required",keypath:"description"},healthValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for health per level. This value represents the scaling value per interval based on Health Drain.",validateFn:e=>e==null?"Health per level scale is required":null,keypath:"balance.health.valuePerLevel"},healthIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which health is calculated based on the health drain. This value determines how often the health is updated.",validateFn:e=>e==null?"Health interval per level is required":e<=0?"Health interval per level must be greater than 0":null,keypath:"balance.health.interval"},costValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for cost per level. This value represents the scaling value per interval based on Cost.",validateFn:e=>e==null?"Cost per level scale is required":null,keypath:"balance.cost.valuePerLevel"},costIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which cost is calculated based on the cost per level. This value determines how often the cost is updated.",validateFn:e=>e==null?"Cost interval per level is required":e<=0?"Cost interval per level must be greater than 0":null,keypath:"balance.cost.interval"},maxValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for max per level. This value represents the scaling value per interval based on Max.",validateFn:e=>e==null?"Max per level scale is required":null,keypath:"balance.max.valuePerLevel"},maxIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which max is calculated based on the max per level. This value determines how often the max is updated.",validateFn:e=>e==null?"Max interval per level is required":e<=0?"Max interval per level must be greater than 0":null,keypath:"balance.max.interval"}},X=({keypath:e,trueLabel:t="",falseLabel:n="",sx:o={display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,boxSizing:"border-box",transition:"background-color 0.3s ease, border-color 1s ease",borderLeft:"2px solid",pl:2,py:.5,width:"100%",color:"text.primary",borderRadius:0},tooltip:r,disabled:p=!1,onChange:d,falseColor:i="warning",trueColor:u="success",trueThemeKey:y="main",falseThemeKey:l="main",border:h=!0,variant:b="row",buttonType:f="button",heightLock:m=!1})=>{const{tool:g,id:w}=T.useContext($t),{updateTool:V,selectEditValue:D}=ke(g,w),S=D(e),{utils:L}=ea(),{lockHeight:_}=At(),ie=()=>{m&&S&&_(),V(e,!S),typeof d=="function"&&d(!S)};return a.jsxs(It,{tabIndex:-1,disableFocusRipple:!0,disabled:p,onClick:()=>{f==="button"&&ie()},sx:{...o,borderColor:S?L.color(u,y,.5):L.color(i,l,.5),"&:hover":{bgcolor:S?L.color(u,y,.1):L.color(i,l,.1)},borderLeft:h?o==null?void 0:o.borderLeft:"none",flexDirection:b},children:[a.jsx(me,{title:a.jsx(z,{variant:"body2",children:r||`Toggle ${e}`}),placement:"top",arrow:!0,children:a.jsx(z,{variant:"body2",sx:{flexGrow:1,textAlign:"left",textTransform:"uppercase"},children:S?t:n||t})}),a.jsx(Rt,{id:`${g}-${w}-${e}`,size:"small",color:S?u:i,checked:S===!0,sx:{"& .MuiSwitch-switchBase":{"&.Mui-checked":{color:L.color(u,y,.8)},"&:not(.Mui-checked)":{color:L.color(i,l,.8)}},"& .MuiSwitch-track":{backgroundColor:L.color("info","light",1)}},onClick:()=>{(f="switch")&&ie()}})]})},Wa=ra(na.div)({}),Ge=({children:e,show:t=!0,duration:n=.3,sx:o={},onMouseLeave:r=()=>{},onMouseEnter:p=()=>{}})=>a.jsx(aa,{children:t&&a.jsx(Wa,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:n},style:{overflow:"hidden",marginBottom:"0.5rem"},sx:o,onMouseLeave:r,onMouseEnter:p,children:e})}),_a={linear:"Change Per Interval","slow-exponential":"Base","fast-exponential":"Base",custom:"Change Per Interval"},it=({disabled:e,property:t,fields:n,slide:o,setSlide:r,slideLabel:p="",slideColor:d="secondary",borderColor:i="honey.main",accentColor:u="info.main"})=>{const{id:y,tool:l}=we(),{edit:h,updateTool:b,selectEditValue:f}=ke(l,y),[m,g]=T.useState(!1),w=f(`balance.${t}`);if(!w)return null;const{valuePerLevel:V,interval:D,scaleToggle:S,scaleCurve:L,base:_,perLevel:ie,valuesPerInterval:Q}=w,re=()=>{const ne=h.balance[t],{interval:W,scaleToggle:le,valuesPerInterval:G}=ne;if(W<=0)return[];const j={};if(G.forEach(C=>{C&&C.level&&C.value!==void 0&&(j[C.level]=C.value)}),le){const C=Array.from({length:Math.ceil(21/W)},(te,A)=>A*W).slice(1,21).map(te=>({level:te,value:0}));b(`balance.${t}.valuesPerInterval`,C)}else return[]};return T.useEffect(()=>{L==="custom"&&re()},[L,D]),a.jsxs(Ge,{show:!e,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",border:"1px solid",borderColor:h!=null&&h.balance[t].perLevel?m?u:i:"transparent",transition:"border-color 0.3s ease, padding 0.3s ease",boxSizing:"border-box",p:h.balance[t].perLevel?1:0,borderRadius:2},onMouseEnter:g.bind(null,!0),onMouseLeave:g.bind(null,!1),children:[a.jsx(ve,{inputConfig:n[`${t}PerLevel`]}),a.jsx(X,{keypath:`balance.${t}.perLevel`,trueLabel:"Scale",falseLabel:"Flat",tooltip:"Enable to automatically adjust related values when max per level changes.",border:!1,variant:"column-reverse",disabled:e,heightLock:!0}),a.jsxs(Ge,{show:h==null?void 0:h.balance[t].perLevel,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",justifyContent:"center"},children:[a.jsx(ve,{inputConfig:n[`${t}IntervalPerLevel`],decimals:0,allowZero:!1}),a.jsx(X,{keypath:`balance.${t}.scaleToggle`,trueLabel:"Custom",falseLabel:"Default",variant:"column-reverse",tooltip:"Enable scaling separate from the base value.",border:!1,heightLock:!0}),a.jsxs(Ge,{show:h==null?void 0:h.balance[t].scaleToggle,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"center"},children:[a.jsx(ve,{dynamicLabel:_a[h==null?void 0:h.balance[t].scaleCurve],inputConfig:n[`${t}ValuePerLevel`],style:{width:"100%"},disabled:(h==null?void 0:h.balance[t].scaleCurve)==="custom"}),a.jsx(Zt,{keypath:`balance.${t}.scaleCurve`,label:"Scale Curve",options:[{value:"linear",name:"Linear"},{value:"slow-exponential",name:"Slow Exponential"},{value:"fast-exponential",name:"Fast Exponential"},{value:"custom",name:"Per Interval"}],small:!1}),a.jsx(Ge,{show:(h==null?void 0:h.balance[t].scaleCurve)==="custom",sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)","repeat(4, 1fr)","repeat(5, 1fr)"],gap:1,width:"100%"},children:Q.map((ne,W)=>a.jsx(ve,{inputConfig:{keypath:`balance.${t}.valuesPerInterval.${W}.value`,label:`Level ${ne.level}`,type:"number"},style:{width:"100%"}},`${t}-interval-${W}`))})]})]})]})},Ya=({columns:e})=>{const{tool:t,id:n}=T.useContext($t),{edit:o}=ke(t,n),[r,p]=T.useState(!1),[d,i]=T.useState(5),u=l=>{const h=o.balance[l],{base:b,perLevel:f,valuePerLevel:m,interval:g,scaleToggle:w}=h;return w?`Floor(${d} / ${g}) * ${m} + ${b})`:f?`Floor(${d} / ${g}) * ${b})`:`${b}`},y=l=>{const h=o.balance[l],{base:b,perLevel:f,valuePerLevel:m,interval:g,scaleToggle:w,scaleCurve:V,valuesPerInterval:D}=h;if(b===void 0)return"0";switch(w){case!0:{const S=d/g;switch(V){case"linear":return(Math.floor(S)*m+b).toFixed(0);case"slow-exponential":return(Math.pow(S,1.5)*m+b).toFixed(0);case"fast-exponential":return(Math.pow(S,2)*m+b).toFixed(0);case"custom":{if(!(D!=null&&D.length))return b.toFixed(0);const L=Math.floor(S);return L<0||L-1>=D.length?b.toFixed(0):(D.slice(0,L).reduce((Q,re)=>Q+re.value,0)+b).toFixed(0)}default:return b.toFixed(0)}}case!1:return f?(Math.max(1,Math.floor(d/g))*b).toFixed(0):b.toFixed(0);default:return b.toFixed(0)}};return o?a.jsxs(I,{id:`attr-values-${n}`,sx:{display:"flex",flexDirection:"column",gap:2},children:[a.jsxs(qt,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,height:"100%"},children:[a.jsxs(Gt,{sx:{display:"flex",alignItems:"center",gap:.5},children:[a.jsx(z,{children:"Autobalance"}),a.jsx(me,{title:"Automatically adjust related values to maintain a balanced configuration.",children:a.jsx(Qt,{sx:{fontSize:18,color:"text.secondary",cursor:"pointer"}})})]}),a.jsx(Rt,{checked:r,onChange:l=>p(l.target.checked)})]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"auto",alignItems:"center",justifyContent:"start",my:2,width:"100%",position:"relative",gridColumn:"span 3",boxSizing:"border-box"},children:[a.jsx(I,{sx:{gridColumn:"span 2",display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:a.jsxs(I,{sx:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",px:4},children:[a.jsx(Fa,{valueLabelDisplay:"auto",color:"secondary",defaultValue:d,value:d,onChange:(l,h)=>{i(h)},min:1,max:20,step:1}),a.jsxs(I,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:1},children:[a.jsx(z,{variant:"body2",sx:{fontWeight:"bold",width:"100%"},children:`Values at Level ${d}: `}),a.jsx(me,{title:u("max"),children:a.jsxs(z,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"success.main"},children:["Max: ",y("max")]})}),o.canHurt&&a.jsx(me,{title:u("health"),children:a.jsxs(z,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"error.main"},children:["Health: ",y("health")]})}),o.isTradeable&&a.jsx(me,{title:u("cost"),children:a.jsxs(z,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"honey.main"},children:["Cost: ",y("cost")]})})]})]})}),a.jsx(it,{disabled:!1,property:"max",fields:Pe,slide:d,setSlide:i,slideLabel:"Max Value",borderColor:"dividerDark"}),a.jsx(it,{disabled:!o.canHurt,property:"health",fields:Pe,slide:d,setSlide:i,slideLabel:"Total Drain",borderColor:"dividerDark",accentColor:"error.main"}),a.jsx(it,{disabled:!o.isTradeable,property:"cost",fields:Pe,slide:d,setSlide:i,slideLabel:"Total Cost",borderColor:"dividerDark",accentColor:"honey.main"})]})]}):null},Ka={name:"",tooltip:"",type:"number",validate:e=>e<=-1?"Value must be 0 or greater":null,keypath:""},Xa=({content:e})=>a.jsx(z,{component:"span",children:e.map((t,n)=>t.type==="text"?a.jsx("span",{children:t.value},n):t.type==="strong"?a.jsx("strong",{children:t.value},n):t.type==="tooltip"?a.jsx(me,{title:t.title,arrow:!0,children:a.jsx(z,{component:"span",sx:{textDecoration:"underline",fontWeight:"bold",cursor:"pointer"},onClick:t.onClick,children:t.value})},n):null)}),Ja=[{name:"Fortified",description:"Fortified Settlements put their trust in theirs walls, preemptive reconnaissance, and well-trained troops.",id:"789"},{name:"Mercantile",description:"Mercantile Settlements focus on establishing and expanding trade, developing vibrant culture, and welcoming artisans.",id:"456"},{name:"Survivalist",description:"Survivalists focus on gathering food, supplies, medical items, and constructing durable shelters.",id:"123"}],Qa=[{type:"text",value:"Define the "},{type:"tooltip",title:"Settlements earn 1 settlement point per level per turn, barring other boons or banes. Click for more information.",value:"Settlement Point Cost",onClick:()=>console.log("open SPC help panel")},{type:"text",value:" of this attribute per Settlement Type. A value of "},{type:"strong",value:"0"},{type:"text",value:" means this cannot be purchased with settlement points for that settlement type."}],Za=()=>{const{tool:e,id:t}=we(),{data:n,order:o,errors:r,add:p,remove:d}=oa(e,t,"settlementPointCost"),[i,u]=T.useState(null),[y,l]=T.useState(""),h=T.useMemo(()=>{const f=Object.keys(n||{}).reduce((g,w)=>(g.push(w),g),[]);return Ja.filter(g=>!f.includes(g.id))},[n]),b=T.useMemo(()=>Object.entries(n||{}).map(([f,m])=>{const g=m;return{...Ka,name:g.name,label:g.name.charAt(0).toUpperCase()+g.name.slice(1),tooltip:void 0,id:f,keypath:`settlementPointCost.data.${f}.value`}}),[n]);return o?a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"1fr 0.1fr 1fr",gap:2},children:[a.jsx(I,{sx:{gridColumn:"span 3",p:2},children:a.jsx(Xa,{content:Qa})}),a.jsx(I,{sx:{display:"flex",alignItems:"start",width:"100%"},children:a.jsx(Ht,{inputValue:y,options:h,getOptionLabel:f=>f.name,renderInput:f=>a.jsx(Wt,{...f,label:"Settlement Type",variant:"outlined",error:!!(r!=null&&r.name),helperText:r==null?void 0:r.name,onChange:m=>{l(m.target.value)},onKeyDown:m=>{m.key==="Enter"&&(p({id:i.id,entry:{name:i.name,value:1},sort:!1}),l(""))}}),onChange:(f,m)=>{u(m),l((m==null?void 0:m.name)||"")},renderOption:(f,m)=>T.createElement(I,{...f,component:"li",key:m.name,sx:{display:"flex",alignItems:"center"}},a.jsx(me,{title:a.jsx(z,{children:m.description}),placement:"left",arrow:!0,children:a.jsx(z,{children:m.name})})),sx:{my:2,width:"100%"}})}),a.jsx(fe,{orientation:"vertical",flexItem:!0,children:a.jsx(_t,{label:a.jsx(qa,{}),onClick:()=>{p({id:i.id,entry:{name:i.name,value:1},sort:!1}),l("")},sx:{width:"100%",color:"white"}})}),a.jsx(I,{children:o.map((f,m)=>{const g=b.find(w=>w.id===f);return g?a.jsx(Yt.Fragment,{children:a.jsx(ve,{inputConfig:g,style:{width:"100%",m:0,p:0},shrink:!0,onMoreDetails:g.name!=="default"?()=>{console.log("More details clicked")}:void 0,onRemove:g.name!=="default"?()=>d(f):void 0})},f):null})})]}):a.jsx(I,{children:"Loading..."})},er={propertiesExpanded:!0,editTabs:{Properties:{name:"Properties",disabled:!1},Values:{name:"Values",disabled:!1},SPC:{name:"SPC",disabled:!1},Thresholds:{name:"Thresholds",disabled:!1},Currency:{name:"Currency",disabled:!0},Gather:{name:"Gather",disabled:!0},Upkeep:{name:"Upkeep",disabled:!0}},activeTab:"Properties",lastTab:null,activeIndex:0,lastIndex:0};function tr(e,t){switch(t.type){case"TOGGLE_PROPERTIES":return{...e,propertiesExpanded:!e.propertiesExpanded};case"SET_ACTIVE_TAB":const{name:n,index:o,defaultLast:r}=t.payload;return{...e,lastIndex:r?0:e.activeIndex,lastTab:r?"Values":e.activeTab,activeTab:n,activeIndex:o};case"SET_TAB_DISABLED":{const{property:p,disabled:d}=t.payload;return{...e,editTabs:{...e.editTabs,[p]:{...e.editTabs[p],disabled:d}}}}default:return e}}const dt=(e,t,n)=>({type:"SET_ACTIVE_TAB",payload:{name:e,index:t,defaultLast:n}}),ar=(e,t)=>({type:"SET_TAB_DISABLED",payload:{property:e,disabled:t}}),rr=({columns:e})=>{var u,y,l,h;const t=pt(),{tool:n,id:o,showModal:r,tabId:p,side:d}=we(),{edit:i}=ke(n,o);return T.useEffect(()=>{i!=null&&i.name&&(t(ut({tabId:p,side:d,keypath:"name",updates:(i==null?void 0:i.name.trim().length)>0?i==null?void 0:i.name.trim():"Untitled"})),t(ut({tabId:p,side:d,keypath:"viewState.isDirty",updates:!0})))},[i==null?void 0:i.name,t,p,d]),a.jsxs(a.Fragment,{children:[a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"flex",alignItems:"center",gap:2},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-around",flexGrow:1},children:[a.jsx(z,{variant:"h6",children:"Icon:"}),a.jsx(Mt,{viewBox:((u=i==null?void 0:i.icon)==null?void 0:u.viewBox)||"0 0 664 512",path:((y=i==null?void 0:i.icon)==null?void 0:y.d)||"",size:24,color:((l=i==null?void 0:i.icon)==null?void 0:l.color)||"primary",backgroundColor:((h=i==null?void 0:i.icon)==null?void 0:h.backgroundColor)||"background.paper",onClick:()=>{r({entry:{componentKey:"IconSelector",props:{tool:n,id:o,tabId:p,side:d},id:"icon-selector"}})}})]}),a.jsx(ve,{inputConfig:Pe.name,style:{flexGrow:2,flexShrink:1,px:1}})]}),a.jsx(ve,{inputConfig:Pe.description,style:{gridColumn:`span ${e}`,px:1},multiline:!0})]})},nr={isTradeable:{disables:["properties.data.isCurrency"]},"properties.data.isCurrency":{disables:["properties.data.requiresUpkeep","isTradeable"],enables:["properties.data.canOverflow"]},"properties.data.requiresUpkeep":{disables:["properties.data.isCurrency","properties.data.canHarvest"]},"properties.data.canGather":{disables:["properties.data.requiresUpkeep"]}},sr={hasThresholds:{key:"Thresholds",value:!0},hasSPC:{key:"SPC",value:!0},"properties.data.isCurrency":{key:"Currency",value:!1},"properties.data.requiresUpkeep":{key:"Upkeep",value:!1},"properties.data.canGather":{key:"Gather",value:!1}},or=({columns:e,activeTab:t,lastTab:n,lastIndex:o,localDispatch:r})=>{const{tool:p,id:d,showModal:i,tabId:u,side:y}=we(),{edit:l,updateTool:h}=ke(p,d),{makeSnackbar:b}=ta(),f=(m,g)=>{var D,S;const w=nr[m],V=sr[m];V&&(t===V.key&&!g&&r(dt(n,o,!0)),r(ar(V.key,!g))),w&&g&&((D=w.disables)==null||D.forEach(L=>{h(L,!1)}),w!=null&&w.enables&&((S=w==null?void 0:w.enables)==null||S.forEach(L=>{h(L,!0)})))};return l?a.jsxs(a.Fragment,{children:[a.jsx(rr,{columns:e}),a.jsx(I,{sx:{gridColumn:`span ${e}`},children:a.jsx(ca,{defaultGenre:l.genre,defaultSubGenre:l.subGenre,updateFn:h})}),a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"grid",gridTemplateColumns:["1fr","1fr",`repeat(${e}, 1fr)`],gap:2},children:[a.jsxs(I,{children:[a.jsxs(fe,{children:["Major Properties"," ",a.jsx(bt,{size:"small",children:a.jsx(kt,{})})]}),a.jsx(X,{keypath:"isPositive",trueLabel:"Is Positive",falseLabel:"Is Negative",falseColor:"error",tooltip:"Toggle if this attribute is positive or negative. A positive attribute is beneficial, while a negative attribute is detrimental."}),a.jsx(X,{keypath:"canHurt",trueLabel:"Can Hurt",falseLabel:"Cannot Hurt",tooltip:"Toggle if this attribute can affect health."}),a.jsx(X,{keypath:"isTradeable",trueLabel:"Can Trade",falseLabel:"Cannot Trade",tooltip:"Toggle if this attribute can be traded. This forces a baseline cost, and allows it to be added to Trading Hubs. Tradeable attributes cannot be currency.",disabled:l==null?void 0:l.properties.data.isCurrency}),a.jsx(X,{keypath:"hasThresholds",trueLabel:"Thresholds",falseLabel:"No Thresholds",tooltip:"Toggle if this attribute has unique thresholds. If disabled, default thresholds will be used internally.",onChange:()=>{f("hasThresholds",!l.hasThresholds),l.hasThresholds&&b({message:"Default thresholds will be used.",type:"info",duration:3e3})}}),a.jsx(X,{keypath:"hasSPC",trueLabel:"Settlement Points",falseLabel:"No Settlement Points",tooltip:"Toggle if this attribute can be acquired through settlement points.",onChange:()=>{f("hasSPC",!l.hasSPC)}})]}),a.jsxs(I,{children:[a.jsxs(fe,{children:["Minor Properties"," ",a.jsx(bt,{size:"small",children:a.jsx(kt,{})})]}),a.jsx(X,{keypath:"properties.data.canOverflow",trueLabel:"Can Overflow",falseLabel:"Cannot Overflow",tooltip:"Toggle if this attribute can overflow. Overflowing attributes can exceed their maximum value, but overages will not be counted towards calculations.",disabled:l==null?void 0:l.properties.data.isCurrency}),a.jsx(X,{keypath:"properties.data.isCurrency",trueLabel:"Is Currency",falseLabel:"Not Currency",tooltip:"Toggle if this attribute is treated as currency. This removes any cap on the attribute's value and allows it to integrate with the Tax System, among other things.",disabled:(l==null?void 0:l.isTradeable)||(l==null?void 0:l.properties.data.requiresUpkeep),onChange:m=>{f("properties.data.isCurrency",m),m&&l.properties.data.canGather&&b({message:"Currency attributes are rarely harvestable. Be sure this makes sense in your world!",type:"warning",duration:5e3})}}),a.jsx(X,{keypath:"properties.data.requiresUpkeep",trueLabel:"Requires Upkeep",falseLabel:"No Upkeep Required",tooltip:"Toggle if this attribute requires upkeep. This will add an upkeep cost to the attribute, which must be paid with a currency to keep it active.",disabled:(l==null?void 0:l.properties.data.isCurrency)||(l==null?void 0:l.properties.data.canGather),onChange:m=>{f("properties.data.requiresUpkeep",m)}}),a.jsx(X,{keypath:"properties.data.canGather",trueLabel:"Can Gather",falseLabel:"Cannot Gather",tooltip:"Toggle if this attribute can be acquired by assigning other attributes, e.g. 'Productivity', to it.",disabled:l==null?void 0:l.properties.data.requiresUpkeep,onChange:m=>{f("properties.data.canGather",m),m&&l.properties.data.isCurrency&&b({message:"Harvestable attributes are rarely currency. Be sure this makes sense in your world!",type:"warning",duration:5e3})}})]})]}),a.jsx(ua,{})]}):null};function ir({id:e,tool:t,tabId:n,side:o}){return async(r,p)=>{var l,h;const d=p(),i=mt.cloneDeep(d.tools[t].edit.byId[e]),u=Object.keys(((h=(l=d.tabs[o].data[n])==null?void 0:l.viewState)==null?void 0:h.dirtyKeypaths)||{});if(u.length===0)return;const y={};u.forEach(b=>{y[b]=mt.get(i,b)}),r(ft({tool:t,id:e,updates:{...y,version:1}})),r(Kt({tabId:n}));try{i.version===0?await vt.saveTool({id:e,tool:t,data:{...i,version:1}}):await vt.saveTool({id:e,tool:t,data:{...y}})}catch(b){console.error("Error during batch update:",b),r(Xt({message:`Failed to batch update ${i.name}. Please try again.`,type:"error",duration:5e3})),r(ft({tool:t,id:e,updates:{...i}}))}}}function lr({tool:e,id:t,tabId:n,side:o,name:r}){const p=pt();return{name:r,batchSaveFn:async()=>{p(ir({id:t,side:o,tabId:n,tool:e}))},intervalMs:6e4}}const cr={Properties:or,Values:Ya,SPC:Za,Thresholds:ia,Currency:()=>a.jsx(I,{children:"Currency Component"}),Gather:()=>a.jsx(I,{children:"Gather Component"}),Upkeep:()=>a.jsx(I,{children:"Upkeep Component"})},ur=()=>{const{tab:e,id:t}=we(),{both:n}=da(),o=pt(),[r,p]=T.useReducer(tr,e.viewState.editAttr||er),{activeTab:d,editTabs:i,lastIndex:u}=r;pa(lr({name:e.name,tool:"attribute",id:t,tabId:e.tabId,side:e.side})),T.useEffect(()=>{e.lastTab&&e.lastIndex&&p(dt(e.lastTab,e.lastIndex))},[]),T.useEffect(()=>()=>{o(ut({tabId:e.tabId,side:e.side,keypath:"viewState.editAttr",updates:{...r}}))},[r]);const y=n?1:2,l=(f,m)=>{p(dt(f,m))},{ref:h,height:b}=At();return a.jsx(I,{id:`edit-attribute-${e.id}`,ref:h,sx:{height:"100%",transition:"height 0.4s ease-in-out",overflow:typeof b=="number"?"hidden":"auto",width:"100%",px:2,boxSizing:"border-box"},children:a.jsx(sa,{tabs:Object.values(i).map(f=>({...f,disabled:f.disabled||!1,props:{localDispatch:p}})),componentMap:cr,activeTab:d,handleTabClick:l,columns:y,lastIndex:u})})},dr=()=>{var p,d,i,u,y,l,h,b,f,m;const{tool:e,id:t,mode:n,side:o}=we(),{current:r}=ke("attribute",t);return a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",mt:2,gap:2,width:"100%",position:"relative",pb:4},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,height:"88px",flexGrow:1,flexShrink:2},children:[a.jsx(z,{variant:"body1",sx:{fontWeight:"bold",fontSize:"1.25rem"},children:"Icon"}),a.jsx(It,{sx:{boxShadow:4,borderRadius:"50%",height:64,width:64},disabled:!0,children:a.jsx(Mt,{viewBox:((p=r==null?void 0:r.icon)==null?void 0:p.viewBox)||"0 0 664 512",path:((d=r==null?void 0:r.icon)==null?void 0:d.d)||"",size:24,color:((i=r==null?void 0:r.icon)==null?void 0:i.color)||"primary",backgroundColor:((u=r==null?void 0:r.icon)==null?void 0:u.backgroundColor)||"background.paper"})})]}),a.jsxs(I,{sx:{gridColumn:"span 2",display:"flex",gap:2,alignItems:"center",justifyContent:"start",height:"100%"},children:[a.jsx(z,{variant:"h6",children:"Name:"}),a.jsx(z,{children:(r==null?void 0:r.name)||"None"})]}),a.jsx(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"DESCRIPTION"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",flexDirection:"column",gap:2,alignItems:"start",justifyContent:"center"},children:[a.jsx(z,{sx:{textAlign:"start"},variant:"body1",children:(r==null?void 0:r.description)||"No description"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",gap:2,alignItems:"center",justifyContent:"center"},children:[a.jsx(z,{variant:"body1",sx:{fontWeight:"bold"},children:"Type:"}),a.jsx(z,{variant:"body1",children:r!=null&&r.isPositive?"Positive":"Negative"})]})]}),a.jsxs(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:[" ","SCALING PER LEVEL"," "]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridColumn:"span 3",columnGap:2},children:[a.jsx(Ve,{name:"Max",value:(l=(y=r==null?void 0:r.balance)==null?void 0:y.max)==null?void 0:l.base,even:!1}),a.jsx(Ve,{name:"Health",value:(b=(h=r==null?void 0:r.balance)==null?void 0:h.health)==null?void 0:b.base,even:!0}),a.jsx(Ve,{name:"Cost",value:(m=(f=r==null?void 0:r.balance)==null?void 0:f.cost)==null?void 0:m.base,even:!1})]}),a.jsx(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"SETTLEMENT POINT COSTS"}),r.settlementPointCost.order.map((g,w)=>a.jsx(Ve,{name:r.settlementPointCost.data[g].name,value:r.settlementPointCost.data[g].value,even:w%2===0},g)),a.jsx(fe,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"THRESHOLDS"}),a.jsx(la,{data:r.thresholds.data,order:r.thresholds.order})]})},pr=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],hr=["name","description","balance","thresholds","settlementPointCost"],Ir=({tab:e})=>a.jsx(ha,{tab:e,initializeTool:Ha,validationFields:hr,editComponent:ur,previewComponent:dr,checklistContent:pr});export{Ir as default,hr as validationFields};
