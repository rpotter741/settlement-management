import{r as C,C as Nt,D as Le,E as Vt,F as Ot,G as nt,H as He,I as st,J as bt,K as We,L as Ct,M as wt,N as ge,j as a,O as St,P as Bt,Q as oe,R as J,S as H,U as Tt,V as ee,W as Xe,X as ct,Y as ut,_ as _e,$ as jt,a0 as ot,a1 as Ut,a2 as Lt,v as Ne,c as Ce,d as Pt,z as fe,T as z,B as I,a3 as qt,a4 as Gt,A as Ht,g as Wt,a5 as me,a6 as _t,a7 as Yt,u as pt,y as ht,a8 as ft,p as mt,l as it,a9 as Xt,q as Kt,aa as Jt}from"./main.js";import{i as Qt}from"./iconList.js";import{S as It,u as $t,a as we}from"./PageBox.js";import{T as ve,I as Zt}from"./ToolInput.js";import{T as ea}from"./ToolSelect.js";import{u as At,a as ta,G as aa}from"./GenreSelect.js";import{A as ra,s as na,m as sa,T as oa}from"./TabbedContent.js";import{u as ia,O as la,R as Ve,P as ca}from"./ThresholdPreview.js";import{I as Mt}from"./Icon.js";import{A as ua}from"./TagTable.js";import{u as da}from"./useTabSplit.js";import{C as pa}from"./CreateToolShell.js";import"./useDebounce.js";const ha={border:0,clip:"rect(0 0 0 0)",height:"1px",margin:"-1px",overflow:"hidden",padding:0,position:"absolute",whiteSpace:"nowrap",width:"1px"};function ba(e,t,r=(s,n)=>s===n){return e.length===t.length&&e.every((s,n)=>r(s,t[n]))}const fa=2;function ke(e,t,r,s,n){return r===1?Math.min(e+t,n):Math.max(e-t,s)}function Et(e,t){return e-t}function vt(e,t){const{index:r}=e.reduce((s,n,u)=>{const h=Math.abs(t-n);return s===null||h<s.distance||h===s.distance?{distance:h,index:u}:s},null)??{};return r}function Oe(e,t){if(t.current!==void 0&&e.changedTouches){const r=e;for(let s=0;s<r.changedTouches.length;s+=1){const n=r.changedTouches[s];if(n.identifier===t.current)return{x:n.clientX,y:n.clientY}}return!1}return{x:e.clientX,y:e.clientY}}function Ye(e,t,r){return(e-t)*100/(r-t)}function ma(e,t,r){return(r-t)*e+t}function va(e){if(Math.abs(e)<1){const r=e.toExponential().split("e-"),s=r[0].split(".")[1];return(s?s.length:0)+parseInt(r[1],10)}const t=e.toString().split(".")[1];return t?t.length:0}function ga(e,t,r){const s=Math.round((e-r)/t)*t+r;return Number(s.toFixed(va(t)))}function gt({values:e,newValue:t,index:r}){const s=e.slice();return s[r]=t,s.sort(Et)}function Be({sliderRef:e,activeIndex:t,setActive:r}){var n,u,h;const s=He(e.current);(!((n=e.current)!=null&&n.contains(s.activeElement))||Number((u=s==null?void 0:s.activeElement)==null?void 0:u.getAttribute("data-index"))!==t)&&((h=e.current)==null||h.querySelector(`[type="range"][data-index="${t}"]`).focus()),r&&r(t)}function Ue(e,t){return typeof e=="number"&&typeof t=="number"?e===t:typeof e=="object"&&typeof t=="object"?ba(e,t):!1}const xa={horizontal:{offset:e=>({left:`${e}%`}),leap:e=>({width:`${e}%`})},"horizontal-reverse":{offset:e=>({right:`${e}%`}),leap:e=>({width:`${e}%`})},vertical:{offset:e=>({bottom:`${e}%`}),leap:e=>({height:`${e}%`})}},ya=e=>e;let qe;function xt(){return qe===void 0&&(typeof CSS<"u"&&typeof CSS.supports=="function"?qe=CSS.supports("touch-action","none"):qe=!0),qe}function ka(e){const{"aria-labelledby":t,defaultValue:r,disabled:s=!1,disableSwap:n=!1,isRtl:u=!1,marks:h=!1,max:i=100,min:d=0,name:y,onChange:l,onChangeCommitted:p,orientation:m="horizontal",rootRef:b,scale:f=ya,step:v=1,shiftStep:S=10,tabIndex:V,value:D}=e,T=C.useRef(void 0),[L,_]=C.useState(-1),[ie,Q]=C.useState(-1),[re,ne]=C.useState(!1),W=C.useRef(0),le=C.useRef(null),[G,j]=Nt({controlled:D,default:r??d,name:"Slider"}),k=l&&((o,c,g)=>{const w=o.nativeEvent||o,P=new w.constructor(w.type,w);Object.defineProperty(P,"target",{writable:!0,value:{value:c,name:y}}),le.current=c,l(P,c,g)}),te=Array.isArray(G);let A=te?G.slice().sort(Et):[G];A=A.map(o=>o==null?d:Le(o,d,i));const Se=h===!0&&v!==null?[...Array(Math.floor((i-d)/v)+1)].map((o,c)=>({value:d+v*c})):h||[],M=Se.map(o=>o.value),[se,xe]=C.useState(-1),$=C.useRef(null),ce=Vt(b,$),Ke=o=>c=>{var w;const g=Number(c.currentTarget.getAttribute("data-index"));bt(c.target)&&xe(g),Q(g),(w=o==null?void 0:o.onFocus)==null||w.call(o,c)},Je=o=>c=>{var g;bt(c.target)||xe(-1),Q(-1),(g=o==null?void 0:o.onBlur)==null||g.call(o,c)},Ie=(o,c)=>{const g=Number(o.currentTarget.getAttribute("data-index")),w=A[g],P=M.indexOf(w);let x=c;if(Se&&v==null){const F=M[M.length-1];x>=F?x=F:x<=M[0]?x=M[0]:x=x<w?M[P-1]:M[P+1]}if(x=Le(x,d,i),te){n&&(x=Le(x,A[g-1]||-1/0,A[g+1]||1/0));const F=x;x=gt({values:A,newValue:x,index:g});let U=g;n||(U=x.indexOf(F)),Be({sliderRef:$,activeIndex:U})}j(x),xe(g),k&&!Ue(x,G)&&k(o,x,g),p&&p(o,le.current??x)},Qe=o=>c=>{var g;if(["ArrowUp","ArrowDown","ArrowLeft","ArrowRight","PageUp","PageDown","Home","End"].includes(c.key)){c.preventDefault();const w=Number(c.currentTarget.getAttribute("data-index")),P=A[w];let x=null;if(v!=null){const F=c.shiftKey?S:v;switch(c.key){case"ArrowUp":x=ke(P,F,1,d,i);break;case"ArrowRight":x=ke(P,F,u?-1:1,d,i);break;case"ArrowDown":x=ke(P,F,-1,d,i);break;case"ArrowLeft":x=ke(P,F,u?1:-1,d,i);break;case"PageUp":x=ke(P,S,1,d,i);break;case"PageDown":x=ke(P,S,-1,d,i);break;case"Home":x=d;break;case"End":x=i;break}}else if(Se){const F=M[M.length-1],U=M.indexOf(P),R=[u?"ArrowRight":"ArrowLeft","ArrowDown","PageDown","Home"],Y=[u?"ArrowLeft":"ArrowRight","ArrowUp","PageUp","End"];R.includes(c.key)?U===0?x=M[0]:x=M[U-1]:Y.includes(c.key)&&(U===M.length-1?x=F:x=M[U+1])}x!=null&&Ie(c,x)}(g=o==null?void 0:o.onKeyDown)==null||g.call(o,c)};Ot(()=>{var o;s&&$.current.contains(document.activeElement)&&((o=document.activeElement)==null||o.blur())},[s]),s&&L!==-1&&_(-1),s&&se!==-1&&xe(-1);const $e=o=>c=>{var g;(g=o.onChange)==null||g.call(o,c),Ie(c,c.target.valueAsNumber)},ue=C.useRef(void 0);let de=m;u&&m==="horizontal"&&(de+="-reverse");const pe=({finger:o,move:c=!1})=>{const{current:g}=$,{width:w,height:P,bottom:x,left:F}=g.getBoundingClientRect();let U;de.startsWith("vertical")?U=(x-o.y)/P:U=(o.x-F)/w,de.includes("-reverse")&&(U=1-U);let R;if(R=ma(U,d,i),v)R=ga(R,v,d);else{const je=vt(M,R);R=M[je]}R=Le(R,d,i);let Y=0;if(te){c?Y=ue.current:Y=vt(A,R),n&&(R=Le(R,A[Y-1]||-1/0,A[Y+1]||1/0));const je=R;R=gt({values:A,newValue:R,index:Y}),n&&c||(Y=R.indexOf(je),ue.current=Y)}return{newValue:R,activeIndex:Y}},he=nt(o=>{const c=Oe(o,T);if(!c)return;if(W.current+=1,o.type==="mousemove"&&o.buttons===0){Z(o);return}const{newValue:g,activeIndex:w}=pe({finger:c,move:!0});Be({sliderRef:$,activeIndex:w,setActive:_}),j(g),!re&&W.current>fa&&ne(!0),k&&!Ue(g,G)&&k(o,g,w)}),Z=nt(o=>{const c=Oe(o,T);if(ne(!1),!c)return;const{newValue:g}=pe({finger:c,move:!0});_(-1),o.type==="touchend"&&Q(-1),p&&p(o,le.current??g),T.current=void 0,be()}),O=nt(o=>{if(s)return;xt()||o.preventDefault();const c=o.changedTouches[0];c!=null&&(T.current=c.identifier);const g=Oe(o,T);if(g!==!1){const{newValue:P,activeIndex:x}=pe({finger:g});Be({sliderRef:$,activeIndex:x,setActive:_}),j(P),k&&!Ue(P,G)&&k(o,P,x)}W.current=0;const w=He($.current);w.addEventListener("touchmove",he,{passive:!0}),w.addEventListener("touchend",Z,{passive:!0})}),be=C.useCallback(()=>{const o=He($.current);o.removeEventListener("mousemove",he),o.removeEventListener("mouseup",Z),o.removeEventListener("touchmove",he),o.removeEventListener("touchend",Z)},[Z,he]);C.useEffect(()=>{const{current:o}=$;return o.addEventListener("touchstart",O,{passive:xt()}),()=>{o.removeEventListener("touchstart",O),be()}},[be,O]),C.useEffect(()=>{s&&be()},[s,be]);const Ze=o=>c=>{var P;if((P=o.onMouseDown)==null||P.call(o,c),s||c.defaultPrevented||c.button!==0)return;c.preventDefault();const g=Oe(c,T);if(g!==!1){const{newValue:x,activeIndex:F}=pe({finger:g});Be({sliderRef:$,activeIndex:F,setActive:_}),j(x),k&&!Ue(x,G)&&k(c,x,F)}W.current=0;const w=He($.current);w.addEventListener("mousemove",he,{passive:!0}),w.addEventListener("mouseup",Z)},Ae=Ye(te?A[0]:d,d,i),B=Ye(A[A.length-1],d,i)-Ae,Te=(o={})=>{const c=st(o),g={onMouseDown:Ze(c||{})},w={...c,...g};return{...o,ref:ce,...w}},Me=o=>c=>{var w;(w=o.onMouseOver)==null||w.call(o,c);const g=Number(c.currentTarget.getAttribute("data-index"));Q(g)},Ee=o=>c=>{var g;(g=o.onMouseLeave)==null||g.call(o,c),Q(-1)},Re=(o={})=>{const c=st(o),g={onMouseOver:Me(c||{}),onMouseLeave:Ee(c||{})};return{...o,...c,...g}},De=o=>({pointerEvents:L!==-1&&L!==o?"none":void 0});let ye;return m==="vertical"&&(ye=u?"vertical-rl":"vertical-lr"),{active:L,axis:de,axisProps:xa,dragging:re,focusedThumbIndex:se,getHiddenInputProps:(o={})=>{const c=st(o),g={onChange:$e(c||{}),onFocus:Ke(c||{}),onBlur:Je(c||{}),onKeyDown:Qe(c||{})},w={...c,...g};return{tabIndex:V,"aria-labelledby":t,"aria-orientation":m,"aria-valuemax":f(i),"aria-valuemin":f(d),name:y,type:"range",min:e.min,max:e.max,step:e.step===null&&e.marks?"any":e.step??void 0,disabled:s,...o,...w,style:{...ha,direction:u?"rtl":"ltr",width:"100%",height:"100%",writingMode:ye}}},getRootProps:Te,getThumbProps:Re,marks:Se,open:ie,range:te,rootRef:ce,trackLeap:B,trackOffset:Ae,values:A,getThumbStyle:De}}const Ca=e=>!e||!We(e);function wa(e){return wt("MuiSlider",e)}const X=Ct("MuiSlider",["root","active","colorPrimary","colorSecondary","colorError","colorInfo","colorSuccess","colorWarning","disabled","dragging","focusVisible","mark","markActive","marked","markLabel","markLabelActive","rail","sizeSmall","thumb","thumbColorPrimary","thumbColorSecondary","thumbColorError","thumbColorSuccess","thumbColorInfo","thumbColorWarning","track","trackInverted","trackFalse","thumbSizeSmall","valueLabel","valueLabelOpen","valueLabelCircle","valueLabelLabel","vertical"]),Sa=e=>{const{open:t}=e;return{offset:ge(t&&X.valueLabelOpen),circle:X.valueLabelCircle,label:X.valueLabelLabel}};function Ta(e){const{children:t,className:r,value:s}=e,n=Sa(e);return t?C.cloneElement(t,{className:ge(t.props.className)},a.jsxs(C.Fragment,{children:[t.props.children,a.jsx("span",{className:ge(n.offset,r),"aria-hidden":!0,children:a.jsx("span",{className:n.circle,children:a.jsx("span",{className:n.label,children:s})})})]})):null}function yt(e){return e}const ja=J("span",{name:"MuiSlider",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,t[`color${H(r.color)}`],r.size!=="medium"&&t[`size${H(r.size)}`],r.marked&&t.marked,r.orientation==="vertical"&&t.vertical,r.track==="inverted"&&t.trackInverted,r.track===!1&&t.trackFalse]}})(ee(({theme:e})=>({borderRadius:12,boxSizing:"content-box",display:"inline-block",position:"relative",cursor:"pointer",touchAction:"none",WebkitTapHighlightColor:"transparent","@media print":{colorAdjust:"exact"},[`&.${X.disabled}`]:{pointerEvents:"none",cursor:"default",color:(e.vars||e).palette.grey[400]},[`&.${X.dragging}`]:{[`& .${X.thumb}, & .${X.track}`]:{transition:"none"}},variants:[...Object.entries(e.palette).filter(Xe()).map(([t])=>({props:{color:t},style:{color:(e.vars||e).palette[t].main}})),{props:{orientation:"horizontal"},style:{height:4,width:"100%",padding:"13px 0","@media (pointer: coarse)":{padding:"20px 0"}}},{props:{orientation:"horizontal",size:"small"},style:{height:2}},{props:{orientation:"horizontal",marked:!0},style:{marginBottom:20}},{props:{orientation:"vertical"},style:{height:"100%",width:4,padding:"0 13px","@media (pointer: coarse)":{padding:"0 20px"}}},{props:{orientation:"vertical",size:"small"},style:{width:2}},{props:{orientation:"vertical",marked:!0},style:{marginRight:44}}]}))),La=J("span",{name:"MuiSlider",slot:"Rail",overridesResolver:(e,t)=>t.rail})({display:"block",position:"absolute",borderRadius:"inherit",backgroundColor:"currentColor",opacity:.38,variants:[{props:{orientation:"horizontal"},style:{width:"100%",height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{height:"100%",width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:"inverted"},style:{opacity:1}}]}),Pa=J("span",{name:"MuiSlider",slot:"Track",overridesResolver:(e,t)=>t.track})(ee(({theme:e})=>({display:"block",position:"absolute",borderRadius:"inherit",border:"1px solid currentColor",backgroundColor:"currentColor",transition:e.transitions.create(["left","width","bottom","height"],{duration:e.transitions.duration.shortest}),variants:[{props:{size:"small"},style:{border:"none"}},{props:{orientation:"horizontal"},style:{height:"inherit",top:"50%",transform:"translateY(-50%)"}},{props:{orientation:"vertical"},style:{width:"inherit",left:"50%",transform:"translateX(-50%)"}},{props:{track:!1},style:{display:"none"}},...Object.entries(e.palette).filter(Xe()).map(([t])=>({props:{color:t,track:"inverted"},style:{...e.vars?{backgroundColor:e.vars.palette.Slider[`${t}Track`],borderColor:e.vars.palette.Slider[`${t}Track`]}:{backgroundColor:ct(e.palette[t].main,.62),borderColor:ct(e.palette[t].main,.62),...e.applyStyles("dark",{backgroundColor:ut(e.palette[t].main,.5)}),...e.applyStyles("dark",{borderColor:ut(e.palette[t].main,.5)})}}}))]}))),Ia=J("span",{name:"MuiSlider",slot:"Thumb",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.thumb,t[`thumbColor${H(r.color)}`],r.size!=="medium"&&t[`thumbSize${H(r.size)}`]]}})(ee(({theme:e})=>({position:"absolute",width:20,height:20,boxSizing:"border-box",borderRadius:"50%",outline:0,backgroundColor:"currentColor",display:"flex",alignItems:"center",justifyContent:"center",transition:e.transitions.create(["box-shadow","left","bottom"],{duration:e.transitions.duration.shortest}),"&::before":{position:"absolute",content:'""',borderRadius:"inherit",width:"100%",height:"100%",boxShadow:(e.vars||e).shadows[2]},"&::after":{position:"absolute",content:'""',borderRadius:"50%",width:42,height:42,top:"50%",left:"50%",transform:"translate(-50%, -50%)"},[`&.${X.disabled}`]:{"&:hover":{boxShadow:"none"}},variants:[{props:{size:"small"},style:{width:12,height:12,"&::before":{boxShadow:"none"}}},{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-50%, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 50%)"}},...Object.entries(e.palette).filter(Xe()).map(([t])=>({props:{color:t},style:{[`&:hover, &.${X.focusVisible}`]:{...e.vars?{boxShadow:`0px 0px 0px 8px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 8px ${_e(e.palette[t].main,.16)}`},"@media (hover: none)":{boxShadow:"none"}},[`&.${X.active}`]:{...e.vars?{boxShadow:`0px 0px 0px 14px rgba(${e.vars.palette[t].mainChannel} / 0.16)`}:{boxShadow:`0px 0px 0px 14px ${_e(e.palette[t].main,.16)}`}}}}))]}))),$a=J(Ta,{name:"MuiSlider",slot:"ValueLabel",overridesResolver:(e,t)=>t.valueLabel})(ee(({theme:e})=>({zIndex:1,whiteSpace:"nowrap",...e.typography.body2,fontWeight:500,transition:e.transitions.create(["transform"],{duration:e.transitions.duration.shortest}),position:"absolute",backgroundColor:(e.vars||e).palette.grey[600],borderRadius:2,color:(e.vars||e).palette.common.white,display:"flex",alignItems:"center",justifyContent:"center",padding:"0.25rem 0.75rem",variants:[{props:{orientation:"horizontal"},style:{transform:"translateY(-100%) scale(0)",top:"-10px",transformOrigin:"bottom center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, 50%) rotate(45deg)",backgroundColor:"inherit",bottom:0,left:"50%"},[`&.${X.valueLabelOpen}`]:{transform:"translateY(-100%) scale(1)"}}},{props:{orientation:"vertical"},style:{transform:"translateY(-50%) scale(0)",right:"30px",top:"50%",transformOrigin:"right center","&::before":{position:"absolute",content:'""',width:8,height:8,transform:"translate(-50%, -50%) rotate(45deg)",backgroundColor:"inherit",right:-8,top:"50%"},[`&.${X.valueLabelOpen}`]:{transform:"translateY(-50%) scale(1)"}}},{props:{size:"small"},style:{fontSize:e.typography.pxToRem(12),padding:"0.25rem 0.5rem"}},{props:{orientation:"vertical",size:"small"},style:{right:"20px"}}]}))),Aa=J("span",{name:"MuiSlider",slot:"Mark",shouldForwardProp:e=>jt(e)&&e!=="markActive",overridesResolver:(e,t)=>{const{markActive:r}=e;return[t.mark,r&&t.markActive]}})(ee(({theme:e})=>({position:"absolute",width:2,height:2,borderRadius:1,backgroundColor:"currentColor",variants:[{props:{orientation:"horizontal"},style:{top:"50%",transform:"translate(-1px, -50%)"}},{props:{orientation:"vertical"},style:{left:"50%",transform:"translate(-50%, 1px)"}},{props:{markActive:!0},style:{backgroundColor:(e.vars||e).palette.background.paper,opacity:.8}}]}))),Ma=J("span",{name:"MuiSlider",slot:"MarkLabel",shouldForwardProp:e=>jt(e)&&e!=="markLabelActive",overridesResolver:(e,t)=>t.markLabel})(ee(({theme:e})=>({...e.typography.body2,color:(e.vars||e).palette.text.secondary,position:"absolute",whiteSpace:"nowrap",variants:[{props:{orientation:"horizontal"},style:{top:30,transform:"translateX(-50%)","@media (pointer: coarse)":{top:40}}},{props:{orientation:"vertical"},style:{left:36,transform:"translateY(50%)","@media (pointer: coarse)":{left:44}}},{props:{markLabelActive:!0},style:{color:(e.vars||e).palette.text.primary}}]}))),Ea=e=>{const{disabled:t,dragging:r,marked:s,orientation:n,track:u,classes:h,color:i,size:d}=e,y={root:["root",t&&"disabled",r&&"dragging",s&&"marked",n==="vertical"&&"vertical",u==="inverted"&&"trackInverted",u===!1&&"trackFalse",i&&`color${H(i)}`,d&&`size${H(d)}`],rail:["rail"],track:["track"],mark:["mark"],markActive:["markActive"],markLabel:["markLabel"],markLabelActive:["markLabelActive"],valueLabel:["valueLabel"],thumb:["thumb",t&&"disabled",d&&`thumbSize${H(d)}`,i&&`thumbColor${H(i)}`],active:["active"],disabled:["disabled"],focusVisible:["focusVisible"]};return Tt(y,wa,h)},Ra=({children:e})=>e,Da=C.forwardRef(function(t,r){const s=St({props:t,name:"MuiSlider"}),n=Bt(),{"aria-label":u,"aria-valuetext":h,"aria-labelledby":i,component:d="span",components:y={},componentsProps:l={},color:p="primary",classes:m,className:b,disableSwap:f=!1,disabled:v=!1,getAriaLabel:S,getAriaValueText:V,marks:D=!1,max:T=100,min:L=0,name:_,onChange:ie,onChangeCommitted:Q,orientation:re="horizontal",shiftStep:ne=10,size:W="medium",step:le=1,scale:G=yt,slotProps:j,slots:k,tabIndex:te,track:A="normal",value:Se,valueLabelDisplay:M="off",valueLabelFormat:se=yt,...xe}=s,$={...s,isRtl:n,max:T,min:L,classes:m,disabled:v,disableSwap:f,orientation:re,marks:D,color:p,size:W,step:le,shiftStep:ne,scale:G,track:A,valueLabelDisplay:M,valueLabelFormat:se},{axisProps:ce,getRootProps:Ke,getHiddenInputProps:Je,getThumbProps:Ie,open:Qe,active:$e,axis:ue,focusedThumbIndex:de,range:pe,dragging:he,marks:Z,values:O,trackOffset:be,trackLeap:Ze,getThumbStyle:Ae}=ka({...$,rootRef:r});$.marked=Z.length>0&&Z.some(E=>E.label),$.dragging=he,$.focusedThumbIndex=de;const B=Ea($),Te=(k==null?void 0:k.root)??y.Root??ja,Me=(k==null?void 0:k.rail)??y.Rail??La,Ee=(k==null?void 0:k.track)??y.Track??Pa,Re=(k==null?void 0:k.thumb)??y.Thumb??Ia,De=(k==null?void 0:k.valueLabel)??y.ValueLabel??$a,ye=(k==null?void 0:k.mark)??y.Mark??Aa,Fe=(k==null?void 0:k.markLabel)??y.MarkLabel??Ma,o=(k==null?void 0:k.input)??y.Input??"input",c=(j==null?void 0:j.root)??l.root,g=(j==null?void 0:j.rail)??l.rail,w=(j==null?void 0:j.track)??l.track,P=(j==null?void 0:j.thumb)??l.thumb,x=(j==null?void 0:j.valueLabel)??l.valueLabel,F=(j==null?void 0:j.mark)??l.mark,U=(j==null?void 0:j.markLabel)??l.markLabel,R=(j==null?void 0:j.input)??l.input,Y=oe({elementType:Te,getSlotProps:Ke,externalSlotProps:c,externalForwardedProps:xe,additionalProps:{...Ca(Te)&&{as:d}},ownerState:{...$,...c==null?void 0:c.ownerState},className:[B.root,b]}),je=oe({elementType:Me,externalSlotProps:g,ownerState:$,className:B.rail}),Dt=oe({elementType:Ee,externalSlotProps:w,additionalProps:{style:{...ce[ue].offset(be),...ce[ue].leap(Ze)}},ownerState:{...$,...w==null?void 0:w.ownerState},className:B.track}),et=oe({elementType:Re,getSlotProps:Ie,externalSlotProps:P,ownerState:{...$,...P==null?void 0:P.ownerState},className:B.thumb}),Ft=oe({elementType:De,externalSlotProps:x,ownerState:{...$,...x==null?void 0:x.ownerState},className:B.valueLabel}),tt=oe({elementType:ye,externalSlotProps:F,ownerState:$,className:B.mark}),at=oe({elementType:Fe,externalSlotProps:U,ownerState:$,className:B.markLabel}),zt=oe({elementType:o,getSlotProps:Je,externalSlotProps:R,ownerState:$});return a.jsxs(Te,{...Y,children:[a.jsx(Me,{...je}),a.jsx(Ee,{...Dt}),Z.filter(E=>E.value>=L&&E.value<=T).map((E,N)=>{const rt=Ye(E.value,L,T),ze=ce[ue].offset(rt);let ae;return A===!1?ae=O.includes(E.value):ae=A==="normal"&&(pe?E.value>=O[0]&&E.value<=O[O.length-1]:E.value<=O[0])||A==="inverted"&&(pe?E.value<=O[0]||E.value>=O[O.length-1]:E.value>=O[0]),a.jsxs(C.Fragment,{children:[a.jsx(ye,{"data-index":N,...tt,...!We(ye)&&{markActive:ae},style:{...ze,...tt.style},className:ge(tt.className,ae&&B.markActive)}),E.label!=null?a.jsx(Fe,{"aria-hidden":!0,"data-index":N,...at,...!We(Fe)&&{markLabelActive:ae},style:{...ze,...at.style},className:ge(B.markLabel,at.className,ae&&B.markLabelActive),children:E.label}):null]},N)}),O.map((E,N)=>{const rt=Ye(E,L,T),ze=ce[ue].offset(rt),ae=M==="off"?Ra:De;return a.jsx(ae,{...!We(ae)&&{valueLabelFormat:se,valueLabelDisplay:M,value:typeof se=="function"?se(G(E),N):se,index:N,open:Qe===N||$e===N||M==="on",disabled:v},...Ft,children:a.jsx(Re,{"data-index":N,...et,className:ge(B.thumb,et.className,$e===N&&B.active,de===N&&B.focusVisible),style:{...ze,...Ae(N),...et.style},children:a.jsx(o,{"data-index":N,"aria-label":S?S(N):u,"aria-valuenow":G(E),"aria-labelledby":i,"aria-valuetext":V?V(G(E),N):h,value:O[N],...zt})})},N)})]})});function Fa(e){return wt("MuiSwitch",e)}const q=Ct("MuiSwitch",["root","edgeStart","edgeEnd","switchBase","colorPrimary","colorSecondary","sizeSmall","sizeMedium","checked","disabled","input","thumb","track"]),za=e=>{const{classes:t,edge:r,size:s,color:n,checked:u,disabled:h}=e,i={root:["root",r&&`edge${H(r)}`,`size${H(s)}`],switchBase:["switchBase",`color${H(n)}`,u&&"checked",h&&"disabled"],thumb:["thumb"],track:["track"],input:["input"]},d=Tt(i,Fa,t);return{...t,...d}},Na=J("span",{name:"MuiSwitch",slot:"Root",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.root,r.edge&&t[`edge${H(r.edge)}`],t[`size${H(r.size)}`]]}})({display:"inline-flex",width:34+12*2,height:14+12*2,overflow:"hidden",padding:12,boxSizing:"border-box",position:"relative",flexShrink:0,zIndex:0,verticalAlign:"middle","@media print":{colorAdjust:"exact"},variants:[{props:{edge:"start"},style:{marginLeft:-8}},{props:{edge:"end"},style:{marginRight:-8}},{props:{size:"small"},style:{width:40,height:24,padding:7,[`& .${q.thumb}`]:{width:16,height:16},[`& .${q.switchBase}`]:{padding:4,[`&.${q.checked}`]:{transform:"translateX(16px)"}}}}]}),Va=J(Ut,{name:"MuiSwitch",slot:"SwitchBase",overridesResolver:(e,t)=>{const{ownerState:r}=e;return[t.switchBase,{[`& .${q.input}`]:t.input},r.color!=="default"&&t[`color${H(r.color)}`]]}})(ee(({theme:e})=>({position:"absolute",top:0,left:0,zIndex:1,color:e.vars?e.vars.palette.Switch.defaultColor:`${e.palette.mode==="light"?e.palette.common.white:e.palette.grey[300]}`,transition:e.transitions.create(["left","transform"],{duration:e.transitions.duration.shortest}),[`&.${q.checked}`]:{transform:"translateX(20px)"},[`&.${q.disabled}`]:{color:e.vars?e.vars.palette.Switch.defaultDisabledColor:`${e.palette.mode==="light"?e.palette.grey[100]:e.palette.grey[600]}`},[`&.${q.checked} + .${q.track}`]:{opacity:.5},[`&.${q.disabled} + .${q.track}`]:{opacity:e.vars?e.vars.opacity.switchTrackDisabled:`${e.palette.mode==="light"?.12:.2}`},[`& .${q.input}`]:{left:"-100%",width:"300%"}})),ee(({theme:e})=>({"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette.action.activeChannel} / ${e.vars.palette.action.hoverOpacity})`:_e(e.palette.action.active,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},variants:[...Object.entries(e.palette).filter(Xe(["light"])).map(([t])=>({props:{color:t},style:{[`&.${q.checked}`]:{color:(e.vars||e).palette[t].main,"&:hover":{backgroundColor:e.vars?`rgba(${e.vars.palette[t].mainChannel} / ${e.vars.palette.action.hoverOpacity})`:_e(e.palette[t].main,e.palette.action.hoverOpacity),"@media (hover: none)":{backgroundColor:"transparent"}},[`&.${q.disabled}`]:{color:e.vars?e.vars.palette.Switch[`${t}DisabledColor`]:`${e.palette.mode==="light"?ct(e.palette[t].main,.62):ut(e.palette[t].main,.55)}`}},[`&.${q.checked} + .${q.track}`]:{backgroundColor:(e.vars||e).palette[t].main}}}))]}))),Oa=J("span",{name:"MuiSwitch",slot:"Track",overridesResolver:(e,t)=>t.track})(ee(({theme:e})=>({height:"100%",width:"100%",borderRadius:14/2,zIndex:-1,transition:e.transitions.create(["opacity","background-color"],{duration:e.transitions.duration.shortest}),backgroundColor:e.vars?e.vars.palette.common.onBackground:`${e.palette.mode==="light"?e.palette.common.black:e.palette.common.white}`,opacity:e.vars?e.vars.opacity.switchTrack:`${e.palette.mode==="light"?.38:.3}`}))),Ba=J("span",{name:"MuiSwitch",slot:"Thumb",overridesResolver:(e,t)=>t.thumb})(ee(({theme:e})=>({boxShadow:(e.vars||e).shadows[1],backgroundColor:"currentColor",width:20,height:20,borderRadius:"50%"}))),Rt=C.forwardRef(function(t,r){const s=St({props:t,name:"MuiSwitch"}),{className:n,color:u="primary",edge:h=!1,size:i="medium",sx:d,slots:y={},slotProps:l={},...p}=s,m={...s,color:u,edge:h,size:i},b=za(m),f={slots:y,slotProps:l},[v,S]=ot("root",{className:ge(b.root,n),elementType:Na,externalForwardedProps:f,ownerState:m,additionalProps:{sx:d}}),[V,D]=ot("thumb",{className:b.thumb,elementType:Ba,externalForwardedProps:f,ownerState:m}),T=a.jsx(V,{...D}),[L,_]=ot("track",{className:b.track,elementType:Oa,externalForwardedProps:f,ownerState:m});return a.jsxs(v,{...S,children:[a.jsx(Va,{type:"checkbox",icon:T,checkedIcon:T,ref:r,ownerState:m,...p,classes:{...b,root:b.switchBase},slots:{...y.switchBase&&{root:y.switchBase},...y.input&&{input:y.input}},slotProps:{...l.switchBase&&{root:typeof l.switchBase=="function"?l.switchBase(m):l.switchBase},...l.input&&{input:typeof l.input=="function"?l.input(m):l.input}}}),a.jsx(L,{..._})]})}),Ua=Lt(a.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),kt=Lt(a.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),qa=["Critical","Strained","Unstable","Stable","Improving","Strong","Thriving"];function Ga(){const e=[9,29,49,69,84,99,100],t={data:{},order:[]};t.order=e.map((n,u)=>{const h=Ne();return t.data[h]={name:qa[u],max:n},h});const r={data:{},order:[]},s=Ne();return r.data[s]={name:"default",value:1},r.order=[s],{id:Ne(),refId:Ne(),version:1,name:"",description:"",icon:{...Qt[0],color:"black",backgroundColor:"#fbf7ef"},balance:{cost:{base:0,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},max:{base:1,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},health:{base:0,perLevel:!1,valuePerLevel:0,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]}},thresholds:t,settlementPointCost:r,isPositive:!0,canHurt:!0,isTradeable:!0,hasThresholds:!0,hasSPC:!0,genre:"",subGenre:"",properties:{data:{canOverflow:!0,isCurrency:!1,requiresUpkeep:!1,canGather:!1},config:{},order:["canOverflow","isCurrency","requiresUpkeep"]},tags:[],isValid:!1,status:"DRAFT",createdBy:""}}const Pe={name:{label:"Attribute Name",type:"text",tooltip:"The unique name of the attribute. This should clearly convey the attribute's purpose and role within the settlement mechanics.",validateFn:e=>e?e.trim().length<3?"Attribute name must be at least 3 characters long":null:"Attribute name is required",keypath:"name"},costPerLevel:{label:"Currency Cost",type:"number",tooltip:"The amount of currency required per level to acquire this attribute. This cost scales with the settlement's level.",validateFn:e=>e?e<=0?"Cost per level must be greater than 0":null:"Cost per level is required",keypath:"balance.cost.base"},healthPerLevel:{label:"Health Drain",type:"number",tooltip:"This value represents the health damage the settlement takes for each missing unit of this attribute, scaled by settlement level.",validateFn:e=>e==null?"Health per level is required":e<0?"Health per level cannot be negative":null,keypath:"balance.health.base"},maxPerLevel:{label:"Max",type:"number",tooltip:"The maximum number of units of this attribute that can provide benefits to the settlement per level.",validateFn:e=>e===void 0?"Max per level is required":e<0?"Max per level must be 0 or greater":null,keypath:"balance.max.base"},description:{label:"Description",type:"textarea",tooltip:"A brief explanation of the attribute's purpose and impact. This provides essential context for understanding its role in the settlement.",validateFn:e=>e?e.trim().length<30?`Description must be at least 30 characters long. You need ${30-e.length} more characters.`:null:"Description is required",keypath:"description"},healthValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for health per level. This value represents the scaling value per interval based on Health Drain.",validateFn:e=>e==null?"Health per level scale is required":null,keypath:"balance.health.valuePerLevel"},healthIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which health is calculated based on the health drain. This value determines how often the health is updated.",validateFn:e=>e==null?"Health interval per level is required":e<=0?"Health interval per level must be greater than 0":null,keypath:"balance.health.interval"},costValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for cost per level. This value represents the scaling value per interval based on Cost.",validateFn:e=>e==null?"Cost per level scale is required":null,keypath:"balance.cost.valuePerLevel"},costIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which cost is calculated based on the cost per level. This value determines how often the cost is updated.",validateFn:e=>e==null?"Cost interval per level is required":e<=0?"Cost interval per level must be greater than 0":null,keypath:"balance.cost.interval"},maxValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for max per level. This value represents the scaling value per interval based on Max.",validateFn:e=>e==null?"Max per level scale is required":null,keypath:"balance.max.valuePerLevel"},maxIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which max is calculated based on the max per level. This value determines how often the max is updated.",validateFn:e=>e==null?"Max interval per level is required":e<=0?"Max interval per level must be greater than 0":null,keypath:"balance.max.interval"}},K=({keypath:e,trueLabel:t="",falseLabel:r="",sx:s={display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,boxSizing:"border-box",transition:"background-color 0.3s ease, border-color 1s ease",borderLeft:"2px solid",pl:2,py:.5,width:"100%",color:"text.primary",borderRadius:0},tooltip:n,disabled:u=!1,onChange:h,falseColor:i="warning",trueColor:d="success",trueThemeKey:y="main",falseThemeKey:l="main",border:p=!0,variant:m="row",buttonType:b="button",heightLock:f=!1})=>{const{tool:v,id:S}=C.useContext(It),{updateTool:V,selectEditValue:D}=Ce(v,S),T=D(e),{utils:L}=At(),{lockHeight:_}=$t(),ie=()=>{f&&T&&_(),V(e,!T),typeof h=="function"&&h(!T)};return a.jsxs(Pt,{tabIndex:-1,disableFocusRipple:!0,disabled:u,onClick:()=>{b==="button"&&ie()},sx:{...s,borderColor:T?L.color(d,y,.5):L.color(i,l,.5),"&:hover":{bgcolor:T?L.color(d,y,.1):L.color(i,l,.1)},borderLeft:p?s==null?void 0:s.borderLeft:"none",flexDirection:m},children:[a.jsx(fe,{title:a.jsx(z,{variant:"body2",children:n||`Toggle ${e}`}),placement:"top",arrow:!0,children:a.jsx(z,{variant:"body2",sx:{flexGrow:1,textAlign:"left",textTransform:"uppercase"},children:T?t:r||t})}),a.jsx(Rt,{id:`${v}-${S}-${e}`,size:"small",color:T?d:i,checked:T===!0,sx:{"& .MuiSwitch-switchBase":{"&.Mui-checked":{color:L.color(d,y,.8)},"&:not(.Mui-checked)":{color:L.color(i,l,.8)}},"& .MuiSwitch-track":{backgroundColor:L.color("info","light",1)}},onClick:()=>{(b="switch")&&ie()}})]})},Ha=na(sa.div)({}),Ge=({children:e,show:t=!0,duration:r=.3,sx:s={},onMouseLeave:n=()=>{},onMouseEnter:u=()=>{}})=>a.jsx(ra,{children:t&&a.jsx(Ha,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:r},style:{overflow:"hidden",marginBottom:"0.5rem"},sx:s,onMouseLeave:n,onMouseEnter:u,children:e})}),Wa={linear:"Change Per Interval","slow-exponential":"Base","fast-exponential":"Base",custom:"Change Per Interval"},lt=({disabled:e,property:t,fields:r,slide:s,setSlide:n,slideLabel:u="",slideColor:h="secondary",borderColor:i="honey.main",accentColor:d="info.main"})=>{const{id:y,tool:l}=we(),{edit:p,updateTool:m,selectEditValue:b}=Ce(l,y),[f,v]=C.useState(!1),S=b(`balance.${t}`);if(!S)return null;const{valuePerLevel:V,interval:D,scaleToggle:T,scaleCurve:L,base:_,perLevel:ie,valuesPerInterval:Q}=S,re=()=>{const ne=p.balance[t],{interval:W,scaleToggle:le,valuesPerInterval:G}=ne;if(W<=0)return[];const j={};if(G.forEach(k=>{k&&k.level&&k.value!==void 0&&(j[k.level]=k.value)}),le){const k=Array.from({length:Math.ceil(21/W)},(te,A)=>A*W).slice(1,21).map(te=>({level:te,value:0}));m(`balance.${t}.valuesPerInterval`,k)}else return[]};return C.useEffect(()=>{L==="custom"&&re()},[L,D]),a.jsxs(Ge,{show:!e,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",border:"1px solid",borderColor:p!=null&&p.balance[t].perLevel?f?d:i:"transparent",transition:"border-color 0.3s ease, padding 0.3s ease",boxSizing:"border-box",p:p.balance[t].perLevel?1:0,borderRadius:2},onMouseEnter:v.bind(null,!0),onMouseLeave:v.bind(null,!1),children:[a.jsx(ve,{inputConfig:r[`${t}PerLevel`]}),a.jsx(K,{keypath:`balance.${t}.perLevel`,trueLabel:"Scale",falseLabel:"Flat",tooltip:"Enable to automatically adjust related values when max per level changes.",border:!1,variant:"column-reverse",disabled:e,heightLock:!0}),a.jsxs(Ge,{show:p==null?void 0:p.balance[t].perLevel,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",justifyContent:"center"},children:[a.jsx(ve,{inputConfig:r[`${t}IntervalPerLevel`],decimals:0,allowZero:!1}),a.jsx(K,{keypath:`balance.${t}.scaleToggle`,trueLabel:"Custom",falseLabel:"Default",variant:"column-reverse",tooltip:"Enable scaling separate from the base value.",border:!1,heightLock:!0}),a.jsxs(Ge,{show:p==null?void 0:p.balance[t].scaleToggle,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"center"},children:[a.jsx(ve,{dynamicLabel:Wa[p==null?void 0:p.balance[t].scaleCurve],inputConfig:r[`${t}ValuePerLevel`],style:{width:"100%"},disabled:(p==null?void 0:p.balance[t].scaleCurve)==="custom"}),a.jsx(ea,{keypath:`balance.${t}.scaleCurve`,label:"Scale Curve",options:[{value:"linear",name:"Linear"},{value:"slow-exponential",name:"Slow Exponential"},{value:"fast-exponential",name:"Fast Exponential"},{value:"custom",name:"Per Interval"}],small:!1}),a.jsx(Ge,{show:(p==null?void 0:p.balance[t].scaleCurve)==="custom",sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)","repeat(4, 1fr)","repeat(5, 1fr)"],gap:1,width:"100%"},children:Q.map((ne,W)=>a.jsx(ve,{inputConfig:{keypath:`balance.${t}.valuesPerInterval.${W}.value`,label:`Level ${ne.level}`,type:"number"},style:{width:"100%"}},`${t}-interval-${W}`))})]})]})]})},_a=({columns:e})=>{const{tool:t,id:r}=C.useContext(It),{edit:s}=Ce(t,r),[n,u]=C.useState(!1),[h,i]=C.useState(5),d=l=>{const p=s.balance[l],{base:m,perLevel:b,valuePerLevel:f,interval:v,scaleToggle:S}=p;return S?`Floor(${h} / ${v}) * ${f} + ${m})`:b?`Floor(${h} / ${v}) * ${m})`:`${m}`},y=l=>{const p=s.balance[l],{base:m,perLevel:b,valuePerLevel:f,interval:v,scaleToggle:S,scaleCurve:V,valuesPerInterval:D}=p;if(m===void 0)return"0";switch(S){case!0:{const T=h/v;switch(V){case"linear":return(Math.floor(T)*f+m).toFixed(0);case"slow-exponential":return(Math.pow(T,1.5)*f+m).toFixed(0);case"fast-exponential":return(Math.pow(T,2)*f+m).toFixed(0);case"custom":{if(!(D!=null&&D.length))return m.toFixed(0);const L=Math.floor(T);return L<0||L-1>=D.length?m.toFixed(0):(D.slice(0,L).reduce((Q,re)=>Q+re.value,0)+m).toFixed(0)}default:return m.toFixed(0)}}case!1:return b?(Math.max(1,Math.floor(h/v))*m).toFixed(0):m.toFixed(0);default:return m.toFixed(0)}};return s?a.jsxs(I,{id:`attr-values-${r}`,sx:{display:"flex",flexDirection:"column",gap:2},children:[a.jsxs(qt,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,height:"100%"},children:[a.jsxs(Gt,{sx:{display:"flex",alignItems:"center",gap:.5},children:[a.jsx(z,{children:"Autobalance"}),a.jsx(fe,{title:"Automatically adjust related values to maintain a balanced configuration.",children:a.jsx(Zt,{sx:{fontSize:18,color:"text.secondary",cursor:"pointer"}})})]}),a.jsx(Rt,{checked:n,onChange:l=>u(l.target.checked)})]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"auto",alignItems:"center",justifyContent:"start",my:2,width:"100%",position:"relative",gridColumn:"span 3",boxSizing:"border-box"},children:[a.jsx(I,{sx:{gridColumn:"span 2",display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:a.jsxs(I,{sx:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",px:4},children:[a.jsx(Da,{valueLabelDisplay:"auto",color:"secondary",defaultValue:h,value:h,onChange:(l,p)=>{i(p)},min:1,max:20,step:1}),a.jsxs(I,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:1},children:[a.jsx(z,{variant:"body2",sx:{fontWeight:"bold",width:"100%"},children:`Values at Level ${h}: `}),a.jsx(fe,{title:d("max"),children:a.jsxs(z,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"success.main"},children:["Max: ",y("max")]})}),s.canHurt&&a.jsx(fe,{title:d("health"),children:a.jsxs(z,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"error.main"},children:["Health: ",y("health")]})}),s.isTradeable&&a.jsx(fe,{title:d("cost"),children:a.jsxs(z,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"honey.main"},children:["Cost: ",y("cost")]})})]})]})}),a.jsx(lt,{disabled:!1,property:"max",fields:Pe,slide:h,setSlide:i,slideLabel:"Max Value",borderColor:"dividerDark"}),a.jsx(lt,{disabled:!s.canHurt,property:"health",fields:Pe,slide:h,setSlide:i,slideLabel:"Total Drain",borderColor:"dividerDark",accentColor:"error.main"}),a.jsx(lt,{disabled:!s.isTradeable,property:"cost",fields:Pe,slide:h,setSlide:i,slideLabel:"Total Cost",borderColor:"dividerDark",accentColor:"honey.main"})]})]}):null},Ya={name:"",tooltip:"",type:"number",validate:e=>e<=-1?"Value must be 0 or greater":null,keypath:""},Xa=({content:e})=>a.jsx(z,{component:"span",children:e.map((t,r)=>t.type==="text"?a.jsx("span",{children:t.value},r):t.type==="strong"?a.jsx("strong",{children:t.value},r):t.type==="tooltip"?a.jsx(fe,{title:t.title,arrow:!0,children:a.jsx(z,{component:"span",sx:{textDecoration:"underline",fontWeight:"bold",cursor:"pointer"},onClick:t.onClick,children:t.value})},r):null)}),Ka=[{name:"Fortified",description:"Fortified Settlements put their trust in theirs walls, preemptive reconnaissance, and well-trained troops.",id:"789"},{name:"Mercantile",description:"Mercantile Settlements focus on establishing and expanding trade, developing vibrant culture, and welcoming artisans.",id:"456"},{name:"Survivalist",description:"Survivalists focus on gathering food, supplies, medical items, and constructing durable shelters.",id:"123"}],Ja=[{type:"text",value:"Define the "},{type:"tooltip",title:"Settlements earn 1 settlement point per level per turn, barring other boons or banes. Click for more information.",value:"Settlement Point Cost",onClick:()=>console.log("open SPC help panel")},{type:"text",value:" of this attribute per Settlement Type. A value of "},{type:"strong",value:"0"},{type:"text",value:" means this cannot be purchased with settlement points for that settlement type."}],Qa=()=>{const{tool:e,id:t}=we(),{data:r,order:s,errors:n,add:u,remove:h}=ia(e,t,"settlementPointCost"),[i,d]=C.useState(null),[y,l]=C.useState(""),p=C.useMemo(()=>{const b=Object.keys(r||{}).reduce((v,S)=>(v.push(S),v),[]);return Ka.filter(v=>!b.includes(v.id))},[r]),m=C.useMemo(()=>Object.entries(r||{}).map(([b,f])=>{const v=f;return{...Ya,name:v.name,label:v.name.charAt(0).toUpperCase()+v.name.slice(1),tooltip:void 0,id:b,keypath:`settlementPointCost.data.${b}.value`}}),[r]);return s?a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:"1fr 0.1fr 1fr",gap:2},children:[a.jsx(I,{sx:{gridColumn:"span 3",p:2},children:a.jsx(Xa,{content:Ja})}),a.jsx(I,{sx:{display:"flex",alignItems:"start",width:"100%"},children:a.jsx(Ht,{inputValue:y,options:p,getOptionLabel:b=>b.name,renderInput:b=>a.jsx(Wt,{...b,label:"Settlement Type",variant:"outlined",error:!!(n!=null&&n.name),helperText:n==null?void 0:n.name,onChange:f=>{l(f.target.value)},onKeyDown:f=>{f.key==="Enter"&&(u({id:i.id,entry:{name:i.name,value:1},sort:!1}),l(""))}}),onChange:(b,f)=>{d(f),l((f==null?void 0:f.name)||"")},renderOption:(b,f)=>C.createElement(I,{...b,component:"li",key:f.name,sx:{display:"flex",alignItems:"center"}},a.jsx(fe,{title:a.jsx(z,{children:f.description}),placement:"left",arrow:!0,children:a.jsx(z,{children:f.name})})),sx:{my:2,width:"100%"}})}),a.jsx(me,{orientation:"vertical",flexItem:!0,children:a.jsx(_t,{label:a.jsx(Ua,{}),onClick:()=>{u({id:i.id,entry:{name:i.name,value:1},sort:!1}),l("")},sx:{width:"100%",color:"white"}})}),a.jsx(I,{children:s.map((b,f)=>{const v=m.find(S=>S.id===b);return v?a.jsx(Yt.Fragment,{children:a.jsx(ve,{inputConfig:v,style:{width:"100%",m:0,p:0},shrink:!0,onMoreDetails:v.name!=="default"?()=>{console.log("More details clicked")}:void 0,onRemove:v.name!=="default"?()=>h(b):void 0})},b):null})})]}):a.jsx(I,{children:"Loading..."})},Za={propertiesExpanded:!0,editTabs:{Properties:{name:"Properties",disabled:!1},Values:{name:"Values",disabled:!1},SPC:{name:"SPC",disabled:!1},Thresholds:{name:"Thresholds",disabled:!1},Currency:{name:"Currency",disabled:!0},Gather:{name:"Gather",disabled:!0},Upkeep:{name:"Upkeep",disabled:!0}},activeTab:"Properties",lastTab:null,activeIndex:0,lastIndex:0};function er(e,t){switch(t.type){case"TOGGLE_PROPERTIES":return{...e,propertiesExpanded:!e.propertiesExpanded};case"SET_ACTIVE_TAB":const{name:r,index:s,defaultLast:n}=t.payload;return{...e,lastIndex:n?0:e.activeIndex,lastTab:n?"Values":e.activeTab,activeTab:r,activeIndex:s};case"SET_TAB_DISABLED":{const{property:u,disabled:h}=t.payload;return{...e,editTabs:{...e.editTabs,[u]:{...e.editTabs[u],disabled:h}}}}default:return e}}const dt=(e,t,r)=>({type:"SET_ACTIVE_TAB",payload:{name:e,index:t,defaultLast:r}}),tr=(e,t)=>({type:"SET_TAB_DISABLED",payload:{property:e,disabled:t}}),ar=({columns:e})=>{var d,y,l,p;const t=pt(),{tool:r,id:s,showModal:n,tabId:u,side:h}=we(),{edit:i}=Ce(r,s);return C.useEffect(()=>{i!=null&&i.name&&t(ht({tabId:u,side:h,keypath:"name",updates:(i==null?void 0:i.name.trim().length)>0?i==null?void 0:i.name.trim():"Untitled"}))},[i==null?void 0:i.name,t,u,h]),a.jsxs(a.Fragment,{children:[a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"flex",alignItems:"center",gap:2},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"space-around",flexGrow:1},children:[a.jsx(z,{variant:"h6",children:"Icon:"}),a.jsx(Mt,{viewBox:((d=i==null?void 0:i.icon)==null?void 0:d.viewBox)||"0 0 664 512",path:((y=i==null?void 0:i.icon)==null?void 0:y.d)||"",size:24,color:((l=i==null?void 0:i.icon)==null?void 0:l.color)||"primary",backgroundColor:((p=i==null?void 0:i.icon)==null?void 0:p.backgroundColor)||"background.paper",onClick:()=>{n({entry:{componentKey:"IconSelector",props:{tool:r,id:s,tabId:u,side:h},id:"icon-selector"}})}})]}),a.jsx(ve,{inputConfig:Pe.name,style:{flexGrow:2,flexShrink:1,px:1}})]}),a.jsx(ve,{inputConfig:Pe.description,style:{gridColumn:`span ${e}`,px:1},multiline:!0})]})},rr={isTradeable:{disables:["properties.data.isCurrency"]},"properties.data.isCurrency":{disables:["properties.data.requiresUpkeep","isTradeable"],enables:["properties.data.canOverflow"]},"properties.data.requiresUpkeep":{disables:["properties.data.isCurrency","properties.data.canHarvest"]},"properties.data.canGather":{disables:["properties.data.requiresUpkeep"]}},nr={hasThresholds:{key:"Thresholds",value:!0},hasSPC:{key:"SPC",value:!0},"properties.data.isCurrency":{key:"Currency",value:!1},"properties.data.requiresUpkeep":{key:"Upkeep",value:!1},"properties.data.canGather":{key:"Gather",value:!1}},sr=({columns:e,activeTab:t,lastTab:r,lastIndex:s,localDispatch:n})=>{const{tool:u,id:h,showModal:i,tabId:d,side:y}=we(),{edit:l,updateTool:p}=Ce(u,h),{makeSnackbar:m}=ta(),b=(f,v)=>{var D,T;const S=rr[f],V=nr[f];V&&(t===V.key&&!v&&n(dt(r,s,!0)),n(tr(V.key,!v))),S&&v&&((D=S.disables)==null||D.forEach(L=>{p(L,!1)}),S!=null&&S.enables&&((T=S==null?void 0:S.enables)==null||T.forEach(L=>{p(L,!0)})))};return l?a.jsxs(a.Fragment,{children:[a.jsx(ar,{columns:e}),a.jsx(I,{sx:{gridColumn:`span ${e}`},children:a.jsx(aa,{defaultGenre:l.genre,defaultSubGenre:l.subGenre,updateFn:p})}),a.jsxs(I,{sx:{gridColumn:`span ${e}`,display:"grid",gridTemplateColumns:["1fr","1fr",`repeat(${e}, 1fr)`],gap:2},children:[a.jsxs(I,{children:[a.jsxs(me,{children:["Major Properties"," ",a.jsx(ft,{size:"small",children:a.jsx(kt,{})})]}),a.jsx(K,{keypath:"isPositive",trueLabel:"Is Positive",falseLabel:"Is Negative",falseColor:"error",tooltip:"Toggle if this attribute is positive or negative. A positive attribute is beneficial, while a negative attribute is detrimental."}),a.jsx(K,{keypath:"canHurt",trueLabel:"Can Hurt",falseLabel:"Cannot Hurt",tooltip:"Toggle if this attribute can affect health."}),a.jsx(K,{keypath:"isTradeable",trueLabel:"Can Trade",falseLabel:"Cannot Trade",tooltip:"Toggle if this attribute can be traded. This forces a baseline cost, and allows it to be added to Trading Hubs. Tradeable attributes cannot be currency.",disabled:l==null?void 0:l.properties.data.isCurrency}),a.jsx(K,{keypath:"hasThresholds",trueLabel:"Thresholds",falseLabel:"No Thresholds",tooltip:"Toggle if this attribute has unique thresholds. If disabled, default thresholds will be used internally.",onChange:()=>{b("hasThresholds",!l.hasThresholds),l.hasThresholds&&m({message:"Default thresholds will be used.",type:"info",duration:3e3})}}),a.jsx(K,{keypath:"hasSPC",trueLabel:"Settlement Points",falseLabel:"No Settlement Points",tooltip:"Toggle if this attribute can be acquired through settlement points.",onChange:()=>{b("hasSPC",!l.hasSPC)}})]}),a.jsxs(I,{children:[a.jsxs(me,{children:["Minor Properties"," ",a.jsx(ft,{size:"small",children:a.jsx(kt,{})})]}),a.jsx(K,{keypath:"properties.data.canOverflow",trueLabel:"Can Overflow",falseLabel:"Cannot Overflow",tooltip:"Toggle if this attribute can overflow. Overflowing attributes can exceed their maximum value, but overages will not be counted towards calculations.",disabled:l==null?void 0:l.properties.data.isCurrency}),a.jsx(K,{keypath:"properties.data.isCurrency",trueLabel:"Is Currency",falseLabel:"Not Currency",tooltip:"Toggle if this attribute is treated as currency. This removes any cap on the attribute's value and allows it to integrate with the Tax System, among other things.",disabled:(l==null?void 0:l.isTradeable)||(l==null?void 0:l.properties.data.requiresUpkeep),onChange:f=>{b("properties.data.isCurrency",f),f&&l.properties.data.canGather&&m({message:"Currency attributes are rarely harvestable. Be sure this makes sense in your world!",type:"warning",duration:5e3})}}),a.jsx(K,{keypath:"properties.data.requiresUpkeep",trueLabel:"Requires Upkeep",falseLabel:"No Upkeep Required",tooltip:"Toggle if this attribute requires upkeep. This will add an upkeep cost to the attribute, which must be paid with a currency to keep it active.",disabled:(l==null?void 0:l.properties.data.isCurrency)||(l==null?void 0:l.properties.data.canGather),onChange:f=>{b("properties.data.requiresUpkeep",f)}}),a.jsx(K,{keypath:"properties.data.canGather",trueLabel:"Can Gather",falseLabel:"Cannot Gather",tooltip:"Toggle if this attribute can be acquired by assigning other attributes, e.g. 'Productivity', to it.",disabled:l==null?void 0:l.properties.data.requiresUpkeep,onChange:f=>{b("properties.data.canGather",f),f&&l.properties.data.isCurrency&&m({message:"Harvestable attributes are rarely currency. Be sure this makes sense in your world!",type:"warning",duration:5e3})}})]})]}),a.jsx(ua,{})]}):null};function or({editSelector:e,currentSelector:t,targets:r,batchSaveFn:s,intervalMs:n=6e4}){if(!e||!t)throw console.warn("useAutosave is missing selectors."),new Error("useAutosave is missing selectors.");const u=mt(e),h=mt(t),i=C.useRef(!1),d=C.useRef({}),{snackbar:y}=At().utils;C.useEffect(()=>{r.forEach(p=>{d.current[p.id]=0})},[r]);const l=C.useCallback(async p=>{if(i.current)return;i.current=!0;const m={};for(const b of r){if(!b||!b.keypath)continue;const f=it.get(h,b.keypath),v=it.get(u,b.keypath);it.isEqual(f,v)||(m[b.keypath]=v)}if(Object.keys(m).length)try{console.log("Batch saving updates:",m),await s({updates:m})}catch(b){console.warn("Batch save failed",b),y({message:"Autosave failed.",type:"error"})}p&&console.log("Flushing autosave // edit: ",u),i.current=!1},[r,h,u,s,y]);C.useEffect(()=>{const p=setInterval(()=>l(!1),n);return()=>{l(!0),clearInterval(p)}},[l,n])}function ir({id:e,side:t,tabId:r,tool:s,updates:n}){return async(u,h)=>{u(Xt({tool:s,id:e,updates:n})),u(ht({tabId:r,side:t,keypath:"viewState.isDirty",updates:!1}));try{console.log("Batch updating tool:",s,"with updates:",n)}catch(i){console.error("Error during batch update:",i)}}}function lr({id:e,tabId:t,side:r}){const s=pt(),n=Kt("attribute",e),u=Jt("attribute",e),h=[{id:`attribute-${e}-name`,label:"Attribute Name",keypath:"name"},{id:`attribute-${e}-description`,label:"Attribute Description",keypath:"description"},{id:`attribute-${e}-icon`,label:"Attribute Icon",keypath:"icon"},{id:`attribute-${e}-cost`,label:"Attribute Cost",keypath:"balance.cost"},{id:`attribute-${e}-max`,label:"Attribute Max",keypath:"balance.max"},{id:`attribute-${e}-health`,label:"Attribute Health",keypath:"balance.health"},{id:`attribute-${e}-thresholds`,label:"Attribute Thresholds",keypath:"thresholds"},{id:`attribute-${e}-settlementPointCost`,label:"Settlement Point Cost",keypath:"settlementPointCost"},{id:`attribute-${e}-isPositive`,label:"Is Positive",keypath:"isPositive"},{id:`attribute-${e}-canHurt`,label:"Can Hurt",keypath:"canHurt"},{id:`attribute-${e}-isTradeable`,label:"Is Tradeable",keypath:"isTradeable"},{id:`attribute-${e}-hasThresholds`,label:"Has Thresholds",keypath:"hasThresholds"},{id:`attribute-${e}-hasSPC`,label:"Has Settlement Point Cost",keypath:"hasSPC"},{id:`attribute-${e}-genre`,label:"Attribute Genre",keypath:"genre"},{id:`attribute-${e}-subGenre`,label:"Attribute Sub Genre",keypath:"subGenre"},{id:`attribute-${e}-properties`,label:"Attribute Properties",keypath:"properties.data"},{id:`attribute-${e}-tags`,label:"Attribute Tags",keypath:"tags"}];return{editSelector:n,currentSelector:u,targets:h,batchSaveFn:async({updates:d})=>{s(ir({id:e,side:r,tabId:t,tool:"attribute",updates:d}))},intervalMs:5e3}}const cr={Properties:sr,Values:_a,SPC:Qa,Thresholds:la,Currency:()=>a.jsx(I,{children:"Currency Component"}),Gather:()=>a.jsx(I,{children:"Gather Component"}),Upkeep:()=>a.jsx(I,{children:"Upkeep Component"})},ur=()=>{const{tab:e,id:t}=we(),{both:r}=da(),s=pt(),[n,u]=C.useReducer(er,e.viewState.editAttr||Za),{activeTab:h,editTabs:i,lastIndex:d}=n;or(lr({id:t,tabId:e.tabId,side:e.side})),C.useEffect(()=>{e.lastTab&&e.lastIndex&&u(dt(e.lastTab,e.lastIndex))},[]),C.useEffect(()=>()=>{console.log("Saving local state on unmount:"),s(ht({tabId:e.tabId,side:e.side,keypath:"viewState.editAttr",updates:{...n}}))},[n]);const y=r?1:2,l=(b,f)=>{u(dt(b,f))},{ref:p,height:m}=$t();return a.jsx(I,{id:`edit-attribute-${e.id}`,ref:p,sx:{height:"100%",transition:"height 0.4s ease-in-out",overflow:typeof m=="number"?"hidden":"auto",width:"100%",px:2,boxSizing:"border-box"},children:a.jsx(oa,{tabs:Object.values(i).map(b=>({...b,disabled:b.disabled||!1,props:{localDispatch:u}})),componentMap:cr,activeTab:h,handleTabClick:l,columns:y,lastIndex:d})})},dr=()=>{var u,h,i,d,y,l,p,m,b,f;const{tool:e,id:t,mode:r,side:s}=we(),{current:n}=Ce("attribute",t);return a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",mt:2,gap:2,width:"100%",position:"relative",pb:4},children:[a.jsxs(I,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,height:"88px",flexGrow:1,flexShrink:2},children:[a.jsx(z,{variant:"body1",sx:{fontWeight:"bold",fontSize:"1.25rem"},children:"Icon"}),a.jsx(Pt,{sx:{boxShadow:4,borderRadius:"50%",height:64,width:64},disabled:!0,children:a.jsx(Mt,{viewBox:((u=n==null?void 0:n.icon)==null?void 0:u.viewBox)||"0 0 664 512",path:((h=n==null?void 0:n.icon)==null?void 0:h.d)||"",size:24,color:((i=n==null?void 0:n.icon)==null?void 0:i.color)||"primary",backgroundColor:((d=n==null?void 0:n.icon)==null?void 0:d.backgroundColor)||"background.paper"})})]}),a.jsxs(I,{sx:{gridColumn:"span 2",display:"flex",gap:2,alignItems:"center",justifyContent:"start",height:"100%"},children:[a.jsx(z,{variant:"h6",children:"Name:"}),a.jsx(z,{children:(n==null?void 0:n.name)||"None"})]}),a.jsx(me,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"DESCRIPTION"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",flexDirection:"column",gap:2,alignItems:"start",justifyContent:"center"},children:[a.jsx(z,{sx:{textAlign:"start"},variant:"body1",children:(n==null?void 0:n.description)||"No description"}),a.jsxs(I,{sx:{gridColumn:"span 3",display:"flex",gap:2,alignItems:"center",justifyContent:"center"},children:[a.jsx(z,{variant:"body1",sx:{fontWeight:"bold"},children:"Type:"}),a.jsx(z,{variant:"body1",children:n!=null&&n.isPositive?"Positive":"Negative"})]})]}),a.jsxs(me,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:[" ","SCALING PER LEVEL"," "]}),a.jsxs(I,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridColumn:"span 3",columnGap:2},children:[a.jsx(Ve,{name:"Max",value:(l=(y=n==null?void 0:n.balance)==null?void 0:y.max)==null?void 0:l.base,even:!1}),a.jsx(Ve,{name:"Health",value:(m=(p=n==null?void 0:n.balance)==null?void 0:p.health)==null?void 0:m.base,even:!0}),a.jsx(Ve,{name:"Cost",value:(f=(b=n==null?void 0:n.balance)==null?void 0:b.cost)==null?void 0:f.base,even:!1})]}),a.jsx(me,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"SETTLEMENT POINT COSTS"}),n.settlementPointCost.order.map((v,S)=>a.jsx(Ve,{name:n.settlementPointCost.data[v].name,value:n.settlementPointCost.data[v].value,even:S%2===0},v)),a.jsx(me,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"THRESHOLDS"}),a.jsx(ca,{data:n.thresholds.data,order:n.thresholds.order})]})},pr=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],hr=["name","description","balance","thresholds","settlementPointCost"],Lr=({tab:e})=>a.jsx(pa,{tab:e,initializeTool:Ga,validationFields:hr,editComponent:ur,previewComponent:dr,checklistContent:pr});export{Lr as default,hr as validationFields};
