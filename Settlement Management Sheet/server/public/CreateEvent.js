import{v as b,j as e,B as l,r as c,U as C,V as T,W as k,R as S,p as y,F as E,X as D,Y as R,Z as z,t as L,q as m,G as P}from"./main.js";import{u as j,C as A}from"./CreateShell.js";function H(){const s=b(),o={data:{},order:[]},t={id:s,name:"Phase 1",description:"",flavorText:{trivial:"",minor:"",notable:"",significant:"",major:""},type:"Immediate",impacts:[],resolutions:[{id:b(),name:"Resolution 1",description:"",impacts:[],keys:[]}],nextPhaseId:null,duration:null,productivity:null,exposedKeys:[],isTerminal:!1};return o.data[s]=t,o.order.push(s),{id:b(),refId:b(),version:1,name:"",description:"",tags:[],isValid:!1,status:"DRAFT",createdBy:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),narrativeWeight:null,phases:o}}const O=({})=>e.jsx(l,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"start",my:2,gap:2,backgroundColor:"background.paper",width:"100%",position:"relative",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:"I'm the PreviewEvent component!"}),W=({children:s,value:o,id:t})=>e.jsx(l,{role:"tabpanel",hidden:o!==t,id:`tabpanel-${t}`,"aria-labelledby":`tab-${t}`,style:{height:"100%",width:"100%"},children:o===t&&e.jsx(l,{sx:{display:"flex",justifyContent:"center",alignItems:"start",flexGrow:1,flexDirection:"row",height:"100%",width:"100%",border:"1px solid",borderColor:"dividerDark",boxSizing:"border-box"},children:s},t)}),Y=({tabs:s,onAdd:o,onRemove:t,removeLimit:h=1,maxContentHeight:x="87vh",height:p,maxWidth:g,headerSx:f,addLabel:v="Add Phase"})=>{const[i,n]=c.useState(null),r=a=>{t(a),i===a&&n(null)};return c.useEffect(()=>{i===null&&s.length>0&&n(s[0].tabId)},[s]),e.jsxs(l,{sx:{width:"100%",height:"100%",overflowY:"scroll",display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",flexShrink:1,boxSizing:"border-box",px:1},children:[e.jsx(l,{sx:{borderColor:"divider",display:"flex",justifyContent:"start",alignItems:"center",width:"100%",boxSizing:"border-box",backgroundColor:"background.paper",maxHeight:40,boxSizing:"border-box"},children:e.jsxs(l,{sx:{display:"flex",flexDirection:"row",display:"flex",justifyContent:"start",alignItems:"center",width:"100%",boxSizing:"border-box"},children:[s.map((a,d)=>e.jsxs(l,{sx:{position:"relative",display:"flex",alignItems:"center",border:"1px solid",boxSizing:"border-box",maxHeight:48,overflow:"hidden",borderRadius:"16px 16px 0 0",p:.5,backgroundColor:i===a.tabId?"primary.main":"background.paper",color:i===a.tabId?"white":"text.primary",borderColor:i===a.tabId?"primary.main":"dividerDark"},onClick:()=>{n(a.tabId)},children:[e.jsx(C,{label:a.name,value:a.tabId,sx:{my:-2,p:2,fontSize:"0.875rem",maxHeight:44}}),e.jsx(T,{size:"small",onClick:u=>{u.stopPropagation(),r(a.tabId)},children:e.jsx(k,{fontSize:"0.75rem",sx:{color:"warning.main"}})})]},a.tabId)),e.jsx(l,{sx:{position:"relative",display:"flex",alignItems:"center",border:"1px solid",boxSizing:"border-box",maxHeight:48,overflow:"hidden",borderRadius:"16px 16px 0 0",p:.5,height:38,borderColor:"dividerDark",backgroundColor:"secondary.main"},children:e.jsx(C,{label:"Add Phase",value:null,sx:{my:-2,p:2,fontSize:"0.875rem",maxHeight:44,textDecoration:"underline",color:"white",fontWeight:"bold"},onClick:o})})]})}),s.map((a,d)=>e.jsx(W,{value:i,id:a.tabId,children:S.createElement(a.component,a.props||{})},d))]})},M=({phaseId:s})=>{const{id:o}=j(),{edit:t,updateTool:h}=y("event",o),x=t==null?void 0:t.phases.data[s],[p,g]=c.useState((t==null?void 0:t.type)||"default");c.useEffect(()=>{x&&g(x.type)},[t]);const f=i=>{g(i.target.value),h(`phases.data.${s}.type`,i.target.value)},v=[{label:"Immediate",tooltip:"Immediate phases apply their impacts immediately without mitigation."},{label:"Active",tooltip:"Active phases apply their impacts until all productivity requirements are met."},{label:"Passive",tooltip:"Passive phases apply their impacts for the duration listed."},{label:"Indefinite",tooltip:"Indefinite phases apply their impacts until resolved in-game via actual TTRPG play."}];return e.jsxs(E,{fullWidth:!0,sx:{width:"100%"},variant:"outlined",children:[e.jsx(D,{id:"phase-type-select-label",children:"Phase Type"}),e.jsx(R,{labelId:"phase-type-select-label",id:"phase-type-select",value:p,label:"Phase Type",onChange:f,sx:{width:"100%"},children:v.map(i=>e.jsx(z,{value:i.label,children:e.jsx(L,{title:e.jsx(m,{children:i.tooltip}),arrow:!0,placement:"left",children:e.jsx(m,{children:i.label})})},i.label))})]})},I=({phaseId:s})=>{const{id:o}=j();return y("event",o),e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",gap:2,backgroundColor:"background.paper",height:"100%",position:"relative",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},className:"create-phase",children:[e.jsx(m,{variant:"h6",sx:{width:"100%",my:2},children:"Create Phase"}),e.jsx(l,{sx:{width:"100%",display:"flex",justifyContent:"start",alignItems:"center"},children:e.jsx(M,{phaseId:s})})]})},B=s=>({id:b(),name:`Phase ${s+1}`,description:"",flavorText:{trivial:"",minor:"",notable:"",significant:"",major:""},type:"Active",impacts:[],resolutions:[],nextPhaseId:null,duration:null,productivity:null,exposedKeys:[],isTerminal:!1}),F=({setShowModal:s})=>{P();const{id:o}=j(),{edit:t,updateTool:h}=y("event",o),[x,p]=c.useState([]),[g,f]=c.useState((t==null?void 0:t.phases.length)||2);c.useEffect(()=>{if(t){console.log(t.phases);const n=t.phases.order.map((r,a)=>{var d;return{name:(d=t.phases.data[r])==null?void 0:d.name,component:I,props:{phaseId:r},tabId:r}});p(n)}},[t]);const v=()=>{const n={...t.phases.data},r=[...t.phases.order],a=B(r.length);n[a.id]=a,r.push(a.id),f(d=>d+1),h("phases.data",n),h("phases.order",r),p(d=>[...d,{name:a.name,component:I,props:{phaseId:a.id},tabId:a.id}])},i=n=>{const r=[...t.phases.order],a={...t.phases.data};delete a[n];const d=r.filter(u=>u!==n);h("phases.data",a),h("phases.order",d),p(u=>u.filter(w=>w.tabId!==n))};return e.jsxs(l,{sx:{display:"grid",gridTemplateColumns:"1fr 6fr",gridTemplateRows:"auto",py:2,backgroundColor:"background.paper",width:"100%",position:"relative",overflowY:"auto",height:"100%"},children:[e.jsxs(l,{sx:{display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",gap:2,backgroundColor:"background.paper",height:"100%",position:"relative",overflowY:"auto"},children:[e.jsx(m,{children:"Meta Data"}),e.jsx(m,{children:"Phases"}),e.jsx(m,{children:"Event Map"}),e.jsx(m,{children:"Resolutions"}),e.jsx(m,{children:"Keys"})]}),e.jsx(Y,{tabs:[...x],onAdd:v,onRemove:i,removeLimit:1,maxContentHeight:"calc(100vh - 200px)",height:"100%",maxWidth:"95%",headerSx:{},addLabel:"+"})]})},$=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],N=({id:s,mode:o,side:t,tabId:h})=>{const{preventSplit:x,setPreventSplit:p}=P();return c.useEffect(()=>{x||p(!0)},[x,p]),c.useEffect(()=>()=>{p(!1)},[]),e.jsx(A,{tool:"event",id:s,initializeTool:H,validationFields:["name","description"],editComponent:F,previewComponent:O,checklistContent:$,loadDisplayName:"Load Event",modalComponents:{},modalComponentsProps:{},side:t,mode:o,tabId:h,page:!1})};export{N as default};
