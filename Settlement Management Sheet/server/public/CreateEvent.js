import{v as x,j as t,B as o,r as h,X as C,I,Y as P,R as k,k as v,n as S,H as j,D as T}from"./main.js";import{u as f,C as E}from"./CreateShell.js";import{E as D}from"./EditNameDescription.js";function R(){return{id:x(),refId:x(),version:1,name:"",description:"",tags:[],isValid:!1,status:"DRAFT",createdBy:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),narrativeWeight:null,phases:[{id:x(),name:"Phase 1",description:"",flavorText:{trivial:"",minor:"",notable:"",significant:"",major:""},type:"Active",impacts:[],resolutions:[{id:x(),name:"Resolution 1",description:"",impacts:[],keys:[]}],nextPhaseId:null,duration:null,productivity:null,exposedKeys:[],isTerminal:!1}]}}const z=({})=>t.jsx(o,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"start",my:2,gap:2,backgroundColor:"background.paper",width:"100%",position:"relative",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:"I'm the PreviewEvent component!"}),H=({children:e,value:r,id:n})=>t.jsx(o,{role:"tabpanel",hidden:r!==n,id:`tabpanel-${n}`,"aria-labelledby":`tab-${n}`,style:{height:"100%",width:"100%"},children:r===n&&t.jsx(o,{sx:{display:"flex",justifyContent:"center",alignItems:"start",flexGrow:1,flexDirection:"row",height:"100%",width:"100%",border:"1px solid",boxSizing:"border-box"},children:e},n)}),A=({tabs:e,onAdd:r,onRemove:n,removeLimit:c=1,maxContentHeight:m="87vh",height:l,maxWidth:b,headerSx:g,addLabel:y="Add Phase"})=>{const[d,i]=h.useState(null),s=a=>{n(a),d===a&&i(null)};return h.useEffect(()=>{d===null&&e.length>0&&i(e[0].tabId)},[e]),t.jsxs(o,{sx:{width:"100%",height:"100%",overflowY:"scroll",display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",flexShrink:1,maxWidth:[600,800,1200,1600],overflowX:"show"},children:[t.jsx(o,{sx:{borderColor:"divider",display:"flex",justifyContent:"start",alignItems:"center",width:"100%",boxSizing:"border-box",backgroundColor:"background.paper",maxHeight:40,boxSizing:"border-box"},children:t.jsxs(o,{sx:{display:"flex",flexDirection:"row",display:"flex",justifyContent:"start",alignItems:"center",width:"100%",boxSizing:"border-box"},children:[e.map((a,p)=>t.jsxs(o,{sx:{position:"relative",display:"flex",alignItems:"center",border:"1px solid",boxSizing:"border-box",maxHeight:48,overflow:"hidden",borderRadius:"16px 16px 0 0",p:.5,backgroundColor:d===a.tabId?"primary.main":"background.paper",color:d===a.tabId?"white":"text.primary",borderColor:d===a.tabId?"primary.main":"dividerDark"},onClick:()=>{i(a.tabId)},children:[t.jsx(C,{label:a.name,value:a.tabId,sx:{my:-2,p:2,fontSize:"0.875rem",maxHeight:44}}),t.jsx(I,{size:"small",onClick:u=>{u.stopPropagation(),s(a.tabId)},children:t.jsx(P,{fontSize:"0.75rem",sx:{color:"warning.main"}})})]},a.tabId)),t.jsx(o,{sx:{position:"relative",display:"flex",alignItems:"center",border:"1px solid",boxSizing:"border-box",maxHeight:48,overflow:"hidden",borderRadius:"16px 16px 0 0",p:.5,height:38,borderColor:"dividerDark",backgroundColor:"secondary.main"},children:t.jsx(C,{label:"Add Phase",value:null,sx:{my:-2,p:2,fontSize:"0.875rem",maxHeight:44,textDecoration:"underline",color:"white",fontWeight:"bold"},onClick:r})})]})}),e.map((a,p)=>t.jsx(H,{value:d,id:a.tabId,children:k.createElement(a.component,a.props||{})},p))]})},w=({phaseId:e})=>{const{id:r}=f();return v("event",r),t.jsx(o,{sx:{display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"center",gap:2,backgroundColor:"background.paper",height:"100%",position:"relative",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},className:"create-phase",children:t.jsx(o,{sx:{width:"100%",display:"flex",justifyContent:"center"},children:t.jsx(S,{variant:"h6",sx:{width:"100%"},children:"Create Phase"})})})},L=e=>({id:x(),name:`Phase ${e+1}`,description:"",flavorText:{trivial:"",minor:"",notable:"",significant:"",major:""},type:"Active",impacts:[],resolutions:[],nextPhaseId:null,duration:null,productivity:null,exposedKeys:[],isTerminal:!1}),Y={name:{name:"name",label:"Event Name",type:"text",tooltip:"The name of the event. This should clearly convey the event's content and / or theme.",validate:e=>e?e.length<3?"Event name must be at least 3 characters long":null:"Event name is required",keypath:"name"},description:{name:"description",label:"Description",type:"text",tooltip:"A description of the event and how it can shape the world.",multiline:!0,minRows:3,validate:e=>e?e.length<30?`Description must be at least 30 characters. You have ${30-e.length} characters remaining.`:null:"Description is required",keypath:"description"}},N=({})=>{const{id:e}=f();return v("event",e),t.jsx(o,{children:t.jsx(D,{tool:"event",id:e,fields:Y})})},W=({setShowModal:e})=>{j();const{id:r}=f(),{edit:n,updateTool:c}=v("event",r),[m,l]=h.useState([]),[b,g]=h.useState((n==null?void 0:n.phases.length)||2);h.useEffect(()=>{if(n){const i=n.phases.map((s,a)=>({name:s.name,component:w,props:{phaseId:s.id},tabId:s.id}));l(i)}},[n]);const y=()=>{const i=[...n.phases],s=L(i.length);i.push({...s,name:`Phase ${b}`}),g(a=>a+1),c("phases",i),l(a=>[...a,{name:s.name,component:w,props:{phaseId:s.id},tabId:s.id}])},d=i=>{const a=[...n.phases].filter(p=>p.id!==i);c("phases",a),l(p=>p.filter(u=>u.tabId!==i))};return t.jsxs(o,{sx:{display:"grid",gridTemplateColumns:"2fr 10px 4fr",gridTemplateRows:"auto",alignItems:"start",justifyContent:"start",gap:1,my:2,backgroundColor:"background.paper",width:"100%",position:"relative",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:[t.jsx(N,{}),t.jsx(T,{orientation:"vertical",flexItem:!0,sx:{mr:1.5}}),t.jsx(A,{tabs:[...m],onAdd:y,onRemove:d,removeLimit:1,maxContentHeight:"87vh",height:"100%",maxWidth:"100%",headerSx:{},addLabel:"+"})]})},$=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],q=({id:e,mode:r,side:n,tabId:c})=>{const{preventSplit:m,setPreventSplit:l}=j();return h.useEffect(()=>{m||l(!0)},[m,l]),h.useEffect(()=>()=>{l(!1)},[]),t.jsx(E,{tool:"event",id:e,initializeTool:R,validationFields:["name","description"],editComponent:W,previewComponent:z,checklistContent:$,loadDisplayName:"Load Event",modalComponents:{},modalComponentsProps:{},side:n,mode:r,tabId:c,width:"100%"})};export{q as default};
