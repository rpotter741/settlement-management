import{v as b,j as t,i as r,r as p,b4 as C,I as S,ax as k,R as T,N as E,O as D,S as R,Q as z,G as A,T as h,h as w}from"./main.js";import{u as y}from"./useTools.js";import{u as j}from"./PageBox.js";import{C as L}from"./CreateToolShell.js";import"./toolSelectors.js";import"./loadTool.js";function H(){const s=b(),i={data:{},order:[]},e={id:s,name:"Phase 1",description:"",flavorText:{trivial:"",minor:"",notable:"",significant:"",major:""},type:"Immediate",impacts:[],resolutions:[{id:b(),name:"Resolution 1",description:"",impacts:[],keys:[]}],nextPhaseId:null,duration:null,productivity:null,exposedKeys:[],isTerminal:!1};return i.data[s]=e,i.order.push(s),{id:b(),refId:b(),version:1,name:"",description:"",tags:[],isValid:!1,status:"DRAFT",createdBy:"",createdAt:new Date().toISOString(),updatedAt:new Date().toISOString(),narrativeWeight:null,phases:i}}const O=({})=>t.jsx(r,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"start",my:2,gap:2,backgroundColor:"background.paper",width:"100%",position:"relative",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:"I'm the PreviewEvent component!"}),W=({children:s,value:i,id:e})=>t.jsx(r,{role:"tabpanel",hidden:i!==e,id:`tabpanel-${e}`,"aria-labelledby":`tab-${e}`,style:{height:"100%",width:"100%"},children:i===e&&t.jsx(r,{sx:{display:"flex",justifyContent:"center",alignItems:"start",flexGrow:1,flexDirection:"row",height:"100%",width:"100%",border:"1px solid",borderColor:"dividerDark",boxSizing:"border-box"},children:s},e)}),Y=({tabs:s,onAdd:i,onRemove:e,removeLimit:c=1,maxContentHeight:m="87vh",height:x,maxWidth:f,headerSx:g,addLabel:v="Add Phase"})=>{const[o,n]=p.useState(null),l=a=>{e(a),o===a&&n(null)};return p.useEffect(()=>{o===null&&s.length>0&&n(s[0].tabId)},[s]),t.jsxs(r,{sx:{width:"100%",height:"100%",overflowY:"scroll",display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",flexShrink:1,boxSizing:"border-box",px:1},children:[t.jsx(r,{sx:{borderColor:"divider",display:"flex",justifyContent:"start",alignItems:"center",width:"100%",boxSizing:"border-box",backgroundColor:"background.paper",maxHeight:40,boxSizing:"border-box"},children:t.jsxs(r,{sx:{display:"flex",flexDirection:"row",display:"flex",justifyContent:"start",alignItems:"center",width:"100%",boxSizing:"border-box"},children:[s.map((a,d)=>t.jsxs(r,{sx:{position:"relative",display:"flex",alignItems:"center",border:"1px solid",boxSizing:"border-box",maxHeight:48,overflow:"hidden",borderRadius:"16px 16px 0 0",p:.5,backgroundColor:o===a.tabId?"primary.main":"background.paper",color:o===a.tabId?"white":"text.primary",borderColor:o===a.tabId?"primary.main":"dividerDark"},onClick:()=>{n(a.tabId)},children:[t.jsx(C,{label:a.name,value:a.tabId,sx:{my:-2,p:2,fontSize:"0.875rem",maxHeight:44}}),t.jsx(S,{size:"small",onClick:u=>{u.stopPropagation(),l(a.tabId)},children:t.jsx(k,{fontSize:"0.75rem",sx:{color:"warning.main"}})})]},a.tabId)),t.jsx(r,{sx:{position:"relative",display:"flex",alignItems:"center",border:"1px solid",boxSizing:"border-box",maxHeight:48,overflow:"hidden",borderRadius:"16px 16px 0 0",p:.5,height:38,borderColor:"dividerDark",backgroundColor:"secondary.main"},children:t.jsx(C,{label:"Add Phase",value:null,sx:{my:-2,p:2,fontSize:"0.875rem",maxHeight:44,textDecoration:"underline",color:"white",fontWeight:"bold"},onClick:i})})]})}),s.map((a,d)=>t.jsx(W,{value:o,id:a.tabId,children:T.createElement(a.component,a.props||{})},d))]})},M=({phaseId:s})=>{const{id:i}=j(),{edit:e,updateTool:c}=y("event",i),m=e==null?void 0:e.phases.data[s],[x,f]=p.useState((e==null?void 0:e.type)||"default");p.useEffect(()=>{m&&f(m.type)},[e]);const g=o=>{f(o.target.value),c(`phases.data.${s}.type`,o.target.value)},v=[{label:"Immediate",tooltip:"Immediate phases apply their impacts immediately without mitigation."},{label:"Active",tooltip:"Active phases apply their impacts until all productivity requirements are met."},{label:"Passive",tooltip:"Passive phases apply their impacts for the duration listed."},{label:"Indefinite",tooltip:"Indefinite phases apply their impacts until resolved in-game via actual TTRPG play."}];return t.jsxs(E,{fullWidth:!0,sx:{width:"100%"},variant:"outlined",children:[t.jsx(D,{id:"phase-type-select-label",children:"Phase Type"}),t.jsx(R,{labelId:"phase-type-select-label",id:"phase-type-select",value:x,label:"Phase Type",onChange:g,sx:{width:"100%"},children:v.map(o=>t.jsx(z,{value:o.label,children:t.jsx(A,{title:t.jsx(h,{children:o.tooltip}),arrow:!0,placement:"left",children:t.jsx(h,{children:o.label})})},o.label))})]})},I=({phaseId:s})=>{const{id:i}=j();return y("event",i),t.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",gap:2,backgroundColor:"background.paper",height:"100%",position:"relative",overflowY:"auto",maxHeight:"calc(100vh - 200px)"},className:"create-phase",children:[t.jsx(h,{variant:"h6",sx:{width:"100%",my:2},children:"Create Phase"}),t.jsx(r,{sx:{width:"100%",display:"flex",justifyContent:"start",alignItems:"center"},children:t.jsx(M,{phaseId:s})})]})},$=s=>({id:b(),name:`Phase ${s+1}`,description:"",flavorText:{trivial:"",minor:"",notable:"",significant:"",major:""},type:"Active",impacts:[],resolutions:[],nextPhaseId:null,duration:null,productivity:null,exposedKeys:[],isTerminal:!1}),B=({setShowModal:s})=>{w();const{id:i}=j(),{edit:e,updateTool:c}=y("event",i),[m,x]=p.useState([]),[f,g]=p.useState((e==null?void 0:e.phases.length)||2);p.useEffect(()=>{if(e){console.log(e.phases);const n=e.phases.order.map((l,a)=>{var d;return{name:(d=e.phases.data[l])==null?void 0:d.name,component:I,props:{phaseId:l},tabId:l}});x(n)}},[e]);const v=()=>{const n={...e.phases.data},l=[...e.phases.order],a=$(l.length);n[a.id]=a,l.push(a.id),g(d=>d+1),c("phases.data",n),c("phases.order",l),x(d=>[...d,{name:a.name,component:I,props:{phaseId:a.id},tabId:a.id}])},o=n=>{const l=[...e.phases.order],a={...e.phases.data};delete a[n];const d=l.filter(u=>u!==n);c("phases.data",a),c("phases.order",d),x(u=>u.filter(P=>P.tabId!==n))};return t.jsxs(r,{sx:{display:"grid",gridTemplateColumns:"1fr 6fr",gridTemplateRows:"auto",py:2,backgroundColor:"background.paper",width:"100%",position:"relative",overflowY:"auto",height:"100%"},children:[t.jsxs(r,{sx:{display:"flex",flexDirection:"column",alignItems:"start",justifyContent:"start",gap:2,backgroundColor:"background.paper",height:"100%",position:"relative",overflowY:"auto"},children:[t.jsx(h,{children:"Meta Data"}),t.jsx(h,{children:"Phases"}),t.jsx(h,{children:"Event Map"}),t.jsx(h,{children:"Resolutions"}),t.jsx(h,{children:"Keys"})]}),t.jsx(Y,{tabs:[...m],onAdd:v,onRemove:o,removeLimit:1,maxContentHeight:"calc(100vh - 200px)",height:"100%",maxWidth:"95%",headerSx:{},addLabel:"+"})]})},F=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],J=({tab:s})=>{const{preventSplit:i,setPreventSplit:e}=w();return p.useEffect(()=>{i||e(!0)},[i,e]),p.useEffect(()=>()=>{e(!1)},[]),t.jsx(L,{tab:s,initializeTool:H,validationFields:["name","description"],editComponent:B,previewComponent:O,checklistContent:F,innerStyle:{display:"flex",justifyContent:"start",flexDirection:"column",alignItems:"center",px:0,mb:0,boxShadow:"none",borderRadius:0,backgroundColor:"background.default",width:"100%",maxWidth:"100%",position:"relative",flexShrink:1,height:"100%",overflowY:"scroll"}})};export{J as default};
