import{aF as l,by as g,a2 as i,bz as A,bA as S,bB as w,bC as f,an as b,ao as I,bD as m,a1 as G,ak as h,bE as p,av as N,bF as E,bG as B,bj as $,v as x,bH as F,bI as v,bJ as M,bK as O,be as P,bL as z}from"./main.js";function C(){return async(n,t)=>{try{const e=await l.getGlossaries(),r=t().glossary.glossaries.edit.byId;console.log(e),e.forEach(a=>{r[a.id]||n(g({glossaryId:a.id,name:a.name,description:a.description,genre:a.genre,subGenre:a.subGenre,integrationState:a.integrationState,theme:a.theme}))})}catch(e){console.error("Error fetching glossaries:",e),n(i({message:"Error fetching glossaries. Try again later.",type:"error",duration:3e3}))}}}function K({glossaryId:n}){return async(t,e)=>{try{const r=e().glossary.glossaries.edit.byId[n];if(r.hydrated)return;const a=await l.getNodes({glossaryId:n}),s=r.renderState,{nodeMap:o,roots:d,renderState:y}=A(a,s);t(S({glossaryId:n,nodes:o,structure:a,renderState:y}))}catch(r){console.error("Error fetching glossary nodes:",r),t(i({message:"Error fetching glossary structure. Try again later.",type:"error",duration:3e3}))}}}function j({node:n}){return async t=>{try{const e=n,r=await l.getEntryById({nodeId:e.id,entryType:e.entryType});t(w({glossaryId:e.glossaryId,entryId:e.id,entryData:r}))}catch(e){console.error("Error fetching glossary node:",e),t(i({message:"Error fetching glossary node. Try again later.",type:"error",duration:3e3}))}}}function H({id:n,name:t,description:e,genre:r,subGenre:a}){return async s=>{try{const o=await l.createGlossary({id:n,name:t,description:e,genre:r,subGenre:a});s(g({glossaryId:o.id,name:o.name,description:o.description,genre:o.genre,subGenre:o.subGenre}))}catch(o){console.error("Error creating glossary:",o),s(i({message:"Error creating glossary. Try again later.",type:"error",duration:3e3}))}}}function J({node:n}){return async t=>{const{id:e,name:r,entryType:a,parentId:s,glossaryId:o}=n;console.log("Creating node and section"),t(f({glossaryId:o,nodeId:e,nodeData:n}));try{await l.createNodeAndSection({id:e,name:r,entryType:a,fileType:"section",parentId:s,glossaryId:o,entryData:n}),t(b({glossaryId:o,nodeId:e})),s&&t(I({glossaryId:o,nodeId:s,expanded:!0}))}catch(d){console.error("Error adding node:",d),t(m({glossaryId:o,nodeId:e})),t(i({message:"Error adding entry. Try again later.",type:"error",duration:3e3}))}}}function L({node:n}){return async(t,e)=>{const{id:r,glossaryId:a,fileType:s,name:o,entryType:d}=n,y=G.cloneDeep(h(a,r)(e()));if(y.name===o){console.warn("No change in name, skipping update.");return}t(p({glossaryId:a,nodeId:r,nodeData:{...y,name:o}}));try{await l.renameNodeAndEntry({id:r,name:o,entryType:d,fileType:s})}catch(c){console.error("Error renaming node:",c),t(p({glossaryId:a,nodeId:r,nodeData:{...y}})),t(i({message:"Error renaming entry. Try again later.",type:"error",duration:3e3}))}}}function q({id:n,name:t,description:e,genre:r,subGenre:a}){return async s=>{s(g({glossaryId:n,name:t,description:e,genre:r,subGenre:a,integrationState:{},theme:"default"})),s(N({glossaryId:n}))}}const k=n=>(t,e)=>{const{left:r,right:a}=e().tabs,s=y=>(y==="left"?r:a).order.find(u=>(y==="left"?r.data[u]:a.data[u]).id===n),o=s("left");if(o){t(E({tabId:o,side:"left"}));return}const d=s("right");if(d){t(E({tabId:d,side:"right"}));return}console.error("Tab not found in tabThunks: findAndDeleteTab:",n)};function Q({node:n}){return async(t,e)=>{const{id:r,entryType:a,fileType:s,glossaryId:o}=n,d=G.cloneDeep(h(o,r)(e()));try{await l.deleteEntry({id:r,entryType:a,fileType:s,glossaryId:o}),t(m({glossaryId:o,nodeId:r})),t(k(r)),t(i({message:`${d.name} successfully deleted.`,type:"success",duration:3e3,component:void 0,props:{}}))}catch(y){console.error("Error removing node:",y),t(f({glossaryId:o,nodeId:r,nodeData:d})),t(i({message:"Error removing entry. Try again later.",type:"error",duration:3e3}))}}}function R({glossaryId:n,entryId:t,property:e,inheritanceMap:r}){return async(a,s)=>{try{const d=(await l.getOptionsByProperty({property:e,inheritanceMap:r})).results;a(B({glossaryId:n,entryId:t,property:e,options:d}))}catch(o){console.error("Error fetching options by property:",o),a(i({message:"Error fetching options. Try again later.",type:"error",duration:3e3}))}}}function U(){return async(n,t)=>{const e=t().glossary.activeGlossaryId;if(!e){n(i({message:"No active glossary selected.",type:"error",duration:3e3}));return}const r=t().glossary.glossaries[e];if(!r){n(i({message:"Active glossary not found.",type:"error",duration:3e3}));return}n($({name:r.name,mode:"edit",tool:"editGlossary",tabType:"glossary",id:r.id,tabId:x(),scroll:0,activate:!0,disableMenu:!0,preventSplit:!1}))}}function V({node:n}){return async t=>{const{id:e,name:r,entryType:a,parentId:s,glossaryId:o}=n;t(f({glossaryId:o,nodeId:e,nodeData:n}));try{await l.createNodeAndDetail({id:e,name:r,entryType:a,fileType:"detail",parentId:s,glossaryId:o,entryData:n}),t(b({glossaryId:o,nodeId:e})),s&&t(I({glossaryId:o,nodeId:s,expanded:!0}))}catch(d){console.error("Error adding node:",d),t(m({glossaryId:o,nodeId:e})),t(i({message:"Error adding entry. Try again later.",type:"error",duration:3e3}))}}}function W({glossaryId:n,side:t}){return async(e,r)=>{try{const a=r().glossary.glossaries.edit.byId[n];if(!a)throw new Error(`Glossary with ID ${n} not found`);e(k(n)),await l.deleteGlossary({glossaryId:n}),e(F({glossaryId:n})),e(N({glossaryId:null})),e(i({message:`${a.name} successfully deleted.`,type:"success",duration:3e3,component:void 0,props:{}}))}catch(a){console.error("Error removing node:",a),e(i({message:"Error removing glossary. Try again later.",type:"error",duration:3e3}))}}}function X({glossaryId:n,entryId:t,content:e}){return async(r,a)=>{const o=a().glossary.glossaries.edit.byId[n];if(!o){r(i({message:"Glossary not found.",type:"error",duration:3e3}));return}const d=o.entries[t];if(!d){r(i({message:"Entry not found.",type:"error",duration:3e3}));return}try{r(v({glossaryId:n,entryId:t,content:e}))}catch(y){console.error("Error updating entry:",y),r(i({message:`Error updating ${d.name}. Try again later.`,type:"error",duration:3e3}))}}}const T={politics:{nations:[],settlements:[],factions:[],locations:[],resources:{},population:{},economy:{},cultures:{},customFields:{}},history:{events:[],flags:{},history:{},customFields:{},historyDataString:""},geography:{climates:[],terrain:[],regions:[],landmarks:[],customFields:{}},relationships:{allies:[],enemies:[],relationships:{},notoriety:{},influence:{},customFields:{}},custom:null};function Y({glossaryId:n,entryId:t,entryType:e,subModel:r}){return async a=>{try{const s=await l.getEntrySubModel({id:t,entryType:e,subModel:r});if(s)a(v({glossaryId:n,entryId:t,content:{[r]:s}}));else{if(!T[r]){console.error(`No ephemeral model found for subModel: ${r}`);return}a(M({glossaryId:n,entryId:t,subModel:r,data:{...T[r]}}))}}catch(s){console.error("Error fetching glossary node:",s),a(i({message:"Error fetching glossary node. Try again later.",type:"error",duration:3e3}))}}}function Z({glossaryId:n,tabId:t,entryId:e,subModel:r,keypath:a,data:s}){return async(o,d)=>{const c=d().glossary.glossaries.edit.byId[n];if(!c){o(i({message:"Glossary not found.",type:"error",duration:3e3}));return}const u=c.entries[e];if(!u){o(i({message:"Entry not found.",type:"error",duration:3e3}));return}try{o(O({glossaryId:n,entryId:e,subModel:r,keypath:a,data:s})),o(P({tabId:t,keypath:`entries.${e}.${r}.${a}`}))}catch(D){console.error("Error updating entry:",D),o(i({message:`Error updating ${u.name}. Try again later.`,type:"error",duration:3e3}))}}}const ee={getGlossaries:C,getNodes:K,createGlossary:H,createNodeAndSection:J,createNodeAndDetail:V,renameNodeAndEntry:L,deleteEntry:Q,updateGlossary:z,addAndActivateGlossary:q,getEntryById:j,updateEntryById:X,getOptionsByProperty:R,openEditGlossary:U,deleteGlossary:W,getEntrySubModel:Y,updateEntrySubModelById:Z};export{ee as t};
