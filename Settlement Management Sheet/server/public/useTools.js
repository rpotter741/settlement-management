import{aZ as h,a1 as f,bp as w,bq as T,aa as i,a0 as m,r as y,br as v,aS as g,bs as A,b8 as S,bd as I}from"./main.js";import{t as u}from"./toolSelectors.js";import{l as F}from"./loadTool.js";function V({tool:e,id:s,keypath:a,updates:r}){return async(t,l)=>{var c;t(h({id:s,tool:e,keypath:a,updates:r}));const o=l(),d=o.tools[e].static.byId[s],n=(c=o.tabs.focusedTab)==null?void 0:c.tabId;if(!n){console.warn("No focused tab found, cannot update dirty state");return}f.isEqual(f.get(d,a),r)?t(T({tabId:n,keypath:a})):t(w({tabId:n,keypath:a}))}}const k=(e,s)=>{const a=m(),r=y.useCallback((c,p)=>{a(V({id:s,tool:e,keypath:c,updates:p}))},[a]),t=y.useCallback((c,p)=>{a(v({id:s,tool:e,keypath:c,error:p}))},[a]),l=y.useCallback(c=>{a(g({tool:e,id:s,fields:Object.keys(c),refObj:c}))},[a]),o=y.useCallback((c=!1)=>{a(A({tool:e,id:s,overwriteCurrent:c}))},[a]),d=y.useCallback(({refId:c,id:p,currentTool:E})=>{a(F({tool:e,refId:c,id:p,currentTool:E}))},[a]),n=y.useCallback(c=>{console.log("Batch updating tool:",e,"with updates:",c),a(S({tool:e,id:s,updates:c}))},[a]);return{updateTool:r,batchUpdate:n,validateToolField:t,validateAll:l,saveToolEdit:o,loadNewTool:d}},C=(e,s)=>{const a=i(u.byId(e,s)),r=i(u.byEditId(e,s)),t=i(u.allIds(e)),l=i(u.allEditIds(e)),o=i(u.allTools(e)),d=i(u.allEditTools(e)),n=i(u.errors(e,s));return{current:a,edit:r,allIds:t,allEditIds:l,allTools:o,allEditTools:d,errors:n,selectStaticValue:b=>i(u.selectValue(e,s,b)),selectEditValue:b=>i(u.selectEditValue(e,s,b)),selectErrorValue:b=>i(u.keypathError(e,s,b)),fieldIsDirty:b=>i(u.keypathDirty(e,s,b))}},D=e=>{const s={save:async r=>{var t,l;try{return await I.post(`/tools/${e}/save`,{data:{...r,contentType:"OFFICIAL",createdBy:"Admin"},tool:e})}catch(o){throw console.error("API error:",o.message),new Error(((l=(t=o.response)==null?void 0:t.data)==null?void 0:l.message)||"Failed to save data")}},publish:async r=>{var o,d;const{refId:t,id:l}=r;try{return await I.post(`/tools/${e}/publish`,{data:{refId:t,id:l},tool:e})}catch(n){throw console.error("API error:",n.message),new Error(((d=(o=n.response)==null?void 0:o.data)==null?void 0:d.message)||"Failed to publish data")}},delete:async r=>{var l,o;const{refId:t}=r;try{return await I.post("/tools/${tool}/delete",{refId:t,tool:e})}catch(d){throw console.error("API error:",d.message),new Error(((o=(l=d.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to delete data")}}};return{runServerActions:async(r,t,l=!1)=>{var o,d;try{if(!s[r])throw new Error(`Unknown server action: ${r}`);const n=await s[r](t);return l&&console.log("Server response:",n.data),n.data}catch(n){throw console.error("API error:",n.message),new Error(((d=(o=n.response)==null?void 0:o.data)==null?void 0:d.message)||`Failed to ${r} data`)}}}},U=(e,s)=>{const a=C(e,s),r=k(e,s),t=D(e);return{...a,...r,...t}};export{U as u};
