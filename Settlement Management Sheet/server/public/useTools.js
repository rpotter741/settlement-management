import{aI as h,a1 as f,be as w,bf as T,aa as i,a0 as m,r as y,bg as v,aB as g,bh as A,a$ as S,b3 as I}from"./main.js";import{t as u}from"./toolSelectors.js";import{l as F}from"./loadTool.js";function V({tool:e,id:s,keypath:a,updates:t}){return async(r,l)=>{var c;r(h({id:s,tool:e,keypath:a,updates:t}));const o=l(),d=o.tools[e].static.byId[s],n=(c=o.tabs.focusedTab)==null?void 0:c.tabId;if(!n){console.warn("No focused tab found, cannot update dirty state");return}f.isEqual(f.get(d,a),t)?r(T({tabId:n,keypath:a})):r(w({tabId:n,keypath:a}))}}const k=(e,s)=>{const a=m(),t=y.useCallback((c,p)=>{a(V({id:s,tool:e,keypath:c,updates:p}))},[a]),r=y.useCallback((c,p)=>{a(v({id:s,tool:e,keypath:c,error:p}))},[a]),l=y.useCallback(c=>{a(g({tool:e,id:s,fields:Object.keys(c),refObj:c}))},[a]),o=y.useCallback((c=!1)=>{a(A({tool:e,id:s,overwriteCurrent:c}))},[a]),d=y.useCallback(({refId:c,id:p,currentTool:E})=>{a(F({tool:e,refId:c,id:p,currentTool:E}))},[a]),n=y.useCallback(c=>{console.log("Batch updating tool:",e,"with updates:",c),a(S({tool:e,id:s,updates:c}))},[a]);return{updateTool:t,batchUpdate:n,validateToolField:r,validateAll:l,saveToolEdit:o,loadNewTool:d}},C=(e,s)=>{const a=i(u.byId(e,s)),t=i(u.byEditId(e,s)),r=i(u.allIds(e)),l=i(u.allEditIds(e)),o=i(u.allTools(e)),d=i(u.allEditTools(e)),n=i(u.errors(e,s));return{current:a,edit:t,allIds:r,allEditIds:l,allTools:o,allEditTools:d,errors:n,selectStaticValue:b=>i(u.selectValue(e,s,b)),selectEditValue:b=>i(u.selectEditValue(e,s,b)),selectErrorValue:b=>i(u.keypathError(e,s,b)),fieldIsDirty:b=>i(u.keypathDirty(e,s,b))}},D=e=>{const s={save:async t=>{var r,l;try{return await I.post(`/tools/${e}/save`,{data:{...t,contentType:"OFFICIAL",createdBy:"Admin"},tool:e})}catch(o){throw console.error("API error:",o.message),new Error(((l=(r=o.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to save data")}},publish:async t=>{var o,d;const{refId:r,id:l}=t;try{return await I.post(`/tools/${e}/publish`,{data:{refId:r,id:l},tool:e})}catch(n){throw console.error("API error:",n.message),new Error(((d=(o=n.response)==null?void 0:o.data)==null?void 0:d.message)||"Failed to publish data")}},delete:async t=>{var l,o;const{refId:r}=t;try{return await I.post("/tools/${tool}/delete",{refId:r,tool:e})}catch(d){throw console.error("API error:",d.message),new Error(((o=(l=d.response)==null?void 0:l.data)==null?void 0:o.message)||"Failed to delete data")}}};return{runServerActions:async(t,r,l=!1)=>{var o,d;try{if(!s[t])throw new Error(`Unknown server action: ${t}`);const n=await s[t](r);return l&&console.log("Server response:",n.data),n.data}catch(n){throw console.error("API error:",n.message),new Error(((d=(o=n.response)==null?void 0:o.data)==null?void 0:d.message)||`Failed to ${t} data`)}}}},U=(e,s)=>{const a=C(e,s),t=k(e,s),r=D(e);return{...a,...t,...r}};export{U as u};
