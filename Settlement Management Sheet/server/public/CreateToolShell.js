import{X as O,j as r,B as w,T as $,u as P,ai as U,r as n,aj as D,l as X,y as Y,d as q,ak as N,x as L,al as G,am as H,an as J,ao as K,ap as M,b as Q,c as Z,R as W}from"./main.js";import{S as _}from"./ShellContext.js";import{P as F}from"./PageBox.js";const ee=O(r.jsx("path",{d:"m14 7-5 5 5 5z"}),"ArrowLeft"),te=O(r.jsx("path",{d:"m10 17 5-5-5-5z"}),"ArrowRight"),oe=O(r.jsx("path",{d:"M9 16.17 4.83 12l-1.42 1.41L9 19 21 7l-1.41-1.41z"}),"Check"),se=O(r.jsx("path",{d:"M1 21h22L12 2zm12-3h-2v-2h2zm0-4h-2v-4h2z"}),"Warning"),re=({error:e,label:a,...o})=>r.jsxs(w,{sx:{display:"flex",gap:2,mb:1,alignItems:"center",justifyContent:"start",...o.sx},children:[e?r.jsx(se,{color:"error"}):r.jsx(oe,{color:"success"}),r.jsx($,{noWrap:!0,sx:{textOverflow:"hidden",overflow:"hidden",whiteSpace:"nowrap",fontWeight:"bold",...o.labelSx},children:a})]}),ae=e=>{const a=Object.keys(e).length;return{valid:Object.values(e).filter(t=>t?Object.entries(t).every(([s,p])=>s==="id"||s==="refId"||p===null):!1).length,total:a}},ne=(e,a,o,t)=>{const s=e/a*100,p=`linear-gradient(to right, ${o} ${s}%, ${t} ${s}%)`;return{progress:s,color:p}},ie=({defaultExpand:e,checklistContent:a,errors:o,tool:t,side:s,...p})=>{const E=P(),u=U(),[i,b]=n.useState(e||!1),[m,x]=n.useState([]),[h,g]=n.useState(0),[j,l]=n.useState(0),[d,f]=n.useState("linear-gradient(to right, #4caf50 0%, #f44336 0%)"),y=u.palette.success.main,C=u.palette.error.main;n.useEffect(()=>{e===!0&&b(!0)},[e]),n.useEffect(()=>{g(D(o))},[o]),n.useEffect(()=>{if(o&&a){let c=0,S=0;const v=a.map(T=>{const k={...T,type:T.type||"single"},z=X.get(o,T.keypath);if(T.type==="group"&&z!==void 0){const{valid:B,total:A}=ae(z);k.valid=B,k.total=A,c+=B,S+=A}else S+=1,z===null&&(c+=1);return k.error=z,k});x(v);const{progress:I,color:V}=ne(c,S,y,C);l(I),f(V)}},[o,a,y,C]);const R=()=>{b(!i),E(N({tabId:p.tabId,side:s,keypath:"tabExpansionState.validationChecklist",updates:!i}))};return r.jsxs(w,{sx:{position:"absolute",top:0,right:i?0:"-325px",width:"300px",height:"100%",backgroundColor:"background.default",boxShadow:4,borderRadius:"8px 0 0 8px",transition:"right 0.4s ease-in-out",zIndex:1e3,boxSizing:"border-box"},children:[r.jsx(Y,{title:i?null:`${h} Errors Remaining`,placement:"left",arrow:!0,children:r.jsx(q,{onClick:R,sx:{position:"absolute",top:"50%",left:"-64px",width:"48px",height:"48px",backgroundColor:s==="left"?"primary.main":"secondary.main",borderRadius:"8px 0 0 8px ",display:"flex",alignItems:"center",justifyContent:"center",boxShadow:2,cursor:"pointer",transition:"transform 0.3s ease-in-out","&:hover":{transform:"scale(1.1)"},borderBottom:"4px solid",borderImage:d,borderImageSlice:1},children:i?r.jsx(te,{sx:{color:"primary.contrastText",fontSize:36}}):r.jsx(ee,{sx:{color:"primary.contrastText",fontSize:36}})})}),r.jsxs(w,{sx:{padding:2,overflow:"auto",backgroundColor:"background.paper",boxShadow:4,borderRadius:"0 0 8px 8px"},children:[r.jsxs($,{variant:"h5",children:[h," Errors"]}),r.jsx($,{variant:"body1",children:h?"Please address the following issues:":"No errors found. You're good to go!"}),m.map((c,S)=>r.jsx(re,{label:c.type==="group"?`${c.label} (${c.valid} / ${c.total})`:c.label,error:c.type==="group"?c.valid<c.total:c.error},S))]})]})},le=({tool:e,mode:a,id:o,current:t,edit:s,errorData:p,initializeFn:E,validationFields:u})=>{const i=P(),[b,m]=n.useState(0),[x,h]=n.useState(!1),[g,j]=n.useState(!1);return n.useEffect(()=>{const l=D(p);m(l),t&&(l===0&&!t.isValid?L({tool:e,keypath:"isValid",updates:!0,id:o}):l>0&&t.isValid&&L({tool:e,keypath:"isValid",updates:!1,id:o}))},[p,e]),n.useEffect(()=>{if(t===void 0){const d={...E(),id:o};i(G({tool:e,data:d}))}},[t,i]),n.useEffect(()=>{if(s===void 0&&t){i(H({id:o,tool:e}));const l=J(t);i(K({tool:e,validationObject:l,id:o}))}},[e,i,s,t]),n.useEffect(()=>{if(a==="preview"){if(t&&u.length>0){if(!u.every(d=>t[d]!==void 0))return;i(M({tool:e,fields:u,refObj:s,id:t.id}))}}else if(a==="edit"&&s&&u.length>0&&!g){if(!u.every(d=>s[d]!==void 0))return;j(!0),i(M({tool:e,fields:u,refObj:s,id:s.id}))}},[i,a,s,t]),{errorCount:b,setErrorCount:m}},ce=(e,a=500)=>{const[o,t]=n.useState(e);return n.useEffect(()=>{const s=setTimeout(()=>t(e),a);return()=>clearTimeout(s)},[e,a]),o},de=(e,a,o)=>{const t=n.useRef();n.useEffect(()=>(clearTimeout(t.current),t.current=setTimeout(()=>{e()},a),()=>clearTimeout(t.current)),[e,a,...o])},he=({tab:e,initializeTool:a,validationFields:o,editComponent:t,previewComponent:s,checklistContent:p,editComponentProps:E={},previewComponentProps:u={},innerStyle:i={}})=>{var I;const{showModal:b,closeModal:m}=Q(),{tool:x,side:h,id:g,mode:j,tabId:l}=e,{current:d,edit:f,errors:y}=Z(x,g);console.log(j);const{errorCount:C}=le({tool:x,mode:e.mode,id:g,edit:f,current:d,errorData:y,initializeFn:()=>a(x),validationFields:o}),R=P(),[c,S]=n.useState(!1),v=ce(f,1e3);if(de(()=>{if(!f)return;const V=f!=null&&f.name?f.name.trim():"Untitled";f.name!==d.name&&R(N({tabId:l,side:h,keypath:"name",updates:V}))},300,[v==null?void 0:v.name,R,l,h]),!d)return r.jsx(w,{children:"Loading..."});if(d!==null)return r.jsx(_.Provider,{value:{tool:x,id:g,mode:j,side:h,showModal:b,closeModal:m},children:r.jsxs(F,{innerStyle:i,children:[C!==void 0&&y&&d&&r.jsx(w,{sx:{position:"absolute",top:0,right:20,height:"auto",backgroundColor:"background.paper",boxShadow:4,borderRadius:4,transition:"transform 0.4s ease-in-out",zIndex:1e3},children:r.jsx(ie,{errorCount:C,defaultExpand:((I=e.tabExpansionState)==null?void 0:I.validationChecklist)??!1,checklistContent:p,errors:y,tool:x,side:h,tabId:l})}),j==="edit"?W.createElement(t,{...E}):W.createElement(s,{...u})]})})};export{he as C,se as W};
