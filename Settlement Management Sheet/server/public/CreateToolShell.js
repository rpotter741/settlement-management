import{a0 as z,r as f,b9 as V,aI as m,ba as g,bb as O,bc as w,bd as B,aB as R,ar as I,b0 as k,j as E,i as M,R as T}from"./main.js";import{u as P}from"./useTools.js";import{S as W,P as A}from"./PageBox.js";const D=({tool:s,mode:r,id:l,current:e,edit:a,errorData:p,initializeFn:b,validationFields:o})=>{const i=z(),[h,n]=f.useState(0),[j,u]=f.useState(!1),[c,y]=f.useState(!1);return f.useEffect(()=>{const t=V(p);n(t),e&&(t===0&&!e.isValid?m({tool:s,keypath:"isValid",updates:!0,id:l}):t>0&&e.isValid&&m({tool:s,keypath:"isValid",updates:!1,id:l}))},[p,s]),f.useEffect(()=>{if(e===void 0){const d={...b(),id:l};i(g({tool:s,data:d}))}},[e,i]),f.useEffect(()=>{if(a===void 0&&e){i(O({id:l,tool:s}));const t=w(e);i(B({tool:s,validationObject:t,id:l}))}},[s,i,a,e]),f.useEffect(()=>{if(r==="preview"){if(e&&o.length>0){if(!o.every(d=>e[d]!==void 0))return;i(R({tool:s,fields:o,refObj:a,id:e.id}))}}else if(r==="edit"&&a&&o.length>0&&!c){if(!o.every(d=>a[d]!==void 0))return;y(!0),i(R({tool:s,fields:o,refObj:a,id:a.id}))}},[i,r,a,e]),{errorCount:h,setErrorCount:n}},L=["event","apt","storyThread"],J=({tab:s,initializeTool:r,validationFields:l,editComponent:e,previewComponent:a,checklistContent:p,editComponentProps:b={},previewComponentProps:o={}})=>{const{showModal:i,closeModal:h}=I(),{tool:n,side:j,id:u,mode:c,tabId:y}=s,{current:t,edit:d,errors:x}=P(n,u);D({tool:n,mode:s.mode,id:u,edit:d,current:t,errorData:x,initializeFn:()=>r(n),validationFields:l});const{splitSize:S,soloSize:v,splitTabs:C}=k();if(!t)return E.jsx(M,{children:"Loading..."});if(t!==null)return E.jsx(W.Provider,{value:{tool:n,id:u,tabId:y,mode:c,side:j,showModal:i,closeModal:h,tab:s},children:E.jsx(A,{mode:c,variant:L.includes(n)?"fullWidth":C?S?"default":"blend":v?"blend":"default",tabType:"tool",minWidth:300,children:c==="edit"?T.createElement(e,{...b}):T.createElement(a,{...o})})})};export{J as C};
