import{a1 as G,r as q,j as S,i as J,G as he,W as re,a0 as Se,a2 as Y,T as H,v as Fe}from"./main.js";import{u as ue}from"./useTools.js";import{S as Oe}from"./PageBox.js";import{T as de}from"./ToolInput.js";const je=({id:d,entry:s,data:o,order:C,sort:w=!1})=>{if(o[d])return console.warn(`Entry with id ${d} already exists. Skipping add.`),{data:o,order:C};const y=G.clone(o);y[d]=s;const P=[...C,d];return w&&P.sort((A,T)=>{var l,L,p,F;const j=((l=y[A])==null?void 0:l.max)||((L=y[A])==null?void 0:L.value)||0,m=((p=y[T])==null?void 0:p.max)||((F=y[T])==null?void 0:F.value)||0;return j-m}),{data:y,order:P}},Le=({id:d,data:s,order:o})=>{if(!s[d])return console.warn(`Entry with id ${d} does not exist. Skipping remove.`),{data:s,order:o};const C={...s};delete C[d];const w=o.filter(y=>y!==d);return{data:C,order:w}},ke=({from:d,to:s,data:o,order:C})=>{if(d<0||d>=C.length||s<0||s>=C.length)return console.warn(`Invalid indices for reorder: from ${d}, to ${s}. Skipping.`),{data:o,order:C};const w=[...C],[y]=w.splice(d,1);return w.splice(s,0,y),{data:o,order:w}},ee={add:je,remove:Le,reorder:ke},ce={thresholds:{name:"Threshold name must be at least 3 characters long.",value:null},settlementPointCost:{name:null,value:null}},Ve=(d,s,o)=>{const{selectEditValue:C,updateTool:w,errors:y,validateToolField:P}=ue(d,s),A=C(o),T=y[o]||{},{data:j,order:m}=A;return{data:j,order:m,errors:T,add:({id:F,entry:V,sort:v=!1})=>{const $=ee.add({id:F,entry:V,data:j,order:m,sort:v});w(o,$);const x=G.cloneDeep(T);if(!ce[o]){console.warn(`Add ${o} in addMap at top of useOrderedData.jsx`);return}x.data[F]={...ce[o]},P(`${o}`,x)},remove:F=>{const V=ee.remove({id:F,data:j,order:m});w(o,V);const v=G.cloneDeep(T);delete v[F],P(`${o}`,v)},reorder:(F,V)=>{const v=ee.reorder({from:F,to:V,data:j,order:m});w(o,v)}}};var ae={};(function d(s,o,C,w){var y=!!(s.Worker&&s.Blob&&s.Promise&&s.OffscreenCanvas&&s.OffscreenCanvasRenderingContext2D&&s.HTMLCanvasElement&&s.HTMLCanvasElement.prototype.transferControlToOffscreen&&s.URL&&s.URL.createObjectURL),P=typeof Path2D=="function"&&typeof DOMMatrix=="function",A=function(){if(!s.OffscreenCanvas)return!1;var r=new OffscreenCanvas(1,1),e=r.getContext("2d");e.fillRect(0,0,1,1);var a=r.transferToImageBitmap();try{e.createPattern(a,"no-repeat")}catch{return!1}return!0}();function T(){}function j(r){var e=o.exports.Promise,a=e!==void 0?e:s.Promise;return typeof a=="function"?new a(r):(r(T,T),null)}var m=function(r,e){return{transform:function(a){if(r)return a;if(e.has(a))return e.get(a);var t=new OffscreenCanvas(a.width,a.height),i=t.getContext("2d");return i.drawImage(a,0,0),e.set(a,t),t},clear:function(){e.clear()}}}(A,new Map),l=function(){var r=Math.floor(16.666666666666668),e,a,t={},i=0;return typeof requestAnimationFrame=="function"&&typeof cancelAnimationFrame=="function"?(e=function(c){var h=Math.random();return t[h]=requestAnimationFrame(function n(u){i===u||i+r-1<u?(i=u,delete t[h],c()):t[h]=requestAnimationFrame(n)}),h},a=function(c){t[c]&&cancelAnimationFrame(t[c])}):(e=function(c){return setTimeout(c,r)},a=function(c){return clearTimeout(c)}),{frame:e,cancel:a}}(),L=function(){var r,e,a={};function t(i){function c(h,n){i.postMessage({options:h||{},callback:n})}i.init=function(n){var u=n.transferControlToOffscreen();i.postMessage({canvas:u},[u])},i.fire=function(n,u,M){if(e)return c(n,null),e;var E=Math.random().toString(36).slice(2);return e=j(function(b){function I(O){O.data.callback===E&&(delete a[E],i.removeEventListener("message",I),e=null,m.clear(),M(),b())}i.addEventListener("message",I),c(n,E),a[E]=I.bind(null,{data:{callback:E}})}),e},i.reset=function(){i.postMessage({reset:!0});for(var n in a)a[n](),delete a[n]}}return function(){if(r)return r;if(!C&&y){var i=["var CONFETTI, SIZE = {}, module = {};","("+d.toString()+")(this, module, true, SIZE);","onmessage = function(msg) {","  if (msg.data.options) {","    CONFETTI(msg.data.options).then(function () {","      if (msg.data.callback) {","        postMessage({ callback: msg.data.callback });","      }","    });","  } else if (msg.data.reset) {","    CONFETTI && CONFETTI.reset();","  } else if (msg.data.resize) {","    SIZE.width = msg.data.resize.width;","    SIZE.height = msg.data.resize.height;","  } else if (msg.data.canvas) {","    SIZE.width = msg.data.canvas.width;","    SIZE.height = msg.data.canvas.height;","    CONFETTI = module.exports.create(msg.data.canvas);","  }","}"].join(`
`);try{r=new Worker(URL.createObjectURL(new Blob([i])))}catch(c){return typeof console!==void 0&&typeof console.warn=="function"&&console.warn("ðŸŽŠ Could not load worker",c),null}t(r)}return r}}(),p={particleCount:50,angle:90,spread:45,startVelocity:45,decay:.9,gravity:1,drift:0,ticks:200,x:.5,y:.5,shapes:["square","circle"],zIndex:100,colors:["#26ccff","#a25afd","#ff5e7e","#88ff5a","#fcff42","#ffa62d","#ff36ff"],disableForReducedMotion:!1,scalar:1};function F(r,e){return e?e(r):r}function V(r){return r!=null}function v(r,e,a){return F(r&&V(r[e])?r[e]:p[e],a)}function $(r){return r<0?0:Math.floor(r)}function x(r,e){return Math.floor(Math.random()*(e-r))+r}function g(r){return parseInt(r,16)}function N(r){return r.map(D)}function D(r){var e=String(r).replace(/[^0-9a-f]/gi,"");return e.length<6&&(e=e[0]+e[0]+e[1]+e[1]+e[2]+e[2]),{r:g(e.substring(0,2)),g:g(e.substring(2,4)),b:g(e.substring(4,6))}}function Z(r){var e=v(r,"origin",Object);return e.x=v(e,"x",Number),e.y=v(e,"y",Number),e}function R(r){r.width=document.documentElement.clientWidth,r.height=document.documentElement.clientHeight}function X(r){var e=r.getBoundingClientRect();r.width=e.width,r.height=e.height}function me(r){var e=document.createElement("canvas");return e.style.position="fixed",e.style.top="0px",e.style.left="0px",e.style.pointerEvents="none",e.style.zIndex=r,e}function fe(r,e,a,t,i,c,h,n,u){r.save(),r.translate(e,a),r.rotate(c),r.scale(t,i),r.arc(0,0,1,h,n,u),r.restore()}function ve(r){var e=r.angle*(Math.PI/180),a=r.spread*(Math.PI/180);return{x:r.x,y:r.y,wobble:Math.random()*10,wobbleSpeed:Math.min(.11,Math.random()*.1+.05),velocity:r.startVelocity*.5+Math.random()*r.startVelocity,angle2D:-e+(.5*a-Math.random()*a),tiltAngle:(Math.random()*(.75-.25)+.25)*Math.PI,color:r.color,shape:r.shape,tick:0,totalTicks:r.ticks,decay:r.decay,drift:r.drift,random:Math.random()+2,tiltSin:0,tiltCos:0,wobbleX:0,wobbleY:0,gravity:r.gravity*3,ovalScalar:.6,scalar:r.scalar,flat:r.flat}}function pe(r,e){e.x+=Math.cos(e.angle2D)*e.velocity+e.drift,e.y+=Math.sin(e.angle2D)*e.velocity+e.gravity,e.velocity*=e.decay,e.flat?(e.wobble=0,e.wobbleX=e.x+10*e.scalar,e.wobbleY=e.y+10*e.scalar,e.tiltSin=0,e.tiltCos=0,e.random=1):(e.wobble+=e.wobbleSpeed,e.wobbleX=e.x+10*e.scalar*Math.cos(e.wobble),e.wobbleY=e.y+10*e.scalar*Math.sin(e.wobble),e.tiltAngle+=.1,e.tiltSin=Math.sin(e.tiltAngle),e.tiltCos=Math.cos(e.tiltAngle),e.random=Math.random()+2);var a=e.tick++/e.totalTicks,t=e.x+e.random*e.tiltCos,i=e.y+e.random*e.tiltSin,c=e.wobbleX+e.random*e.tiltCos,h=e.wobbleY+e.random*e.tiltSin;if(r.fillStyle="rgba("+e.color.r+", "+e.color.g+", "+e.color.b+", "+(1-a)+")",r.beginPath(),P&&e.shape.type==="path"&&typeof e.shape.path=="string"&&Array.isArray(e.shape.matrix))r.fill(Me(e.shape.path,e.shape.matrix,e.x,e.y,Math.abs(c-t)*.1,Math.abs(h-i)*.1,Math.PI/10*e.wobble));else if(e.shape.type==="bitmap"){var n=Math.PI/10*e.wobble,u=Math.abs(c-t)*.1,M=Math.abs(h-i)*.1,E=e.shape.bitmap.width*e.scalar,b=e.shape.bitmap.height*e.scalar,I=new DOMMatrix([Math.cos(n)*u,Math.sin(n)*u,-Math.sin(n)*M,Math.cos(n)*M,e.x,e.y]);I.multiplySelf(new DOMMatrix(e.shape.matrix));var O=r.createPattern(m.transform(e.shape.bitmap),"no-repeat");O.setTransform(I),r.globalAlpha=1-a,r.fillStyle=O,r.fillRect(e.x-E/2,e.y-b/2,E,b),r.globalAlpha=1}else if(e.shape==="circle")r.ellipse?r.ellipse(e.x,e.y,Math.abs(c-t)*e.ovalScalar,Math.abs(h-i)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI):fe(r,e.x,e.y,Math.abs(c-t)*e.ovalScalar,Math.abs(h-i)*e.ovalScalar,Math.PI/10*e.wobble,0,2*Math.PI);else if(e.shape==="star")for(var f=Math.PI/2*3,k=4*e.scalar,B=8*e.scalar,U=e.x,W=e.y,z=5,_=Math.PI/z;z--;)U=e.x+Math.cos(f)*B,W=e.y+Math.sin(f)*B,r.lineTo(U,W),f+=_,U=e.x+Math.cos(f)*k,W=e.y+Math.sin(f)*k,r.lineTo(U,W),f+=_;else r.moveTo(Math.floor(e.x),Math.floor(e.y)),r.lineTo(Math.floor(e.wobbleX),Math.floor(i)),r.lineTo(Math.floor(c),Math.floor(h)),r.lineTo(Math.floor(t),Math.floor(e.wobbleY));return r.closePath(),r.fill(),e.tick<e.totalTicks}function ge(r,e,a,t,i){var c=e.slice(),h=r.getContext("2d"),n,u,M=j(function(E){function b(){n=u=null,h.clearRect(0,0,t.width,t.height),m.clear(),i(),E()}function I(){C&&!(t.width===w.width&&t.height===w.height)&&(t.width=r.width=w.width,t.height=r.height=w.height),!t.width&&!t.height&&(a(r),t.width=r.width,t.height=r.height),h.clearRect(0,0,t.width,t.height),c=c.filter(function(O){return pe(h,O)}),c.length?n=l.frame(I):b()}n=l.frame(I),u=b});return{addFettis:function(E){return c=c.concat(E),M},canvas:r,promise:M,reset:function(){n&&l.cancel(n),u&&u()}}}function ne(r,e){var a=!r,t=!!v(e||{},"resize"),i=!1,c=v(e,"disableForReducedMotion",Boolean),h=y&&!!v(e||{},"useWorker"),n=h?L():null,u=a?R:X,M=r&&n?!!r.__confetti_initialized:!1,E=typeof matchMedia=="function"&&matchMedia("(prefers-reduced-motion)").matches,b;function I(f,k,B){for(var U=v(f,"particleCount",$),W=v(f,"angle",Number),z=v(f,"spread",Number),_=v(f,"startVelocity",Number),we=v(f,"decay",Number),ye=v(f,"gravity",Number),Ce=v(f,"drift",Number),oe=v(f,"colors",N),Te=v(f,"ticks",Number),se=v(f,"shapes"),Ee=v(f,"scalar"),Ie=!!v(f,"flat"),le=Z(f),ie=U,Q=[],Ae=r.width*le.x,Pe=r.height*le.y;ie--;)Q.push(ve({x:Ae,y:Pe,angle:W,spread:z,startVelocity:_,color:oe[ie%oe.length],shape:se[x(0,se.length)],ticks:Te,decay:we,gravity:ye,drift:Ce,scalar:Ee,flat:Ie}));return b?b.addFettis(Q):(b=ge(r,Q,u,k,B),b.promise)}function O(f){var k=c||v(f,"disableForReducedMotion",Boolean),B=v(f,"zIndex",Number);if(k&&E)return j(function(_){_()});a&&b?r=b.canvas:a&&!r&&(r=me(B),document.body.appendChild(r)),t&&!M&&u(r);var U={width:r.width,height:r.height};n&&!M&&n.init(r),M=!0,n&&(r.__confetti_initialized=!0);function W(){if(n){var _={getBoundingClientRect:function(){if(!a)return r.getBoundingClientRect()}};u(_),n.postMessage({resize:{width:_.width,height:_.height}});return}U.width=U.height=null}function z(){b=null,t&&(i=!1,s.removeEventListener("resize",W)),a&&r&&(document.body.contains(r)&&document.body.removeChild(r),r=null,M=!1)}return t&&!i&&(i=!0,s.addEventListener("resize",W,!1)),n?n.fire(f,U,z):I(f,U,z)}return O.reset=function(){n&&n.reset(),b&&b.reset()},O}var K;function te(){return K||(K=ne(null,{useWorker:!0,resize:!0})),K}function Me(r,e,a,t,i,c,h){var n=new Path2D(r),u=new Path2D;u.addPath(n,new DOMMatrix(e));var M=new Path2D;return M.addPath(u,new DOMMatrix([Math.cos(h)*i,Math.sin(h)*i,-Math.sin(h)*c,Math.cos(h)*c,a,t])),M}function xe(r){if(!P)throw new Error("path confetti are not supported in this browser");var e,a;typeof r=="string"?e=r:(e=r.path,a=r.matrix);var t=new Path2D(e),i=document.createElement("canvas"),c=i.getContext("2d");if(!a){for(var h=1e3,n=h,u=h,M=0,E=0,b,I,O=0;O<h;O+=2)for(var f=0;f<h;f+=2)c.isPointInPath(t,O,f,"nonzero")&&(n=Math.min(n,O),u=Math.min(u,f),M=Math.max(M,O),E=Math.max(E,f));b=M-n,I=E-u;var k=10,B=Math.min(k/b,k/I);a=[B,0,0,B,-Math.round(b/2+n)*B,-Math.round(I/2+u)*B]}return{type:"path",path:e,matrix:a}}function be(r){var e,a=1,t="#000000",i='"Apple Color Emoji", "Segoe UI Emoji", "Segoe UI Symbol", "Noto Color Emoji", "EmojiOne Color", "Android Emoji", "Twemoji Mozilla", "system emoji", sans-serif';typeof r=="string"?e=r:(e=r.text,a="scalar"in r?r.scalar:a,i="fontFamily"in r?r.fontFamily:i,t="color"in r?r.color:t);var c=10*a,h=""+c+"px "+i,n=new OffscreenCanvas(c,c),u=n.getContext("2d");u.font=h;var M=u.measureText(e),E=Math.ceil(M.actualBoundingBoxRight+M.actualBoundingBoxLeft),b=Math.ceil(M.actualBoundingBoxAscent+M.actualBoundingBoxDescent),I=2,O=M.actualBoundingBoxLeft+I,f=M.actualBoundingBoxAscent+I;E+=I+I,b+=I+I,n=new OffscreenCanvas(E,b),u=n.getContext("2d"),u.font=h,u.fillStyle=t,u.fillText(e,O,f);var k=1/a;return{type:"bitmap",bitmap:n.transferToImageBitmap(),matrix:[k,0,0,k,-E*k/2,-b*k/2]}}o.exports=function(){return te().apply(this,arguments)},o.exports.reset=function(){te().reset()},o.exports.create=ne,o.exports.shapeFromPath=xe,o.exports.shapeFromText=be})(function(){return typeof window<"u"?window:typeof self<"u"?self:this||{}}(),ae,!1);const Re=ae.exports;ae.exports.create;const Be=(d,s)=>{const w={...d},y=[],P=new Set;let A=Object.entries(w).map(([m,l])=>({id:m,name:l.name,max:l.max}));const T=m=>{let l=m,L=0;for(;P.has(l)&&L<200;){const p=[...P].filter(g=>g<l),F=[...P].filter(g=>g>l),V=p.length?Math.max(...p):-1/0,v=F.length?Math.min(...F):1/0,$=V===-1/0?l-1:l-(V+1),x=v===1/0?100-l:v-1-l;if($>=x&&$>0&&l>1)l--;else if(x>0&&l<100)l++;else break;l=Math.max(1,Math.min(100,l)),L++}return l},j=A.findIndex(m=>m.id===s);if(j>=0){let m=A[j],l=m.max,L=Math.max(1,Math.min(100,l)),p=T(L);p!==l&&y.push(`Threshold ${m.name} changed from ${l} to ${p} to prevent duplicates.`),m.max=p,P.add(p),A[j]=m}A.sort((m,l)=>m.max-l.max);for(let m=0;m<A.length;m++){const l=A[m];if(l.id===s)continue;const L=l.max;let p=Math.max(1,Math.min(100,L));P.has(p)&&(p=T(p)),P.has(p)&&(p=T(p)),p!==L&&y.push(`Threshold ${l.name} changed from ${L} to ${p} to prevent duplicates.`),l.max=p,P.add(p),A[m]=l}return A.forEach(m=>{w[m.id]={name:m.name,max:m.max}}),{thresholdsClone:w,changes:y}},Ue={label:"",type:"text",tooltip:"",validateFn:d=>d.length<3?"Name must be at least 3 characters long":null},Ne={label:"Value",type:"number",validateFn:d=>d<0||d>100?"Value must be between 0 and 100":null},De=({id:d,handleRemove:s,handleBlur:o})=>S.jsxs(J,{sx:{display:"flex",alignItems:"center",px:{sm:0,md:4,lg:6,xl:8,xxl:12},transition:"top 0.3s ease, left 0.3s ease",gap:2},children:[S.jsx(de,{inputConfig:{...Ue,keypath:`thresholds.data.${d}.name`},style:{width:"100%"},debounced:!0}),S.jsx(de,{inputConfig:{...Ne,keypath:`thresholds.data.${d}.max`},style:{width:"66%"},onBlur:o,debounced:!0}),s!==null&&S.jsx(he,{title:"Remove threshold",children:S.jsx(re,{variant:"contained","aria-label":"Remove threshold",onClick:s?()=>s(d):()=>{},sx:{px:4},children:"Remove"})})]},d),_e=q.memo(De),Xe=({max:d=21})=>{const s=Se(),{tool:o,id:C}=q.useContext(Oe),{add:w,remove:y}=Ve(o,C,"thresholds"),{edit:P,updateTool:A}=ue(o,C),T=P.thresholds,[j,m]=q.useState(!1),[l,L]=q.useState(null),p=q.useCallback(G.debounce((x,g)=>{s(Y({message:x,type:g}))},300,{leading:!0,trailing:!1}),[Y,s]),F=q.useCallback(()=>{const{thresholdsClone:x,changes:g}=Be(T.data,l),N=[...T.order].sort((D,Z)=>x[D].max-x[Z].max);A("thresholds.data",x),A("thresholds.order",N),g&&g.forEach(D=>{p(D,"warning")})},[T.data,T.order,A,l,p]),V=x=>{if(x.order.length===0)return 33;const g=x.order.map(R=>x.data[R]).sort((R,X)=>R.max-X.max);let N=0,D=0;for(let R=0;R<g.length-1;R++){const X=g[R+1].max-g[R].max;X>N&&(N=X,D=Math.floor((g[R+1].max+g[R].max)/2))}g[0].max>N&&(N=g[0].max,D=Math.floor(g[0].max/2));const Z=100-g[g.length-1].max;return Z>N&&(N=Z,D=Math.floor((100+g[g.length-1].max)/2)),D},v=q.useCallback(x=>{y(x)},[y]),$=()=>{if(T.order.length>=d){s(Y({message:`Congrats on clicking at least ${d-7} times! ${d} is the limit, friend. Hope that's enough!`,type:"info"})),Re({particleCount:100,spread:70,origin:{y:.6}}),m(!0);return}const x=Fe(),g={id:x,name:"",max:V(T)};w({id:x,entry:g,sort:!0})};return S.jsxs(J,{children:[S.jsxs(H,{variant:"h6",children:[o.charAt(0).toUpperCase()+o.slice(1)," Thresholds"]}),S.jsxs(H,{children:["Thresholds represent ",o," state at a given percentage. They provide both narrative depth and an easy way to set"," ",S.jsx("strong",{children:"Conditions and Listeners"})," without relying on intimate knowledge of the ",o," itself."," "]}),T.order.map(x=>S.jsx(_e,{handleRemove:T.order.length>2?v:void 0,handleBlur:F,id:x},x)),j?S.jsx(he,{title:"Back for more? That's what we love about you!",children:S.jsx(re,{variant:"contained",color:"success","aria-label":"Add threshold",onClick:$,sx:{px:4},children:"Add Threshold"})}):S.jsx(re,{variant:"contained",color:"success","aria-label":"Add threshold",onClick:$,sx:{px:4},children:"Add Threshold"})]})},$e=({name:d,value:s,style:o,even:C})=>S.jsxs(J,{sx:{display:"flex",alignItems:"center",width:"100%",position:"relative",backgroundColor:C?"background.default":"background.paper",...o},children:[S.jsxs(H,{variant:"body1",sx:{fontWeight:"bold",width:"100%",textAlign:"start"},children:[G.capitalize(d),":"]}),S.jsx(H,{sx:{fontWeight:"bold",position:"absolute",right:16},children:s})]}),Ge=({data:d,order:s})=>S.jsx(J,{sx:{gridColumn:"span 3",columnGap:2,display:"grid",gridTemplateRows:"repeat(7, 1fr)",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridAutoFlow:"column"},children:s.map((o,C)=>{const{name:w,max:y}=d[o];return S.jsx($e,{name:w,value:y,style:{width:"100%",maxWidth:"256px"},even:C%2===0},o)})});export{Xe as O,Ge as P,$e as R,Ve as u};
