import{v as j,r as c,j as e,i as p,T as l,b2 as f,W as v,X as m,a6 as A,a7 as S,Z as C,b3 as k}from"./main.js";import{u}from"./useTools.js";import{u as w,S as E}from"./PageBox.js";import{E as I}from"./EditNameDescription.js";import{O,P as R}from"./ThresholdPreview.js";import{T as N}from"./ToolInput.js";import{C as P,I as F}from"./Icon.js";import{C as B}from"./CreateToolShell.js";import"./toolSelectors.js";import"./loadTool.js";const z=()=>{const t=[9,29,49,69,84,99,100],n={},s=t.map(r=>{const i=j();return n[i]={name:"",max:r},i});return{id:j(),refId:j(),version:1,name:"",description:"",attributes:[],thresholds:{data:n,order:s},dependencies:{data:{},order:[]},tags:[],isValid:!1,status:"DRAFT",createdBy:""}},H=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"thresholds.data",label:"Thresholds",type:"group"},{keypath:"dependencies.data",label:"Dependencies",type:"group"}],L={label:"Modifier",type:"number",validateFn:t=>t<0||t>5?"Value must be between 0 and 5":null},M=({threshold:t,keypath:n})=>e.jsxs(p,{sx:{display:"flex",alignItems:"center",px:12,transition:"top 0.3s ease, left 0.3s ease",gap:2},children:[e.jsxs(l,{sx:{width:"33%",textAlign:"left"},variant:"h6",children:[t.name.charAt(0).toUpperCase()+t.name.slice(1),":"]}),e.jsx(N,{inputConfig:{...L,keypath:n},style:{width:"66%"}})]},t.id),$=c.memo(M),q=()=>{const{tool:t,id:n}=w(),{selectEditValue:s,updateTool:r}=u(t,n),i=s("dependencies.data"),o=s("dependencies.order"),[d,a]=c.useState(new Array(o.length).fill(!1)),y=c.useCallback(h=>{const g=o.filter(b=>b!==h),x={...i};delete x[h],r("dependencies.data",x),r("dependencies.order",g)},[o,i,r]);return e.jsx(p,{children:o.map((h,g)=>i[h]&&e.jsxs(f,{open:d[g],title:i[h].name,toggleOpen:()=>{const x=[...d];x[g]=!x[g],a(x)},children:[i[h].thresholds.map((x,b)=>e.jsx($,{threshold:x,keypath:`dependencies.data.${h}.thresholds.${b}.modifier`})),e.jsxs(v,{variant:"contained",onClick:()=>y(h),children:["Remove ",i[h].name," Dependency"]})]},h))})},Q=({displayName:t})=>{const{id:n,tool:s,showModal:r,closeModal:i}=c.useContext(E);return u(s,n),c.useCallback(()=>{},[s,n]),e.jsxs(p,{children:[e.jsxs(l,{variant:"h6",children:[s.charAt(0).toUpperCase()+s.slice(1)," Dependencies"]}),e.jsxs(l,{children:["Dependencies reflect how this ",s," interacts with others. For instance, if this ",s," is dependent on another ",s,", its own score will be modulated by the thresholds of the other ",s,". A dependency modifier of 0.75 means this ",s," will be 25% less at the other ",s,"'s threshold."]}),e.jsx(q,{}),e.jsx(v,{variant:"contained",color:"success","aria-label":"Add dependency",sx:{px:4},onClick:()=>{console.log("Fix me! I need to be implemented!")},children:"Add Dependency"})]})},U={name:{name:"name",label:"Category Name",type:"text",tooltip:"The unique name of the category. This should clearly convey the category's purpose and role within the settlement mechanics.",validate:t=>t?t.length<3?"Category name must be at least 3 characters long":null:"Category name is required",keypath:"name"},description:{name:"description",label:"Description",type:"text",tooltip:"A brief description of the category and its role within the settlement mechanics.",multiline:!0,minRows:3,validate:t=>t?t.length<30?`Description must be at least 30 characters. You have ${30-t.length} characters remaining.`:null:"Description is required",keypath:"description"}};function V(t,n=2){return t.split(" ").map(s=>Math.floor(Number(s)/n)).join(" ")}const D=({attr:t})=>{const[n,s]=c.useState(!1);return e.jsxs(P,{sx:{pb:4,boxShadow:3,backgroundColor:"background.default"},children:[e.jsxs(p,{sx:{display:"flex",justifyContent:"center",alignItems:"center",gap:2,minHeight:100},children:[e.jsx(l,{variant:"h6",sx:{textAlign:"center"},children:t.name}),e.jsx(F,{viewBox:V(t.icon.viewBox,1),path:t.icon.d,size:40,color:t.icon.color})]}),e.jsx(m,{sx:{fontSize:"0.75rem"},children:"Per Level"}),e.jsxs(l,{variant:"body2",sx:{textAlign:"left",pl:2},children:["Max: ",t.balance.maxPerLevel]}),e.jsxs(l,{variant:"body2",sx:{textAlign:"left",pl:2},children:["Cost: ",t.balance.costPerLevel]}),e.jsxs(l,{variant:"body2",sx:{textAlign:"left",pl:2},children:["Health: ",t.balance.healthPerLevel]}),e.jsx(m,{children:e.jsx(A,{sx:{backgroundColor:"background.default",color:"primary.main"},label:n?"Hide Description":"Show Description",size:"small",onClick:()=>s(r=>!r)})}),e.jsx(S,{in:n,children:e.jsx(l,{variant:"body2",sx:{textAlign:"center",px:2},children:t.description})})]})},T=(t,n=[])=>{const[s,r]=c.useState([]);return c.useEffect(()=>{const i=n.map(d=>C.getQueryData([t,d])),o=n.filter((d,a)=>i[a]===void 0);o.length>0?k.post("/tools/fetchByIds",{tool:t,ids:o}).then(({data:d})=>{d.forEach(a=>{C.setQueryData([t,a.id],a)}),r(n.map(a=>C.getQueryData([t,a])).filter(a=>a!==void 0))}):r(i.filter(d=>d!==void 0))},[t,n]),s},W=({setShowModal:t,id:n})=>{const{edit:s}=u("category",n),r=T("attribute",s.attributes),i=()=>{t("Select Attribute")};return e.jsx(p,{children:e.jsxs(l,{variant:"h6",sx:{textAlign:"center",mb:2},children:[e.jsx(p,{sx:{display:"grid",gridTemplateColumns:"repeat(3, 1fr)",gap:2},children:r.map(o=>e.jsx(D,{attr:o},o.refId))}),s.attributes.length<6&&e.jsx(v,{onClick:i,children:"Add Attribute"})]})})},Y=()=>{const{tool:t,id:n}=w();u(t,n);const[s,r]=c.useState(!1),[i,o]=c.useState(!1),[d,a]=c.useState(!1),[y,h]=c.useState(!1);return e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",my:2,gap:2,width:"100%",position:"relative",pb:2,overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:[e.jsx(I,{tool:"category",fields:U,id:n}),e.jsx(m,{sx:{gridColumn:"span 3"}}),e.jsx(f,{title:"Attributes",titleType:"h6",open:s,styles:{width:"100%",mb:2},boxSx:{gridColumn:"span 3"},toggleOpen:()=>r(!s),children:e.jsx(W,{id:n})}),e.jsx(f,{title:"Thresholds",titleType:"h6",open:i,styles:{width:"100%",mb:2},boxSx:{gridColumn:"span 3"},toggleOpen:()=>o(!i),children:e.jsx(O,{tool:"category",id:n})}),e.jsx(f,{title:"Dependencies",titleType:"h6",open:d,styles:{width:"100%",mb:2},boxSx:{gridColumn:"span 3"},toggleOpen:()=>a(!d),children:e.jsx(Q,{tool:"category",id:n,displayName:"Categories"})}),e.jsx(f,{title:"Tags",titleType:"h6",open:y,styles:{width:"100%",mb:2},boxSx:{gridColumn:"span 3"},toggleOpen:()=>h(!y),children:"tags"})]})},X=({label:t,data:n,isLoading:s,edit:r,type:i="h6"})=>e.jsxs(p,{sx:{...r,display:"flex",alignItems:"center",justifyContent:"start",gap:2},children:[e.jsxs(l,{variant:"h6",children:[t,":"]}),e.jsx(l,{variant:i,children:n||"None"})]}),Z=({threshold:t,style:n})=>t.name!==""?e.jsxs(p,{sx:{display:"flex",alignItems:"start",transition:"top 0.3s ease, left 0.3s ease",gap:2,...n},children:[e.jsxs(l,{sx:{width:"66%",textAlign:"left"},children:[t.name,":"]}),e.jsx(l,{children:t.modifier})]}):null,_=({data:t,name:n})=>e.jsxs(p,{sx:{gridColumn:"span 3",display:"grid",gridTemplateRows:`repeat(${t.length+1}, 1fr)`,gridAutoFlow:"column"},children:[e.jsx(l,{variant:"body1",sx:{textAlign:"left",fontSize:"1.2rem",fontWeight:"bold",pl:"25%"},children:n}),t.map((s,r)=>e.jsx(Z,{threshold:s,style:{backgroundColor:r%2===0?"background.paper":"background.default"}},s.name))]}),G=()=>{var i,o,d;const{tool:t,id:n}=w(),{current:s}=u(t,n),r=T("attribute",s.attributes);return e.jsxs(p,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",my:2,gap:2,width:"100%",position:"relative"},children:[e.jsx(X,{data:s==null?void 0:s.name,label:"Name",edit:{gridColumn:"span 3"},type:"body1"}),e.jsxs(p,{sx:{gridColumn:"span 3",display:"flex",flexDirection:"column",gap:2,alignItems:"start",justifyContent:"center"},children:[e.jsx(l,{variant:"h6",children:"Description:"}),e.jsx(l,{sx:{textAlign:"start"},variant:"body1",children:(s==null?void 0:s.description)||"No description"})]}),e.jsx(m,{sx:{gridColumn:"span 3",borderColor:"#000"},children:"ATTRIBUTES"}),r.map(a=>e.jsx(D,{attr:a},a.refId)),e.jsx(m,{sx:{gridColumn:"span 3",borderColor:"#000"},children:"THRESHOLDS"}),e.jsx(R,{data:(i=s==null?void 0:s.thresholds)==null?void 0:i.data,order:(o=s==null?void 0:s.thresholds)==null?void 0:o.order,innerSx:{gridColumn:"span 3"}}),e.jsx(m,{sx:{gridColumn:"span 3",borderColor:"#000"},children:"DEPENDENCIES"}),(d=s==null?void 0:s.dependencies)==null?void 0:d.order.map(a=>e.jsx(p,{sx:{gridColumn:"span 1",display:"flex",flexDirection:"column",display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gap:2},children:e.jsx(_,{data:s.dependencies.data[a].thresholds,name:s.dependencies.data[a].name})},a))]})},le=({tab:t})=>{var i;const{edit:n}=u("category",t.id),[s,r]=c.useState([]);return c.useEffect(()=>{var o;n&&r((o=n==null?void 0:n.dependencies)==null?void 0:o.order)},[(i=n==null?void 0:n.dependencies)==null?void 0:i.order]),e.jsx(B,{tab:t,initializeTool:z,validationFields:["name","description","thresholds","dependencies"],editComponent:Y,previewComponent:G,checklistContent:H})};export{le as default};
