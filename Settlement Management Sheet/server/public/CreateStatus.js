import{v as g,j as e,B as c,F as W,X as q,Y as K,Z as Y,p as I,r as o,G,_ as D,q as w,V as J,W as X,A as C,T as b,D as B,C as Z,J as _,$ as Q,H as U,a as O}from"./main.js";import{u as k,C as ee}from"./CreateShell.js";import{E as te}from"./EditNameDescription.js";function se(){return{id:g(),refId:g(),version:1,name:"",description:"",type:"Weather",mode:"Simple",steps:[{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]}],isValid:!1,status:"DRAFT",createdBy:""}}const ae={name:{name:"name",label:"Status Name",type:"text",tooltip:"The unique name of the status. This should clearly convey the status's shape or meaning within the system mechanics",validate:s=>s?s.length<3?"Status name must be at least 3 characters long":null:"Status name is required",keypath:"name"},description:{name:"description",label:"Description",type:"text",tooltip:"A brief description of the status and its impact on system mechanics.",multiline:!0,minRows:3,validate:s=>s?s.length<30?`Description must be at least 30 characters. You have ${30-s.length} characters remaining.`:null:"Description is required",keypath:"description"}},E=({options:s,onChange:r,value:t,label:l,disabled:i=!1,width:x="100%"})=>e.jsx(c,{sx:{width:"100%"},children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(q,{id:`select-${l}`,children:l}),e.jsx(K,{labelId:`select-${l}`,id:`select-${l}`,value:t,label:l,onChange:r,disabled:i,sx:{width:x,backgroundColor:"background.paper","& .MuiSelect-select":{padding:"8px 16px"}},children:s.map(y=>e.jsx(Y,{value:y,children:y},y))})]})}),ne=()=>{const{tool:s,id:r}=k(),{edit:t,updateTool:l}=I(s,r);return e.jsxs(c,{sx:{gridColumn:"span 3",width:"100%",display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{label:"Status Type",value:t==null?void 0:t.type,onChange:i=>l("type",i.target.value),options:["Weather","Morale","Settlement"]}),e.jsx(E,{label:"Creation Mode",value:t==null?void 0:t.mode,onChange:i=>l("mode",i.target.value),options:["Simple","Advanced"]})]})},F=(s=[],r)=>Array.isArray(s)?[...s].sort((t,l)=>{const i=t[r],x=l[r];return i==null||x==null?0:typeof i=="number"&&typeof x=="number"?i-x:String(i).localeCompare(String(x),void 0,{sensitivity:"base"})}):[],le={system:[{name:"None",value:""},{name:"Abstract Progress Tracker",value:"apt"},{name:"Attribute",value:"attribute"},{name:"Building",value:"building"},{name:"Category",value:"category"},{name:"Settlement",value:"settlement"}]},ie={attribute:[{name:"Current",value:"current"},{name:"Max",value:"max"},{name:"Bonus",value:"bonus"}],category:[{name:"Bonus",value:"bonus"},{name:"Add New Attribute",value:"addAttr"},{name:"Remove Attribute",value:"removeAttr"}],building:["Health","Durability","Complexity"],settlement:["Productivity","Supplies","Health","Vault","Settlement Points"]},z=({disabled:s=!1,index:r,keypath:t,onRemove:l=()=>{},isAdvanced:i=!1})=>{const{tool:x,id:y}=k(),{edit:S,updateTool:d}=I(x,y),[h,u]=o.useState(0),{options:m}=G(),[f,ce]=o.useState(le.system),[N,M]=o.useState([]),[V,H]=o.useState([]),[de,me]=o.useState([]),[L,P]=o.useState(""),[A,R]=o.useState(!1),n=D.get(S,t);return o.useEffect(()=>{var a;if(((a=n.system)==null?void 0:a.name)!==void 0){H(F(D.get(m,n.system.value,[]),"name"));const p=F(ie[n.system.value],"name");M(p)}},[m,n.system]),o.useEffect(()=>{d(`${t}.target`,null)},[n.system]),o.useEffect(()=>{d(`${t}.key`,null)},[n.target]),o.useEffect(()=>{d(`${t}.value`,null)},[n.key]),o.useEffect(()=>{(async()=>{var T,$;const p=n.system,j=n.target;if(p&&j)switch(p.value){case"attribute":try{const v=await Q({tool:"attribute",id:(T=j.id)==null?void 0:T[0],refId:($=j.refId)==null?void 0:$[0]});v&&P(`${v.name} max per level is ${v.balance.maxPerLevel}`)}catch(v){console.error("Failed to fetch attribute:",v)}break}})()},[n.system,n.target]),e.jsxs(c,{sx:{width:"100%",display:"flex",alignItems:"start",justifyContent:"space-around",my:1,borderRadius:2,backgroundColor:"background.default",p:1,boxShadow:2,borderColor:"accent.light",boxSizing:"border-box",flexWrap:"wrap",pb:i?0:4},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:"100%",height:48,mb:1},children:[e.jsx(w,{children:L}),e.jsx(J,{sx:{position:"absolute",top:0,right:0,color:"warning.main"},onClick:l,children:e.jsx(X,{})})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(C,{value:n.system||{name:"-Select-",value:""},label:"System",onChange:(a,p)=>{d(`${t}.system`,p)},disabled:s,options:f,getOptionLabel:a=>a.name,renderInput:a=>e.jsx(b,{...a,label:"System",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(C,{value:n.target||{name:"-Select-",value:""},onChange:(a,p)=>{d(`${t}.target`,p),u(h+1)},disabled:n.system===null,options:V,getOptionLabel:a=>a.name,renderInput:a=>e.jsx(b,{...a,label:"Target",variant:"outlined",size:"small"}),sx:{width:"100%"}})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(C,{value:n.key||{name:"-Select-",value:""},onChange:(a,p)=>{d(`${t}.key`,p)},disabled:n.target===null,options:N,getOptionLabel:a=>a.name,renderInput:a=>e.jsx(b,{...a,label:"Key",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(b,{value:n.value||0,onChange:a=>{d(`${t}.value`,Number(a.target.value))},disabled:n.key===null,label:"Value",variant:"outlined",size:"small",sx:{width:"100%"},type:"number"})]}),i&&e.jsxs(e.Fragment,{children:[e.jsx(B,{flexItem:!0,sx:{width:"100%"},children:e.jsx(Z,{label:"Advanced",onClick:()=>{R(!A)},sx:{my:2,cursor:"pointer"}})}),e.jsx(_,{in:A,timeout:"auto",unmountOnExit:!0,children:e.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",width:"100%",my:2}})})]})]})},oe=({})=>{const{tool:s,id:r}=k(),{edit:t,updateTool:l}=I(s,r),[i,x]=o.useState(!1),[y,S]=o.useState([!1,!1,!1,!1,!1]),d=(h,u)=>{const m=[...h];m.push({system:"",key:"",target:"",value:"add"}),l(`steps.${u}.impacts`,m)};return e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",my:2,gap:2,backgroundColor:"background.paper",width:"100%",position:"relative",pb:2,overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:[e.jsx(te,{tool:s,fields:ae,id:r}),e.jsx(B,{sx:{gridColumn:"span 3"}}),e.jsx(ne,{}),(t==null?void 0:t.mode)==="Advanced"?e.jsx(w,{sx:{gridColumn:"span 3"},children:"Advanced Creation Mode enables you to assign varying impacts to each step, allowing significantly more customization to the status that doesn't follow a linear progression, as well as giving you access to advanced customization logic."}):e.jsxs(w,{sx:{gridColumn:"span 3"},children:["Simple Creation Mode streamlines the status creation process by automatically scaling the Step 1 impacts to the rest of the steps. Simply put, a Step 1 Impact of Food (Current) - 1 will automatically result in a Step 2 Impact of Food (Current) - 2."," "]}),(t==null?void 0:t.mode)==="Advanced"&&e.jsx(c,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:t.steps.map((h,u)=>e.jsxs(U,{title:`Step ${u+1}`,titleType:"h6",defaultState:y[u],noDefaultHandler:()=>{const m=[...y];m[u]=!m[u],S(m)},children:[e.jsx(c,{sx:{display:"flex",flexDirection:"column"},className:"status-impacts",children:h.impacts.map((m,f)=>e.jsx(z,{index:f,keypath:`steps.${u}.impacts.${f}`,isAdvanced:t.mode==="Advanced"},f))}),e.jsx(O,{onClick:()=>{d(h.impacts,u)},children:"Add Impact"})]},u))}),(t==null?void 0:t.mode)==="Simple"&&e.jsxs(c,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:[t.steps[0].impacts.map((h,u)=>e.jsx(z,{keypath:`steps.0.impacts.${u}`})),e.jsx(O,{onClick:()=>{d(entry.impacts,0)},children:"Add Impact"})]})]})},re=({id:s,mode:r,side:t,tabId:l})=>e.jsx(c,{children:"I'm preview status!"}),ue=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"}],he=({id:s,mode:r,side:t,tabId:l})=>e.jsx(ee,{tool:"gameStatus",toolName:"Status",id:s,initializeTool:se,validationFields:["name","description"],editComponent:oe,previewComponent:re,checklistContent:ue,loadDisplayName:"Load Status",modalComponents:{},side:t,mode:r,tabId:l});export{he as default};
