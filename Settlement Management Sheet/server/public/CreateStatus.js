import{v as x,c as k,j as e,B as o,r as l,a as W,l as O,T as w,a8 as q,ai as K,A as C,g as b,a5 as F,a6 as Y,ad as G,am as J,ac as Q,d as D}from"./main.js";import{a as I}from"./PageBox.js";import{E as U}from"./EditNameDescription.js";import{T as E}from"./ToolSelect.js";import{C as X}from"./CreateToolShell.js";import"./useTabSplit.js";import"./ToolInput.js";import"./useDebounce.js";function Z(){return{id:x(),refId:x(),version:1,name:"",description:"",type:"Weather",mode:"Simple",steps:[{id:x(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:x(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:x(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:x(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:x(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]}],isValid:!1,status:"DRAFT",createdBy:""}}const _={name:{name:"name",label:"Status Name",type:"text",tooltip:"The unique name of the status. This should clearly convey the status's shape or meaning within the system mechanics",validate:a=>a?a.length<3?"Status name must be at least 3 characters long":null:"Status name is required",keypath:"name"},description:{name:"description",label:"Description",type:"text",tooltip:"A brief description of the status and its impact on system mechanics.",multiline:!0,minRows:3,validate:a=>a?a.length<30?`Description must be at least 30 characters. You have ${30-a.length} characters remaining.`:null:"Description is required",keypath:"description"}},ee=()=>{const{tool:a,id:m}=I();return k(a,m),e.jsxs(o,{sx:{gridColumn:"span 3",width:"100%",display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{label:"Status Type",options:["Weather","Morale","Settlement"],keypath:"type"}),e.jsx(E,{label:"Creation Mode",keypath:"mode",options:["Simple","Advanced"]})]})},z=(a=[],m)=>Array.isArray(a)?[...a].sort((t,g)=>{const p=t[m],d=g[m];return p==null||d==null?0:typeof p=="number"&&typeof d=="number"?p-d:String(p).localeCompare(String(d),void 0,{sensitivity:"base"})}):[],te={system:[{name:"None",value:""},{name:"Abstract Progress Tracker",value:"apt"},{name:"Attribute",value:"attribute"},{name:"Building",value:"building"},{name:"Category",value:"category"},{name:"Settlement",value:"settlement"}]},se={attribute:[{name:"Current",value:"current"},{name:"Max",value:"max"},{name:"Bonus",value:"bonus"}],category:[{name:"Bonus",value:"bonus"},{name:"Add New Attribute",value:"addAttr"},{name:"Remove Attribute",value:"removeAttr"}],building:["Health","Durability","Complexity"],settlement:["Productivity","Supplies","Health","Vault","Settlement Points"]},B=({disabled:a=!1,index:m,keypath:t,onRemove:g=()=>{},isAdvanced:p=!1})=>{const{tool:d,id:v}=I(),{edit:S,updateTool:r}=k(d,v),[y,i]=l.useState(0),{options:u}=W(),[h,ie]=l.useState(te.system),[N,M]=l.useState([]),[P,R]=l.useState([]),[oe,re]=l.useState([]),[V,H]=l.useState(""),[A,L]=l.useState(!1),n=O.get(S,t);return l.useEffect(()=>{var s;if(((s=n.system)==null?void 0:s.name)!==void 0){R(z(O.get(u,n.system.value,[]),"name"));const c=z(se[n.system.value],"name");M(c)}},[u,n.system]),l.useEffect(()=>{r(`${t}.target`,null)},[n.system]),l.useEffect(()=>{r(`${t}.key`,null)},[n.target]),l.useEffect(()=>{r(`${t}.value`,null)},[n.key]),l.useEffect(()=>{(async()=>{var T,$;const c=n.system,j=n.target;if(c&&j)switch(c.value){case"attribute":try{const f=await J({tool:"attribute",id:(T=j.id)==null?void 0:T[0],refId:($=j.refId)==null?void 0:$[0]});f&&H(`${f.name} max per level is ${f.balance.maxPerLevel}`)}catch(f){console.error("Failed to fetch attribute:",f)}break}})()},[n.system,n.target]),e.jsxs(o,{sx:{width:"100%",display:"flex",alignItems:"start",justifyContent:"space-around",my:1,borderRadius:2,backgroundColor:"background.default",p:1,boxShadow:2,borderColor:"accent.light",boxSizing:"border-box",flexWrap:"wrap",pb:p?0:4},children:[e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:"100%",height:48,mb:1},children:[e.jsx(w,{children:V}),e.jsx(q,{sx:{position:"absolute",top:0,right:0,color:"warning.main"},onClick:g,children:e.jsx(K,{})})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(C,{value:n.system||{name:"-Select-",value:""},label:"System",onChange:(s,c)=>{r(`${t}.system`,c)},disabled:a,options:h,getOptionLabel:s=>s.name,renderInput:s=>e.jsx(b,{...s,label:"System",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(C,{value:n.target||{name:"-Select-",value:""},onChange:(s,c)=>{r(`${t}.target`,c),i(y+1)},disabled:n.system===null,options:P,getOptionLabel:s=>s.name,renderInput:s=>e.jsx(b,{...s,label:"Target",variant:"outlined",size:"small"}),sx:{width:"100%"}})]}),e.jsxs(o,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(C,{value:n.key||{name:"-Select-",value:""},onChange:(s,c)=>{r(`${t}.key`,c)},disabled:n.target===null,options:N,getOptionLabel:s=>s.name,renderInput:s=>e.jsx(b,{...s,label:"Key",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(b,{value:n.value||0,onChange:s=>{r(`${t}.value`,Number(s.target.value))},disabled:n.key===null,label:"Value",variant:"outlined",size:"small",sx:{width:"100%"},type:"number"})]}),p&&e.jsxs(e.Fragment,{children:[e.jsx(F,{flexItem:!0,sx:{width:"100%"},children:e.jsx(Y,{label:"Advanced",onClick:()=>{L(!A)},sx:{my:2,cursor:"pointer"}})}),e.jsx(G,{in:A,timeout:"auto",unmountOnExit:!0,children:e.jsx(o,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",width:"100%",my:2}})})]})]})},ae=({})=>{const{tool:a,id:m}=I(),{edit:t,updateTool:g}=k(a,m),[p,d]=l.useState(!1),[v,S]=l.useState([!1,!1,!1,!1,!1]),r=(y,i)=>{const u=[...y];u.push({system:"",key:"",target:"",value:"add"}),g(`steps.${i}.impacts`,u)};return e.jsxs(o,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",my:2,gap:2,backgroundColor:"background.paper",width:"100%",position:"relative",pb:2,overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:[e.jsx(U,{fields:_}),e.jsx(F,{sx:{gridColumn:"span 3"}}),e.jsx(ee,{}),(t==null?void 0:t.mode)==="Advanced"?e.jsx(w,{sx:{gridColumn:"span 3"},children:"Advanced Creation Mode enables you to assign varying impacts to each step, allowing significantly more customization to the status that doesn't follow a linear progression, as well as giving you access to advanced customization logic."}):e.jsxs(w,{sx:{gridColumn:"span 3"},children:["Simple Creation Mode streamlines the status creation process by automatically scaling the Step 1 impacts to the rest of the steps. Simply put, a Step 1 Impact of Food (Current) - 1 will automatically result in a Step 2 Impact of Food (Current) - 2."," "]}),(t==null?void 0:t.mode)==="Advanced"&&e.jsx(o,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:t.steps.map((y,i)=>e.jsxs(Q,{title:`Step ${i+1}`,titleType:"h6",open:v[i],toggleOpen:()=>{const u=[...v];u[i]=!u[i],S(u)},children:[e.jsx(o,{sx:{display:"flex",flexDirection:"column"},className:"status-impacts",children:y.impacts.map((u,h)=>e.jsx(B,{index:h,keypath:`steps.${i}.impacts.${h}`,isAdvanced:t.mode==="Advanced"},h))}),e.jsx(D,{onClick:()=>{r(y.impacts,i)},children:"Add Impact"})]},i))}),(t==null?void 0:t.mode)==="Simple"&&e.jsxs(o,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:[t.steps[0].impacts.map((y,i)=>e.jsx(B,{keypath:`steps.0.impacts.${i}`})),e.jsx(D,{onClick:()=>{r(entry.impacts,0)},children:"Add Impact"})]})]})},ne=({id:a,mode:m,side:t,tabId:g})=>e.jsx(o,{children:"I'm preview status!"}),le=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"}],he=({tab:a})=>e.jsx(X,{tab:a,initializeTool:Z,validationFields:["name","description"],editComponent:ae,previewComponent:ne,checklistContent:le});export{he as default};
