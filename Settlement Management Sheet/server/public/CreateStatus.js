import{v as g,r as i,c as j,j as e,B as c,Y as H,ab as q,ac as K,ad as Y,a as _,l as O,T as I,a9 as G,aa as J,A as w,g as S,_ as F,$ as Q,a5 as U,ae as X,a4 as Z,d as D}from"./main.js";import{S as ee,u as k}from"./ShellContext.js";import{E as te}from"./EditNameDescription.js";import{C as se}from"./CreateToolShell.js";import"./ToolInput.js";import"./PageBox.js";function ae(){return{id:g(),refId:g(),version:1,name:"",description:"",type:"Weather",mode:"Simple",steps:[{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:g(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]}],isValid:!1,status:"DRAFT",createdBy:""}}const ne={name:{name:"name",label:"Status Name",type:"text",tooltip:"The unique name of the status. This should clearly convey the status's shape or meaning within the system mechanics",validate:s=>s?s.length<3?"Status name must be at least 3 characters long":null:"Status name is required",keypath:"name"},description:{name:"description",label:"Description",type:"text",tooltip:"A brief description of the status and its impact on system mechanics.",multiline:!0,minRows:3,validate:s=>s?s.length<30?`Description must be at least 30 characters. You have ${30-s.length} characters remaining.`:null:"Description is required",keypath:"description"}},E=({options:s,label:r,keypath:t,disabled:h=!1,width:d="100%"})=>{const{tool:p,id:y}=i.useContext(ee),{edit:f,updateTool:u}=j(p,y),[x,o]=i.useState(f?f[t]:"");return e.jsx(c,{sx:{width:"100%"},children:e.jsxs(H,{fullWidth:!0,children:[e.jsx(q,{id:`select-${r}`,children:r}),e.jsx(K,{labelId:`select-${r}`,id:`select-${r}`,value:x,label:r,onChange:l=>{o(l.target.value),u(t,l.target.value)},disabled:h,sx:{width:d,backgroundColor:"background.paper","& .MuiSelect-select":{padding:"8px 16px"}},children:s.map(l=>e.jsx(Y,{value:l,children:l},l))})]})})},le=()=>{const{tool:s,id:r}=k();return j(s,r),e.jsxs(c,{sx:{gridColumn:"span 3",width:"100%",display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{label:"Status Type",options:["Weather","Morale","Settlement"],keypath:"type"}),e.jsx(E,{label:"Creation Mode",keypath:"mode",options:["Simple","Advanced"]})]})},z=(s=[],r)=>Array.isArray(s)?[...s].sort((t,h)=>{const d=t[r],p=h[r];return d==null||p==null?0:typeof d=="number"&&typeof p=="number"?d-p:String(d).localeCompare(String(p),void 0,{sensitivity:"base"})}):[],ie={system:[{name:"None",value:""},{name:"Abstract Progress Tracker",value:"apt"},{name:"Attribute",value:"attribute"},{name:"Building",value:"building"},{name:"Category",value:"category"},{name:"Settlement",value:"settlement"}]},oe={attribute:[{name:"Current",value:"current"},{name:"Max",value:"max"},{name:"Bonus",value:"bonus"}],category:[{name:"Bonus",value:"bonus"},{name:"Add New Attribute",value:"addAttr"},{name:"Remove Attribute",value:"removeAttr"}],building:["Health","Durability","Complexity"],settlement:["Productivity","Supplies","Health","Vault","Settlement Points"]},B=({disabled:s=!1,index:r,keypath:t,onRemove:h=()=>{},isAdvanced:d=!1})=>{const{tool:p,id:y}=k(),{edit:f,updateTool:u}=j(p,y),[x,o]=i.useState(0),{options:l}=_(),[v,de]=i.useState(ie.system),[M,N]=i.useState([]),[V,P]=i.useState([]),[me,pe]=i.useState([]),[R,L]=i.useState(""),[A,W]=i.useState(!1),n=O.get(f,t);return i.useEffect(()=>{var a;if(((a=n.system)==null?void 0:a.name)!==void 0){P(z(O.get(l,n.system.value,[]),"name"));const m=z(oe[n.system.value],"name");N(m)}},[l,n.system]),i.useEffect(()=>{u(`${t}.target`,null)},[n.system]),i.useEffect(()=>{u(`${t}.key`,null)},[n.target]),i.useEffect(()=>{u(`${t}.value`,null)},[n.key]),i.useEffect(()=>{(async()=>{var T,$;const m=n.system,C=n.target;if(m&&C)switch(m.value){case"attribute":try{const b=await X({tool:"attribute",id:(T=C.id)==null?void 0:T[0],refId:($=C.refId)==null?void 0:$[0]});b&&L(`${b.name} max per level is ${b.balance.maxPerLevel}`)}catch(b){console.error("Failed to fetch attribute:",b)}break}})()},[n.system,n.target]),e.jsxs(c,{sx:{width:"100%",display:"flex",alignItems:"start",justifyContent:"space-around",my:1,borderRadius:2,backgroundColor:"background.default",p:1,boxShadow:2,borderColor:"accent.light",boxSizing:"border-box",flexWrap:"wrap",pb:d?0:4},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:"100%",height:48,mb:1},children:[e.jsx(I,{children:R}),e.jsx(G,{sx:{position:"absolute",top:0,right:0,color:"warning.main"},onClick:h,children:e.jsx(J,{})})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(w,{value:n.system||{name:"-Select-",value:""},label:"System",onChange:(a,m)=>{u(`${t}.system`,m)},disabled:s,options:v,getOptionLabel:a=>a.name,renderInput:a=>e.jsx(S,{...a,label:"System",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(w,{value:n.target||{name:"-Select-",value:""},onChange:(a,m)=>{u(`${t}.target`,m),o(x+1)},disabled:n.system===null,options:V,getOptionLabel:a=>a.name,renderInput:a=>e.jsx(S,{...a,label:"Target",variant:"outlined",size:"small"}),sx:{width:"100%"}})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(w,{value:n.key||{name:"-Select-",value:""},onChange:(a,m)=>{u(`${t}.key`,m)},disabled:n.target===null,options:M,getOptionLabel:a=>a.name,renderInput:a=>e.jsx(S,{...a,label:"Key",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(S,{value:n.value||0,onChange:a=>{u(`${t}.value`,Number(a.target.value))},disabled:n.key===null,label:"Value",variant:"outlined",size:"small",sx:{width:"100%"},type:"number"})]}),d&&e.jsxs(e.Fragment,{children:[e.jsx(F,{flexItem:!0,sx:{width:"100%"},children:e.jsx(Q,{label:"Advanced",onClick:()=>{W(!A)},sx:{my:2,cursor:"pointer"}})}),e.jsx(U,{in:A,timeout:"auto",unmountOnExit:!0,children:e.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",width:"100%",my:2}})})]})]})},re=({})=>{const{tool:s,id:r}=k(),{edit:t,updateTool:h}=j(s,r),[d,p]=i.useState(!1),[y,f]=i.useState([!1,!1,!1,!1,!1]),u=(x,o)=>{const l=[...x];l.push({system:"",key:"",target:"",value:"add"}),h(`steps.${o}.impacts`,l)};return e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",my:2,gap:2,backgroundColor:"background.paper",width:"100%",position:"relative",pb:2,overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:[e.jsx(te,{fields:ne}),e.jsx(F,{sx:{gridColumn:"span 3"}}),e.jsx(le,{}),(t==null?void 0:t.mode)==="Advanced"?e.jsx(I,{sx:{gridColumn:"span 3"},children:"Advanced Creation Mode enables you to assign varying impacts to each step, allowing significantly more customization to the status that doesn't follow a linear progression, as well as giving you access to advanced customization logic."}):e.jsxs(I,{sx:{gridColumn:"span 3"},children:["Simple Creation Mode streamlines the status creation process by automatically scaling the Step 1 impacts to the rest of the steps. Simply put, a Step 1 Impact of Food (Current) - 1 will automatically result in a Step 2 Impact of Food (Current) - 2."," "]}),(t==null?void 0:t.mode)==="Advanced"&&e.jsx(c,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:t.steps.map((x,o)=>e.jsxs(Z,{title:`Step ${o+1}`,titleType:"h6",open:y[o],toggleOpen:()=>{const l=[...y];l[o]=!l[o],f(l)},children:[e.jsx(c,{sx:{display:"flex",flexDirection:"column"},className:"status-impacts",children:x.impacts.map((l,v)=>e.jsx(B,{index:v,keypath:`steps.${o}.impacts.${v}`,isAdvanced:t.mode==="Advanced"},v))}),e.jsx(D,{onClick:()=>{u(x.impacts,o)},children:"Add Impact"})]},o))}),(t==null?void 0:t.mode)==="Simple"&&e.jsxs(c,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:[t.steps[0].impacts.map((x,o)=>e.jsx(B,{keypath:`steps.0.impacts.${o}`})),e.jsx(D,{onClick:()=>{u(entry.impacts,0)},children:"Add Impact"})]})]})},ue=({id:s,mode:r,side:t,tabId:h})=>e.jsx(c,{children:"I'm preview status!"}),ce=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"}],be=({tab:s})=>e.jsx(se,{tab:s,initializeTool:ae,validationFields:["name","description"],editComponent:re,previewComponent:ue,checklistContent:ce});export{be as default};
