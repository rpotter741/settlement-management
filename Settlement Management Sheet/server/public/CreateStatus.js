import{v as y,j as e,B as c,F as W,Z as q,_ as K,$ as Y,k as I,r as i,H as J,a0 as D,n as w,I as Z,Y as _,a1 as C,q as S,D as B,L as G,M as Q,a2 as U,J as X,o as O}from"./main.js";import{u as k,C as ee}from"./CreateShell.js";import{E as te}from"./EditNameDescription.js";function se(){return{id:y(),refId:y(),version:1,name:"",description:"",type:"Weather",mode:"Simple",steps:[{id:y(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:y(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:y(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:y(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]},{id:y(),name:"",description:"",impacts:[{system:null,target:null,key:null,value:null}]}],isValid:!1,status:"DRAFT",createdBy:""}}const ae={name:{name:"name",label:"Status Name",type:"text",tooltip:"The unique name of the status. This should clearly convey the status's shape or meaning within the system mechanics",validate:s=>s?s.length<3?"Status name must be at least 3 characters long":null:"Status name is required",keypath:"name"},description:{name:"description",label:"Description",type:"text",tooltip:"A brief description of the status and its impact on system mechanics.",multiline:!0,minRows:3,validate:s=>s?s.length<30?`Description must be at least 30 characters. You have ${30-s.length} characters remaining.`:null:"Description is required",keypath:"description"}},E=({options:s,onChange:r,value:t,label:l,disabled:o=!1,width:p="100%"})=>e.jsx(c,{sx:{width:"100%"},children:e.jsxs(W,{fullWidth:!0,children:[e.jsx(q,{id:`select-${l}`,children:l}),e.jsx(K,{labelId:`select-${l}`,id:`select-${l}`,value:t,label:l,onChange:r,disabled:o,sx:{width:p,backgroundColor:"background.paper","& .MuiSelect-select":{padding:"8px 16px"}},children:s.map(g=>e.jsx(Y,{value:g,children:g},g))})]})}),ne=()=>{const{tool:s,id:r}=k(),{edit:t,updateTool:l}=I(s,r);return e.jsxs(c,{sx:{gridColumn:"span 3",width:"100%",display:"flex",alignItems:"center",gap:2},children:[e.jsx(E,{label:"Status Type",value:t==null?void 0:t.type,onChange:o=>l("type",o.target.value),options:["Weather","Morale","Settlement"]}),e.jsx(E,{label:"Creation Mode",value:t==null?void 0:t.mode,onChange:o=>l("mode",o.target.value),options:["Simple","Advanced"]})]})},F=(s=[],r)=>Array.isArray(s)?[...s].sort((t,l)=>{const o=t[r],p=l[r];return o==null||p==null?0:typeof o=="number"&&typeof p=="number"?o-p:String(o).localeCompare(String(p),void 0,{sensitivity:"base"})}):[],le={system:[{name:"None",value:""},{name:"Abstract Progress Tracker",value:"apt"},{name:"Attribute",value:"attribute"},{name:"Building",value:"building"},{name:"Category",value:"category"},{name:"Settlement",value:"settlement"}]},ie={attribute:[{name:"Current",value:"current"},{name:"Max",value:"max"},{name:"Bonus",value:"bonus"}],category:["Bonus","Add New Attribute","Remove Attribute"],building:["Health","Durability","Complexity"],settlement:["Productivity","Supplies","Health","Vault","Settlement Points"]},z=({disabled:s=!1,index:r,keypath:t,onRemove:l=()=>{},isAdvanced:o=!1})=>{const{tool:p,id:g}=k(),{edit:j,updateTool:d}=I(p,g),[h,u]=i.useState(0),{options:m}=J(),[f,ce]=i.useState(le.system),[M,N]=i.useState([]),[L,H]=i.useState([]),[de,me]=i.useState([]),[P,R]=i.useState(""),[T,V]=i.useState(!1),a=D.get(j,t);return i.useEffect(()=>{console.log(a,"impact")},[a]),i.useEffect(()=>{var n;((n=a.system)==null?void 0:n.name)!==void 0&&(H(F(D.get(m,a.system.value,[]),"name")),N(F(ie[a.system.value],"name")))},[m,a.system]),i.useEffect(()=>{d(`${t}.target`,null)},[a.system]),i.useEffect(()=>{d(`${t}.key`,null)},[a.target]),i.useEffect(()=>{d(`${t}.value`,null)},[a.key]),i.useEffect(()=>{(async()=>{var A,$;const x=a.system,b=a.target;if(console.log(x,b,"here i am bitches!"),x&&b)switch(x.value){case"attribute":try{const v=await U({tool:"attribute",id:(A=b.id)==null?void 0:A[0],refId:($=b.refId)==null?void 0:$[0]});v&&R(`${v.name} max per level is ${v.balance.maxPerLevel}`)}catch(v){console.error("Failed to fetch attribute:",v)}break}})()},[a.system,a.target]),e.jsxs(c,{sx:{width:"100%",display:"flex",alignItems:"start",justifyContent:"space-around",my:1,borderRadius:2,backgroundColor:"background.default",p:1,boxShadow:2,borderColor:"accent.light",boxSizing:"border-box",flexWrap:"wrap",pb:o?0:4},children:[e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",width:"100%",height:48,mb:1},children:[e.jsx(w,{children:P}),e.jsx(Z,{sx:{position:"absolute",top:0,right:0,color:"warning.main"},onClick:l,children:e.jsx(_,{})})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(C,{value:a.system||{name:"-Select-",value:""},label:"System",onChange:(n,x)=>{d(`${t}.system`,x)},disabled:s,options:f,getOptionLabel:n=>n.name,renderInput:n=>e.jsx(S,{...n,label:"System",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(C,{value:a.target||{name:"-Select-",value:""},onChange:(n,x)=>{d(`${t}.target`,x),u(h+1)},disabled:a.system===null,options:L,getOptionLabel:n=>n.name,renderInput:n=>e.jsx(S,{...n,label:"Target",variant:"outlined",size:"small"}),sx:{width:"100%"}})]}),e.jsxs(c,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"50%"},children:[e.jsx(C,{value:a.key||{name:"-Select-",value:""},onChange:(n,x)=>{d(`${t}.key`,x)},disabled:a.target===null,options:M,getOptionLabel:n=>n.name,renderInput:n=>e.jsx(S,{...n,label:"Key",variant:"outlined",size:"small"}),sx:{width:"100%"}}),e.jsx(S,{value:a.value||0,onChange:n=>{d(`${t}.value`,Number(n.target.value))},disabled:a.key===null,label:"Value",variant:"outlined",size:"small",sx:{width:"100%"},type:"number"})]}),o&&e.jsxs(e.Fragment,{children:[e.jsx(B,{flexItem:!0,sx:{width:"100%"},children:e.jsx(G,{label:"Advanced",onClick:()=>{V(!T)},sx:{my:2,cursor:"pointer"}})}),e.jsx(Q,{in:T,timeout:"auto",unmountOnExit:!0,children:e.jsx(c,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",flexWrap:"wrap",width:"100%",my:2}})})]})]})},oe=({})=>{const{tool:s,id:r}=k(),{edit:t,updateTool:l}=I(s,r),[o,p]=i.useState(!1),[g,j]=i.useState([!1,!1,!1,!1,!1]),d=(h,u)=>{const m=[...h];m.push({system:"",key:"",target:"",value:"add"}),l(`steps.${u}.impacts`,m)};return e.jsxs(c,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",my:2,gap:2,backgroundColor:"background.paper",width:"100%",position:"relative",pb:2,overflowY:"auto",maxHeight:"calc(100vh - 200px)"},children:[e.jsx(te,{tool:s,fields:ae,id:r}),e.jsx(B,{sx:{gridColumn:"span 3"}}),e.jsx(ne,{}),(t==null?void 0:t.mode)==="Advanced"?e.jsx(w,{sx:{gridColumn:"span 3"},children:"Advanced Creation Mode enables you to assign varying impacts to each step, allowing significantly more customization to the status that doesn't follow a linear progression, as well as giving you access to advanced customization logic."}):e.jsxs(w,{sx:{gridColumn:"span 3"},children:["Simple Creation Mode streamlines the status creation process by automatically scaling the Step 1 impacts to the rest of the steps. Simply put, a Step 1 Impact of Food (Current) - 1 will automatically result in a Step 2 Impact of Food (Current) - 2."," "]}),(t==null?void 0:t.mode)==="Advanced"&&e.jsx(c,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:t.steps.map((h,u)=>e.jsxs(X,{title:`Step ${u+1}`,titleType:"h6",defaultState:g[u],noDefaultHandler:()=>{const m=[...g];m[u]=!m[u],j(m)},children:[e.jsx(c,{sx:{display:"flex",flexDirection:"column"},className:"status-impacts",children:h.impacts.map((m,f)=>e.jsx(z,{index:f,keypath:`steps.${u}.impacts.${f}`,isAdvanced:t.mode==="Advanced"},f))}),e.jsx(O,{onClick:()=>{d(h.impacts,u)},children:"Add Impact"})]},u))}),(t==null?void 0:t.mode)==="Simple"&&e.jsxs(c,{sx:{gridColumn:"span 3",display:"flex",gap:2,flexDirection:"column"},children:[t.steps[0].impacts.map((h,u)=>e.jsx(z,{keypath:`steps.0.impacts.${u}`})),e.jsx(O,{onClick:()=>{d(entry.impacts,0)},children:"Add Impact"})]})]})},re=({id:s,mode:r,side:t,tabId:l})=>e.jsx(c,{children:"I'm preview status!"}),ue=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"}],he=({id:s,mode:r,side:t,tabId:l})=>e.jsx(ee,{tool:"gameStatus",toolName:"Status",id:s,initializeTool:se,validationFields:["name","description"],editComponent:oe,previewComponent:re,checklistContent:ue,loadDisplayName:"Load Status",modalComponents:{},side:t,mode:r,tabId:l});export{he as default};
