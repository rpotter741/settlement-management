import{ay as h,az as f,aA as T,aB as j,a0 as S,h as B,ar as k,j as o,i as v,T as y,W as m,Y as b,a2 as w,aC as I}from"./main.js";import{u as A}from"./useTools.js";import{s as D,a as E}from"./toolSelectors.js";import"./loadTool.js";async function F({tool:a,id:n,tabId:r,side:i,validationFields:e}){return async(t,d)=>{const c=d(),s=D(a,n)(c),l=E(a,n)(c);t(h({tabId:r,side:i,keypath:"mode",updates:"preview"})),(s==null?void 0:s.name)!==(l==null?void 0:l.name)&&t(h({tabId:r,side:i,keypath:"name",updates:(s==null?void 0:s.name)||"Untitled"})),t(f({tool:a,id:n})),t(T({tabId:r})),t(j({tool:a,id:n,fields:e,refObj:s}))}}const p=["apt","action","attribute","building","category","event","gameStatus","kit","listener","settlementType","settlement","storyThread","tradeHub","upgrade"],U=({tab:a})=>{const n=S(),{removeById:r}=B(),{closeModal:i}=k(),{tool:e,id:t,side:d,name:c,tabId:s}=a,l=()=>{r(a.tabId,a.side,!1)},{edit:u}=e&&p.includes(e)?A(e,t):{edit:null},g=async()=>{if(!(!e||!u)&&p.includes(e))try{await b.saveTool({tool:e,data:u}),l(),i()}catch{localStorage.setItem(`${e}-${t}`,JSON.stringify(u)),i(),n(w({message:`Failed to save ${c} to database. Try again later.`,type:"error"}));return}},x=()=>{i()},C=()=>{n(F({tool:e,id:t,tabId:s,side:d,validationFields:I[a.tabType][e].validationFields||[]})),i(),l()};return o.jsxs(v,{sx:{p:2,textAlign:"center",minWidth:500},children:[o.jsx(y,{variant:"h6",gutterBottom:!0,children:"Unsaved Changes"}),o.jsxs(y,{variant:"body1",gutterBottom:!0,children:["You have unsaved changes. Close ",o.jsx("strong",{children:a.name})," without saving?"]}),o.jsxs(v,{sx:{mt:2},children:[o.jsx(m,{variant:"outlined",color:"success",onClick:g,children:"Save and Close"}),o.jsx(m,{variant:"outlined",color:"info",onClick:x,sx:{ml:2},children:"Cancel"}),o.jsx(m,{variant:"outlined",color:"error",onClick:C,sx:{ml:2},children:"Close Without Saving"})]})]})};export{U as default};
