import{s as T,a as f,u as v,r as j,c as S,v as B,b,d as k,e as w,f as I,j as o,B as m,T as y,g as h,t as D,h as E,i as F}from"./main.js";async function M({tool:t,id:n,tabId:r,side:l,validationFields:e}){return async(a,d)=>{const c=d(),s=T(t,n)(c),i=f(t,n)(c);a(v({tabId:r,side:l,keypath:"mode",updates:"preview"})),(s==null?void 0:s.name)!==(i==null?void 0:i.name)&&a(v({tabId:r,side:l,keypath:"name",updates:(s==null?void 0:s.name)||"Untitled"})),a(j({tool:t,id:n})),a(S({tabId:r})),a(B({tool:t,id:n,fields:e,refObj:s}))}}const g=["apt","action","attribute","building","category","event","gameStatus","kit","listener","settlementType","settlement","storyThread","tradeHub","upgrade"],N=({tab:t})=>{const n=b(),{removeById:r}=k(),{closeModal:l}=w(),{tool:e,id:a,side:d,name:c,tabId:s}=t,i=()=>{r(t.tabId,t.side,!1)},{edit:u}=e&&g.includes(e)?I(e,a):{edit:null},p=async()=>{if(!(!e||!u)&&g.includes(e))try{await D.saveTool({tool:e,data:u}),i(),l()}catch{localStorage.setItem(`${e}-${a}`,JSON.stringify(u)),l(),n(E({message:`Failed to save ${c} to database. Try again later.`,type:"error"}));return}},x=()=>{l()},C=()=>{n(M({tool:e,id:a,tabId:s,side:d,validationFields:F[t.tabType][e].validationFields||[]})),l(),i()};return o.jsxs(m,{sx:{p:2,textAlign:"center",minWidth:500},children:[o.jsx(y,{variant:"h6",gutterBottom:!0,children:"Unsaved Changes"}),o.jsxs(y,{variant:"body1",gutterBottom:!0,children:["You have unsaved changes. Close ",o.jsx("strong",{children:t.name})," without saving?"]}),o.jsxs(m,{sx:{mt:2},children:[o.jsx(h,{variant:"outlined",color:"success",onClick:p,children:"Save and Close"}),o.jsx(h,{variant:"outlined",color:"info",onClick:x,sx:{ml:2},children:"Cancel"}),o.jsx(h,{variant:"outlined",color:"error",onClick:C,sx:{ml:2},children:"Close Without Saving"})]})]})};export{N as default};
