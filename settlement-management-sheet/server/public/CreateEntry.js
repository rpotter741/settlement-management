import{F as ne,j as r,a0 as W,aa as B,ak as se,bw as oe,ac as q,r as p,bx as ie,as as ce,by as pe,b9 as ue,bo as J,a$ as de,R as N,a1 as j,aP as U,b4 as M,a4 as X,_ as A,G as _,U as Z,a6 as me,f as ye,K as Y,I as he,H as be,T as H,a2 as V,aW as fe,aR as ge,bz as xe,ba as ve,bA as ee,i as D,W as Q,bB as ke,bC as Se,bD as te,bE as Ce,bF as je,bb as Ee,bG as Te,bH as Le,bI as Ae,ai as we}from"./main.js";import{t as F}from"./glossaryThunks.js";import{g as Pe}from"./hasParentProperty.js";import{A as Oe}from"./TagTable.js";const Ge=ne(r.jsx("path",{d:"M12 2C6.47 2 2 6.47 2 12s4.47 10 10 10 10-4.47 10-10S17.53 2 12 2"}),"Circle"),Me=(t,e)=>{try{const a=localStorage.getItem(t);return a?JSON.parse(a):null}catch(a){return console.error("Error getting local storage item:",a),e??null}},Re=(t,e)=>{try{localStorage.setItem(t,JSON.stringify(e))}catch(a){console.error("Error setting local storage item:",a)}},Be=t=>{try{localStorage.removeItem(t)}catch(e){console.error("Error removing local storage item:",e)}},Ne=t=>({get:e=>Me(t,e),set:e=>Re(t,e),remove:()=>Be(t)}),z=(t,e)=>{const a=W(),l=B(se(t,e)),i=B(oe(t,e)),d=B(q(t));console.log(d),p.useEffect(()=>{!i&&(l!=null&&l.entryType)&&a(F.getEntryById({node:l}))},[a,e,t,l==null?void 0:l.entryType,i]);const s=p.useCallback(u=>{a(F.updateEntryById({glossaryId:t,entryId:e,content:u}))},[a,t,e]),x=p.useCallback(({subModel:u,keypath:T,data:w,tabId:G})=>{console.log(G,"tabId in updateSubModel"),a(F.updateEntrySubModelById({glossaryId:t,entryId:e,subModel:u,keypath:T,data:w,tabId:G}))},[a,t,e]),v=p.useCallback((u,T)=>a(F.getOptionsByProperty({glossaryId:t,entryId:e,property:u,inheritanceMap:T})),[t,e]),k=u=>B(ie(t,e,u)),m=u=>{i[u]||a(F.getEntrySubModel({glossaryId:t,entryId:e,entryType:l.entryType,subModel:u}))},b=Ne(`${t}-${e}`),n=p.useCallback(()=>b.get(),[t,e]),y=p.useCallback(u=>{b.set(u)},[t,e]),o=p.useCallback(()=>{b.remove()},[t,e]),h=p.useCallback(()=>{const u=b.get();if(!u)return!1;const T=new Date((i==null?void 0:i.updatedAt)||0);return new Date((u==null?void 0:u.updatedAt)||0)>T},[t,e]);return{node:l,entry:i,buildOptionsByKeypath:v,getOptionsByKeypath:k,updateGlossaryEntry:s,getLocalStorage:n,setLocalStorage:y,clearLocalStorage:o,localIsNewer:h,getSubModel:m,updateSubModel:x}},De=({tab:t,editComponent:e,editComponentProps:a,previewComponent:l,previewComponentProps:i})=>{const d=W(),{showModal:s,closeModal:x}=ce(),{tool:v,id:k,mode:m,side:b,tabId:n,glossaryId:y,tabType:o}=t,h=g=>{const C=j.cloneDeep(t.viewState.lastSaved||{});C[g]=new Date().toISOString(),d(U({tabId:n,side:b,keypath:"viewState.lastUpdated",updates:C}))};if(!y)return null;const{node:u,entry:T}=z(y,k),w=B(pe(y)),G=p.useMemo(()=>u?Pe({node:u,nodeStructure:w}):{},[u,w]),{splitSize:R,soloSize:f,splitTabs:S}=ue(),c=p.useMemo(()=>({tab:t,tool:v,id:k,mode:m,side:b,tabId:n,glossaryId:y,entry:T,node:u,inheritanceMap:G,updateLastSaved:h,showModal:s,closeModal:x}),[t,v,k,m,b,n,y,T,h,s,x,u,G]);return T?r.jsx(de.Provider,{value:c,children:r.jsx(J,{variant:S?R?"default":"blend":f?"blend":"default",tabType:"glossary",mode:m,children:m==="edit"&&e?N.createElement(e,{...a}):m==="preview"&&l?N.createElement(l,{...i}):r.jsx("div",{style:{padding:"16px"},children:"Yo shit is busted, bruh"})})}):r.jsx(J,{mode:m,variant:"default",children:"Loading..."})},ae=({multiple:t=!0,subModel:e,label:a,keypath:l,alphabetizeOptions:i=!0,hasPrimary:d=!1,placeholder:s})=>{const{glossaryId:x,id:v,inheritanceMap:k,tabId:m}=M();if(!x)return null;const{entry:b,updateSubModel:n,getOptionsByKeypath:y,buildOptionsByKeypath:o}=z(x,v),h=y(l);p.useEffect(()=>{h||o(l,k)},[l,h]);const[u,T]=N.useState(d?"Aymaq":""),w=N.useRef(null);function G(c,g){const C=new Map,L={inherited:1,nearby:2,extended:3,other:4};for(const E of Object.keys(L))for(const P of c[E]??[]){const K=(Array.isArray(P[g]),P[g]);if(K)for(const $ of K)if(C.has($)){const I=C.get($);I.sources.push({id:P.id,name:P.name,relationship:E});const le=L[E],re=L[I.group];console.log(le,re,"tier and existingTier"),L[E]<L[I.group]&&(console.log("Updating group for",$,"from",I.group,"to",E),I.group=E)}else C.set($,{value:$,label:$,group:E,sources:[{id:P.id,name:P.name,relationship:E}]})}return[...C.values()].map(E=>({...E,label:j.capitalize(E.label),group:j.capitalize(E.group)}))}p.useMemo(()=>h?Object.entries(h).flatMap(([c,g])=>g.map(C=>({label:j.capitalize(C[l]),value:C[l],group:j.capitalize(c),meta:{id:C.id[0],name:C.name}}))):[],[h,l]);const R=c=>{var g;Array.isArray(c)&&(d&&(c.includes(u)||(c=[u,...c])),c=c.map(C=>C.trim().toLowerCase())),n({subModel:e,keypath:l,data:c,tabId:m}),t&&((g=w.current)==null||g.focus())},f=h?G(h,l):[],S=p.useMemo(()=>{var c,g;return(g=(c=b==null?void 0:b[e])==null?void 0:c[l])==null?void 0:g.map(C=>({label:j.capitalize(C)}))},[b,e,l]);return b[e]?r.jsx(X,{freeSolo:!0,disablePortal:!0,multiple:t,options:f,groupBy:c=>c.group,value:S??[],disableCloseOnSelect:t,onChange:(c,g)=>{g===null?R(t?[]:""):Array.isArray(g)?R(g.map(C=>C.label)):R([g.label])},renderInput:c=>r.jsx(Y,{...c,inputRef:w,label:a,variant:"outlined",fullWidth:!0,slotProps:{inputLabel:{shrink:!0}}}),renderTags:(c,g)=>c.map((C,L)=>p.createElement(me,{label:C,...g({index:L}),key:C.value,sx:{mr:.5,mb:.5,backgroundColor:E=>ye(E.palette.primary.main,E.palette.mode==="dark"?.5:.9),color:"primary.contrastText"}})),blurOnSelect:!t,getOptionLabel:c=>{var g;return((g=c[0])==null?void 0:g.label)||""},renderOption:(c,g,{selected:C})=>{const L=g.value===u,P=C&&!L;return p.createElement(A,{component:"li",...c,key:g.value,sx:{display:"flex",alignItems:"center",justifyContent:"space-between",width:"100%",position:"relative"}},r.jsxs(A,{children:[t&&d&&r.jsx(_,{title:L?`This is the current primary ${l}.`:P?`Make ${g} the primary ${l}`:"",children:r.jsx("span",{children:r.jsx(Z,{checked:L,disabled:!P&&!L,onClick:K=>K.stopPropagation(),onChange:()=>T(g),disableRipple:!0,tabIndex:-1,sx:{mr:1}})})}),j.capitalize(g.label)]}))}}):r.jsx("div",{children:"Loading..."})},ze=[{name:"Geography",children:[{multiple:!1,component:ae,keypath:"climates"},{multiple:!0,keypath:"terrain"},{multiple:!0,keypath:"regions"}]},{name:"Politics",children:[{multiple:!0,keypath:"nations",label:"Nations"},{multiple:!0,keypath:"settlements",label:"Settlements"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"resources",label:"Resources"},{multiple:!1,keypath:"population",label:"Population"}]},{name:"History",children:[{multiple:!0,keypath:"events",label:"Event Log"},{multiple:!1,keypath:"history",label:"History"}]}],O=t=>t,$e=O([{name:"Geography",children:[{multiple:!1,keypath:"climates",label:"Climates",hasPrimary:!0},{multiple:!0,keypath:"terrain",label:"Terrain"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"landmarks",label:"Landmarks"}]},{name:"Political",children:[{multiple:!0,keypath:"nations",label:"Nations",hasPrimary:!0},{multiple:!0,keypath:"factions",label:"Factions",hasPrimary:!1},{multiple:!1,keypath:"population",label:"Population"},{multiple:!0,keypath:"resources",label:"Resources"}]}]),Fe=O([{name:"Government",children:[{multiple:!0,keypath:"capital",label:"Capital"},{multiple:!1,keypath:"governmentType",label:"Government Type"},{multiple:!1,keypath:"population",label:"Population"},{multiple:!0,keypath:"notableFigures",label:"Notable Figures"},{multiple:!1,keypath:"culture",label:"Culture"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"languages",label:"Languages"},{multiple:!1,keypath:"economy",label:"Economy"},{multiple:!0,keypath:"resources",label:"Resources"}]},{name:"Geography",children:[{multiple:!0,keypath:"continent",label:"Continents"},{multiple:!0,keypath:"regions",label:"Regions"},{multiple:!0,keypath:"geography",label:"Landmarks"}]},{name:"History",children:[{multiple:!1,keypath:"history",label:"History"},{multiple:!0,keypath:"notableEvents",label:"Notable Events"},{multiple:!0,keypath:"flags",label:"Flags"}]}]),He=O([{name:"Geography",children:[{multiple:!0,keypath:"terrain",label:"Terrain"},{multiple:!0,keypath:"locations",label:"Locations"},{multiple:!0,keypath:"landmarks",label:"Landmarks"}]},{name:"Political",children:[{multiple:!0,keypath:"nations",label:"Nations"},{multiple:!0,keypath:"resources",label:"Resources"},{multiple:!1,keypath:"population",label:"Population"},{multiple:!0,keypath:"people",label:"People"}]},{name:"History",children:[{multiple:!0,keypath:"eventLog",label:"Event Log"}]}]),Ie=O([{name:"Geography",children:[{multiple:!1,keypath:"climates",label:"Climate"},{multiple:!0,keypath:"regions",label:"Region",hasPrimary:!0},{multiple:!1,keypath:"geographicType",label:"Type"}]},{name:"Notes",children:[{multiple:!1,keypath:"notes",label:"Notes"}]}]),Ue=O([{name:"Geopolitical",children:[{multiple:!0,keypath:"nation",label:"Nation"},{multiple:!0,keypath:"region",label:"Region"},{multiple:!1,keypath:"population",label:"Population"}]},{name:"Government",children:[{multiple:!1,keypath:"government",label:"Government"},{multiple:!1,keypath:"type",label:"Settlement Type"},{multiple:!1,keypath:"economy",label:"Economy"},{multiple:!1,keypath:"culture",label:"Culture"},{multiple:!0,keypath:"people",label:"Notable Figures"}]},{name:"History",children:[{multiple:!0,keypath:"events",label:"Notable Events"},{multiple:!0,keypath:"locations",label:"Notable Locations"},{multiple:!1,keypath:"history",label:"History"}]}]),We=O([{name:"Roster",children:[{multiple:!0,keypath:"leader",label:"Leader"},{multiple:!0,keypath:"homeBase",label:"Home Base"},{multiple:!0,keypath:"members",label:"Members"}]},{name:"Geopolitical",children:[{multiple:!0,keypath:"nations",label:"Nations"},{multiple:!0,keypath:"regions",label:"Regions"}]},{name:"Relationships",children:[{multiple:!0,keypath:"allies",label:"Allies"},{multiple:!0,keypath:"enemies",label:"Enemies"}]}]),Ke=O([{name:"Profession",children:[{multiple:!1,keypath:"occupation",label:"Occupation"},{multiple:!1,keypath:"title",label:"Title"}]},{name:"Background",children:[{multiple:!0,keypath:"traits",label:"Traits"},{multiple:!0,keypath:"faction",label:"Faction"},{multiple:!1,keypath:"history",label:"History"}]},{name:"Details",children:[{multiple:!0,keypath:"location",label:"Location"},{multiple:!1,keypath:"appearance",label:"Appearance"},{multiple:!1,keypath:"events",label:"Events"}]}]),qe=O([{name:"Details",children:[{multiple:!1,keypath:"locationType",label:"Type"},{multiple:!0,keypath:"currentOccupants",label:"Current Occupants"},{multiple:!0,keypath:"resources",label:"Resources"}]},{name:"History",children:[{multiple:!0,keypath:"eventLog",label:"Event Log"}]}]),_e=O([{name:"Details",children:[{multiple:!1,keypath:"type",label:"Type"},{multiple:!1,keypath:"priority",label:"Priority"},{multiple:!1,keypath:"dueDate",label:"Due Date"},{multiple:!0,keypath:"sharedWith",label:"Shared With"}]}]),Ye=O([{name:"Details",children:[{multiple:!1,keypath:"significance",label:"Significance"},{multiple:!1,keypath:"gameDate",label:"Game Date"},{multiple:!0,keypath:"location",label:"Location"},{multiple:!1,keypath:"frequency",label:"Frequency"}]},{name:"Related",children:[{multiple:!0,keypath:"relatedEntries",label:"Related Entries"}]}]),Je={continent:ze,territory:$e,domain:Fe,province:He,landmark:Ie,settlement:Ue,faction:We,person:Ke,location:qe,note:_e,event:Ye};function Ve(t){return[...t].sort((e,a)=>e.localeCompare(a))}const Qe=({multiple:t=!0,subModel:e,label:a,keypath:l,options:i,alphabetizeOptions:d=!0,hasPrimary:s=!1,placeholder:x})=>{const{glossaryId:v,id:k}=M();if(!v)return null;const[m,b]=N.useState(""),{entry:n,updateSubModel:y}=z(v,k),[o,h]=N.useState(s?"Aymaq":""),u=N.useRef(null),T=p.useMemo(()=>{let f=i.filter(S=>n[l]?Array.isArray(n[l])?!n[l].some(c=>c.toLowerCase()===S.toLowerCase()):n[l].toLowerCase()!==S.toLowerCase():!0);return d?Ve(f).map(S=>S):f.map(S=>j.capitalize(S))},[i]),w=p.useMemo(()=>{if(!n[l])return[];const f=Array.isArray(n[l])?n[l]:[n[l]];return[o,...f.filter(S=>S.toLowerCase()!==o)]},[n,l,o]),G=f=>{var S;if(t){const c=[...Array.isArray(n[e][l])?n[e][l]:n[e][l]?[n[e][l]]:[],f].flat();y({subModel:e,keypath:l,data:c}),t&&((S=u.current)==null||S.focus());return}else y({subModel:e,keypath:l,data:f})},R=f=>{let S=[];Array.isArray(n[e][l])?S=n[e][l]:typeof n[e][l]=="string"&&(S=[n[e][l]]);const c=S.filter(g=>g.toLowerCase()!==f.toLowerCase());y({subModel:e,keypath:l,data:c})};return r.jsxs(A,{sx:{display:"flex",flexDirection:"column",width:"100%",my:2},children:[r.jsx(X,{options:T,freeSolo:!0,disableCloseOnSelect:!0,value:null,inputValue:m,blurOnSelect:!1,clearOnBlur:!0,onInputChange:(f,S)=>b(S),onChange:(f,S)=>{S&&G(S),b(""),setTimeout(()=>{var c;return(c=u.current)==null?void 0:c.focus()})},renderInput:f=>r.jsx(Y,{...f,inputRef:u,placeholder:`Search for ${a}â€¦`,variant:"outlined",fullWidth:!0}),clearOnEscape:!0,selectOnFocus:!0,handleHomeEndKeys:!0,getOptionLabel:f=>j.capitalize(f),renderOption:(f,S)=>p.createElement(A,{component:"li",...f,key:S,sx:{px:1}},j.capitalize(S))}),r.jsx(A,{children:t?w.length>0?r.jsx(A,{sx:{display:"flex",flexDirection:"column",gap:.5,mt:1},children:w.map((f,S)=>r.jsxs(A,{sx:{display:"flex",alignItems:"center",justifyContent:"start",width:"100%",position:"relative"},children:[r.jsx(he,{onClick:()=>R(f),disabled:o===f.toLowerCase(),children:r.jsx(be,{sx:{color:o===f.toLowerCase()?"transparent":"inherit"}})}),s&&r.jsx(_,{title:`Click to set ${f} as primary`,placement:"auto",children:r.jsx(Z,{checked:o===f.toLowerCase(),onChange:()=>{o!==f&&h(f.toLowerCase())},disabled:o===f.toLowerCase(),sx:{mr:2}})}),r.jsx(H,{children:j.capitalize(f)})]},f))}):r.jsxs(A,{sx:{textAlign:"left",mt:1,ml:4,color:"text.secondary",fontStyle:"italic"},children:["No ",a," selected"]}):r.jsx(A,{sx:{mt:1,color:"text.secondary",fontStyle:"italic"},children:n[l]?`Selected: ${j.capitalize(n[e][l])}`:`No ${{label:a}} selected`})})]})};function Xe({glossaryId:t,subModel:e,entryId:a,tabId:l}){return async(i,d)=>{var s;try{const x=d(),v=x.glossary.glossaries.edit.byId[t],k=x.glossary.glossaries.static.byId[t];if(!k||!v){i(V({message:"Glossary not found.",type:"error",duration:3e3}));return}const m=x.tabs.left.data[l]||x.tabs.right.data[l],b=Object.keys(((s=m==null?void 0:m.viewState)==null?void 0:s.dirtyKeypaths)||{}).map(n=>{if(!n.startsWith(`entries.${a}.${e}.`))return null;const y=j.get(k,n),o=j.get(v,n),h=n.split(".").pop();if(o===void 0)return{key:h,value:null};if(y!==o)return{key:h,value:o};if(y===o)return null}).filter(n=>n!==null);if(b.length>0){const n={};b.forEach(y=>{const{key:o,value:h}=y;n[o]=h}),await fe.updateEntrySubModel({id:a,subModel:e,updates:n}),i(ge({tabId:l,key:`entries.${a}.${e}`})),i(xe({glossaryId:t,entryId:a,subModel:e}))}}catch{i(V({message:"Error updating glossary entry. Try again later.",type:"error",duration:3e3}))}}}function Ze({glossaryId:t,subModel:e,entryId:a,tabId:l,name:i}){const d=W();return{name:i,batchSaveFn:async()=>{d(Xe({glossaryId:t,subModel:e,entryId:a,tabId:l}))},intervalMs:5e3}}const et=({subModel:t,propertyMap:e})=>{const a=p.useRef(!1),{glossaryId:l,id:i,tab:d}=M(),{entry:s,getSubModel:x}=z(l,i),v=B(q(l));p.useEffect(()=>{!s[t]&&!a.current&&(a.current=!0,x(t))},[s,t]),ve(Ze({glossaryId:l,subModel:t,entryId:i,tabId:d.tabId,name:`${d.name} - ${t}`}));const k=p.useMemo(()=>[...e],[e]);return r.jsx(r.Fragment,{children:k.map(m=>{const{label:b}=ee({glossary:v,subModel:t,key:m.keypath});return m.multiple?r.jsx(Qe,{subModel:t,multiple:!0,keypath:m.keypath,options:[],label:b},m.keypath):r.jsx(ae,{subModel:t,multiple:!1,keypath:m.keypath,options:[],label:b},m.keypath)})})},tt=({label:t,value:e,onSave:a,style:l={}})=>{const[i,d]=p.useState(e),[s,x]=p.useState(!1),v=i!==e;p.useEffect(()=>{d(e)},[e]);const k=()=>{a(i)},m=b=>{d(b.target.value)};return r.jsxs(D,{sx:{display:"flex",alignItems:"center",gap:2,...l},children:[r.jsx(Y,{label:t,variant:"outlined",value:i,onChange:m,disabled:!s,fullWidth:!0,slotProps:{input:{endAdornment:s?r.jsx(Ge,{sx:{color:v?"error.main":"transparent",fontSize:".75rem"}}):null}}}),r.jsx(Q,{variant:"contained",onClick:()=>{s&&k(),x(!s),s&&v&&d(e)},children:s?"Save":"Edit"}),r.jsx(Q,{variant:"outlined",disabled:!s,onClick:()=>{d(e),x(!1)},children:"Cancel"})]})},at=j.debounce((t,e,a)=>{t({description:e,dataString:a.trim()})},1e3),lt=j.debounce((t,e)=>{t(e)},1e3),rt=({keypath:t,minHeight:e="300px",maxHeight:a="1015px",style:l={}})=>{var n,y;ke();const{entry:i,tab:d,updateLastSaved:s}=M(),{updateGlossaryEntry:x}=z(d.glossaryId,d.id),v=((y=(n=d==null?void 0:d.viewState)==null?void 0:n.lastUpdated)==null?void 0:y[t])||null,[k,m]=p.useState(i[t]||""),b=(o,h)=>{at(x,o,h),lt(s,t)};return r.jsxs(D,{sx:{display:"flex",flexDirection:"column",boxSizing:"border-box",border:"1px solid",borderColor:"divider"},children:[r.jsx(D,{className:"shell-editor",sx:{boxSizing:"border-box",display:"flex",flexDirection:"column",position:"relative",minHeight:e,maxHeight:a,overflowY:"scroll",height:"100%",...l},children:r.jsx(Se,{slotBefore:r.jsx(Ce,{}),extensions:te,content:k,onUpdate:o=>{const h=o.editor.getHTML(),u=o.editor.getText();m(h),b(h,u)}})}),v&&r.jsxs(H,{variant:"caption",sx:{width:"100%",backgroundColor:o=>o.palette.mode==="dark"?"secondary.main":"secondary.light",borderTop:"1px solid",borderColor:"divider",color:o=>o.palette.mode==="dark"?"text.primary":"secondary.contrastText"},children:["Last Saved: ",je(v)]})]})},nt=()=>{const{glossaryId:t,id:e,tabId:a,side:l,mode:i}=M(),{updateGlossaryEntry:d,node:s}=z(t,e),x=W(),[v,k]=p.useState(s.name||""),m=p.useRef(!1);p.useEffect(()=>{v!==s.name&&(m.current=!0,d({name:v}),x(U({tabId:a,side:l,keypath:"name",updates:v})))},[v,x,a,l]),p.useEffect(()=>{if(m.current){m.current=!1;return}v!==s.name&&(k(s.name),x(U({tabId:a,side:l,keypath:"name",updates:s.name})))},[s.name]);const b=n=>{k(n),x(U({tabId:a,side:l,keypath:"name",updates:n})),x(F.renameNodeAndEntry({node:s}))};return r.jsxs(r.Fragment,{children:[r.jsx(tt,{label:"Entry Title",value:v,onSave:b,style:{width:"100%",mb:2}}),r.jsx(rt,{keypath:"description",maxHeight:"500px"}),r.jsx(Oe,{})]})},st={Overview:nt},ot=[{name:"Overview",key:"overview",disabled:!1,props:{keypath:"description"}},{name:"Backlinks",key:"backlinks",disabled:!1,props:{propertyMap:[]}}],it=({propertyMap:t})=>{var b,n;const e=W(),{tab:a}=M(),l=B(q(a.glossaryId)),[i,d]=p.useState(((b=a==null?void 0:a.viewState)==null?void 0:b.activeTab)||"Overview"),[s,x]=p.useState(((n=a==null?void 0:a.viewState)==null?void 0:n.activeIndex)||0),v=p.useMemo(()=>a.side==="right"?"secondary":"primary",[a.side]);p.useEffect(()=>()=>{const y={...a.viewState,activeTab:i,activeIndex:s};e(U({tabId:a.tabId,side:a.side,keypath:"viewState",updates:y}))},[i,s]);const k=p.useMemo(()=>{const y=t.map(h=>({name:ee({glossary:l,subModel:h.name.toLowerCase(),key:`${j.capitalize(h.name)} Name`}).label,key:h.name,disabled:!1,props:{subModel:h.name.toLowerCase(),propertyMap:h.children}}));return ot.toSpliced(1,0,...y)},[t,l.integrationState]),m=p.useMemo(()=>k.reduce((y,o)=>(y[o.name]=st[o.name]||et||(()=>null),y),{}),[k]);return p.useEffect(()=>{var y,o,h;k.findIndex(u=>u.name===i)===-1&&d(((y=k[s])==null?void 0:y.name)??((h=k[(o=a==null?void 0:a.viewState)==null?void 0:o.activeIndex])==null?void 0:h.name)??"Overview")},[k,i]),r.jsx(Ee,{tabs:k,componentMap:m,activeTab:i,handleTabClick:(y,o)=>{d(y),x(o)},lastIndex:s,color:v})},ct=({height:t="100%"})=>{const{glossaryId:e,id:a,mode:l,side:i}=M(),{node:d}=z(e,a);return r.jsx(it,{propertyMap:Je[d.entryType]})},pt=({content:t})=>{const e=Te({extensions:te,content:t,editable:!1});return r.jsx(A,{sx:{width:"100%",maxHeight:"calc(100vh - 200px)",overflowY:"auto",borderRadius:2},children:r.jsx(Le,{editor:e})})},ut=({keypath:t,header:e})=>{const{entry:a}=M();return r.jsxs(D,{sx:{display:"flex",justifyContent:"start",alignItems:"start",mt:2,width:"100%",flexDirection:"column"},children:[r.jsx(H,{sx:{fontSize:"1.25rem",width:"100%",borderBottom:"1px solid",borderColor:"divider",textAlign:"left",fontWeight:600},children:e}),r.jsx(H,{sx:{fontSize:"1.1rem",width:"100%",textAlign:"left",ml:2},children:Array.isArray(a[t])?a[t].map(l=>j.capitalize(l)).join(", "):j.capitalize(a[t])||"No data available"})]})},dt={nations:"Nations",regions:"Regions",locations:"Locations",resources:"Resources",population:"Population",climate:"Climate",terrain:"Terrain",capital:"Capital",languages:"Languages",persons:"Persons",eventLog:"Event Log",geography:"Geography",type:"Type",region:"Regions",landmark:"Landmark",settlement:"Settlement",faction:"Faction",person:"Person",event:"Event",note:"Note"},mt=({keypathArray:t})=>r.jsxs(D,{sx:{width:"100%",p:2,borderLeft:"1px solid",borderColor:"divider"},children:[r.jsx(D,{sx:{width:"100%",display:"flex",justifyContent:"start",alignItems:"center",borderBottom:"1px solid",borderColor:"primary.main",flexWrap:"wrap"},children:Ae.map(e=>{const a=(Math.random()*(10*Math.random())).toFixed(0),l=a==="1"?"Backlink":"Backlinks";return Number(a)<1?null:r.jsx(_,{title:`${a} ${j.capitalize(e)} ${l}`,children:r.jsxs(D,{sx:{display:"flex",flexDirection:"column",alignItems:"center",p:1,cursor:"pointer"},children:[we[e],r.jsxs(H,{variant:"body2",sx:{mt:.5},children:["(",a,")"]})]})},e)})}),t.map(e=>r.jsx(ut,{keypath:e,header:dt[e]},e))]}),yt={continent:["nations","regions","locations","resources","population","climate","terrain"],territory:[],domain:["continent","regions","capital","population","languages","persons","eventLog","locations","geography"],province:[],landmark:["region","climate","type"],settlement:[],faction:[],location:["terrain","climate","type","region"],person:[],event:[],note:[]},ht=()=>{const{entry:t,node:e}=M(),{entryType:a}=e;return r.jsxs(A,{sx:{display:"grid",height:"100%",width:"100%",gridTemplateColumns:"2fr 1fr"},children:[r.jsxs(A,{sx:{width:"100%",py:2,borderColor:"divider",display:"flex",flexDirection:"column"},children:[r.jsx(H,{variant:"h2",sx:{mb:2},children:t.name}),r.jsx(pt,{content:t.description})]}),r.jsx(mt,{keypathArray:yt[a]})]})},vt=({tab:t})=>r.jsx(De,{tab:t,editComponent:ct,editComponentProps:{},previewComponent:ht,previewComponentProps:{}});export{vt as default};
