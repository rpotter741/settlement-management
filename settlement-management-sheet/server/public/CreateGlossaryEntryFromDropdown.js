import{bc as M,bk as U,a2 as C,bl as F,am as R,bm as D,bn as q,bo as K,bp as W,a3 as $,as as H,u as J,ah as G,aG as Q,r as o,az as X,bq as Y,j as t,B as j,T as N,O as I,a5 as k,W as Z,a as L,v as _,ag as O}from"./main.js";function V(r){return["person","location","lore","event"].includes(r)}function z({node:r,sourceId:c,keypath:p,newTab:g}){return async(s,h)=>{const{id:v,name:S,entryType:m,parentId:f,glossaryId:n,fileType:A,subTypeId:y}=r,i=h();try{const u=await M.createNodeAndEntry({entryData:{...r,subTypeId:y}}),{entry:a,node:T}=u;s(U({glossaryId:n,nodeId:T.id,nodeData:C.cloneDeep(T)})),s(F({glossaryId:n,entryId:a.id,entryData:C.cloneDeep(a)})),f&&s(R({glossaryId:n,nodeId:f,expanded:!0}));const d=`${p}.value`,x=i.glossary.glossaries.edit.byId[n].entries[c],b=C.get(x,d);Array.isArray(b)?s(D({glossaryId:n,entryId:c,content:{[d]:[...b,a.id]}})):s(D({glossaryId:n,entryId:c,content:{[d]:a.id}})),g&&s(q({name:a.name,mode:"edit",tool:a.entryType,id:a.id,tabId:a.id,scroll:0,preventSplit:!1,glossaryId:n,tabType:"glossary"})),s(K({id:"smart-link-spawner",data:{data:{entryId:a.id,glossaryId:n}},status:"complete",sourceId:"createAndAppendEntryThunk"}))}catch(u){console.error("Error adding node:",u),s(W({glossaryId:n,nodeId:v})),s($({message:"Error adding entry. Try again later.",type:"error",duration:3e3}))}}}const ne=({sourceId:r,keypath:c,property:p,glossaryId:g,newEntryName:s})=>{const{getPropertyLabel:h}=H(),{closeModal:v}=J(),S=G(Q),[m,f]=o.useState(s||"Untitled"),[n,A]=o.useState({name:h(p.shape.relationship[0]).label??"",value:p.shape.relationship[0]}),y=o.useMemo(()=>[...S].filter(e=>e.entryType===n.value).map(e=>({name:e.name,value:e.id})),[S,n.value]);o.useEffect(()=>{y.length>0?x(y[0]):x(null)},[y]);const[i,u]=o.useState(null),[a,T]=o.useState(!0),[d,x]=o.useState(y[0]||null),b=G(X(g??""))||[],E=o.useMemo(()=>Y(b,n.value).map(e=>({value:e.id,name:e.name,entryType:e.entryType})),[b,n.value]),B=[...E,{value:null,name:"None",entryType:null}];o.useEffect(()=>{E.length>0&&i===null&&u(E.find(e=>e.value===r)||null)},[E,i,r]);const P=()=>{if(!d)return;const e=_(),l=i==null?void 0:i.value,w={id:e,parentId:l??null,name:m||"Untitled",entryType:n.value,subTypeId:d.value,glossaryId:g};V(n.value)?O(z({node:{...w,fileType:"detail"},sourceId:r,keypath:c,newTab:a})):O(z({node:{...w,fileType:"section"},sourceId:r,keypath:c,newTab:a})),v()};return t.jsxs(j,{sx:{gap:2,display:"flex",flexDirection:"column"},children:[t.jsx(N,{variant:"h6",sx:{width:"100%",textAlign:"center"},children:"Link New Glossary Entry"}),t.jsx(I,{label:"Entry Name",sx:{width:"100%",mt:2},value:m,onChange:e=>f(e.target.value),placeholder:"Untitled",slotProps:{inputLabel:{shrink:!0}}}),t.jsxs(j,{sx:{display:"flex",gap:2,alignItems:"center"},children:[t.jsx(k,{disabled:p.shape.relationship.length<=1,value:n,options:p.shape.relationship.map(e=>({name:h(e).label||e,value:e})),getOptionLabel:e=>e.name,renderInput:e=>t.jsx(I,{...e,label:"Entry Type"}),onChange:(e,l)=>{A(l||{name:"",value:""})},sx:{flex:1}}),t.jsx(k,{value:d,options:y,getOptionLabel:e=>e.name,renderInput:e=>t.jsx(I,{...e,label:"Sub-Type"}),onChange:(e,l)=>{x(l||null)},sx:{flex:1}})]}),t.jsx(k,{value:i,options:B,getOptionLabel:e=>e.name,renderInput:e=>t.jsx(I,{...e,label:"Parent Entry"}),onChange:(e,l)=>{u(l||null)}}),t.jsxs(j,{sx:{display:"flex",alignItems:"center",gap:2,px:6,fontSize:"1.1rem"},children:[t.jsxs(N,{variant:"body1",fontSize:"1.1rem",children:["Open"," ",t.jsx(N,{variant:"body1",color:"primary",component:"span",fontSize:"1.1rem",children:m||"Untitled"})," ","in new tab?"]}),t.jsx(Z,{color:"success",checked:a,onChange:e=>T(e.target.checked)})]}),t.jsxs(j,{sx:{display:"flex",gap:2,mt:4,alignItems:"center",justifyContent:"space-between"},children:[t.jsx(L,{color:"primary",variant:"contained",onClick:()=>v(),children:"Cancel"}),t.jsx(L,{color:"secondary",variant:"contained",disabled:!n||!d||m.trim().length===0,onClick:()=>P(),children:"Create Entry"})]})]})};export{ne as default};
