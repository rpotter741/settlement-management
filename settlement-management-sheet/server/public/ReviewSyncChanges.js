import{H as T,j as s,r as m,u as H,B as f,T as j,J as R,M as F,W as L,a as M,a2 as p,ag as z,bm as D}from"./main.js";const V=T(s.jsx("path",{d:"m10 17 5-5-5-5z"}),"ArrowRight"),$=({suggestions:l,nodes:O,backlinksFrom:b,entry:w,properties:C,glossaryId:B})=>{const u=Object.fromEntries(C.map(e=>[e.id,e])),[c,v]=m.useState({}),[h,k]=m.useState({}),{closeModal:E}=H(),x=m.useMemo(()=>{const e={};return b.forEach(t=>{e[t.propertyId]||(e[t.propertyId]=[]),e[t.propertyId].push(t.targetId)}),e},[b]);m.useEffect(()=>{if(x&&Object.keys(c).length===0&&Object.keys(l).length>0){const e={},t={};Object.entries(l).forEach(([a,r])=>{t[a]===void 0&&(t[a]=!0),e[a]===void 0&&(e[a]={});const o=y(u[a]);r.forEach((n,i)=>{var d;(d=x[a])!=null&&d.includes(n.nodeId)||(o==="single"?e[a][n.nodeId]=i===0:e[a][n.nodeId]=!0)})}),v(e),k(t)}},[c,l,h]);function S(){const e=[],t={};Object.entries(c).forEach(([r,o])=>{const n=[];Object.entries(o).forEach(([i,d])=>{d&&(n.push(i),e.push(i))}),n.length>0&&(t[r]=n)});const a=p.cloneDeep(w.groups);Object.entries(t).forEach(([r,o])=>{const n=u[r];if(!n)return;const i=`${n.groupId}.properties.${r}.value`,d=p.get(a,i);if(Array.isArray(d)){const g=Array.from(new Set(d.concat(o)));p.set(a,i,g)}else p.set(a,i,o[0])}),z(D({glossaryId:B,entryId:w.id,content:{groups:a},nukedIds:e})),E()}function A(e,t){function a(){const n={};Object.keys(c[e]||{}).forEach(i=>{n[i]=i===t?!(c[e][i]??!1):!1}),v({...c,[e]:n})}function r(){var n;v({...c,[e]:{...c[e]??{},[t]:!(((n=c[e])==null?void 0:n[t])??!1)}})}y(u[e])==="single"?a():r()}return s.jsxs(f,{sx:{minHeight:750},children:[s.jsx(j,{variant:"h6",gutterBottom:!0,children:"Suggested Links"}),s.jsx(f,{sx:{maxHeight:700,overflowY:"auto"},children:Object.entries(l).map(([e,t],a)=>{const r=u[e];return Object.keys(c[e]??{}).length===0?null:s.jsxs(s.Fragment,{children:[s.jsx(R,{size:"small",onClick:()=>{k({...h,[e]:!(h[e]??!1)})},children:s.jsx(V,{sx:{transform:h[e]??!1?"rotate(90deg)":"rotate(0deg)",transition:"transform 0.2s ease"}})}),s.jsxs(j,{component:"span",children:[r.name," "]}),s.jsxs(j,{component:"span",children:["(",Object.values(c[e]??{}).filter(Boolean).length," ","/",t.filter(o=>{var n;return!((n=x[r.id])!=null&&n.includes(o.nodeId))}).length," ","Selected)"]}),s.jsx(F,{sx:{maxHeight:200,overflowY:"auto"},animate:{opacity:h[e]??!1?1:0,height:h[e]??!1?"auto":0},children:s.jsx(f,{sx:{ml:2,mb:2},children:t.map((o,n)=>{var d,g;const i=(d=c[e])==null?void 0:d[o.nodeId];return(g=x[e])!=null&&g.includes(o.nodeId)?null:s.jsxs(f,{sx:{mb:1,display:"flex",alignItems:"center",gap:2},children:[s.jsx(L,{sx:{width:32},checked:i??!1,onChange:()=>{A(e,o.nodeId)}}),s.jsx(j,{children:O[o.nodeId].name})]},o.nodeId+r.id+"resultTop")})})},e+"motionBox")]})})}),s.jsxs(f,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:3},children:[s.jsx(M,{variant:"contained",color:"success",onClick:S,children:"Link Selected"}),s.jsx(M,{variant:"contained",color:"warning",onClick:()=>{E()},children:"Cancel"})]})]})};function y(l){return l.inputType==="dropdown"?l.shape.selectType:l.inputType==="compound"?y(l.shape.left)||y(l.shape.right):null}export{$ as default};
