import{b6 as h,b7 as C,b8 as T,a1 as b,n as j,u as S,j as o,B as v,T as p,a as m,Z as B,a3 as k,b9 as I}from"./main.js";import{u as w}from"./useTools.js";import{s as E,a as F}from"./toolSelectors.js";import"./loadTool.js";async function M({tool:t,id:n,tabId:r,side:l,validationFields:e}){return async(s,d)=>{const c=d(),a=E(t,n)(c),i=F(t,n)(c);s(h({tabId:r,keypath:"mode",updates:"preview"})),(a==null?void 0:a.name)!==(i==null?void 0:i.name)&&s(h({tabId:r,keypath:"name",updates:(a==null?void 0:a.name)||"Untitled"})),s(C({tool:t,id:n})),s(T({tool:t,id:n,fields:e,refObj:a}))}}const y=["apt","action","attribute","building","category","event","gameStatus","kit","listener","settlementType","settlement","storyThread","tradeHub","upgrade"],U=({tab:t})=>{const n=b(),{removeById:r}=j(),{closeModal:l}=S(),{tool:e,id:s,side:d,name:c,tabId:a}=t,i=()=>{r(t.tabId,t.side,!1)},{edit:u}=e&&y.includes(e)?w(e,s):{edit:null},g=async()=>{if(!(!e||!u)&&y.includes(e))try{await B.saveTool({tool:e,data:u}),i(),l()}catch{localStorage.setItem(`${e}-${s}`,JSON.stringify(u)),l(),n(k({message:`Failed to save ${c} to database. Try again later.`,type:"error"}));return}},x=()=>{l()},f=()=>{n(M({tool:e,id:s,tabId:a,side:d,validationFields:I[t.tabType][e].validationFields||[]})),l(),i()};return o.jsxs(v,{sx:{p:2,textAlign:"center",minWidth:500},children:[o.jsx(p,{variant:"h6",gutterBottom:!0,children:"Unsaved Changes"}),o.jsxs(p,{variant:"body1",gutterBottom:!0,children:["You have unsaved changes. Close ",o.jsx("strong",{children:t.name})," without saving?"]}),o.jsxs(v,{sx:{mt:2},children:[o.jsx(m,{variant:"outlined",color:"success",onClick:g,children:"Save and Close"}),o.jsx(m,{variant:"outlined",color:"info",onClick:x,sx:{ml:2},children:"Cancel"}),o.jsx(m,{variant:"outlined",color:"error",onClick:f,sx:{ml:2},children:"Close Without Saving"})]})]})};export{U as default};
