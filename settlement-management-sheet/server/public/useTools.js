import{bf as T,a2 as f,ah as u,a1 as h,r as y,bR as w,b8 as m,bS as v,bB as A,aT as I}from"./main.js";import{t as i}from"./toolSelectors.js";import{l as g}from"./loadTool.js";function k({tool:e,id:s,keypath:a,updates:t}){return async(o,n)=>{var c;o(T({id:s,tool:e,keypath:a,updates:t}));const r=n(),l=r.tools[e].static.byId[s];if(!((c=r.tabs.focusedTab)==null?void 0:c.tabId)){console.warn("No focused tab found, cannot update dirty state");return}f.isEqual(f.get(l,a),t)}}const S=(e,s)=>{const a=h(),t=y.useCallback((c,b)=>{a(k({id:s,tool:e,keypath:c,updates:b}))},[a]),o=y.useCallback((c,b)=>{a(w({id:s,tool:e,keypath:c,error:b}))},[a]),n=y.useCallback(c=>{a(m({tool:e,id:s,fields:Object.keys(c),refObj:c}))},[a]),r=y.useCallback((c=!1)=>{a(v({tool:e,id:s,overwriteCurrent:c}))},[a]),l=y.useCallback(({refId:c,id:b,currentTool:E})=>{a(g({tool:e,refId:c,id:b,currentTool:E}))},[a]),d=y.useCallback(c=>{a(A({tool:e,id:s,updates:c}))},[a]);return{updateTool:t,batchUpdate:d,validateToolField:o,validateAll:n,saveToolEdit:r,loadNewTool:l}},F=(e,s)=>{const a=u(i.byId(e,s)),t=u(i.byEditId(e,s)),o=u(i.allIds(e)),n=u(i.allEditIds(e)),r=u(i.allTools(e)),l=u(i.allEditTools(e)),d=u(i.errors(e,s));return{current:a,edit:t,allIds:o,allEditIds:n,allTools:r,allEditTools:l,errors:d,selectStaticValue:p=>u(i.selectValue(e,s,p)),selectEditValue:p=>u(i.selectEditValue(e,s,p)),selectErrorValue:p=>u(i.keypathError(e,s,p)),fieldIsDirty:p=>u(i.keypathDirty(e,s,p))}},V=e=>{const s={save:async t=>{var o,n;try{return await I.post(`/tools/${e}/save`,{data:{...t,contentType:"OFFICIAL",createdBy:"Admin"},tool:e})}catch(r){throw console.error("API error:",r.message),new Error(((n=(o=r.response)==null?void 0:o.data)==null?void 0:n.message)||"Failed to save data")}},publish:async t=>{var r,l;const{refId:o,id:n}=t;try{return await I.post(`/tools/${e}/publish`,{data:{refId:o,id:n},tool:e})}catch(d){throw console.error("API error:",d.message),new Error(((l=(r=d.response)==null?void 0:r.data)==null?void 0:l.message)||"Failed to publish data")}},delete:async t=>{var n,r;const{refId:o}=t;try{return await I.post("/tools/${tool}/delete",{refId:o,tool:e})}catch(l){throw console.error("API error:",l.message),new Error(((r=(n=l.response)==null?void 0:n.data)==null?void 0:r.message)||"Failed to delete data")}}};return{runServerActions:async(t,o,n=!1)=>{var r,l;try{if(!s[t])throw new Error(`Unknown server action: ${t}`);const d=await s[t](o);if(n)return d.data}catch(d){throw console.error("API error:",d.message),new Error(((l=(r=d.response)==null?void 0:r.data)==null?void 0:l.message)||`Failed to ${t} data`)}}}},P=(e,s)=>{const a=F(e,s),t=S(e,s),o=V(e);return{...a,...t,...o}};export{P as u};
