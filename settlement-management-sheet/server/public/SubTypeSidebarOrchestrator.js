import{F as q,j as e,W as w,r as l,as as Q,av as N,aw as X,$ as G,a4 as Z,K as L,a3 as ee,i as v,T as z,ax as te,ay as M,az as se,a8 as re,aa as H,aA as oe,aB as W,aC as ae,aD as ne,I as E,am as le,J as ie,aE as ce,a7 as de,aF as ue,v as pe,aG as xe,aH as ye,aI as me,ab as he,aJ as ge,aK as fe,aL as je,a1 as be,aM as Se,aN as ve}from"./main.js";import{u as Y,G as Ce,A as ke}from"./GlossarySidePanelWrapper.js";import"./glossaryThunks.js";const De=q(e.jsx("path",{d:"M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4m-7 7H3v4c0 1.1.9 2 2 2h4v-2H5zM5 5h4V3H5c-1.1 0-2 .9-2 2v4h2zm14-2h-4v2h4v4h2V5c0-1.1-.9-2-2-2m0 16h-4v2h4c1.1 0 2-.9 2-2v-4h-2z"}),"CenterFocusStrong"),F=({subType:t,editId:a,onClick:x})=>e.jsx(w,{fullWidth:!0,sx:{mt:2},variant:t.id===a?"contained":"outlined",color:t.id===a?"success":t.createdBy==="system"?"secondary":"primary",onClick:x,children:t.name},t.id),Te=({type:t,setType:a,editId:x,onSubmit:i})=>{const[d,j]=l.useState("all"),{showModal:b}=Q(),{getPropertyLabel:u}=N(),{glossary:C}=Y(),S=l.useMemo(()=>{if(!C)return[];const r=C.templates||[];return t?Object.values(r[t]||{}):Object.keys(r)},[C,t]),D=X.map(r=>{const{label:y,defaultLabel:k}=u("system",r);return{label:y||G(k||r),value:r}}).sort((r,y)=>r.label.localeCompare(y.label)),s=()=>{if(!t)return b({entry:{id:"new-subType-id",componentKey:"NameNewSubType",props:{}}});const r=u("system",t).label||t,{subType:y}=te(r,t);i(y)},T=r=>{i(r)};return e.jsxs(e.Fragment,{children:[e.jsx(Z,{disablePortal:!0,options:D,renderInput:r=>e.jsx(L,{...r,label:"Select a Type..."}),getOptionLabel:r=>r.label||"",sx:{pt:2},value:t?{label:G(u("system",t).label||t),value:t}:null,onChange:(r,y)=>{a(y?y.value:"")}}),e.jsxs(ee,{fullWidth:!0,sx:{mt:2,mb:2},children:[e.jsx(w,{variant:"contained",onClick:()=>j("all"),size:"small",sx:{backgroundColor:d==="all"?"success.main":"secondary.main"},children:"All"}),e.jsx(w,{variant:"contained",onClick:()=>j("custom"),size:"small",sx:{backgroundColor:d==="custom"?"success.main":"secondary.main"},children:"Custom"}),e.jsx(w,{variant:"contained",onClick:()=>j("system"),size:"small",sx:{backgroundColor:d==="system"?"success.main":"secondary.main"},children:"System"})]}),e.jsxs(v,{children:[e.jsx(w,{variant:"contained",sx:{mt:2},fullWidth:!0,onClick:s,children:t?`Create ${G(u("system",t).label||t)} SubType`:"Create New Sub-Type"}),t?S.map(r=>e.jsx(F,{subType:r,editId:x,onClick:()=>T(r)},r.id)):S.map(r=>{var y;return e.jsxs(v,{children:[e.jsx(z,{variant:"h6",gutterBottom:!0,sx:{mt:2},children:G(u("system",r).label||r)}),Object.values(((y=C.templates)==null?void 0:y[r])||{}).map(k=>e.jsx(F,{subType:k,editId:x,onClick:()=>T(k)},k.id))]},r)})]})]})};function Pe({glossaryId:t,type:a,subTypeId:x,groupId:i,name:d}){M(se({glossaryId:t,type:a,subTypeId:x,groupId:i,name:d}))}const $=l.createContext({isDragging:!1,draggedType:null,draggedItem:null,startDrag:()=>{},endDrag:()=>{},lastDragged:null}),Oe=({children:t})=>{const a=re();return e.jsx($.Provider,{value:a,children:t})},we=()=>{const t=l.useContext($);if(!t)throw new Error("useSubTypePropertyDrag must be used within a SubTypePropertyDragProvider");return t},Ee=({index:t,groupId:a,hoverGroup:x,setHoverGroup:i,openRelay:d,glossaryId:j,type:b,subTypeId:u,activeGroup:C,setActiveGroup:S,activeProperty:D,setActiveProperty:s,mode:T,setGroupHoverIndex:r,groupHoverIndex:y,handleGroupReorder:k,setPropertyHoverIndex:O,handlePropertyReorder:I,propertyHoverIndex:A})=>{const c=H(oe({glossaryId:j,type:b,subTypeId:u,groupId:a})),P=l.useRef(null),{draggedType:n}=we(),[m,g]=l.useState((c==null?void 0:c.name)||""),[p,f]=l.useState(!1),[o,B]=l.useState(!0);W();const[,J]=ae({type:"sub-type-group",item:{groupId:a,index:t}}),[,U]=ne({accept:["sub-type-group","sub-type-property"],hover:()=>{r(t)},drop:h=>{h.index!==t&&k(h,t,a),r(null)}}),V=l.useCallback(()=>{S(a),s(c.propertyOrder[0]||null),d({data:{setActiveGroup:a,setActiveProperty:c.propertyOrder[0]||null},status:"complete"})},[a,S,d]),K=l.useCallback(h=>{s(h),S(a),d({data:{setActiveProperty:h,setActiveGroup:a},status:"complete"})},[a,S,d]),R=()=>{const h=pe();M(xe({glossaryId:j||"",type:b,subTypeId:u,groupId:c.id,property:{id:h,name:"Untitled Property",type:"text",value:""}}))};return J(U(P)),c?e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{py:2,width:"100%",position:"relative"},children:[e.jsxs(v,{sx:{position:"relative",bgcolor:x===c.id||y===t?"action.hover":"inherit"},onMouseEnter:()=>i(c.id),onMouseLeave:()=>i(null),children:[e.jsx(v,{ref:P,sx:{display:"flex",alignItems:"center",gap:.5,cursor:"grab",color:C===c.id?"success.main":"text.primary",height:40},onClick:V,children:p?e.jsx(L,{variant:"standard",defaultValue:m,size:"small",fullWidth:!0,onBlur:h=>{g(h.target.value),f(!1)},autoFocus:!0,onKeyDown:h=>{h.key==="Enter"&&(g(h.target.value),Pe({glossaryId:j,type:b,subTypeId:u,groupId:c.id,name:h.target.value}),f(!1)),h.key==="Escape"&&f(!1)},sx:{ml:4,maxHeight:32,p:0}}):e.jsxs(e.Fragment,{children:[e.jsx(z,{variant:"body1",sx:{textAlign:"start",pl:4,fontSize:"1.1rem"},children:m}),e.jsxs(z,{variant:"body1",component:"span",children:["(",c.propertyOrder.length,")"]})]})}),x===c.id&&e.jsxs(e.Fragment,{children:[e.jsx(E,{size:"small",sx:{position:"absolute",top:"50%",left:0,transform:"translateY(-50%)"},onClick:()=>B(!o),children:e.jsx(le,{sx:{fontSize:"1rem"}})}),e.jsxs(v,{sx:{position:"absolute",top:"50%",right:0,display:"flex",alignItems:"center",gap:1,transform:"translateY(-50%)"},children:[e.jsx(E,{size:"small",onClick:()=>f(!0),children:e.jsx(ie,{sx:{fontSize:"1rem"}})}),e.jsx(E,{size:"small",children:e.jsx(ce,{sx:{fontSize:"1rem"}})})]})]})]}),e.jsx(de,{in:o,timeout:"auto",unmountOnExit:!0,children:c.propertyOrder.map((h,_)=>e.jsx(ue,{index:_,hoverGroup:x,setHoverGroup:i,handlePropertyClick:()=>K(h),groupId:c.id,propertyId:h,subTypeId:u,type:b,glossaryId:j,mode:T,activeProperty:D,setPropertyHoverIndex:O,handlePropertyReorder:I,propertyHoverIndex:A},h))})]}),c.propertyOrder.length<10&&e.jsx(e.Fragment,{children:e.jsx(w,{onClick:R,children:"Add Property"})})]}):null};function Ie({glossaryId:t,type:a,subTypeId:x,newOrder:i}){M(ye({glossaryId:t,type:a,subTypeId:x,newOrder:i}))}function ze({glossaryId:t,type:a,subTypeId:x,groupData:i}){M(me({glossaryId:t,type:a,subTypeId:x,groupData:i}))}const Ae=({editId:t,mode:a,setMode:x,openRelay:i,activeGroup:d,setActiveGroup:j,activeProperty:b,setActiveProperty:u})=>{const C=H(he()),[S,D]=l.useState(null),{subType:s,addGroup:T}=ge(t),[r,y]=l.useState(null),[k,O]=l.useState(null),I=(n,m,g)=>{const p=be.cloneDeep(s.groupData),f=Array.from(p[n.groupId].propertyOrder),[o]=f.splice(n.index,1);if(console.log(o,f),m)n.groupId===g&&f.splice(m,0,o);else{const B=p[n.groupId].propertyData[o];p[n.groupId].propertyOrder=f,delete p[n.groupId].propertyData[o],p[g].propertyData[o]=B,p[g].propertyOrder.splice(0,0,o)}console.log(n),ze({glossaryId:C||"",type:s.entryType,subTypeId:s.id,groupData:p})},A=(n,m,g)=>{if(console.log(n),n.propertyId)I(n,null,g);else{const p=Array.from(s.groupOrder),[f]=p.splice(n.index,1);p.splice(m,0,f),Ie({glossaryId:C||"",type:s.entryType,subTypeId:s.id,newOrder:p})}},{getPropertyLabel:c}=N(),P=n=>{x(n),i({data:{setMode:n},status:"complete"})};return l.useEffect(()=>{var g;const n=(s==null?void 0:s.groupOrder[0])||null,m=((g=s==null?void 0:s.groupData[n])==null?void 0:g.propertyOrder[0])||null;i({data:{setActiveGroup:n||null,setActiveProperty:m||null},status:"complete"}),j(n),u(m)},[s==null?void 0:s.id]),l.useEffect(()=>{var n,m,g,p;if(s&&d&&b){const f=s.groupOrder[0]||null;if((n=s.groupData)!=null&&n[d]||j(f),!((g=(m=s.groupData)==null?void 0:m[d])!=null&&g.propertyData[b])){const o=((p=s.groupData[f])==null?void 0:p.propertyOrder[0])||null;u(o)}}},[s,d,b]),s?e.jsxs(v,{children:[e.jsxs(z,{variant:"h5",sx:{mt:3},children:[s==null?void 0:s.name," Properties"]}),e.jsx(z,{variant:"caption",children:`( ${c("system",s.entryType).label} )`}),e.jsxs(v,{sx:{display:"flex",gap:0,justifyContent:"center",mt:2},children:[e.jsx(E,{size:"small",sx:{color:a==="focus"?"secondary.light":"text.primary"},onClick:()=>P("focus"),children:e.jsx(De,{fontSize:"small"})}),e.jsx(E,{sx:{color:a==="form"?"secondary.light":"text.secondary"},onClick:()=>P("form"),children:e.jsx(fe,{fontSize:"small"})}),e.jsx(E,{sx:{color:a==="preview"?"secondary.light":"text.primary"},onClick:()=>P("preview"),children:e.jsx(je,{fontSize:"small"})})]}),e.jsx(v,{sx:{maxHeight:1e3,overflowY:"auto"},children:e.jsx(Oe,{children:e.jsx(v,{sx:{mb:2},children:s.groupOrder.map((n,m)=>e.jsx(Ee,{index:m,groupId:n,hoverGroup:S,setHoverGroup:D,openRelay:i,glossaryId:C||"",type:s.entryType,subTypeId:t,activeGroup:d,setActiveGroup:j,activeProperty:b,setActiveProperty:u,mode:a,setGroupHoverIndex:y,groupHoverIndex:r,handleGroupReorder:A,setPropertyHoverIndex:O,handlePropertyReorder:I,propertyHoverIndex:k},n))})})}),s.groupOrder.length<5&&e.jsx(w,{onClick:T,children:"Add Tab"})]}):e.jsx(v,{children:"No SubType Found"})},Fe=()=>{var P,n,m,g,p,f;const{ui:t,updateUI:a}=Se(),{deselectGlossary:x}=Y(),[i,d]=l.useState(((P=t==null?void 0:t.subType)==null?void 0:P.editing)??!1),[j,b]=l.useState(((n=t==null?void 0:t.subType)==null?void 0:n.type)??""),[u,C]=l.useState(((m=t==null?void 0:t.subType)==null?void 0:m.editId)??null),[S,D]=l.useState(((g=t==null?void 0:t.subType)==null?void 0:g.mode)??"focus"),[s,T]=l.useState(((p=t==null?void 0:t.subType)==null?void 0:p.activeGroup)??null),[r,y]=l.useState(((f=t==null?void 0:t.subType)==null?void 0:f.activeProperty)??null);l.useEffect(()=>()=>{a({key:"subType",value:{activeGroup:s,activeProperty:r,mode:S,editId:u,editing:i,type:j}})},[s,r,S,u,i,j]);const k=o=>{o!=null&&o.setActiveGroup&&T(o.setActiveGroup),o!=null&&o.setActiveProperty&&y(o.setActiveProperty),o!=null&&o.setMode&&D(o.setMode)},{openRelay:O}=ve({id:"subType-sidebar-template",onComplete:k}),{getAlphaColor:I}=W(),A=()=>{i===!1?(x(),C(null)):(d(!1),b(""),D("focus"))};l.useEffect(()=>{var o;O({data:{setMode:((o=t==null?void 0:t.subType)==null?void 0:o.mode)??"focus"},status:"complete"})},[]);const c=o=>{O({data:{subType:o},status:"complete"}),d(!0),C(o.id),b(o.entryType)};return e.jsxs(Ce,{children:[e.jsxs(v,{sx:{width:"100%",display:"flex",justifyContent:"center",position:"relative"},children:[e.jsx(E,{sx:{position:"absolute",left:0,top:"50%",transform:"translateY(-50%)"},onClick:A,children:e.jsx(ke,{})}),e.jsx(z,{variant:"h6",sx:{marginLeft:2},children:"Glossary Sub-Types"})]}),e.jsxs(v,{sx:{height:"100%"},children:[e.jsx(v,{component:"aside",inert:S==="preview",children:i===!1?e.jsx(Te,{onSubmit:c,editId:u,type:j,setType:b}):e.jsx(Ae,{editId:u||"",mode:S,setMode:D,openRelay:O,activeGroup:s,setActiveGroup:T,activeProperty:r,setActiveProperty:y})}),S==="preview"&&e.jsxs(e.Fragment,{children:[e.jsx(v,{sx:{position:"absolute",height:"100%",width:"100%",zIndex:10,top:64,left:0,backgroundColor:I({color:"background",key:"paper",opacity:.7})}}),e.jsx(w,{sx:{position:"absolute",top:"45%",left:"50%",transform:"translate(-50%, -50%)",zIndex:20},variant:"contained",onClick:()=>{D("form"),O({data:{setMode:"form"},status:"complete"})},children:"Exit Preview"})]})]})]})};export{Fe as default};
