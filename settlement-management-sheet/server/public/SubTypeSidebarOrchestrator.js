import{H as Ce,j as e,ak as ve,aF as Z,B as v,a as H,T as x,r as l,ah as F,aG as ie,as as le,at as V,aH as we,Y as L,V as E,W as D,aI as ke,aJ as ce,a3 as J,aK as ue,aL as Pe,ag as U,aM as pe,aN as de,aO as Ae,aP as Ie,J as R,aQ as X,aE as xe,O as _,u as he,aR as ye,A as q,M as N,al as re,a8 as oe,N as Me,aS as Ee,aT as ee,a2 as me,aU as te,aV as se,aW as ze,aX as Ge,v as fe,aY as Le,U as De,a0 as ne,aZ as Be,a_ as We,a$ as Ye,b0 as ge,b1 as Oe,b2 as He}from"./main.js";import{u as Ne}from"./useGlossaryManager.js";const ae=Ce(e.jsx("path",{d:"m12 8-6 6 1.41 1.41L12 10.83l4.59 4.58L18 14z"}),"ExpandLess"),Fe=({subType:t,editId:s,onClick:n})=>{const c=ve[t.entryType],{getAlphaColor:a}=Z();return e.jsxs(v,{sx:{mt:2,display:"flex",alignItems:"center",justifyContent:"space-between",px:2,gap:2,borderRadius:1,backgroundColor:s===t.id?a({color:"success",key:"light",opacity:.2}):"inherit",cursor:"default"},children:[e.jsx(v,{sx:{display:"flex",alignItems:"center",gap:1,width:"10%"},children:c}),e.jsx(H,{variant:"text",sx:{textTransform:"none",textAlign:"start",width:"60%","&:hover":{backgroundColor:"action.hover"},cursor:"pointer"},onClick:n,children:e.jsx(x,{sx:{textAlign:"start",width:"100%"},variant:"caption",children:t.name})}),e.jsx(v,{sx:{width:"30%"},children:e.jsx(x,{color:"text.secondary",variant:"caption",children:t.contentType==="SYSTEM"?"System":"Custom"})})]},t.id)},Re=(t,s)=>{const[n,c]=l.useState(""),[a,d]=l.useState(null),[r,u]=l.useState([]),[i,y]=l.useState(null),[p,o]=l.useState(null),[m,k]=l.useState(null),[z,M]=l.useState(null),[I,C]=l.useState([]),[T,w]=l.useState(null),h=(P,G)=>{switch(P.preventDefault(),G){case"type":d(P.currentTarget);break;case"name":o(P.currentTarget);break;case"content":M(P.currentTarget);break}},g=()=>{d(null),o(null),M(null)},f=F(ie),S=l.useRef(f.map(P=>P.id));l.useEffect(()=>{if(S.current.length>0&&f.length-S.current.length===1){const G=[...f].filter(b=>!S.current.includes(b.id))[0];s(G),S.current=f.map(b=>b.id)}},[f,t]);const B=l.useMemo(()=>f?[...f.filter(b=>{const W=b.name.toLowerCase().includes(n.toLowerCase())||b.entryType.toLowerCase().includes(n.toLowerCase()),A=r.length===0||r.includes(b.entryType),Y=I.length===0||I.includes(b.contentType);return W&&A&&Y})].sort((b,W)=>{const A=[];i&&A.push({key:"entryType",direction:i,locale:!0}),m&&A.push({key:"name",direction:m,locale:!0}),T&&A.push({key:"contentType",direction:T,locale:!0});for(const{key:Y,direction:$,locale:K}of A){let O=0;if(K?O=b[Y].localeCompare(W[Y],void 0,{sensitivity:"base"}):O=b[Y]-W[Y],O!==0)return $==="desc"?-O:O}return 0}):[],[f,n,r,I,i,m]);return{searchTerm:n,setSearchTerm:c,typeAnchor:a,handleMenu:h,typeFilters:r,setTypeFilters:u,typeSort:i,setTypeSort:y,nameAnchor:p,nameSort:m,setNameSort:k,contentAnchor:z,contentFilters:I,setContentFilters:C,filteredSubTypes:B,closeMenu:g,contentSort:T,setContentSort:w}},Ue=({width:t,typeFilters:s,setTypeFilters:n,typeAnchor:c,handleMenu:a,closeMenu:d,typeSort:r,setTypeSort:u})=>{const i=!!c,{getPropertyLabel:y}=le();return e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"text",id:"subtype-select-type-menu-button","aria-controls":i?"subtype-select-type-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:p=>a(p,"type"),sx:{textTransform:"none",width:t,color:"text.primary",p:0},children:e.jsx(x,{variant:"caption",sx:{textAlign:"left",width:"100%"},children:"Type"})}),e.jsxs(V,{id:"subtype-select-type-menu",anchorEl:c,open:i,onClose:d,children:[e.jsx(x,{sx:{px:2,pt:1,fontWeight:"bold"},children:"Sort By Type"}),e.jsx(L,{sx:{my:1}}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Ascending"}),e.jsx(D,{size:"small",checked:r==="asc",onChange:()=>u(r==="asc"?null:"asc")})]}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Descending"}),e.jsx(D,{size:"small",checked:r==="desc",onChange:()=>u(r==="desc"?null:"desc")})]}),e.jsx(x,{sx:{px:2,pt:1,fontWeight:"bold"},children:"Filter By Type"}),e.jsx(L,{sx:{my:1}}),we.map(p=>e.jsxs(E,{onClick:()=>{s.includes(p)?n(s.filter(o=>o!==p)):n([...s,p])},sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:y(p).label||p}),e.jsx(D,{size:"small",checked:s.includes(p),onChange:()=>{s.includes(p)?n(s.filter(o=>o!==p)):n([...s,p])}})]},p))]})]})},$e=({width:t,nameAnchor:s,handleMenu:n,closeMenu:c,nameSort:a,setNameSort:d})=>{const r=!!s;return e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"text",id:"subtype-select-type-menu-button","aria-controls":r?"subtype-select-type-menu":void 0,"aria-haspopup":"true","aria-expanded":r?"true":void 0,onClick:u=>n(u,"name"),sx:{textTransform:"none",width:t,color:"text.primary",p:0},children:e.jsx(x,{variant:"caption",sx:{textAlign:"left",width:"100%"},children:"Name"})}),e.jsxs(V,{id:"subtype-select-type-menu",anchorEl:s,open:r,onClose:c,children:[e.jsx(x,{sx:{px:2,pt:1,fontWeight:"bold"},children:"Sort By Name"}),e.jsx(L,{sx:{my:1}}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Ascending"}),e.jsx(D,{size:"small",checked:a==="asc",onChange:()=>d(a==="asc"?null:"asc")})]}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Descending"}),e.jsx(D,{size:"small",checked:a==="desc",onChange:()=>d(a==="desc"?null:"desc")})]})]})]})},Ke=({width:t,contentAnchor:s,handleMenu:n,closeMenu:c,contentSort:a,setContentSort:d,contentFilters:r,setContentFilters:u})=>{const i=!!s;return e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"text",id:"subtype-select-type-menu-button","aria-controls":i?"subtype-select-type-menu":void 0,"aria-haspopup":"true","aria-expanded":i?"true":void 0,onClick:y=>n(y,"content"),sx:{textTransform:"none",width:t,color:"text.primary",p:0},children:e.jsx(x,{variant:"caption",sx:{textAlign:"left",width:"100%"},children:"Content"})}),e.jsxs(V,{id:"subtype-select-type-menu",anchorEl:s,open:i,onClose:c,children:[e.jsx(x,{sx:{px:2,pt:1,fontWeight:"bold"},children:"Sort By Content"}),e.jsx(L,{sx:{my:1}}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Ascending"}),e.jsx(D,{size:"small",checked:a==="asc",onChange:()=>d(a==="asc"?null:"asc")})]}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Descending"}),e.jsx(D,{size:"small",checked:a==="desc",onChange:()=>d(a==="desc"?null:"desc")})]}),e.jsx(x,{sx:{px:2,pt:1,fontWeight:"bold"},children:"Filter By Content"}),e.jsx(L,{sx:{my:1}}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"System"}),e.jsx(D,{size:"small",checked:r.includes("SYSTEM"),onChange:()=>{r.includes("SYSTEM")?u(r.filter(y=>y!=="SYSTEM")):u([...r,"SYSTEM"])}})]}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Custom"}),e.jsx(D,{size:"small",checked:r.includes("CUSTOM"),onChange:()=>{r.includes("CUSTOM")?u(r.filter(y=>y!=="CUSTOM")):u([...r,"CUSTOM"])}})]})]})]})};function be(){return async(t,s)=>{try{const n=s().subType.groups.edit;if(Object.keys(n).length!==0)return;const a=(await ke({system:!0})).filter(d=>!n[d.id]);t(ce({groups:a}))}catch(n){console.error("Error fetching subTypes:",n),t(J({message:"Error fetching subTypes. Try again later.",type:"error",duration:3e3}))}}}const _e=({editId:t,setEditId:s})=>{const n=F(ue(t??"")),{hoverIndex:c,setHoverIndex:a,hoverColor:d}=Pe(),[r,u]=l.useState(""),[i,y]=l.useState(null),[p,o]=l.useState([]),m=(C,T)=>{switch(C.preventDefault(),T){case"content":y(C.currentTarget);break}},k=()=>{y(null)};U(pe()),U(be());const z=F(ie),M=F(de),I=l.useMemo(()=>{const C=M.filter(T=>{const w=T.name.toLowerCase().includes(r.toLowerCase()),h=p.length===0||p.includes("system")&&T.contentType==="system"||p.includes("custom")&&T.contentType==="custom";return w&&h}).sort((T,w)=>T.name.localeCompare(w.name));return n?C.filter(T=>{var w;return!((w=n.groups)!=null&&w.some(h=>h.groupId===T.id))}):C},[M,r,p,n]);return{allSubTypes:z,searchTerm:r,filteredGroups:I,setSearchTerm:u,contentAnchor:i,contentFilters:p,setContentFilters:o,handleMenu:m,closeMenu:k,hoverIndex:c,setHoverIndex:a,hoverColor:d}},je=({index:t,handleGroupClick:s,groupId:n,hoverIndex:c,setHoverIndex:a,handleGroupReorder:d,isActive:r,handleGroupDeletion:u})=>{const i=F(Ae({groupId:n})),{getAlphaColor:y}=Z(),{ref:p}=Ie({interaction:"both",types:["subtype-group","subtype-group-reorder"],type:"subtype-group-reorder",item:{kind:"subtype-group-reorder",groupId:n,index:t},onDrop:()=>{a(null)},onHover:(k,z)=>{k.kind==="subtype-group-reorder"&&d(k,c)},index:t}),[o,m]=l.useState(!1);return i?e.jsxs(v,{ref:p,sx:{pl:2,width:"100%",display:"flex",position:"relative",maxHeight:"50px",height:"44px",my:.25,backgroundColor:r?y({color:"success",key:"dark",opacity:.2}):t%2===0?"background.default":"background.paper"},onMouseEnter:()=>m(!0),onMouseLeave:()=>m(!1),children:[e.jsxs(H,{size:"small",variant:"text",sx:{display:"flex",gap:1,alignItems:"center",color:r?"success.main":"text.primary",justifyContent:"start",width:"100%",overflow:"hidden"},onClick:()=>s(n),children:[e.jsxs(v,{sx:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",flexGrow:1,textAlign:"start"},children:[e.jsx(x,{variant:"body1",textTransform:"none",component:"span",children:i.name}),e.jsxs(x,{variant:"body2",component:"span",children:[" ","(",i.properties.length,")"]})]}),e.jsx(v,{children:e.jsx(x,{variant:"caption",sx:{color:r?"success.main":"text.secondary",mr:4},children:i==null?void 0:i.contentType})})]}),u&&e.jsx(R,{size:"small",sx:{color:"error.main",bgcolor:"transparent",position:"absolute",right:0,top:"50%",transform:"translateY(-50%)"},onClick:()=>u(n),children:e.jsx(X,{fontSize:"small",sx:{color:o?"warning.main":"transparent"}})})]}):null},Je=({editId:t,setEditId:s})=>{const{searchTerm:n,setSearchTerm:c,filteredGroups:a,hoverIndex:d,setHoverIndex:r}=_e({editId:t,setEditId:s});return e.jsxs(e.Fragment,{children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",pt:2},children:[e.jsx(x,{variant:"h6",children:"Available Groups"}),e.jsx(R,{sx:{position:"absolute",left:0},onClick:()=>{s(null)},children:e.jsx(xe,{})})]}),e.jsx(_,{fullWidth:!0,size:"small",placeholder:"Search Groups...",value:n,onChange:u=>c(u.target.value),sx:{my:1}}),a.map((u,i)=>e.jsx(je,{index:i,handleGroupClick:()=>{},groupId:u.id,hoverIndex:d,setHoverIndex:r,handleGroupReorder:()=>{}},u.id))]})},Q={icon:"10%",name:"60%",contentType:"30%"},Ve=({editId:t,setEditId:s,onSubmit:n})=>{const{showModal:c,closeModal:a}=he(),{filteredSubTypes:d,searchTerm:r,setSearchTerm:u,typeFilters:i,setTypeFilters:y,handleMenu:p,closeMenu:o,typeAnchor:m,setTypeSort:k,typeSort:z,nameAnchor:M,setNameSort:I,nameSort:C,contentAnchor:T,setContentSort:w,contentSort:h,contentFilters:g,setContentFilters:f}=Re(t,n),S=()=>c({entry:{id:"new-subType-id",componentKey:"NameNewSubType",props:{}}}),B=b=>{if(b.cancel)return a();n(b),a()},P=b=>{n(b)},{data:G}=ye({id:"create-new-subtype",onComplete:B});return e.jsxs(q,{mode:"popLayout",children:[e.jsxs(N,{layout:!0,layoutId:"subtype-creator-box",initial:{opacity:1,scaleY:1},animate:{opacity:1,scaleY:t===null?1:0,height:t===null?"auto":0},exit:{opacity:0,scaleY:0,height:0},transition:{duration:.33},children:[e.jsx(H,{variant:"contained",fullWidth:!0,onClick:S,children:"Create New Sub-Type"}),e.jsx(_,{sx:{mt:2},fullWidth:!0,size:"small",placeholder:"Search Sub-Types...",value:r,onChange:b=>u(b.target.value)}),e.jsxs(v,{sx:{display:"flex",alignItems:"center",gap:2,px:2,mt:2,width:"100%"},children:[e.jsx(Ue,{width:Q.icon,typeFilters:i,setTypeFilters:y,typeAnchor:m,handleMenu:p,closeMenu:o,typeSort:z,setTypeSort:k}),e.jsx($e,{width:Q.name,nameAnchor:M,handleMenu:p,closeMenu:o,nameSort:C,setNameSort:I}),e.jsx(Ke,{width:Q.contentType,contentAnchor:T,handleMenu:p,closeMenu:o,contentSort:h,setContentSort:w,contentFilters:g,setContentFilters:f})]})]},"subtype-creator-box"),e.jsx(L,{sx:{mt:1,borderColor:t?"transparent":"divider",transition:"border-color 0.3s ease"}}),e.jsx(N,{layoutId:"subtype-editor-subtype-list-box",initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.33},sx:{maxHeight:"calc(100vh - 280px)",overflowY:"auto",pb:4},children:!t&&d.map(b=>e.jsx(Fe,{subType:b,editId:t,onClick:()=>P(b)},b.id))},"subtype-editor-subtype-list-box"),e.jsx(N,{layoutId:"subtype-editor-group-list-box",layout:!0,initial:{opacity:t?1:0},animate:{opacity:t?1:0},transition:{duration:.4},sx:{py:0,height:"70vh",overflowY:"auto"},children:e.jsx(Je,{editId:t,setEditId:s})},"subtype-editor-group-list-box")]})},Qe=({subType:t,showModal:s})=>{const[n,c]=l.useState(!1),[a,d]=l.useState(!1),[r,u]=l.useState(!1),i=()=>{s({entry:{id:"delete-subtype-confirmation",componentKey:"DeleteSubTypeConfirmation",props:{subType:t}}})};return e.jsxs(v,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[e.jsx(L,{}),e.jsx(x,{variant:"h6",sx:{mb:2},children:`${t==null?void 0:t.name} Sub-Type Settings`}),e.jsx(x,{variant:"body2",sx:{mb:1},children:"Here you can configure various settings related to the sub-type."}),e.jsxs(v,{sx:{position:"relative"},children:[e.jsx(R,{sx:{position:"absolute",left:0,top:-4},onClick:()=>u(!r),children:r?e.jsx(ae,{}):e.jsx(re,{})}),e.jsx(x,{variant:"h6",sx:{mb:1,width:"100%",textAlign:"center"},children:"Publication Settings"}),e.jsx(L,{sx:{mb:2}}),e.jsx(oe,{in:r,timeout:"auto",unmountOnExit:!0,children:e.jsxs(v,{sx:{gap:2,display:"flex",flexDirection:"column"},children:[e.jsx(x,{variant:"body2",sx:{mb:2},children:"Published sub-types are visible to all users, while draft sub-types are only visible to editors."}),e.jsxs(v,{sx:{display:"flex",width:"100%",gap:2},children:[e.jsx(x,{variant:"body1",sx:{mb:1,width:"75%"},children:"Publication Status:"}),e.jsx(x,{color:"primary",fontWeight:"bold",sx:{width:"50%",textAlign:"center"},children:t==null?void 0:t.status})]}),(t==null?void 0:t.status)==="DRAFT"&&e.jsx(H,{variant:"contained",color:"primary",children:"Publish Sub-Type"})]})})]}),e.jsxs(v,{sx:{position:"relative"},children:[e.jsx(R,{sx:{position:"absolute",left:0,top:-4},onClick:()=>d(!a),children:a?e.jsx(ae,{}):e.jsx(re,{})}),e.jsx(x,{variant:"h6",sx:{width:"100%",textAlign:"center"},children:"Pricing"})]}),e.jsx(L,{sx:{mb:2}}),e.jsx(oe,{in:a,timeout:"auto",unmountOnExit:!0,children:e.jsxs(v,{sx:{gap:2,display:"flex",flexDirection:"column"},children:[e.jsx(x,{variant:"body2",sx:{mb:1},children:"Before or after publishing, you can set a purchase price for the sub-type. This flags it as a premium sub-type and prevents others from cloning or forking it. If you do not set a price, it will be available for free."}),e.jsx(_,{type:"number",disabled:!n,label:"Set Purchase Price",fullWidth:!0,slotProps:{inputLabel:{shrink:!0},input:{startAdornment:e.jsx(x,{sx:{mr:1},children:"$"}),endAdornment:e.jsx(R,{onClick:()=>c(!n),children:n?e.jsx(Ee,{}):e.jsx(Me,{})})}},placeholder:"0.00",sx:{mb:2}})]})}),e.jsx(H,{variant:"contained",color:"warning",onClick:i,children:"Delete Sub-Type"})]})};async function Xe({property:t}){return ee.post("/glossary/subTypes/properties",{property:t}).then(s=>s.data)}function Ze({property:t}){return async s=>{try{const n=me.cloneDeep(t);n.contentType="custom",s(te({properties:[n]})),await Xe({property:t}),s(se({scope:"subType",id:t.id,keypath:`${t.id}`}))}catch(n){console.error("Error creating subtype property:",n),s(J({message:"Error creating subtype property. Try again later.",type:"error",duration:3e3}))}}}function qe(){return async(t,s)=>{try{const n=s().subType.properties.edit;if(Object.keys(n).length!==0)return;const a=(await ze({system:!0})).filter(d=>!n[d.id]);t(te({properties:a}))}catch(n){console.error("Error fetching subTypes:",n),t(J({message:"Error fetching subTypes. Try again later.",type:"error",duration:3e3}))}}}const et=["text","date","checkbox","range","dropdown","compound"],Se=()=>{const[t,s]=l.useState(""),[n,c]=l.useState(null),[a,d]=l.useState([]),[r,u]=l.useState(null),[i,y]=l.useState(null),[p,o]=l.useState([]),[m,k]=l.useState(null),z=(g,f)=>{switch(g.preventDefault(),f){case"type":c(g.currentTarget);break;case"content":y(g.currentTarget);break}},M=()=>{c(null),y(null)};U(qe());const C=F(Ge).filter(g=>{const f=g.name.toLowerCase().includes(t.toLowerCase()),S=g.inputType.toLowerCase().includes(t.toLowerCase());return f||S}).sort((g,f)=>g.name.localeCompare(f.name)),T=l.useMemo(()=>C?[...C.filter(S=>{var W,A,Y,$,K,O;const B=S.name.toLowerCase().includes(t.toLowerCase())||S.inputType.toLowerCase().includes(t.toLowerCase()),P=a.length===0||a.includes(S.inputType),G=p.length===0||p.includes(S.contentType),b=m===null||m===!0&&S.shape.relationship||m===!1&&!S.shape.relationship||S.inputType==="compound"&&((Y=(A=(W=S.shape)==null?void 0:W.left)==null?void 0:A.shape)==null?void 0:Y.relationship)||S.inputType==="compound"&&((O=(K=($=S.shape)==null?void 0:$.right)==null?void 0:K.shape)==null?void 0:O.relationship);return B&&P&&G&&b})].sort((S,B)=>{const P=[];r&&P.push({key:"inputType",direction:r,locale:!0});for(const{key:G,direction:b,locale:W}of P){let A=0;if(W?A=S[G].localeCompare(B[G],void 0,{sensitivity:"base"}):A=S[G]-B[G],A===0)return b==="desc"?-A:A}return 0}):[],[C,t,a,p,r]);return{searchTerm:t,setSearchTerm:s,typeAnchor:n,typeFilters:a,setTypeFilters:d,typeSort:r,setTypeSort:u,contentAnchor:i,contentFilters:p,setContentFilters:o,handleMenu:z,closeMenu:M,allProperties:C,filteredProperties:T,addProperty:(g,f)=>{const S=fe(),B=Le(f,g,S);U(Ze({property:B}))},handlePropertyClick:g=>{},relationshipFilter:m,setRelationshipFilter:k}},Te=({onAdd:t,selectOptions:s,label:n})=>{const[c,a]=l.useState(!1),[d,r]=l.useState(""),[u,i]=l.useState(s[0]??"text"),[y,p]=l.useState(!1);return e.jsx(v,{tabIndex:-1,sx:{display:"flex",width:"100%",gap:c?1:0,alignItems:"center"},onBlur:o=>{if(y)return;const m=o.relatedTarget,k=o.currentTarget;(!m||m&&!k.contains(m))&&a(!1)},children:e.jsxs(q,{children:[e.jsx(N,{initial:{width:0},animate:{width:c?s.length?"50%":"90%":"0%"},transition:{duration:.25},exit:{width:0},sx:{overflow:"hidden"},children:e.jsx(_,{size:"small",placeholder:"Name",value:d,onChange:o=>r(o.target.value),onKeyDown:o=>{o.key==="Enter"&&d.trim().length>0&&(t(d,u),r(""))}})},"name-input"),s.length>0&&e.jsx(N,{initial:{width:0},animate:{width:c?"40%":"0%"},transition:{duration:.25},exit:{width:0},sx:{overflow:"hidden"},children:e.jsx(De,{size:"small",value:u,onChange:o=>i(o.target.value),onFocus:()=>p(!0),onBlur:()=>p(!1),children:s.map(o=>e.jsx(E,{value:o,sx:{fontSize:"0.875rem"},children:ne(o)},o))})},"type-select"),e.jsx(N,{initial:{width:"100%",maxHeight:36},animate:{width:c?"10%":"100%",maxHeight:36},transition:{duration:.25},exit:{width:0},sx:{overflow:"hidden"},children:e.jsx(H,{variant:"contained",onClick:()=>{c?(t(d,u),r("")):a(!0)},sx:{p:c?.5:1,m:0,minWidth:0,display:"flex",justifyContent:"center",alignItems:"center",transition:"all 0.3s ease",bgcolor:c?"success.main":"primary.main"},children:c?e.jsx(Be,{sx:{color:"white"}}):n})},"add-button")]})})},tt=async({propertyId:t})=>ee.post("/glossary/subTypes/properties/delete",{propertyId:t}).then(s=>s.data);function st({propertyId:t}){return async(s,n)=>{const a=n().subType.properties.edit[t];if(!a){s(J({message:"Property not found.",type:"error",duration:3e3}));return}try{s(We({propertyId:t})),tt({propertyId:t}),s(se({scope:"subType",id:t,keypath:`${t}`}))}catch{s(te({properties:[a]})),s(J({message:"Error removing property. Try again later.",type:"error",duration:3e3}))}}}const nt=({width:t,typeFilters:s,setTypeFilters:n,typeAnchor:c,handleMenu:a,closeMenu:d,typeSort:r,setTypeSort:u,relationshipFilter:i,setRelationshipFilter:y})=>{const p=!!c;return le(),e.jsxs(e.Fragment,{children:[e.jsx(H,{variant:"text",id:"subtype-select-type-menu-button","aria-controls":p?"subtype-select-type-menu":void 0,"aria-haspopup":"true","aria-expanded":p?"true":void 0,onClick:o=>a(o,"type"),sx:{textTransform:"none",width:t,color:"text.primary",alignItems:"center"},children:e.jsx(x,{variant:"caption",sx:{textAlign:"left",width:"100%"},children:"Type"})}),e.jsxs(V,{id:"subtype-select-type-menu",anchorEl:c,open:p,onClose:d,children:[e.jsx(x,{sx:{px:2,fontWeight:"bold"},children:"Sort By Type"}),e.jsx(L,{sx:{my:1}}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Ascending"}),e.jsx(D,{size:"small",checked:r==="asc",onChange:()=>u(r==="asc"?null:"asc")})]}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Descending"}),e.jsx(D,{size:"small",checked:r==="desc",onChange:()=>u(r==="desc"?null:"desc")})]}),e.jsx(L,{sx:{my:1}}),e.jsx(x,{sx:{px:2,fontWeight:"bold"},children:"Filter By Type"}),e.jsx(L,{sx:{my:1}}),Ye.map(o=>e.jsxs(E,{onClick:()=>{s.includes(o)?n(s.filter(m=>m!==o)):n([...s,o])},sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:ne(o)}),e.jsx(D,{size:"small",checked:s.includes(o),onChange:()=>{s.includes(o)?n(s.filter(m=>m!==o)):n([...s,o])}})]},o)),e.jsx(L,{sx:{my:1}}),e.jsx(x,{sx:{px:2,fontWeight:"bold"},children:"Filter By List Type"}),e.jsx(L,{sx:{my:1}}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"Entry Type"}),e.jsx(D,{size:"small",checked:i===!0,onChange:()=>y(i===!0?null:!0)})]}),e.jsxs(E,{sx:{justifyContent:"space-between",alignItems:"center",p:.5,px:2},children:[e.jsx(x,{sx:{fontSize:"0.875rem"},children:"List"}),e.jsx(D,{size:"small",checked:i===!1,onChange:()=>y(i===!1?null:!1)})]})]})]})},rt=({openRelay:t,setActiveProperty:s,activeProperty:n})=>{const{searchTerm:c,setSearchTerm:a,addProperty:d,filteredProperties:r,typeFilters:u,setTypeFilters:i,relationshipFilter:y,setRelationshipFilter:p,typeAnchor:o,handleMenu:m,closeMenu:k,typeSort:z,setTypeSort:M}=Se(),I=h=>{t&&t({data:{propertyId:h},status:"complete"}),s&&s(h)},C=l.useCallback(h=>{U(st({propertyId:h})),t&&t({data:{setActiveProperty:null},status:"complete"})},[t]),[T,w]=l.useState(null);return e.jsxs(e.Fragment,{children:[e.jsx(Te,{onAdd:d,selectOptions:et,label:"Add Property"}),e.jsx(_,{sx:{my:2},fullWidth:!0,size:"small",placeholder:"Search Properties...",value:c,onChange:h=>a(h.target.value)}),e.jsx(nt,{width:"200px",typeFilters:u,setTypeFilters:i,relationshipFilter:y,setRelationshipFilter:p,typeAnchor:o,handleMenu:m,closeMenu:k,typeSort:z,setTypeSort:M}),e.jsx(v,{sx:{maxHeight:"calc(100vh - 312px)",overflowY:"scroll"},children:e.jsx(v,{sx:{display:"flex",flexDirection:"column",overflowY:"scroll"},children:r.map((h,g)=>e.jsx(ge,{propertyId:h.id,index:g,handlePropertyClick:I,hoverIndex:T,setHoverIndex:w,isActive:n===h.id,handlePropertyDeletion:C},h.id))})})]})};async function ot({group:t}){return ee.post("/glossary/subTypes/groups",{group:t}).then(s=>s.data)}function at({group:t}){return async s=>{try{const n=me.cloneDeep(t);n.displayName=n.name,s(ce({groups:[{...n,properties:[]}]})),await ot({group:n}),s(se({scope:"subType",id:n.id,keypath:`${n}`}))}catch(n){console.error("Error creating subtype group:",n),s(J({message:"Error creating subtype group. Try again later.",type:"error",duration:3e3}))}}}const it=({activeGroup:t,setActiveGroup:s,openRelay:n})=>{const[c,a]=l.useState(""),[d,r]=l.useState(null),[u,i]=l.useState([]),y=(h,g)=>{switch(h.preventDefault(),g){case"content":r(h.currentTarget);break}},p=()=>{r(null)};U(be());const o=F(de),m=l.useMemo(()=>o.filter(h=>{const g=h.name.toLowerCase().includes(c.toLowerCase()),f=u.length===0||u.includes("system")&&h.contentType==="system"||u.includes("custom")&&h.contentType==="custom";return g&&f}).sort((h,g)=>h.name.localeCompare(g.name)),[o,c,u]),k=h=>{const g=fe(),f=Oe(h,g);U(at({group:f}))},z=h=>{s(h),n({data:{setActiveGroup:h},status:"complete"})},{allProperties:M}=Se(),I=l.useMemo(()=>{if(!t)return[];const h=o.find(f=>f.id===t);if(!h)return[];const g=h.properties?h.properties.map(f=>f.propertyId):[];return M.filter(f=>!g.includes(f.id))},[t,M,o]),[C,T]=l.useState(""),w=l.useMemo(()=>I.filter(h=>h.name.toLowerCase().includes(C.toLowerCase())),[I,C]);return{searchTerm:c,setSearchTerm:a,contentAnchor:d,contentFilters:u,handleMenu:y,closeMenu:p,addGroup:k,handleGroupClick:z,allGroups:m,activeGroup:t,availableProperties:I,searchProperties:C,setSearchProperties:T,filteredAvailableProperties:w}},lt=({openRelay:t,activeGroup:s,setActiveGroup:n})=>{const{searchTerm:c,setSearchTerm:a,addGroup:d,allGroups:r,handleGroupClick:u,filteredAvailableProperties:i,searchProperties:y,setSearchProperties:p}=it({activeGroup:s,setActiveGroup:n,openRelay:t});return e.jsxs(q,{mode:"popLayout",children:[e.jsxs(N,{layout:!0,layoutId:"subtype-group-creator-box",animate:{opacity:1,scaleY:s===null?1:0,height:s===null?"auto":0},exit:{opacity:0,scaleY:0,height:0},transition:{duration:.33},children:[e.jsx(Te,{onAdd:d,selectOptions:[],label:"Add Group"}),e.jsx(_,{sx:{my:2},fullWidth:!0,size:"small",placeholder:"Search Groups...",value:c,onChange:o=>a(o.target.value),slotProps:{input:{endAdornment:e.jsx(R,{onClick:()=>a(""),children:e.jsx(X,{})})}}})]},"subtype-group-creator-box"),e.jsxs(N,{layoutId:"subtype-group-list-box",layout:!0,initial:{opacity:0},animate:{opacity:1,maxHeight:"calc(100vh - 280px)",overflowY:"auto"},exit:{opacity:0},transition:{duration:.33},sx:{},children:[!s&&r.map(o=>e.jsx(je,{index:r.indexOf(o),handleGroupClick:u,groupId:o.id,hoverIndex:-1,setHoverIndex:()=>{},handleGroupReorder:()=>{},isActive:s===o.id,handleGroupDeletion:()=>{}},o.id)),e.jsxs(N,{layout:!0,layoutId:"property_list_box",initial:{opacity:0},animate:{opacity:s?1:0},transition:{duration:.4},sx:{py:0,height:"70vh",overflowY:"auto"},children:[e.jsxs(v,{sx:{display:"flex",alignItems:"center",justifyContent:"center",position:"relative",pt:2},children:[e.jsx(x,{variant:"h6",children:"Available Properties"}),e.jsx(R,{sx:{position:"absolute",left:0},onClick:()=>{u(null),t({data:{setActiveGroup:null},status:"complete"})},children:e.jsx(xe,{})})]}),e.jsx(_,{fullWidth:!0,size:"small",placeholder:"Search Properties...",value:y,onChange:o=>p(o.target.value),sx:{my:1},slotProps:{input:{endAdornment:e.jsx(R,{onClick:()=>p(""),children:e.jsx(X,{})})}}}),i.map((o,m)=>e.jsx(ge,{index:m,handlePropertyClick:()=>{},propertyId:o.id},o.id))]},"property_list_box")]},"subtype-group-list-box")]})},pt=()=>{var b,W,A,Y,$,K,O;const{ui:t,updateUI:s}=He();Ne();const[n,c]=l.useState(((b=t==null?void 0:t.subType)==null?void 0:b.editing)??!1),[a,d]=l.useState(((W=t==null?void 0:t.subType)==null?void 0:W.type)??""),[r,u]=l.useState(((A=t==null?void 0:t.subType)==null?void 0:A.editId)??null),[i,y]=l.useState(((Y=t==null?void 0:t.subType)==null?void 0:Y.mode)??"property"),[p,o]=l.useState((($=t==null?void 0:t.subType)==null?void 0:$.activeProperty)??null),[m,k]=l.useState(((K=t==null?void 0:t.subType)==null?void 0:K.activeGroup)??null),[z,M]=l.useState(((O=t.subType)==null?void 0:O.subTypeId)??null),[I,C]=l.useState(!1);U(pe()),l.useEffect(()=>()=>{s({key:"subType",value:{activeGroup:m,activeProperty:p,mode:i,subTypeId:z,editing:n,type:a}})},[m,p,i,r,n,a]);const T=j=>{(j==null?void 0:j.setActiveGroup)!==void 0&&k(j.setActiveGroup),(j==null?void 0:j.setActiveProperty)!==void 0&&o(j.setActiveProperty),(j==null?void 0:j.setMode)!==void 0&&y(j.setMode),j.isDeleting&&(u(null),c(!1),d(""),y("property"),C(!1),s({key:"subType",value:{editId:null,editing:!1}}))},{openRelay:w}=ye({id:"subType-sidebar-template",onComplete:T,removeAfterConsume:!1}),{getAlphaColor:h,darkenColor:g}=Z(),{showModal:f}=he();l.useEffect(()=>{w({data:{setMode:i},status:"complete"})},[i]);const S=j=>{w({data:{subType:j},status:"complete"}),c(!0),u(j.id),d(j.entryType)},B=F(ue(r||"")),P=["property","group","subtype"];function G(j){return j===0?`${j*108}px`:`${j*108+8*j}px`}return l.useEffect(()=>{w({data:{subType:{id:r}},status:"complete"})},[r]),e.jsxs(N,{sx:{p:2,overflowY:"hidden",pb:4},initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:-20},transition:{duration:.3},children:[e.jsx(v,{sx:{width:"100%",display:"flex",justifyContent:"center",position:"relative"},children:e.jsx(x,{variant:"h6",sx:{marginLeft:2},children:"Glossary Sub-Types"})}),e.jsxs(v,{sx:{height:"100%"},children:[e.jsxs(v,{sx:{mt:2,mb:2,gap:2,width:"100%",justifyContent:"center",display:"flex",position:"relative"},children:[P.map(j=>e.jsx(H,{variant:"text",sx:{width:"100px",display:"flex",justifyContent:"center",borderRadius:0,borderColor:i===j?h({color:"success",key:"dark",opacity:.3}):"",color:i===j?"success.main":"primary.main","&:hover":{backgroundColor:i!==j?g({color:"background",key:"default",amount:.2}):void 0,color:"text.primary"}},onClick:()=>{y(j)},children:ne(j)},j)),e.jsx(v,{component:"span",sx:{width:"100px",display:"flex",justifyContent:"center",position:"absolute",height:"36.5px",borderBottom:1,borderColor:"success.main",left:G(P.indexOf(i||"property")),ml:2,transition:"left 0.3s ease",backgroundColor:h({color:"success",key:"dark",opacity:.3})}})]}),I?e.jsx(Qe,{subType:B,showModal:f}):e.jsxs(e.Fragment,{children:[i==="property"&&e.jsx(rt,{openRelay:w,setActiveProperty:o,activeProperty:p}),i==="group"&&e.jsx(lt,{openRelay:w,activeGroup:m,setActiveGroup:k}),i==="subtype"&&e.jsx(Ve,{onSubmit:S,editId:r,setEditId:u})]})]})]})};export{pt as default};
