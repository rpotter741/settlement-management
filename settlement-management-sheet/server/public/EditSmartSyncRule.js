import{j as t,B as d,T as h,as as g,Q as C,S as T,U as A,V as k,a5 as I,O as y,I as S,aH as w,a0 as D,u as R,r as L,aR as B,a as x,a2 as f}from"./main.js";import{I as F}from"./Info.js";const u=({name:r,options:n,value:e,onChange:a,relationship:s=!1,multiple:l=!1,disabled:i=!1,usePropLabel:c=!0,size:o="small"})=>t.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center",width:"100%",px:4},children:[t.jsx(h,{sx:{width:"33%"},children:r}),t.jsx(M,{disabled:i,label:"",options:n,value:e,onChange:a,relationship:s,multiple:l,usePropLabel:c,size:o})]}),M=({label:r,options:n,value:e,onChange:a,multiple:s,relationship:l=!1,disabled:i,usePropLabel:c=!0,size:o="small"})=>{const{getPropertyLabel:m}=c?g():{getPropertyLabel:p=>({label:p})},j=l?s?e.map(p=>m(p).label).join(", "):m(e).label:e;return t.jsx(t.Fragment,{children:t.jsxs(C,{sx:{width:"100%"},children:[t.jsx(T,{children:r}),t.jsx(A,{size:o,value:s?Array.isArray(e)?e:[e]:e||"",multiple:s,renderValue:()=>j||"",readOnly:i,sx:{color:i?"primary.main":"text.primary"},children:n.map(p=>t.jsx(k,{value:p,onClick:()=>a(s?[...e,p.toLowerCase()]:p.toLowerCase()),children:p},p))})]})})},P=({ruleState:r,setRuleState:n})=>t.jsx(u,{relationship:!1,multiple:!1,name:"Method",options:["Add","Remove","Monitor"],value:r.operand,onChange:e=>{n(a=>({...a,operand:e}))}}),E=({name:r,options:n,value:e,onChange:a,getTargetTooltip:s})=>t.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center",width:"100%",px:4},children:[t.jsx(h,{sx:{width:"33%"},children:r}),t.jsxs(d,{sx:{display:"flex",width:"100%",alignItems:"center",justifyContent:"start"},children:[t.jsx(I,{sx:{cursor:"pointer"},fullWidth:!0,options:n.filter(l=>l.label!==(e==null?void 0:e.label)),getOptionLabel:l=>l.label,groupBy:l=>l.group,renderInput:l=>t.jsx(y,{...l,sx:{cursor:"pointer"},size:"small"}),value:e,onChange:(l,i)=>{a((i==null?void 0:i.label)||"Child")}}),s&&t.jsx(S,{title:t.jsx(h,{children:s((e==null?void 0:e.label)||"")}),arrow:!0,sx:{fontSize:"1.5rem"},children:t.jsx(F,{color:"info",sx:{ml:1}})})]})]}),O=({ruleState:r,setRuleState:n,getTarget:e,getTargetTooltip:a})=>t.jsx(E,{name:"Target",onChange:s=>{n(l=>({...l,target:s}))},value:e(r.target),options:[{group:"Relationship",label:"Parent"},{group:"Relationship",label:"Child"},{group:"Relationship",label:"Sibling"},{group:"Structure",label:"Entry Type"},{group:"Structure",label:"Backlink"}],getTargetTooltip:a}),b=({name:r,type:n,value:e,onChange:a,disabled:s,size:l="small",placeholder:i="Infinity"})=>t.jsxs(d,{sx:{display:"flex",gap:2,alignItems:"center",width:"100%",px:4,opacity:s?.5:1,transition:"opacity 0.3s ease"},children:[t.jsx(h,{sx:{width:"33%"},children:r}),t.jsx(y,{fullWidth:!0,type:n,size:l,value:e!==null?e===0?"Infinity":e:null,onChange:c=>{const o=n==="number"?parseInt(c.target.value):c.target.value;!(typeof o=="number"&&n==="number")||o>=0?a(o):a(0)},disabled:s,placeholder:i})]}),z=({ruleState:r,setRuleState:n,showDepth:e})=>t.jsx(b,{name:"Hops",value:e(r.target)&&r.depth!==null?r==null?void 0:r.depth:0,onChange:a=>{n(s=>({...s,depth:a}))},disabled:!e(r.target),type:"number"}),H=({ruleState:r,setRuleState:n})=>{const{getPropertyLabel:e}=g();return t.jsx(u,{multiple:!0,name:"Type",options:w.map(a=>e(a).label).filter(a=>{var s;return!((s=r.parameters.types)!=null&&s.includes(a.toLowerCase()))}),relationship:!0,value:r.parameters.types||null,onChange:a=>{n(s=>({...s,parameters:{...s.parameters,types:a}}))},disabled:!0})},W=({ruleState:r,setRuleState:n})=>t.jsx(u,{multiple:!1,name:"Property Match",value:r.parameters.propertyMatch?"True":"False",options:["False","True"],onChange:e=>{console.log(e);const a=Array.isArray(e)?e[0]??"":e??"";n(s=>({...s,parameters:{...s.parameters,propertyMatch:a==="true"}}))},relationship:!1}),G=({ruleState:r,setRuleState:n})=>t.jsx(u,{multiple:!1,name:"Scope",value:r.parameters.scope||"Branch",options:["Branch","Global"],onChange:e=>{console.log(e);const a=Array.isArray(e)?e[0]??"":e??"";n(s=>({...s,parameters:{...s.parameters,scope:D(a)}}))},relationship:!1}),Q=({ruleState:r,setRuleState:n})=>t.jsx(u,{multiple:!1,name:"First Match Only",value:r.parameters.closest?"True":"False",options:["False","True"],onChange:e=>{console.log(e);const a=Array.isArray(e)?e[0]??"":e??"";n(s=>({...s,parameters:{...s.parameters,closest:a==="true"}}))},relationship:!1}),U=({ruleState:r,setRuleState:n})=>t.jsx(b,{name:"Limit",value:r.parameters.limit!==null&&r.parameters.limit||0,onChange:e=>{n(a=>({...a,parameters:{...a.parameters,limit:e}}))},disabled:r.parameters.closest===!0,type:"number"});function q(r,n){if(Object.keys(r).length>0)return r;{const e={};if(n.inputType==="dropdown"){const{relationship:a}=n.shape;a&&(e.types=f.cloneDeep(a)||[])}return{operand:"Add",target:"Child",depth:1,parameters:e}}}function v(r){switch(r){case"Child":return{group:"Relationship",label:"Child"};case"Sibling":return{group:"Relationship",label:"Sibling"};case"Parent":return{group:"Relationship",label:"Parent"};case"Backlink":return{group:"Structure",label:"Backlink"};case"Entry Type":return{group:"Structure",label:"Entry Type"};default:return{group:"",label:""}}}const J=r=>!(r==="Backlink"||r==="Sibling"),Y=({rule:r,property:n,isCompound:e})=>{const{closeModal:a}=R(),[s,l]=L.useState(q(r,n)),{openRelay:i}=B({id:"property-smart-sync-rules"}),c=()=>{const o=f.cloneDeep(s);i({data:o,status:"complete"}),a()};return t.jsxs(t.Fragment,{children:[t.jsx(h,{variant:"h5",gutterBottom:!0,sx:{width:"100%",textAlign:"center"},children:"Edit Smart Sync Rule"}),t.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2,mt:4},children:[t.jsx(P,{ruleState:s,setRuleState:l}),t.jsx(O,{ruleState:s,setRuleState:l,getTarget:v,getTargetTooltip:K}),t.jsx(z,{ruleState:s,setRuleState:l,showDepth:J})]}),t.jsx(h,{variant:"h6",gutterBottom:!0,sx:{width:"100%",textAlign:"center",my:2},children:"Parameterization Options"}),t.jsxs(d,{sx:{display:"flex",flexDirection:"column",gap:2,mt:2},children:[t.jsx(H,{ruleState:s,setRuleState:l}),t.jsx(W,{ruleState:s,setRuleState:l}),t.jsx(G,{ruleState:s,setRuleState:l}),t.jsx(U,{ruleState:s,setRuleState:l}),t.jsx(Q,{ruleState:s,setRuleState:l})]}),t.jsxs(d,{sx:{display:"flex",alignItems:"center",justifyContent:"space-between",mt:4,px:2},children:[t.jsx(x,{color:"success",variant:"contained",onClick:c,children:"Save"}),t.jsx(x,{color:"error",variant:"contained",onClick:()=>a(),children:"Cancel"})]})]})};function K(r){switch(r){case"Child":return"Targets entries that are children of the entry, including all descendants up to and including the specified depth. For example, a depth of 2 includes children and grandchildren.";case"Sibling":return"Targets entries that share the same parent as the entry.";case"Parent":return"Targets entries that are parents of the entry, including all ancestors up to and including the specified depth. For example, a depth of 2 includes parents and grandparents.";case"Backlink":return"Targets entries that link back to the entry through a direct or indirect relationship (eg, dropdown or rich text description).";case"Entry Type":return"Targets entries based solely on their type. This automatically includes all relationship types to the specified depth, where applicable. For example, at a depth of 2, this would search children, grandchildren, siblings, parents, parent's siblings, and grandparents and only select those entries that match the specified type(s).";default:return"Oh shit we broke. Sorry! "}}export{Y as default};
