import{r as c,b as Y,L as ve,w as G,s as J,e as K,T as F,j as e,f as X,x as Ce,y as U,z as te,C as Z,D as _,E as L,m as de,F as je,G as Te,k as Q,H as Se,R as Ie,B as m,I as ke,J as we,K as pe,N as ue,P as Re,O as ze,Q as O,S as W,U as N,V as z,W as se,X as $e,a as Ae,Y as ae,Z as xe,_ as re,$ as Pe,a0 as Me,a1 as Fe,a2 as oe,a3 as V}from"./main.js";import{u as De}from"./useTools.js";import{l as He}from"./loadTool.js";import"./toolSelectors.js";const Le=t=>{const{classes:s,inset:r,primary:o,secondary:x,dense:d}=t;return X({root:["root",r&&"inset",d&&"dense",o&&x&&"multiline"],primary:["primary"],secondary:["secondary"]},Ce,s)},Be=J("div",{name:"MuiListItemText",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[{[`& .${U.primary}`]:s.primary},{[`& .${U.secondary}`]:s.secondary},s.root,r.inset&&s.inset,r.primary&&r.secondary&&s.multiline,r.dense&&s.dense]}})({flex:"1 1 auto",minWidth:0,marginTop:4,marginBottom:4,[`.${te.root}:where(& .${U.primary})`]:{display:"block"},[`.${te.root}:where(& .${U.secondary})`]:{display:"block"},variants:[{props:({ownerState:t})=>t.primary&&t.secondary,style:{marginTop:6,marginBottom:6}},{props:({ownerState:t})=>t.inset,style:{paddingLeft:56}}]}),Ee=c.forwardRef(function(s,r){const o=Y({props:s,name:"MuiListItemText"}),{children:x,className:d,disableTypography:n=!1,inset:p=!1,primary:l,primaryTypographyProps:b,secondary:v,secondaryTypographyProps:T,slots:$={},slotProps:y={},...I}=o,{dense:S}=c.useContext(ve);let i=l??x,u=v;const h={...o,disableTypography:n,inset:p,primary:!!i,secondary:!!u,dense:S},g=Le(h),j={slots:$,slotProps:{primary:b,secondary:T,...y}},[k,B]=G("root",{className:K(g.root,d),elementType:Be,externalForwardedProps:{...j,...I},ownerState:h,ref:r}),[H,A]=G("primary",{className:g.primary,elementType:F,externalForwardedProps:j,ownerState:h}),[w,R]=G("secondary",{className:g.secondary,elementType:F,externalForwardedProps:j,ownerState:h});return i!=null&&i.type!==F&&!n&&(i=e.jsx(H,{variant:S?"body2":"body1",component:A!=null&&A.variant?void 0:"span",...A,children:i})),u!=null&&u.type!==F&&!n&&(u=e.jsx(w,{variant:"body2",color:"textSecondary",...R,children:u})),e.jsxs(k,{...B,children:[i,u]})}),Ne=c.createContext(),me=c.createContext();function Ue(t){return _("MuiTableCell",t)}const Oe=Z("MuiTableCell",["root","head","body","footer","sizeSmall","sizeMedium","paddingCheckbox","paddingNone","alignLeft","alignCenter","alignRight","alignJustify","stickyHeader"]),We=t=>{const{classes:s,variant:r,align:o,padding:x,size:d,stickyHeader:n}=t,p={root:["root",r,n&&"stickyHeader",o!=="inherit"&&`align${L(o)}`,x!=="normal"&&`padding${L(x)}`,`size${L(d)}`]};return X(p,Ue,s)},Ve=J("td",{name:"MuiTableCell",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,s[r.variant],s[`size${L(r.size)}`],r.padding!=="normal"&&s[`padding${L(r.padding)}`],r.align!=="inherit"&&s[`align${L(r.align)}`],r.stickyHeader&&s.stickyHeader]}})(de(({theme:t})=>({...t.typography.body2,display:"table-cell",verticalAlign:"inherit",borderBottom:t.vars?`1px solid ${t.vars.palette.TableCell.border}`:`1px solid
    ${t.palette.mode==="light"?je(Q(t.palette.divider,1),.88):Te(Q(t.palette.divider,1),.68)}`,textAlign:"left",padding:16,variants:[{props:{variant:"head"},style:{color:(t.vars||t).palette.text.primary,lineHeight:t.typography.pxToRem(24),fontWeight:t.typography.fontWeightMedium}},{props:{variant:"body"},style:{color:(t.vars||t).palette.text.primary}},{props:{variant:"footer"},style:{color:(t.vars||t).palette.text.secondary,lineHeight:t.typography.pxToRem(21),fontSize:t.typography.pxToRem(12)}},{props:{size:"small"},style:{padding:"6px 16px",[`&.${Oe.paddingCheckbox}`]:{width:24,padding:"0 12px 0 16px","& > *":{padding:0}}}},{props:{padding:"checkbox"},style:{width:48,padding:"0 0 0 4px"}},{props:{padding:"none"},style:{padding:0}},{props:{align:"left"},style:{textAlign:"left"}},{props:{align:"center"},style:{textAlign:"center"}},{props:{align:"right"},style:{textAlign:"right",flexDirection:"row-reverse"}},{props:{align:"justify"},style:{textAlign:"justify"}},{props:({ownerState:s})=>s.stickyHeader,style:{position:"sticky",top:0,zIndex:2,backgroundColor:(t.vars||t).palette.background.default}}]}))),Qe=c.forwardRef(function(s,r){const o=Y({props:s,name:"MuiTableCell"}),{align:x="inherit",className:d,component:n,padding:p,scope:l,size:b,sortDirection:v,variant:T,...$}=o,y=c.useContext(Ne),I=c.useContext(me),S=I&&I.variant==="head";let i;n?i=n:i=S?"th":"td";let u=l;i==="td"?u=void 0:!u&&S&&(u="col");const h=T||I&&I.variant,g={...o,align:x,component:i,padding:p||(y&&y.padding?y.padding:"normal"),size:b||(y&&y.size?y.size:"medium"),sortDirection:v,stickyHeader:h==="head"&&y&&y.stickyHeader,variant:h},j=We(g);let k=null;return v&&(k=v==="asc"?"ascending":"descending"),e.jsx(Ve,{as:i,ref:r,className:K(j.root,d),"aria-sort":k,scope:u,ownerState:g,...$})});function Ye(t){return _("MuiTableContainer",t)}Z("MuiTableContainer",["root"]);const Je=t=>{const{classes:s}=t;return X({root:["root"]},Ye,s)},Ke=J("div",{name:"MuiTableContainer",slot:"Root",overridesResolver:(t,s)=>s.root})({width:"100%",overflowX:"auto"}),Xe=c.forwardRef(function(s,r){const o=Y({props:s,name:"MuiTableContainer"}),{className:x,component:d="div",...n}=o,p={...o,component:d},l=Je(p);return e.jsx(Ke,{ref:r,as:d,className:K(l.root,x),ownerState:p,...n})});function qe(t){return _("MuiTableRow",t)}const ne=Z("MuiTableRow",["root","selected","hover","head","footer"]),Ge=t=>{const{classes:s,selected:r,hover:o,head:x,footer:d}=t;return X({root:["root",r&&"selected",o&&"hover",x&&"head",d&&"footer"]},qe,s)},Ze=J("tr",{name:"MuiTableRow",slot:"Root",overridesResolver:(t,s)=>{const{ownerState:r}=t;return[s.root,r.head&&s.head,r.footer&&s.footer]}})(de(({theme:t})=>({color:"inherit",display:"table-row",verticalAlign:"middle",outline:0,[`&.${ne.hover}:hover`]:{backgroundColor:(t.vars||t).palette.action.hover},[`&.${ne.selected}`]:{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / ${t.vars.palette.action.selectedOpacity})`:Q(t.palette.primary.main,t.palette.action.selectedOpacity),"&:hover":{backgroundColor:t.vars?`rgba(${t.vars.palette.primary.mainChannel} / calc(${t.vars.palette.action.selectedOpacity} + ${t.vars.palette.action.hoverOpacity}))`:Q(t.palette.primary.main,t.palette.action.selectedOpacity+t.palette.action.hoverOpacity)}}}))),ie="tr",_e=c.forwardRef(function(s,r){const o=Y({props:s,name:"MuiTableRow"}),{className:x,component:d=ie,hover:n=!1,selected:p=!1,...l}=o,b=c.useContext(me),v={...o,component:d,hover:n,selected:p,head:b&&b.variant==="head",footer:b&&b.variant==="footer"},T=Ge(v);return e.jsx(Ze,{as:d,ref:r,className:K(T.root,x),role:d===ie?null:"row",ownerState:v,...l})}),he=Se(e.jsx("path",{d:"m12 21.35-1.45-1.32C5.4 15.36 2 12.28 2 8.5 2 5.42 4.42 3 7.5 3c1.74 0 3.41.81 4.5 2.09C13.09 3.81 14.76 3 16.5 3 19.58 3 22 5.42 22 8.5c0 3.78-3.4 6.86-8.55 11.54z"}),"Favorite"),et=Ie.memo(t=>{const{onActionClick:s,refId:r,id:o,options:x,onDelete:d}=t;return e.jsx(m,{sx:{display:"flex",gap:0},children:x.map(n=>e.jsx(ke,{title:n.name,placement:"top",arrow:!0,children:e.jsx(we,{size:"small",fontSize:"inherit",sx:{zIndex:1e3,fontSize:"1rem","&:hover":{color:"secondary.main"}},icon:n.icon,onClick:async p=>{if(p.stopPropagation(),n.name==="delete")try{await s(p,n.name,{refId:r,id:o}),d(p,r)}catch(l){console.error("Failed to delete:",l)}else s(p,n.name,{refId:r,id:o})},children:n.name==="Favorite"?e.jsx(he,{fontSize:"inherit"}):n.name==="Delete"?e.jsx(pe,{fontSize:"inherit"}):n.name==="Edit"?e.jsx(ue,{fontSize:"inherit"}):n.icon},n.name)},n.name))})}),tt=({rows:t,type:s,fetchNextPage:r,hasNextPage:o,isFetchingNextPage:x,onSearch:d,onActionClick:n,onDelete:p,checkbox:l=!1,selected:b,setSelected:v,maxSelections:T,infiniteScroll:$=!0,options:y=[],onConfirm:I})=>{const S=c.useRef(null),i=c.useRef(),[u,h]=c.useState(""),[g,j]=c.useState(""),[k,B]=c.useState(""),[H,A]=c.useState(""),[w,R]=c.useState([]),P=(a,{id:C,refId:f})=>{a.stopPropagation(),v(D=>D.ids.includes(C)?{ids:D.ids.filter(q=>q!==C),refIds:D.refIds.filter(q=>q!==f)}:{ids:[...D.ids,C],refIds:[...D.refIds,f]})};c.useEffect(()=>{i.current&&i.current.resetAfterIndex(0,!0)},[t,u,g,k,H,w]),c.useEffect(()=>{if(!S.current||!o)return;const a=new IntersectionObserver(([C])=>{C.isIntersecting&&r()},{root:null,rootMargin:"200px",threshold:.1});return a.observe(S.current),()=>a.disconnect()},[r,o]);const[M,ge]=c.useState(null),ye=a=>{ge(M===a?null:a),i.current&&i.current.resetAfterIndex(0)},E=t.filter(a=>{var C;return((C=a==null?void 0:a.name)==null?void 0:C.toLowerCase().includes(u.toLowerCase()))&&(!g||a.contentType===g)&&(!k||a.status===k)}),fe=a=>M===E[a].refId?175:55,be=({index:a,style:C})=>{const f=E[a],D=a===E.length-1;return f?e.jsxs(m,{ref:D?S:null,onClick:()=>ye(f.refId),sx:{display:"flex",alignItems:"center",width:"100%",borderBottom:"1px solid",borderColor:"secondary.main",cursor:"pointer","&:hover":{backgroundColor:"background.default"},boxSizing:"border-box",flexWrap:"wrap",overflowY:M===f.refId?"scroll":"hidden"},style:C,children:[e.jsxs(m,{sx:{display:"flex",alignItems:"center",maxHeight:55,height:55,width:"100%",pr:1},children:[e.jsx(m,{sx:{flex:1,p:.5,alignItems:"center"},children:e.jsx(F,{variant:"body2",textAlign:"left",sx:{pl:1},children:f.name||"(Unnamed)"})}),e.jsx(ae,{orientation:"vertical",flexItem:!0,sx:{borderColor:"secondary.main",height:"60%",mx:1,mt:1.5}}),e.jsx(m,{sx:{flex:.5,textAlign:"end",maxHeight:55},children:l?e.jsx(se,{sx:{zIndex:3},onClick:ee=>P(ee,{id:f.id,refId:f.refId}),checked:b.ids.includes(f.id),disabled:b.length>=T&&!b.includes(f.id)}):e.jsx(et,{options:y,onActionClick:n,refId:f.refId,id:f.id,onDelete:p})})]}),M===f.refId&&e.jsxs(m,{children:[e.jsx(ae,{flexItem:!0,sx:{fontSize:"1rem",fontWeight:"bold"},children:"Description"}),e.jsx(m,{sx:{width:"85%",p:2},children:e.jsx(m,{sx:{display:"flex",justifyContent:"start",alignItems:"start"},children:e.jsxs(m,{children:[e.jsx(F,{variant:"body2",children:f.description}),e.jsxs(F,{variant:"caption",children:["Tags: ",f.tags.join(", ")]})]})})})]})]},f.refId):e.jsx(_e,{style:C,children:e.jsx(Qe,{colSpan:6,children:e.jsx(Skeleton,{animation:"wave",height:40})})})};return e.jsxs(Xe,{component:Re,children:[e.jsxs(m,{sx:{display:"flex",position:"sticky",top:0,flexWrap:"wrap",backgroundColor:"background.default",zIndex:5,my:1},children:[e.jsx(ze,{label:"Search",variant:"outlined",size:"small",value:u,onChange:a=>{h(a.target.value),d(a.target.value)},sx:{width:s==="community"?"50%":"100%"}}),s==="community"&&e.jsxs(O,{size:"small",sx:{width:"50%"},children:[e.jsx(W,{children:"Content Type"}),e.jsxs(N,{value:g,onChange:a=>j(a.target.value),children:[e.jsx(z,{value:"",children:"All"},"all"),e.jsx(z,{value:"CUSTOM",children:"Custom"},"custom"),e.jsx(z,{value:"OFFICIAL",children:"Official"},"official")]})]}),s==="personal"&&e.jsxs(O,{size:"small",sx:{width:"50%"},children:[e.jsx(W,{sx:{mt:2,backgroundColor:"background.default"},children:"Status"}),e.jsxs(N,{value:k,onChange:a=>B(a.target.value),sx:{my:2},children:[e.jsx(z,{value:"",children:"All"},"all"),e.jsx(z,{value:"DRAFT",children:"Draft"},"draft"),e.jsx(z,{value:"PUBLISHED",children:"Published"},"published")]})]}),s==="community"&&e.jsxs(O,{size:"small",sx:{width:"50%"},children:[e.jsx(W,{sx:{mt:2,backgroundColor:"background.default"},children:"Created By"}),e.jsxs(N,{value:H,onChange:a=>A(a.target.value),sx:{mt:2},children:[e.jsx(z,{value:"",children:"All"},"all"),Array.from(new Set(t.map(a=>a==null?void 0:a.createdBy))).map((a,C)=>e.jsx(z,{value:a,children:a},a+C))]})]}),e.jsxs(O,{size:"small",sx:{width:"50%"},children:[e.jsx(W,{sx:{mt:2,backgroundColor:"background.default"},children:"Tags"}),e.jsx(N,{multiple:!0,value:w,onChange:a=>R(a.target.value),renderValue:a=>a.join(", "),sx:{my:2},children:Array.from(new Set(t.flatMap(a=>a==null?void 0:a.tags))).map((a,C)=>e.jsxs(z,{value:a,children:[e.jsx(se,{checked:w.includes(a)}),e.jsx(Ee,{primary:a})]},a+C))})]}),e.jsxs(m,{sx:{display:"flex",alignItems:"space-between",py:2,backgroundColor:"primary.main",width:"100%",zIndex:"5",mb:1,color:"black"},children:[e.jsx(m,{sx:{width:"60%",fontWeight:"bold",px:1,textAlign:"start"},children:"Name"}),e.jsx(m,{sx:{width:"40%",fontSize:"1rem",fontWeight:"bold",textAlign:"end",pr:2},children:"Actions"})]})]}),e.jsx(m,{sx:{scrollbarWidth:"none"},"aria-label":"attributes table",children:e.jsxs(m,{sx:{maxHeight:"300px",overflowY:"auto"},children:[e.jsx($e,{ref:i,height:500,itemCount:E.length,itemSize:fe,width:"100%",overscanCount:5,children:be},E.length),e.jsx(m,{children:x&&e.jsx(m,{colSpan:6,children:"Loading..."})})]})}),l&&e.jsx(m,{sx:{display:"flex",justifyContent:"center",p:2},children:e.jsx(Ae,{onClick:I,children:"Confirm"})})]})},le=({onActionClick:t,options:s,type:r,tool:o,selectionMode:x=!1,maxSelections:d=6,selected:n,setSelected:p,displayName:l=Me(o),onConfirm:b=()=>{},dependency:v=!1,isOpen:T=!0})=>{const{selectStaticValue:$}=De(o),y=$("refId"),[I,S]=c.useState(T),[i,u]=c.useState([]),[h,g]=c.useState(""),{data:j,fetchNextPage:k,hasNextPage:B,isFetchingNextPage:H}=xe.paginateToolContent({tool:o,scope:r,search:h,dependency:v,depId:y});c.useEffect(()=>{const w=re.getQueryData([o,r,h]);j?u(j.pages.flatMap(R=>R.items)):w&&u(w.pages.flatMap(R=>R.items))},[j,r,h]);const A=async(w,R)=>{w.stopPropagation();try{re.setQueryData([o,r,h],P=>({...P,items:P.items.filter(M=>M.refId!==R)})),u(P=>P.filter(M=>M.refId!==R))}catch(P){console.error("Error deleting item:",P)}};return e.jsxs(Pe,{sx:{minWidth:["100%"]},children:[e.jsx(F,{variant:"h6",sx:{my:2},children:r==="personal"?`My ${l}`:`Community ${l}`}),e.jsx(tt,{options:s,rows:i,fetchNextPage:k,hasNextPage:B,isFetchingNextPage:H,onSearch:g,onActionClick:t,onDelete:A,type:r,checkbox:x,selected:n,setSelected:p,maxSelections:d,onConfirm:b})]})},st=()=>e.jsx(he,{style:{color:"red"}}),at=()=>e.jsx(ue,{}),rt=()=>e.jsx(pe,{}),ce=[{name:"Edit",icon:e.jsx(at,{})},{name:"Delete",icon:e.jsx(rt,{})},{name:"Favorite",icon:e.jsx(st,{})}],ct=({keypath:t="",refKeypath:s="",selectionMode:r=!1,maxSelections:o=6,outerUpdate:x=()=>{},outerTool:d={},dependency:n=!1})=>{const p=Fe(),[l,b]=c.useState("attribute"),v={apt:"Abstract Progress Trackers",action:"Actions",attribute:"Attributes",building:"Buildings",event:"Events",kit:"Kits",listener:"Listeners",settlementType:"Settlement Types",settlement:"Settlements",gameStatus:"Statuses",storyThread:"Story Threads",tradeHub:"Trade Hubs",upgrade:"Upgrades"},[T,$]=c.useState({ids:oe.get(d,t)||[],refIds:oe.get(d,s)||[]}),y=()=>{x(t,T)},I=(i,u,{refId:h,id:g})=>{switch(i.stopPropagation(),u){case"Edit":return()=>{p(He({refId:h,id:g,tool:l,currentTool:l,mode:"edit"}))};case"Delete":return async()=>{try{await xe.deleteTool({tool:l,id:g}),p(V({message:"Deleted successfully",type:"success"}))}catch{p(V({message:`Unable to delete ${l}. Try again later.`,type:"error"}))}};case"Favorite":return async()=>{try{p(V({message:"Favorited successfully",type:"success"}))}catch(j){p(V({message:j.message,type:"error"}))}};default:return()=>{}}},S=(i,u,{refId:h,id:g})=>{i.stopPropagation(),I(i,u,{refId:h,id:g})()};return e.jsxs(m,{sx:{minWidth:["100%"]},children:[e.jsx(N,{value:l,onChange:i=>b(i.target.value),sx:{width:"100%"},children:Object.entries(v).map(([i,u])=>e.jsx(z,{value:i,children:u},i))}),e.jsx(le,{onActionClick:S,options:ce,type:"personal",tool:l,displayName:v[l],selectionMode:r,selected:T,setSelected:$,maxSelections:o,onConfirm:y,dependency:n,isOpen:!1}),e.jsx(le,{onActionClick:S,options:ce,type:"community",tool:l,displayName:v[l],selectionMode:r,selected:T,setSelected:$,maxSelections:o,onConfirm:y,dependency:n,isOpen:!1})]})};export{ct as default};
