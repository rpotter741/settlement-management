import{H as K,j as e,v as q,r as T,bs as Y,bt as X,a as Z,I as L,T as x,bu as J,A as ee,bv as te,bw as ae,bx as E,B as b,Q as re,by as se,bz as ne,a5 as ie,O as le,Y as I,a7 as oe,R as ce,a1 as U,b6 as B,bA as de,ba as ue,J as V,a2 as N,bB as z,Z as W,a3 as he,bC as pe,bD as ve}from"./main.js";import{i as be}from"./iconList.js";import{u as A}from"./useTools.js";import{T as P}from"./ToolInput.js";import{T as me}from"./ToolSelect.js";import{I as fe}from"./Info.js";import{u as ge,O as xe,R as $,P as ye}from"./ThresholdPreview.js";import{I as Q}from"./Icon.js";import{T as Ce}from"./TabbedContent.js";import{C as we}from"./CreateToolShell.js";import"./toolSelectors.js";import"./loadTool.js";const Te=K(e.jsx("path",{d:"m12 4-1.41 1.41L16.17 11H4v2h12.17l-5.58 5.59L12 20l8-8z"}),"ArrowForward"),_=K(e.jsx("path",{d:"M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2m1 17h-2v-2h2zm2.07-7.75-.9.92C13.45 12.9 13 13.5 13 15h-2v-.5c0-1.1.45-2.1 1.17-2.83l1.24-1.26c.37-.36.59-.86.59-1.41 0-1.1-.9-2-2-2s-2 .9-2 2H8c0-2.21 1.79-4 4-4s4 1.79 4 4c0 .88-.36 1.68-.93 2.25"}),"Help"),je=["Critical","Strained","Unstable","Stable","Improving","Strong","Thriving"];function ke(){const t=[9,29,49,69,84,99,100],s={data:{},order:[]};s.order=t.map((r,h)=>{const o=q();return s.data[o]={name:je[h],max:r},o});const i={data:{},order:[]},c=q();return i.data[c]={name:"default",value:1},i.order=[c],{id:q(),refId:q(),version:0,name:"",description:"",icon:{...be[0],color:"black",backgroundColor:"#fbf7ef"},balance:{cost:{base:0,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},max:{base:1,perLevel:!0,valuePerLevel:1,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]},health:{base:0,perLevel:!1,valuePerLevel:0,interval:1,scaleToggle:!1,scaleCurve:"linear",valuesPerInterval:[]}},thresholds:s,settlementPointCost:i,isPositive:!0,canHurt:!0,isTradeable:!0,hasThresholds:!0,hasSPC:!0,genre:"",subGenre:"",properties:{data:{canOverflow:!0,isCurrency:!1,requiresUpkeep:!1,canGather:!1},config:{},order:["canOverflow","isCurrency","requiresUpkeep"]},tags:[],isValid:!1,status:"DRAFT",createdBy:""}}const D={name:{label:"Attribute Name",type:"text",tooltip:"The unique name of the attribute. This should clearly convey the attribute's purpose and role within the settlement mechanics.",validateFn:t=>t?t.trim().length<3?"Attribute name must be at least 3 characters long":null:"Attribute name is required",keypath:"name"},costPerLevel:{label:"Currency Cost",type:"number",tooltip:"The amount of currency required per level to acquire this attribute. This cost scales with the settlement's level.",validateFn:t=>t?t<=0?"Cost per level must be greater than 0":null:"Cost per level is required",keypath:"balance.cost.base"},healthPerLevel:{label:"Health Drain",type:"number",tooltip:"This value represents the health damage the settlement takes for each missing unit of this attribute, scaled by settlement level.",validateFn:t=>t==null?"Health per level is required":t<0?"Health per level cannot be negative":null,keypath:"balance.health.base"},maxPerLevel:{label:"Max",type:"number",tooltip:"The maximum number of units of this attribute that can provide benefits to the settlement per level.",validateFn:t=>t===void 0?"Max per level is required":t<0?"Max per level must be 0 or greater":null,keypath:"balance.max.base"},description:{label:"Description",type:"textarea",tooltip:"A brief explanation of the attribute's purpose and impact. This provides essential context for understanding its role in the settlement.",validateFn:t=>t?t.trim().length<30?`Description must be at least 30 characters long. You need ${30-t.length} more characters.`:null:"Description is required",keypath:"description"},healthValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for health per level. This value represents the scaling value per interval based on Health Drain.",validateFn:t=>t==null?"Health per level scale is required":null,keypath:"balance.health.valuePerLevel"},healthIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which health is calculated based on the health drain. This value determines how often the health is updated.",validateFn:t=>t==null?"Health interval per level is required":t<=0?"Health interval per level must be greater than 0":null,keypath:"balance.health.interval"},costValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for cost per level. This value represents the scaling value per interval based on Cost.",validateFn:t=>t==null?"Cost per level scale is required":null,keypath:"balance.cost.valuePerLevel"},costIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which cost is calculated based on the cost per level. This value determines how often the cost is updated.",validateFn:t=>t==null?"Cost interval per level is required":t<=0?"Cost interval per level must be greater than 0":null,keypath:"balance.cost.interval"},maxValuePerLevel:{label:"Change Per Interval",type:"number",tooltip:"The scaling factor for max per level. This value represents the scaling value per interval based on Max.",validateFn:t=>t==null?"Max per level scale is required":null,keypath:"balance.max.valuePerLevel"},maxIntervalPerLevel:{label:"Interval (Every N Levels)",type:"number",tooltip:"The interval at which max is calculated based on the max per level. This value determines how often the max is updated.",validateFn:t=>t==null?"Max interval per level is required":t<=0?"Max interval per level must be greater than 0":null,keypath:"balance.max.interval"}},k=({keypath:t,trueLabel:s="",falseLabel:i="",sx:c={display:"flex",alignItems:"center",justifyContent:"space-between",gap:1,boxSizing:"border-box",transition:"background-color 0.3s ease, border-color 1s ease",borderLeft:"2px solid",pl:2,py:.5,width:"100%",color:"text.primary",borderRadius:0},tooltip:r,disabled:h=!1,onChange:o,falseColor:a="warning",trueColor:m="success",trueThemeKey:f="main",falseThemeKey:n="main",border:v=!0,variant:d="row",buttonType:u="button",heightLock:l=!1})=>{const{tool:p,id:g}=T.useContext(Y),{updateTool:j,selectEditValue:y}=A(p,g),C=y(t),{utils:w}=X(),F=()=>{j(t,!C),typeof o=="function"&&o(!C)};return e.jsxs(Z,{tabIndex:-1,disableFocusRipple:!0,disabled:h,onClick:()=>{u==="button"&&F()},sx:{...c,borderColor:C?w.color(m,f,.5):w.color(a,n,.5),"&:hover":{bgcolor:C?w.color(m,f,.1):w.color(a,n,.1)},borderLeft:v?c==null?void 0:c.borderLeft:"none",flexDirection:d},children:[e.jsx(L,{title:e.jsx(x,{variant:"body2",children:r||`Toggle ${t}`}),placement:"top",arrow:!0,children:e.jsx(x,{variant:"body2",sx:{flexGrow:1,textAlign:"left",textTransform:"uppercase"},children:C?s:i||s})}),e.jsx(J,{id:`${p}-${g}-${t}`,size:"small",color:C?m:a,checked:C===!0,sx:{"& .MuiSwitch-switchBase":{"&.Mui-checked":{color:w.color(m,f,.8)},"&:not(.Mui-checked)":{color:w.color(a,n,.8)}},"& .MuiSwitch-track":{backgroundColor:w.color("info","light",1)}},onClick:()=>{(u="switch")&&F()}})]})},Se=te(ae.div)({}),H=({children:t,show:s=!0,duration:i=.3,sx:c={},onMouseLeave:r=()=>{},onMouseEnter:h=()=>{}})=>e.jsx(ee,{children:s&&e.jsx(Se,{initial:{height:0,opacity:0},animate:{height:"auto",opacity:1},exit:{height:0,opacity:0},transition:{duration:i},style:{overflow:"hidden",marginBottom:"0.5rem"},sx:c,onMouseLeave:r,onMouseEnter:h,children:t})}),Le={linear:"Change Per Interval","slow-exponential":"Base","fast-exponential":"Base",custom:"Change Per Interval"},G=({disabled:t,property:s,fields:i,borderColor:c="honey.main",accentColor:r="info.main"})=>{const{id:h,tool:o}=E(),{edit:a,updateTool:m,selectEditValue:f}=A(o,h),[n,v]=T.useState(!1),d=f(`balance.${s}`);if(!d)return null;const{interval:u,scaleCurve:l,valuesPerInterval:p}=d,g=()=>{const j=a.balance[s],{interval:y,scaleToggle:C,valuesPerInterval:w}=j;if(y<=0)return[];const F={};if(w.forEach(S=>{S&&S.level&&S.value!==void 0&&(F[S.level]=S.value)}),C){const S=Array.from({length:Math.ceil(21/y)},(M,R)=>R*y).slice(1,21).map(M=>({level:M,value:0}));m(`balance.${s}.valuesPerInterval`,S)}else return[]};return T.useEffect(()=>{l==="custom"&&g()},[l,u]),e.jsxs(H,{show:!t,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",border:"1px solid",borderColor:a!=null&&a.balance[s].perLevel?n?r:c:"transparent",transition:"border-color 0.3s ease, padding 0.3s ease",boxSizing:"border-box",p:a.balance[s].perLevel?1:0,borderRadius:2},onMouseEnter:v.bind(null,!0),onMouseLeave:v.bind(null,!1),children:[e.jsx(P,{inputConfig:i[`${s}PerLevel`]}),e.jsx(k,{keypath:`balance.${s}.perLevel`,trueLabel:"Scale",falseLabel:"Flat",tooltip:"Enable to automatically adjust related values when max per level changes.",border:!1,variant:"column-reverse",disabled:t,heightLock:!0}),e.jsxs(H,{show:a==null?void 0:a.balance[s].perLevel,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"5fr 1fr",alignItems:"center",justifyContent:"center"},children:[e.jsx(P,{inputConfig:i[`${s}IntervalPerLevel`],decimals:0,allowZero:!1}),e.jsx(k,{keypath:`balance.${s}.scaleToggle`,trueLabel:"Custom",falseLabel:"Default",variant:"column-reverse",tooltip:"Enable scaling separate from the base value.",border:!1,heightLock:!0}),e.jsxs(H,{show:a==null?void 0:a.balance[s].scaleToggle,sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:"1fr 1fr",gap:2,flexDirection:"column",width:"100%",alignItems:"center",justifyContent:"center"},children:[e.jsx(P,{dynamicLabel:Le[a==null?void 0:a.balance[s].scaleCurve],inputConfig:i[`${s}ValuePerLevel`],style:{width:"100%"},disabled:(a==null?void 0:a.balance[s].scaleCurve)==="custom"}),e.jsx(me,{keypath:`balance.${s}.scaleCurve`,label:"Scale Curve",options:[{value:"linear",name:"Linear"},{value:"slow-exponential",name:"Slow Exponential (^1.5)"},{value:"fast-exponential",name:"Fast Exponential (^2)"},{value:"custom",name:"Per Interval"}],small:!1}),e.jsx(H,{show:(a==null?void 0:a.balance[s].scaleCurve)==="custom",sx:{gridColumn:"span 2",display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)","repeat(4, 1fr)","repeat(5, 1fr)"],gap:1,width:"100%"},children:p.map((j,y)=>e.jsx(P,{inputConfig:{keypath:`balance.${s}.valuesPerInterval.${y}.value`,label:`Level ${j.level}`,type:"number"},style:{width:"100%"}},`${s}-interval-${y}`))})]})]})]})},Ie=({columns:t})=>{const{tool:s,id:i}=T.useContext(Y),{edit:c}=A(s,i),[r,h]=T.useState(!1),[o,a]=T.useState(5),m=n=>{const v=c.balance[n],{base:d,perLevel:u,valuePerLevel:l,interval:p,scaleToggle:g}=v;return g?`Floor(${o} / ${p}) * ${l} + ${d})`:u?`Floor(${o} / ${p}) * ${d})`:`${d}`},f=n=>{const v=c.balance[n],{base:d,perLevel:u,valuePerLevel:l,interval:p,scaleToggle:g,scaleCurve:j,valuesPerInterval:y}=v;if(d===void 0)return"0";switch(g){case!0:{const C=o/p;switch(j){case"linear":return(Math.floor(C)*l+d).toFixed(0);case"slow-exponential":return(Math.pow(C,1.5)*l+d).toFixed(0);case"fast-exponential":return(Math.pow(C,2)*l+d).toFixed(0);case"custom":{if(!(y!=null&&y.length))return d.toFixed(0);const w=Math.floor(C);return w<0||w-1>=y.length?d.toFixed(0):(y.slice(0,w).reduce((M,R)=>M+R.value,0)+d).toFixed(0)}default:return d.toFixed(0)}}case!1:return u?(Math.max(1,Math.floor(o/p))*d).toFixed(0):d.toFixed(0);default:return d.toFixed(0)}};return c?e.jsxs(b,{id:`attr-values-${i}`,sx:{display:"flex",flexDirection:"column",gap:2},children:[e.jsxs(re,{sx:{display:"flex",flexDirection:"row",alignItems:"center",gap:1,height:"100%"},children:[e.jsxs(se,{sx:{display:"flex",alignItems:"center",gap:.5},children:[e.jsx(x,{children:"Autobalance"}),e.jsx(L,{title:"Automatically adjust related values to maintain a balanced configuration.",children:e.jsx(fe,{sx:{fontSize:18,color:"text.secondary",cursor:"pointer"}})})]}),e.jsx(J,{checked:r,onChange:n=>h(n.target.checked)})]}),e.jsxs(b,{sx:{display:"grid",gridTemplateColumns:"5fr 1fr",gridTemplateRows:"auto",alignItems:"center",justifyContent:"start",my:2,width:"100%",position:"relative",gridColumn:"span 3",boxSizing:"border-box"},children:[e.jsx(b,{sx:{gridColumn:"span 2",display:"flex",width:"100%",justifyContent:"center",alignItems:"center"},children:e.jsxs(b,{sx:{display:"flex",flexDirection:"column",width:"100%",boxSizing:"border-box",px:4},children:[e.jsx(ne,{valueLabelDisplay:"auto",color:"secondary",defaultValue:o,value:o,onChange:(n,v)=>{a(v)},min:1,max:20,step:1}),e.jsxs(b,{sx:{display:"flex",flexWrap:"wrap",alignItems:"center",justifyContent:"center",gap:1},children:[e.jsx(x,{variant:"body2",sx:{fontWeight:"bold",width:"100%"},children:`Values at Level ${o}: `}),e.jsx(L,{title:m("max"),children:e.jsxs(x,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"success.main"},children:["Max: ",f("max")]})}),c.canHurt&&e.jsx(L,{title:m("health"),children:e.jsxs(x,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"error.main"},children:["Health: ",f("health")]})}),c.isTradeable&&e.jsx(L,{title:m("cost"),children:e.jsxs(x,{variant:"body2",sx:{fontWeight:"bold",textDecoration:"underline",cursor:"help",color:"honey.main"},children:["Cost: ",f("cost")]})})]})]})}),e.jsx(G,{disabled:!1,property:"max",fields:D,slide:o,setSlide:a,slideLabel:"Max Value",borderColor:"dividerDark"}),e.jsx(G,{disabled:!c.canHurt,property:"health",fields:D,slide:o,setSlide:a,slideLabel:"Total Drain",borderColor:"dividerDark",accentColor:"error.main"}),e.jsx(G,{disabled:!c.isTradeable,property:"cost",fields:D,slide:o,setSlide:a,slideLabel:"Total Cost",borderColor:"dividerDark",accentColor:"honey.main"})]})]}):null},Pe={name:"",tooltip:"",type:"number",validate:t=>t<=-1?"Value must be 0 or greater":null,keypath:""},Ee=({content:t})=>e.jsx(x,{component:"span",children:t.map((s,i)=>s.type==="text"?e.jsx("span",{children:s.value},i):s.type==="strong"?e.jsx("strong",{children:s.value},i):s.type==="tooltip"?e.jsx(L,{title:s.title,arrow:!0,children:e.jsx(x,{component:"span",sx:{textDecoration:"underline",fontWeight:"bold",cursor:"pointer"},onClick:s.onClick,children:s.value})},i):null)}),Ae=[{name:"Fortified",description:"Fortified Settlements put their trust in theirs walls, preemptive reconnaissance, and well-trained troops.",id:"789"},{name:"Mercantile",description:"Mercantile Settlements focus on establishing and expanding trade, developing vibrant culture, and welcoming artisans.",id:"456"},{name:"Survivalist",description:"Survivalists focus on gathering food, supplies, medical items, and constructing durable shelters.",id:"123"}],Fe=[{type:"text",value:"Define the "},{type:"tooltip",title:"Settlements earn 1 settlement point per level per turn, barring other boons or banes. Click for more information.",value:"Settlement Point Cost",onClick:()=>console.log("open SPC help panel")},{type:"text",value:" of this attribute per Settlement Type. A value of "},{type:"strong",value:"0"},{type:"text",value:" means this cannot be purchased with settlement points for that settlement type."}],De=()=>{const{tool:t,id:s}=E(),{data:i,order:c,errors:r,add:h,remove:o}=ge(t,s,"settlementPointCost"),[a,m]=T.useState(null),[f,n]=T.useState(""),v=T.useMemo(()=>{const u=Object.keys(i||{}).reduce((p,g)=>(p.push(g),p),[]);return Ae.filter(p=>!u.includes(p.id))},[i]),d=T.useMemo(()=>Object.entries(i||{}).map(([u,l])=>{const p=l;return{...Pe,name:p.name,label:p.name.charAt(0).toUpperCase()+p.name.slice(1),tooltip:void 0,id:u,keypath:`settlementPointCost.data.${u}.value`}}),[i]);return c?e.jsxs(b,{sx:{display:"grid",gridTemplateColumns:"1fr 0.1fr 1fr",gap:2},children:[e.jsx(b,{sx:{gridColumn:"span 3",p:2},children:e.jsx(Ee,{content:Fe})}),e.jsx(b,{sx:{display:"flex",alignItems:"start",width:"100%"},children:e.jsx(ie,{inputValue:f,options:v,getOptionLabel:u=>u.name,renderInput:u=>e.jsx(le,{...u,label:"Settlement Type",variant:"outlined",error:!!(r!=null&&r.name),helperText:r==null?void 0:r.name,onChange:l=>{n(l.target.value)},onKeyDown:l=>{l.key==="Enter"&&(h({id:a.id,entry:{name:a.name,value:1},sort:!1}),n(""))}}),onChange:(u,l)=>{m(l),n((l==null?void 0:l.name)||"")},renderOption:(u,l)=>T.createElement(b,{...u,component:"li",key:l.name,sx:{display:"flex",alignItems:"center"}},e.jsx(L,{title:e.jsx(x,{children:l.description}),placement:"left",arrow:!0,children:e.jsx(x,{children:l.name})})),sx:{my:2,width:"100%"}})}),e.jsx(I,{orientation:"vertical",flexItem:!0,children:e.jsx(oe,{label:e.jsx(Te,{}),onClick:()=>{h({id:a.id,entry:{name:a.name,value:1},sort:!1}),n("")},sx:{width:"100%",color:"white"}})}),e.jsx(b,{children:c.map((u,l)=>{const p=d.find(g=>g.id===u);return p?e.jsx(ce.Fragment,{children:e.jsx(P,{inputConfig:p,style:{width:"100%",m:0,p:0},shrink:!0,onMoreDetails:p.name!=="default"?()=>{}:void 0,onRemove:p.name!=="default"?()=>o(u):void 0})},u):null})})]}):e.jsx(b,{children:"Loading..."})},Me={propertiesExpanded:!0,editTabs:{Properties:{name:"Properties",disabled:!1},Values:{name:"Values",disabled:!1},SPC:{name:"SPC",disabled:!1},Thresholds:{name:"Thresholds",disabled:!1},Currency:{name:"Currency",disabled:!0},Gather:{name:"Gather",disabled:!0},Upkeep:{name:"Upkeep",disabled:!0}},activeTab:"Properties",lastTab:null,activeIndex:0,lastIndex:0};function qe(t,s){switch(s.type){case"TOGGLE_PROPERTIES":return{...t,propertiesExpanded:!t.propertiesExpanded};case"SET_ACTIVE_TAB":const{name:i,index:c,defaultLast:r}=s.payload;return{...t,lastIndex:r?0:t.activeIndex,lastTab:r?"Values":t.activeTab,activeTab:i,activeIndex:c};case"SET_TAB_DISABLED":{const{property:h,disabled:o}=s.payload;return{...t,editTabs:{...t.editTabs,[h]:{...t.editTabs[h],disabled:o}}}}default:return t}}const O=(t,s,i)=>({type:"SET_ACTIVE_TAB",payload:{name:t,index:s,defaultLast:i}}),$e=(t,s)=>({type:"SET_TAB_DISABLED",payload:{property:t,disabled:s}}),He=({columns:t})=>{var m,f,n,v;const s=U(),{tool:i,id:c,showModal:r,tabId:h,side:o}=E(),{edit:a}=A(i,c);return T.useEffect(()=>{a!=null&&a.name&&(s(B({tabId:h,side:o,keypath:"name",updates:(a==null?void 0:a.name.trim().length)>0?a==null?void 0:a.name.trim():"Untitled"})),s(B({tabId:h,side:o,keypath:"viewState.isDirty",updates:!0})))},[a==null?void 0:a.name,s,h,o]),e.jsxs(e.Fragment,{children:[e.jsxs(b,{sx:{gridColumn:`span ${t}`,display:"flex",alignItems:"center",gap:2},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"space-around",flexGrow:1},children:[e.jsx(x,{variant:"h6",children:"Icon:"}),e.jsx(Q,{viewBox:((m=a==null?void 0:a.icon)==null?void 0:m.viewBox)||"0 0 664 512",path:((f=a==null?void 0:a.icon)==null?void 0:f.d)||"",size:24,color:((n=a==null?void 0:a.icon)==null?void 0:n.color)||"primary",backgroundColor:((v=a==null?void 0:a.icon)==null?void 0:v.backgroundColor)||"background.paper",onClick:()=>{r({entry:{componentKey:"IconSelector",props:{tool:i,id:c,tabId:h,side:o},id:"icon-selector"}})}})]}),e.jsx(P,{inputConfig:D.name,style:{flexGrow:2,flexShrink:1,px:1}})]}),e.jsx(P,{inputConfig:D.description,style:{gridColumn:`span ${t}`,px:1},multiline:!0})]})},Re={flammable:{enabled:!1,tooltip:"Vulnerable to fire.",eventTags:[{name:"Fire",description:"Events which involve fire or burning.",weight:1},{name:"Arson",description:"Events which involve intentional fire damage.",weight:.75}]},durable:{enabled:!1,tooltip:"Resistant to damage or wear.",eventTags:[{name:"Infrastructure",description:"Events which affect the durability of structures or resources.",weight:1},{name:"Maintenance",description:"Events which require upkeep or repair of structures or resources.",weight:1}]},perishable:{enabled:!1,tooltip:"Degrades over time without proper storage.",eventTags:[{name:"Famine",description:"A shortage of food or other perishable resources consumed for survival.",weight:1},{name:"Spoilage",description:"A loss of resources due to improper storage or handling.",weight:1}]},valuable:{enabled:!1,tooltip:"High worth; a frequent target for theft or trade.",eventTags:[{name:"Theft",description:"Events which involve the loss of valuable resources.",weight:1},{name:"Trade",description:"Events which involve the exchange of valuable resources.",weight:1}]},renewable:{enabled:!1,tooltip:"Can replenish naturally over time.",eventTags:[{name:"Harvest",description:"Events which involve the collection of renewable resources.",weight:1},{name:"Replanting",description:"Events which involve the restoration of renewable resources.",weight:1}]},scarce:{enabled:!1,tooltip:"Difficult to obtain or maintain in this region.",eventTags:[{name:"Scarcity",description:"Events which involve a shortage of scarce resources.",weight:1},{name:"Rationing",description:"Events which involve the controlled distribution of scarce resources.",weight:1},{name:"Surplus",description:"Events which involve an excess of scarce resources.",weight:.5}]},agricultural:{enabled:!1,tooltip:"Tied to farming or rural industries.",eventTags:[{name:"Harvest",description:"Events which involve the collection of agricultural resources.",weight:1},{name:"Planting",description:"Events which involve the cultivation of agricultural resources.",weight:1}]},industrial:{enabled:!1,tooltip:"Related to manufacturing or heavy labor.",eventTags:[{name:"Industrial Accident",description:"Events which involve the loss of life or resources due to industrial activity.",weight:1},{name:"Labor Shortage",description:"Events which involve a lack of ready or willing workers",weight:1}]},arcane:{enabled:!1,tooltip:"Linked to magic or the supernatural.",eventTags:[{name:"Magic",description:"Events which involve the use of arcane resources.",weight:1},{name:"Curses",description:"Events which involve the misuse or backlash of arcane resources.",weight:1}]},religious:{enabled:!1,tooltip:"A resource important to faith or rituals.",eventTags:[{name:"Religious Ceremony",description:"Events which involve the use of religious resources.",weight:1},{name:"Sacrifice",description:"Events which involve the loss of religious resources.",weight:1}]},exotic:{enabled:!1,tooltip:"Uncommon or unique to the region.",eventTags:[{name:"Exotic Trade",description:"Events which involve the exchange of rare or unique resources.",weight:1},{name:"Discovery",description:"Events which involve the identification of rare or unique resources.",weight:1}]},edible:{enabled:!1,tooltip:"Can be consumed for survival.",eventTags:[{name:"Feast",description:"Events which involve the consumption of edible resources.",weight:1},{name:"Famine",description:"A shortage of food or other perishable resources consumed for survival.",weight:1},{name:"Plague",description:"Events which involve the spread of disease.",weight:1}]},toxic:{enabled:!1,tooltip:"Harmful if improperly handled or consumed.",eventTags:[{name:"Poisoning",description:"Events which involve the harmful effects of toxic resources.",weight:1},{name:"Contamination",description:"Events which involve the spread of toxic resources.",weight:1}]},strategic:{enabled:!1,tooltip:"Important in warfare or diplomacy.",eventTags:[{name:"War",description:"Events which involve the use of strategic resources.",weight:1},{name:"Diplomacy",description:"Events which involve the use of strategic resources.",weight:1}]},contested:{enabled:!1,tooltip:"Frequently the focus of disputes or events.",eventTags:[{name:"Conflict",description:"Events which involve the use of contested resources.",weight:1},{name:"Dispute",description:"Events which involve the use of contested resources.",weight:1}]}},Ge=()=>{const[t,s]=T.useState(Re);return e.jsx(b,{sx:{padding:2,boxShadow:4,borderRadius:4,backgroundColor:"background.default",mt:3},children:"I'll be tags one day!"})},Be={isTradeable:{disables:["properties.data.isCurrency"]},"properties.data.isCurrency":{disables:["properties.data.requiresUpkeep","isTradeable"],enables:["properties.data.canOverflow"]},"properties.data.requiresUpkeep":{disables:["properties.data.isCurrency","properties.data.canHarvest"]},"properties.data.canGather":{disables:["properties.data.requiresUpkeep"]}},Oe={hasThresholds:{key:"Thresholds",value:!0},hasSPC:{key:"SPC",value:!0},"properties.data.isCurrency":{key:"Currency",value:!1},"properties.data.requiresUpkeep":{key:"Upkeep",value:!1},"properties.data.canGather":{key:"Gather",value:!1}},Ue=({columns:t,activeTab:s,lastTab:i,lastIndex:c,localDispatch:r})=>{const{tool:h,id:o,showModal:a,tabId:m,side:f}=E(),{edit:n,updateTool:v}=A(h,o),{makeSnackbar:d}=de(),u=(l,p)=>{var y,C;const g=Be[l],j=Oe[l];j&&(s===j.key&&!p&&r(O(i,c,!0)),r($e(j.key,!p))),g&&p&&((y=g.disables)==null||y.forEach(w=>{v(w,!1)}),g!=null&&g.enables&&((C=g==null?void 0:g.enables)==null||C.forEach(w=>{v(w,!0)})))};return console.log(n),n?e.jsxs(e.Fragment,{children:[e.jsx(He,{columns:t}),e.jsx(b,{sx:{gridColumn:`span ${t}`},children:e.jsx(ue,{defaultGenre:n.genre,defaultSubGenre:n.subGenre,updateFn:v})}),e.jsxs(b,{sx:{gridColumn:`span ${t}`,display:"grid",gridTemplateColumns:["1fr","1fr",`repeat(${t}, 1fr)`],gap:2},children:[e.jsxs(b,{children:[e.jsxs(I,{children:["Major Properties"," ",e.jsx(V,{size:"small",children:e.jsx(_,{})})]}),e.jsx(k,{keypath:"isPositive",trueLabel:"Is Positive",falseLabel:"Is Negative",falseColor:"error",tooltip:"Toggle if this attribute is positive or negative. A positive attribute is beneficial, while a negative attribute is detrimental."}),e.jsx(k,{keypath:"canHurt",trueLabel:"Can Hurt",falseLabel:"Cannot Hurt",tooltip:"Toggle if this attribute can affect health."}),e.jsx(k,{keypath:"isTradeable",trueLabel:"Can Trade",falseLabel:"Cannot Trade",tooltip:"Toggle if this attribute can be traded. This forces a baseline cost, and allows it to be added to Trading Hubs. Tradeable attributes cannot be currency.",disabled:n==null?void 0:n.properties.data.isCurrency}),e.jsx(k,{keypath:"hasThresholds",trueLabel:"Thresholds",falseLabel:"No Thresholds",tooltip:"Toggle if this attribute has unique thresholds. If disabled, default thresholds will be used internally.",onChange:()=>{u("hasThresholds",!n.hasThresholds),n.hasThresholds&&d({message:"Default thresholds will be used.",type:"info",duration:3e3})}}),e.jsx(k,{keypath:"hasSPC",trueLabel:"Settlement Points",falseLabel:"No Settlement Points",tooltip:"Toggle if this attribute can be acquired through settlement points.",onChange:()=>{u("hasSPC",!n.hasSPC)}})]}),e.jsxs(b,{children:[e.jsxs(I,{children:["Minor Properties"," ",e.jsx(V,{size:"small",children:e.jsx(_,{})})]}),e.jsx(k,{keypath:"properties.data.canOverflow",trueLabel:"Can Overflow",falseLabel:"Cannot Overflow",tooltip:"Toggle if this attribute can overflow. Overflowing attributes can exceed their maximum value, but overages will not be counted towards calculations.",disabled:n==null?void 0:n.properties.data.isCurrency}),e.jsx(k,{keypath:"properties.data.isCurrency",trueLabel:"Is Currency",falseLabel:"Not Currency",tooltip:"Toggle if this attribute is treated as currency. This removes any cap on the attribute's value and allows it to integrate with the Tax System, among other things.",disabled:(n==null?void 0:n.isTradeable)||(n==null?void 0:n.properties.data.requiresUpkeep),onChange:l=>{u("properties.data.isCurrency",l),l&&n.properties.data.canGather&&d({message:"Currency attributes are rarely harvestable. Be sure this makes sense in your world!",type:"warning",duration:5e3})}}),e.jsx(k,{keypath:"properties.data.requiresUpkeep",trueLabel:"Requires Upkeep",falseLabel:"No Upkeep Required",tooltip:"Toggle if this attribute requires upkeep. This will add an upkeep cost to the attribute, which must be paid with a currency to keep it active.",disabled:(n==null?void 0:n.properties.data.isCurrency)||(n==null?void 0:n.properties.data.canGather),onChange:l=>{u("properties.data.requiresUpkeep",l)}}),e.jsx(k,{keypath:"properties.data.canGather",trueLabel:"Can Gather",falseLabel:"Cannot Gather",tooltip:"Toggle if this attribute can be acquired by assigning other attributes, e.g. 'Productivity', to it.",disabled:n==null?void 0:n.properties.data.requiresUpkeep,onChange:l=>{u("properties.data.canGather",l),l&&n.properties.data.isCurrency&&d({message:"Harvestable attributes are rarely currency. Be sure this makes sense in your world!",type:"warning",duration:5e3})}})]})]}),e.jsx(Ge,{})]}):null};function Ve({id:t,tool:s,tabId:i,side:c}){return async(r,h)=>{var n,v;const o=h(),a=N.cloneDeep(o.tools[s].edit.byId[t]),m=Object.keys(((v=(n=o.tabs[c].data[i])==null?void 0:n.viewState)==null?void 0:v.dirtyKeypaths)||{});if(m.length===0)return;const f={};m.forEach(d=>{const u=d.split(".").shift();f[u]=N.get(a,u)}),r(z({tool:s,id:t,updates:{...f,version:1}}));try{a.version===0?await W.saveTool({id:t,tool:s,data:{...a,version:1}}):await W.saveTool({id:t,tool:s,data:{...f}})}catch(d){console.error("Error during batch update:",d),r(he({message:`Failed to batch update ${a.name}. Please try again.`,type:"error",duration:5e3})),r(z({tool:s,id:t,updates:{...a}}))}}}function Ne({tool:t,id:s,tabId:i,side:c,name:r}){const h=U();return{name:r,batchSaveFn:async()=>{h(Ve({id:s,side:c,tabId:i,tool:t}))},intervalMs:6e4}}const ze={Properties:Ue,Values:Ie,SPC:De,Thresholds:xe,Currency:()=>e.jsx(b,{children:"Currency Component"}),Gather:()=>e.jsx(b,{children:"Gather Component"}),Upkeep:()=>e.jsx(b,{children:"Upkeep Component"})},We=()=>{const{tab:t,id:s}=E(),{both:i}=pe(),c=U(),[r,h]=T.useReducer(qe,t.viewState.editAttr||Me),{activeTab:o,editTabs:a,lastIndex:m}=r;ve(Ne({name:t.name,tool:"attribute",id:s,tabId:t.tabId,side:t.side})),T.useEffect(()=>{t.lastTab&&t.lastIndex&&h(O(t.lastTab,t.lastIndex))},[]),T.useEffect(()=>()=>{c(B({tabId:t.tabId,keypath:"viewState.editAttr",updates:{...r}}))},[r]);const f=i?1:2,n=(v,d)=>{h(O(v,d))};return e.jsx(b,{id:`edit-attribute-${t.id}`,sx:{height:"100%",transition:"height 0.4s ease-in-out",overflow:"auto",width:"100%",px:2,boxSizing:"border-box"},children:e.jsx(Ce,{tabs:Object.values(a).map(v=>({...v,key:v.name,disabled:v.disabled||!1,props:{localDispatch:h}})),componentMap:ze,activeTab:o,handleTabClick:n,columns:f,lastIndex:m})})},_e=()=>{var h,o,a,m,f,n,v,d,u,l;const{tool:t,id:s,mode:i,side:c}=E(),{current:r}=A("attribute",s);return e.jsxs(b,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridTemplateRows:"auto",alignItems:"start",justifyContent:"center",mt:2,gap:2,width:"100%",position:"relative",pb:4},children:[e.jsxs(b,{sx:{display:"flex",alignItems:"center",justifyContent:"center",gap:1,height:"88px",flexGrow:1,flexShrink:2},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:"bold",fontSize:"1.25rem"},children:"Icon"}),e.jsx(Z,{sx:{boxShadow:4,borderRadius:"50%",height:64,width:64},disabled:!0,children:e.jsx(Q,{viewBox:((h=r==null?void 0:r.icon)==null?void 0:h.viewBox)||"0 0 664 512",path:((o=r==null?void 0:r.icon)==null?void 0:o.d)||"",size:24,color:((a=r==null?void 0:r.icon)==null?void 0:a.color)||"primary",backgroundColor:((m=r==null?void 0:r.icon)==null?void 0:m.backgroundColor)||"background.paper"})})]}),e.jsxs(b,{sx:{gridColumn:"span 2",display:"flex",gap:2,alignItems:"center",justifyContent:"start",height:"100%"},children:[e.jsx(x,{variant:"h6",children:"Name:"}),e.jsx(x,{children:(r==null?void 0:r.name)||"None"})]}),e.jsx(I,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"DESCRIPTION"}),e.jsxs(b,{sx:{gridColumn:"span 3",display:"flex",flexDirection:"column",gap:2,alignItems:"start",justifyContent:"center"},children:[e.jsx(x,{sx:{textAlign:"start"},variant:"body1",children:(r==null?void 0:r.description)||"No description"}),e.jsxs(b,{sx:{gridColumn:"span 3",display:"flex",gap:2,alignItems:"center",justifyContent:"center"},children:[e.jsx(x,{variant:"body1",sx:{fontWeight:"bold"},children:"Type:"}),e.jsx(x,{variant:"body1",children:r!=null&&r.isPositive?"Positive":"Negative"})]})]}),e.jsxs(I,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:[" ","SCALING PER LEVEL"," "]}),e.jsxs(b,{sx:{display:"grid",gridTemplateColumns:["1fr","1fr 1fr","repeat(3, 1fr)"],gridColumn:"span 3",columnGap:2},children:[e.jsx($,{name:"Max",value:(n=(f=r==null?void 0:r.balance)==null?void 0:f.max)==null?void 0:n.base,even:!1}),e.jsx($,{name:"Health",value:(d=(v=r==null?void 0:r.balance)==null?void 0:v.health)==null?void 0:d.base,even:!0}),e.jsx($,{name:"Cost",value:(l=(u=r==null?void 0:r.balance)==null?void 0:u.cost)==null?void 0:l.base,even:!1})]}),e.jsx(I,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"SETTLEMENT POINT COSTS"}),r.settlementPointCost.order.map((p,g)=>e.jsx($,{name:r.settlementPointCost.data[p].name,value:r.settlementPointCost.data[p].value,even:g%2===0},p)),e.jsx(I,{sx:{gridColumn:"span 3",borderColor:"#ccc",fontWeight:"bold"},children:"THRESHOLDS"}),e.jsx(ye,{data:r.thresholds.data,order:r.thresholds.order})]})},Ke=[{keypath:"name",label:"Name"},{keypath:"description",label:"Description"},{keypath:"balance.maxPerLevel",label:"Max Per Level"},{keypath:"balance.healthPerLevel",label:"Health Per Level"},{keypath:"balance.costPerLevel",label:"Cost Per Level"},{keypath:"settlementPointCost.data",label:"Settlement Point Cost",type:"group"},{keypath:"thresholds.data",label:"Thresholds",type:"group"}],Ye=["name","description","balance","thresholds","settlementPointCost"],ot=({tab:t})=>e.jsx(we,{tab:t,initializeTool:ke,validationFields:Ye,editComponent:We,previewComponent:_e,checklistContent:Ke});export{ot as default,Ye as validationFields};
